{% assign maxRelated = 5 %}
{% assign minCommonTags =  1 %}
{% assign maxRelatedCounter = 0 %}
{% assign haveRelatedPosts = false %}

{% for post in site.posts %}
  {% assign sameTagCount = 0 %}

  {% for tag in post.tags %}
    {% if post.url != page.url %}
      {% if page.tags contains tag %}
        {% assign sameTagCount = sameTagCount | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% if sameTagCount >= minCommonTags %}
    {% unless haveRelatedPosts %}
      {% assign haveRelatedPosts = true %}

  <br>
  <hr>
  <br>
  <ul class="list-disc pl-8"></ul>

  <!-- Adds related posts to the end of an article -->
  <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2>
  <p class="mb-2">Here are some more articles you might like to read next:</p>
    {% endunless %}

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a>
  </li>

  {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}

  {% if maxRelatedCounter >= maxRelated %}
    {% break %}
  {% endif %}

  {% endif %}
{% endfor %}

{% if maxRelatedCounter > 0 %}
</ul>
{% endif %}