var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._goldName="treasureIcon",t._scale=1,t._listenName="listenIcon",t._listenNum=-1,t._boo=!0,t.isMove=!1,t}return __extends(i,e),i.prototype.GetCardWidth=function(){return i.CardWidth},i.prototype.GetCardHeight=function(){return i.CardHeight},Object.defineProperty(i.prototype,"scale",{set:function(t){this._scale=t},enumerable:!0,configurable:!0}),i.prototype.initUI=function(){},i.prototype.showCard=function(){var e=t.GameConst.cardStylePer+this._cardName;this._card?this._card.texture=t.ResUtil.createTexture(e):this._card=t.ResUtil.createBitmapByName(e),this.addChildAt(this._card,0),this._card.scaleX=this._card.scaleY=this._scale,this.data&&(this.isGold=t.GameData.getInstance().isGoldenCard(this._data)),-1!=this._listenNum&&this.setListenData(this._listenNum)},i.prototype.setNameTxt=function(){this._nameTxt&&(uniLib.DisplayUtils.removeFromParent(this._nameTxt),this._nameTxt=null),t.RoomInfo.getInstance().GM_Mode&&(this._nameTxt=uniLib.DisplayUtils.createTextLabel(0,egret.HorizontalAlign.LEFT,""+this._data,12,50,15),this.addChild(this._nameTxt))},Object.defineProperty(i.prototype,"isGold",{set:function(e){e&&t.GameVc.isResult?this.showGoldIcon():this._goldIcon&&(this._goldIcon.visible=!1)},enumerable:!0,configurable:!0}),i.prototype.showGoldIcon=function(){this._goldIcon?(this._goldIcon.scaleX=this._goldIcon.scaleY=this._scale,this._goldIcon.visible=!0):(this._goldIcon=t.ResUtil.createBitmapByName(this._goldName),this._goldIcon.scaleX=this._goldIcon.scaleY=this._scale),"GoldIcon2"==this._goldName&&(this._goldIcon.y=-2),this.addChild(this._goldIcon)},i.prototype.showListenIcon=function(){this._listenIcon?this._listenIcon.visible=!0:(this._listenIcon=uniLib.DisplayUtils.createBitmapByName(this._listenName),this._listenIcon.x=(this._card.width-this._listenIcon.width)/2*t.GameConst.scaleFactor,this._listenIcon.y=-5,this.addChild(this._listenIcon),this.flash())},i.prototype.hideListenIcon=function(t){void 0===t&&(t=!1),t?this.stopTimer():this._listenIcon&&(this._listenIcon.visible=!1)},i.prototype.flash=function(){this._listenIcon&&egret.Tween.get(this._listenIcon,{loop:!0}).to({y:this._listenIcon.y-10},800).to({y:this._listenIcon.y},800)},i.prototype.stopTimer=function(){this._listenIcon&&(egret.Tween.removeTweens(this._listenIcon),uniLib.DisplayUtils.removeFromParent(this._listenIcon)),this._listenIcon=null},i.prototype.setListenData=function(t,e){void 0===e&&(e=!1),this._listenNumIcon||(1e3==t?this._listenNumIcon=uniLib.DisplayUtils.createBitmapByName("listenNum_All"):this._listenNumIcon=uniLib.DisplayUtils.createBitmapByName("listenNum_"+t)),e&&this._listenNumIcon&&(this._listenNumIcon=uniLib.DisplayUtils.createBitmapByName("listenNum_"+t)),this._listenNumIcon.y=50,1e3==t?this._listenNumIcon.x=-8:this._listenNumIcon.x=5,this.addChild(this._listenNumIcon)},Object.defineProperty(i.prototype,"card",{get:function(){return this._card},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"listenNum",{get:function(){return this._listenNum},set:function(t){this._listenNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cardName",{get:function(){return this._cardName},set:function(t){this._cardName=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"goldName",{set:function(t){this._goldName=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"select",{set:function(t){t&&!this.isMove&&0==this.card.y?(this.isMove=!0,egret.Tween.get(this.card).to({y:this.card.y-Math.floor(1*i.CardHeight/5)},50).call(this.finish,this,[this.card]),this._goldIcon&&egret.Tween.get(this._goldIcon).to({y:this._goldIcon.y-Math.floor(1*i.CardHeight/5)},50).call(this.finishGold,this,[this._goldIcon])):(egret.Tween.get(this.card).to({y:0},50).call(this.finish,this,[this.card]),this._goldIcon&&egret.Tween.get(this._goldIcon).to({y:0},50).call(this.finishGold,this,[this._goldIcon]))},enumerable:!0,configurable:!0}),i.prototype.setInitY=function(){this.card&&(egret.Tween.removeTweens(this.card),this.card.y=0),this._goldIcon&&(egret.Tween.removeTweens(this._goldIcon),this._goldIcon.y=0)},i.prototype.finish=function(t){egret.Tween.removeTweens(t),this.isMove=!1},i.prototype.finishGold=function(t){egret.Tween.removeTweens(t)},i.prototype.destory=function(){this._listenIcon&&egret.Tween.removeTweens(this._listenIcon),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._data=null,this._card=null,this._goldIcon=null,this._listenIcon=null,this._listenNumIcon=null},i}(t.BaseVc);e.CardWidth=78,e.CardHeight=135,t.CardMJ=e,__reflect(e.prototype,"game.CardMJ")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._curIndex=0,t._drawIndex=13,t.sendCardMcPointArr=[new egret.Point(200,500),new egret.Point(1e3,500),new egret.Point(1e3,100),new egret.Point(200,100)],t.seatCardPointArr=[[t.sendCardMcPointArr[0],t.sendCardMcPointArr[2]],[t.sendCardMcPointArr[0],t.sendCardMcPointArr[1],t.sendCardMcPointArr[3]],[t.sendCardMcPointArr[0],t.sendCardMcPointArr[1],t.sendCardMcPointArr[2],t.sendCardMcPointArr[3]]],t.cacheAsBitmap=!0,t}return __extends(i,e),i.prototype.initUI=function(){this.curIndex=0,this._cardsBitArr=[],this._handCardsArr=[],this.outPutCards=new t.OutPutCards,this.addChild(this.outPutCards),this._handsCard=new egret.DisplayObjectContainer,this.addChild(this._handsCard),this._displayCardsMc=new egret.DisplayObjectContainer,this._displayCardsMc.touchEnabled=!1,this._displayCardsMc.touchChildren=!1,this.addChild(this._displayCardsMc),this._otherHandMc=new egret.DisplayObjectContainer,this.addChild(this._otherHandMc),this._tempPanel=new egret.Sprite,this.addChild(this._tempPanel)},Object.defineProperty(i.prototype,"defaultPoint",{get:function(){return this._defaultPoint},set:function(t){this._defaultPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayCardsMc",{get:function(){return this._displayCardsMc},enumerable:!0,configurable:!0}),i.prototype.initOutPutCards=function(){},Object.defineProperty(i.prototype,"curIndex",{get:function(){return this._curIndex},set:function(t){this._curIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"handsCard",{get:function(){return this._handsCard},enumerable:!0,configurable:!0}),i.prototype.getSendPos=function(t){var e=new egret.Point;return e.x=this.initPoint.x+t*Math.round(this.stepX),e.y=this.initPoint.y+t*Math.round(this.stepY),e},Object.defineProperty(i.prototype,"stepX",{get:function(){return this._stepX},set:function(t){this._stepX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stepY",{get:function(){return this._stepY},set:function(t){this._stepY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"userSeat",{get:function(){return this._userSeat},set:function(t){this._userSeat=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"handCardsArr",{get:function(){return this._handCardsArr},set:function(t){this._handCardsArr=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayPos",{get:function(){return this._displayPos},set:function(t){this._displayPos=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"drawIndex",{get:function(){return this._drawIndex},enumerable:!0,configurable:!0}),i.prototype.groupingSendCards=function(){for(var e=0;e<this._handsCard.numChildren;e++)this._handsCard.getChildAt(e).visible=!1;for(var i=this,n=function(e){uniLib.SetUniEventTimeout(s,function(){for(var e=t.RoomInfo.getInstance().playerNumber,n=i.seatCardPointArr[e-2],s=100,a=function(e){s+=60;var a=t.GameConst.cardStylePer+"cardheap1",o=t.ResUtil.createBitmapByName(a);i.addChild(o),o.x=uniLib.Global.screenWidth/2-o.width/2,o.y=uniLib.Global.screenHeight/2-o.height/2-35,egret.Tween.get(o).wait(s).to({x:n[e].x,y:n[e].y},200).call(function(){o&&o.parent&&o.parent.removeChild(o)})},o=0;o<n.length;o++)a(o)},500*e,1,s,null),uniLib.SetUniEventTimeout(s,function(){for(var t=4*e;4*(e+1)-1>=t;t++)t<=i._handsCard.numChildren-1&&(i._handsCard.getChildAt(t).visible=!0);uniLib.SoundMgr.instance.playSound("DealSound_mp3")},500*(e+1),1,s,null)},s=this,e=0;4>e;e++)n(e)},i.prototype.showUserHandCard=function(e,i,n){if(void 0===n&&(n=!1),0!=e&&(t.RoomInfo.getInstance().GM_Mode||n)&&i&&!(i.length<=0)){uniLib.DisplayUtils.removeAllChildren(this._handsCard);for(var s,a=this._handsCard.numChildren+this._curIndex,o=0;o<i.length;o++)s=new t.OutPutCard,s.setCard(e,i[o],1,!1),s.name="card"+(a+o),s.x=Math.round(this.initPoint.x+(a+o)*this.stepX),s.y=Math.round(this.initPoint.y+(a+o)*this.stepY),a+o==13&&(s.x+=this.takeCardStepX,s.y+=this.takeCardStepY),this.stepY<0?this._handsCard.addChildAt(s,0):this._handsCard.addChild(s);t.CardInfo.getInstance().getHandCardBySeat(e);this.sendCards(t.CardInfo.getInstance().userHandCount[e]-i.length)}},i.prototype.sendCards=function(e){if(0!=this.userSeat){if(!this._handsCard)return;if(this._handsCard.numChildren>14)return;for(var i,n=this._handsCard.numChildren+this._curIndex,s=0;e>s;s++){if(this._cardsBitArr[n+s])i=this._cardsBitArr[n+s];else{var a=t.GameConst.cardStylePer+"BackCard"+this.userSeat;i=t.ResUtil.createBitmapByName(a),this._cardsBitArr[n+s]=i}i.name="card"+(n+s),i.x=Math.round(this.initPoint.x+(n+s)*this.stepX),i.y=Math.round(this.initPoint.y+(n+s)*this.stepY),n+s==13&&(i.x+=this.takeCardStepX,i.y+=this.takeCardStepY),this.stepY<0?this._handsCard.addChildAt(i,0):this._handsCard.addChild(i)}}},i.prototype.sortCard=function(){},i.prototype.fillFlower=function(e,i){if(t.RoomInfo.getInstance().GM_Mode){var n=t.CardInfo.getInstance().getHandCardBySeat(e);this.showUserHandCard(e,n)}this.outPutCards.fillFlower(i)},i.prototype.setEnable=function(t){},i.prototype.addCard=function(t){if(this._handCardsArr||(this._handCardsArr=[]),this._handCardsArr.length<14){var e;e=t&&t.thisId?t.thisId:0,this._handCardsArr.push(e)}},i.prototype.doDraw=function(e){if(void 0===e&&(e=null),0==this.userSeat||t.RoomInfo.getInstance().GM_Mode){if(0!=this.userSeat&&t.RoomInfo.getInstance().GM_Mode){var i=e;this.showDrawCard(i)}}else this.addDrawCard()},i.prototype.addDrawCard=function(){var e;if(this._cardsBitArr[this._drawIndex])e=this._cardsBitArr[this._drawIndex];else{var i=t.GameConst.cardStylePer+"BackCard"+this.userSeat;e=t.ResUtil.createBitmapByName(i),this._cardsBitArr[this._drawIndex]=e}e.name="card"+this._drawIndex,e.x=this.initPoint.x+this._drawIndex*this.stepX+this.takeCardStepX,e.y=this.initPoint.y+this._drawIndex*this.stepY+this.takeCardStepY,this.stepY<0?this.handsCard.addChildAt(e,0):this.handsCard.addChild(e)},i.prototype.showDrawCard=function(e){var i,n=table.TableCard.resPutOut(e,this.userSeat);i=t.ResUtil.createBitmapByName(n),this._cardsBitArr[this._drawIndex]=i,i.name="card"+this._drawIndex,i.x=this.initPoint.x+this._drawIndex*this.stepX+this.takeCardStepX,i.y=this.initPoint.y+this._drawIndex*this.stepY+this.takeCardStepY,this.stepY<0?this.handsCard.addChildAt(i,0):this.handsCard.addChild(i)},i.prototype.doDiscard=function(e,i){var n;if(this._cardsBitArr[this._drawIndex]&&this._cardsBitArr[this._drawIndex].parent&&0!=this.userSeat&&(n=new egret.Point(this._cardsBitArr[this._drawIndex].x,this._cardsBitArr[this._drawIndex].y),this._cardsBitArr[this._drawIndex].parent.removeChild(this._cardsBitArr[this._drawIndex])),this.sortCard(),this.outPutCards.showOutPutCard(e),0!=this.userSeat){var s=table.TableCard.resNormal(e);this._tempCard&&egret.Tween.removeTweens(this._tempCard),this._tempCard=t.ResUtil.createBitmapByName(s),this._tempCard.x=t.GameData.getInstance().TempeLocation[i][0],this._tempCard.y=t.GameData.getInstance().TempeLocation[i][1],this._tempPanel.addChild(this._tempCard)}else{var a=this.outPutCards.getNextOutPutPos();if(!a||null==n)return;this._discardEffect||(this._discardEffect=new t.DiscardBlurMc(this.userSeat),this._discardEffect.x=n.x,this._discardEffect.y=n.y,this._discardEffect.setCard(e),t.GameInfo.topLayer.addChild(this._discardEffect))}return this.outPutCards.getCurOutPutPos()},i.prototype.movieEnd=function(t){this._discardEffect&&this._discardEffect.parent&&this._discardEffect.parent.removeChild(this._discardEffect),this._discardEffect=null,this._tempCard&&egret.Tween.removeTweens(this._tempCard),uniLib.DisplayUtils.removeAllChildren(this._tempPanel)},i.prototype.refreshTempCard=function(){uniLib.DisplayUtils.removeAllChildren(this._tempPanel)},i.prototype.removeCard=function(t,e){if(void 0===e&&(e=!0),!this._cardsBitArr||0==this._cardsBitArr.length)return null;var i;if(!e){var n=this._cardsBitArr[this._drawIndex];if(n&&n.parent)return i=new egret.Point(n.x,n.y),uniLib.DisplayUtils.removeFromParent(n),i}for(var s=0;s<t.length;s++){var n=this._cardsBitArr[this._curIndex];n&&(n.parent&&(i=new egret.Point,i.x=n.x,i.y=n.y,uniLib.DisplayUtils.removeFromParent(n),i=new egret.Point),e&&this._curIndex++)}return this.refreshCard(),i},i.prototype.refreshCard=function(){var e;if(this._cardsBitArr&&!(this._cardsBitArr.length<=0))for(var i=0;i<this._cardsBitArr.length;i++)if(e=this._cardsBitArr[i],i>=this._curIndex){if(!e){var n=t.GameConst.cardStylePer+"BackCard"+this.userSeat;this._cardsBitArr[i]=e=t.ResUtil.createBitmapByName(n),this._handsCard.addChild(this._cardsBitArr[i])}e.x=Math.round(this.initPoint.x+i*Math.round(this.stepX)),e.y=Math.round(this.initPoint.y+i*Math.round(this.stepY)),i==this._drawIndex&&(e.x+=Math.round(this.takeCardStepX),e.y+=Math.round(this.takeCardStepY))}else e&&e.parent&&e.parent.removeChild(e)},i.prototype.showKong=function(e,i){void 0===i&&(i=!1);var n=t.GroupCardsFactory.getInstance().getGangCard(e);this.addGroupCards(n,i)},i.prototype.showPong=function(e,i){void 0===i&&(i=!1);var n=t.GroupCardsFactory.getInstance().getPongCard(e);this.addGroupCards(n,i)},i.prototype.showChow=function(e,i){void 0===i&&(i=!1);var n=t.GroupCardsFactory.getInstance().getChowCard(e);this.addGroupCards(n,i)},i.prototype.addGroupCards=function(t,e){void 0===e&&(e=!1);var i=new egret.Point;this._displayCardsMc.numChildren>0&&(0==this.userSeat?t.x=this._displayCardsMc.width+6:1==this.userSeat?t.y=-this._displayCardsMc.height-2:2==this.userSeat?t.x=-(this._displayCardsMc.width+5):3==this.userSeat&&(t.y=this._displayCardsMc.height+2)),e?(0==this.userSeat?(i.x=Math.round(t.x+t.width/2),i.y=Math.round(t.height/2)):1==this.userSeat?(i.y=Math.round(t.y),i.x=Math.round(t.width/2)):2==this.userSeat?(i.y=Math.round(t.height/2),i.x=Math.round(t.x+t.width/2)):3==this.userSeat&&(i.y=Math.round(t.y+t.height/2),i.x=Math.round(t.width/2)),this.showGroupCard(t)):(1==this.userSeat?this._displayCardsMc.addChildAt(t,0):this._displayCardsMc.addChild(t),this.resetHandleCardPos())},i.prototype.showGroupCard=function(t){1==this.userSeat?this._displayCardsMc.addChildAt(t,0):this._displayCardsMc.addChild(t),this.resetHandleCardPos()},i.prototype.resetHandleCardPos=function(){this.initPoint.x=this._defaultPoint.x,this.initPoint.y=this._defaultPoint.y,this._displayCardsMc.numChildren>0&&(1==this.userSeat?this.initPoint.y=this._displayPos.y-(this._displayCardsMc.height+10)-3*this._stepY*this._displayCardsMc.numChildren:3==this.userSeat?this.initPoint.y=this._displayPos.y+this._displayCardsMc.height+5-3*this._stepY*this._displayCardsMc.numChildren:2==this.userSeat&&(this.initPoint.x=this._displayPos.x-(this._displayCardsMc.width+10)-3*this._stepX*this._displayCardsMc.numChildren));var t,e;t=this.handsCard.numChildren;for(var i,n=0;t>n;n++)e=this.handsCard.getChildAt(n),e&&(i=Number(e.name.slice(4)),e.x=Math.round(this.initPoint.x+i*Math.round(this.stepX)),e.y=Math.round(this.initPoint.y+i*Math.round(this.stepY)),i==this._drawIndex&&(e.x+=Math.round(this.takeCardStepX),e.y+=Math.round(this.takeCardStepY)))},i.prototype.checkIndex=function(){this.curIndex=3*this.displayCardsMc.numChildren,t.RoomInfo.getInstance().outerId==this.uid&&this.curIndex++,0!=this.userSeat&&this.refreshCard()},i.prototype.refreshOperate=function(e){this._curIndex=0,this.removeHandleCards(),this.removeGroupCards();var i=t.CardInfo.getInstance().getOpCardBySeat(e);if(null!=i)for(var n=0;n<i.length;n++){var s=i[n];s.type==Cmd.MahjongOpCardType.MahjongOpCardType_Touch?this.showPong(s,!1):s.type==Cmd.MahjongOpCardType.MahjongOpCardType_Eat?this.showChow(s,!1):this.showKong(s,!1)}this._curIndex=3*i.length;var a=t.CardInfo.getInstance().getHandCardBySeat(e);t.RoomInfo.getInstance().GM_Mode?(a.sort(function(t,e){return t>e?1:t==e?0:-1}),this.showUserHandCard(e,a)):this.sendCards(t.CardInfo.getInstance().userHandCount[e])},i.prototype.refreshOutCards=function(){this.outPutCards.resetCard();var e=t.CardInfo.getInstance().getOutCardBySeat(this._userSeat);this.outPutCards.showOutPutCardArr(e)},i.prototype.removeOutPutCard=function(t){this.outPutCards.removeOutPutCard(t)},i.prototype.resetCard=function(){this.resetPoint(),this.removeResult(),this.outPutCards.resetCard(),this.removeHandleCards(),this.removeGroupCards(),this._curIndex=0,this.resetHandleCardPos()},i.prototype.resetCardBitArr=function(){this._cardsBitArr&&this._cardsBitArr.forEach(function(t){uniLib.DisplayUtils.removeFromParent(t),t=null}),this._cardsBitArr=[]},i.prototype.removeGroupCards=function(){for(var t,e=this._displayCardsMc.numChildren,i=0;e>i;i++)t=this._displayCardsMc.removeChildAt(0),t.destory(),t=null;uniLib.DisplayUtils.removeAllChildren(this._displayCardsMc)},i.prototype.removeResult=function(){uniLib.DisplayUtils.removeAllChildren(this._otherHandMc)},i.prototype.removeHandleCards=function(){uniLib.DisplayUtils.removeAllChildren(this.handsCard)},i.prototype.setReloginData=function(){this.resetCard(),this._handCardsArr=t.CardInfo.getInstance().getHandCardBySeat(this._userSeat);var e=t.CardInfo.getInstance().getOutCardBySeat(this._userSeat);this.outPutCards.showOutPutCardArr(e),this.refreshOperate(this._userSeat)},i.prototype.doGm=function(t){},i.prototype.initSelect=function(){},i.prototype.reloginFlower=function(t){this.outPutCards.fillFlower(t)},i.prototype.refreshHandCards=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null)},i.prototype.selectGoldOut=function(){},i.prototype.showListenIcon=function(t){void 0===t&&(t=0)},i.prototype.getHandsCardByThisIDToBaseId=function(t){return[]},i.prototype.getSelectCardThisId=function(){return 0},i.prototype.hideListenIcon=function(){},i.prototype.addHostMask=function(){},i.prototype.removeHostMask=function(){},i.prototype.resetPoint=function(){},i.prototype.destory=function(){this.outPutCards&&this.outPutCards.destory(),this.outPutCards=null,this._handsCard&&(uniLib.DisplayUtils.removeAllChildren(this.handsCard),uniLib.DisplayUtils.removeFromParent(this._handsCard)),this._handsCard=null,this._otherHandMc&&(uniLib.DisplayUtils.removeAllChildren(this._otherHandMc),uniLib.DisplayUtils.removeFromParent(this._otherHandMc),this._otherHandMc=null),this._displayCardsMc&&(uniLib.DisplayUtils.removeAllChildren(this._displayCardsMc),uniLib.DisplayUtils.removeFromParent(this._displayCardsMc)),this._displayCardsMc=null,this._tempPanel&&(uniLib.DisplayUtils.removeAllChildren(this._tempPanel),uniLib.DisplayUtils.removeFromParent(this._tempPanel)),this._discardEffect&&(this._discardEffect.destory(),this._discardEffect=null),this._tempPanel=null,this._tempCard=null,this._handCardsArr=null,this._defaultPoint=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.UserSideCard=e,__reflect(e.prototype,"game.UserSideCard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.row=10,t.btnGroup=[],t.initWidth=230,t.initHeight=50,t.createScene(),t}return __extends(i,e),i.prototype.createScene=function(){this.name="chat",this.content=uniLib.DisplayUtils.createMask(.5,1280,350,0),this.content.name="chat_bg",this.content.touchEnabled=!0,this.content.touchChildren=!0,this.addChild(this.content),this.btnPanel=uniLib.DisplayUtils.createMask(.3,1280,200,0),this.btnPanel.y=350,this.addChild(this.btnPanel),this.cardsGroup=[],this.content.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)},i.prototype.removeListener=function(){this.content.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)},i.prototype.touchHandler=function(e){var i=e.target.name;if(this.selectCard&&this.selectCard.name==i)this.setSelectMode(this.selectCard,!1),this.selectCard=null;else if(this.selectCard&&this.selectCard.name!=i)this.setSelectMode(this.selectCard,!1),this.selectCard=this.content.getChildByName(i),this.setSelectMode(this.selectCard,!0);else{if(this.selectCard=this.content.getChildByName(i),null==this.selectCard)return;this.setSelectMode(this.selectCard,!0);var n=t.MahJongFourFacede.getInstance().retrieveMediator(t.DLTDHGameMJMediator.NAME),s=n.getViewComponent();s.dispatchEventWith(t.UIEventConsts.GM_SELECT_HEAPCARD,!1,this.getSelectCard())}},i.prototype.setTypeButton=function(t){this.clearTypeButton();for(var e=0,i=Math.ceil(t.length/this.row),n=0;i>n;n++)for(var s=0;s<this.row;s++){var a=t[e];if(a){var o=this.creatBtn(a);o.x=80+120*s,o.y=20+30*n}e++}},i.prototype.creatBtn=function(t){var e=uniLib.DisplayUtils.createMask(1,100,25,16418329);e.name=t.id.toString(),e.touchEnabled=!0,this.btnPanel.addChild(e);var i=uniLib.DisplayUtils.createTextLabel(16777215,egret.HorizontalAlign.CENTER,t.value,16,100,25);return i.y=3,e.addChild(i),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnTypeHandler,this),this.btnGroup.push(e),e},i.prototype.btnTypeHandler=function(e){var i=e.target.name,n=t.MahJongFourFacede.getInstance().retrieveMediator(t.DLTDHGameMJMediator.NAME),s=n.getViewComponent();s.dispatchEventWith(t.UIEventConsts.GM_SELECT_CARDS,!1,Number(i))},i.prototype.clearTypeButton=function(){for(var t=0;t<this.btnGroup.length;t++){var e=this.btnGroup[t];e&&(e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnTypeHandler,this),uniLib.DisplayUtils.removeAllChildren(e),uniLib.DisplayUtils.removeFromParent(e))}uniLib.DisplayUtils.removeAllChildren(this.btnPanel),this.btnGroup=[]},i.prototype.setHeapCard=function(e){if(this.clearHeapCard(),e||!(e.length<=0)){e.sort(function(t,e){return t>e?1:t==e?0:-1});for(var i=0;i<e.length;i++){var n=table.TableCard.selectByThisId(e[i]),s=table.TableCard.resPutOut(n.cardId,0),a=t.ResUtil.createBitmapByName(s);a.name=n.thisId+"",a.touchEnabled=!0,20>i?(a.x=this.initWidth+40*i,a.y=this.initHeight):i>=20&&40>i?(a.x=this.initWidth+40*(i-20),a.y=this.initHeight+70):i>=40&&60>i?(a.x=this.initWidth+40*(i-40),a.y=this.initHeight+140):i>=60&&80>i?(a.x=this.initWidth+40*(i-60),a.y=this.initHeight+210):i>=80&&100>i?(a.x=this.initWidth+40*(i-80),a.y=this.initHeight+280):i>=100&&120>i?(a.x=this.initWidth+40*(i-100),a.y=this.initHeight+350):i>=120&&140>i?(a.x=this.initWidth+40*(i-120),a.y=this.initHeight+420):i>=140&&(a.x=this.initWidth+40*(i-140),a.y=this.initHeight+490),this.cardsGroup.push(a),this.content.addChild(a)}}},i.prototype.clearHeapCard=function(){for(var t=0;t<this.cardsGroup.length;t++){var e=this.cardsGroup[t];uniLib.DisplayUtils.removeFromParent(e)}this.selectMode&&uniLib.DisplayUtils.removeFromParent(this.selectMode),this.selectMode=null,uniLib.DisplayUtils.removeAllChildren(this.content),this.cardsGroup=[],this.selectCard=null},i.prototype.setSelectMode=function(e,i){i?(this.selectMode=t.ResUtil.createBitmapByName("GoldIcon2"),this.selectMode.x=e.x,this.selectMode.y=e.y,this.content.addChild(this.selectMode)):(this.selectMode&&uniLib.DisplayUtils.removeFromParent(this.selectMode),this.selectMode=null)},i.prototype.getSelectCard=function(){return this.selectCard?this.selectCard.name:""},i.prototype.onKeyDown=function(t){},i.prototype.onBtnClick=function(t){},i.prototype.createBitmapByName=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=new egret.Bitmap,s=RES.getRes(t);return n.texture=s,n.smoothing=!0,n.x=e,n.y=i,n},i.prototype.destory=function(){this.removeListener(),this.clearHeapCard(),this.clearTypeButton(),this.content&&(uniLib.DisplayUtils.removeAllChildren(this.content),uniLib.DisplayUtils.removeFromParent(this.content)),this.content=null,this.btnPanel&&(uniLib.DisplayUtils.removeAllChildren(this.btnPanel),uniLib.DisplayUtils.removeFromParent(this.btnPanel)),this.btnPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.RoomGmTool=e,__reflect(e.prototype,"game.RoomGmTool");var i=function(t){function e(){var e=t.call(this)||this;return e.inputs=[],e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this;document.onkeydown=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];t.handlekeydown(n),t.inputs.length>0&&t.dispatchEventWith(e.onkeydown,!0,t.inputs,!0)},document.onkeyup=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];t.handlekeyup(n),t.inputs.length>0&&t.dispatchEventWith(e.onkeyup,!0,t.inputs,!0)},document.onmousedown=function(e){t.inputs=[]}},e.prototype.handlekeydown=function(t){t.key==e.CnterEnter&&this.checkInput(e.CnterEnter)},e.prototype.handlekeyup=function(t){t.key==e.CnterEnter&&this.removeByKey(e.CnterEnter)},e.prototype.checkInput=function(t){for(var e=!1,i=0;i<this.inputs.length;i++)this.inputs[i]==t&&(e=!0);e||this.inputs.push(t)},e.prototype.removeByKey=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e]==t&&this.inputs.splice(e,1)},e.prototype.isContain=function(t,e){for(var i=!1,n=0;n<t.length;n++)t[n]==e&&(i=!0);return i},e}(egret.EventDispatcher);i.onkeydown="KeyBoardonkeydown",i.onkeyup="KeyBoardonkeyup",i.CnterEnter="Enter",t.KeyBoard=i,__reflect(i.prototype,"game.KeyBoard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._effectName="",t.actionList=[],t._gender=0,t._muitiType=Cmd.MahjongOpCardType.MahjongOpCardType_Win,t._index=0,t}return __extends(i,e),i.prototype.initUI=function(){dragonBones.addMovieGroup(RES.getRes("ningdumj_effect_ske_dbmv"),RES.getRes("ningdumj_effect_tex_png"),"win_effect"),this._winEffect=dragonBones.buildMovie("MovieClip","win_effect"),this._winEffect.addEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this.loop,this),this._time_100=new uniLib.TimerBase(100,this.countSecond,this),this._time_100.stop(),this._facePanel=[];for(var t=0;4>t;t++){var e=new egret.Sprite;this._facePanel.push(e),this.addChild(e)}this._quickTalkPanel=[];for(var t=0;4>t;t++){var e=new egret.Sprite;this._quickTalkPanel.push(e),this.addChild(e)}this._talkPanel=[];for(var t=0;4>t;t++){var e=new egret.Sprite;this._talkPanel.push(e),this.addChild(e)}},i.prototype.showWinEffect=function(e,i,n,s){void 0===s&&(s=!1),this._effectName="",egret.Tween.removeTweens(this._winEffect);var a=t.RoomInfo.getInstance().getSeatNoByUserId(i);if(this._winEffect.rotation=0,20!=e||-1!=i)if(-1==i)this._winEffect.x=Math.round(t.DataCache.defaultWidth/2),this._winEffect.y=Math.round(t.DataCache.defaultHeight/2);else{var o=t.RoomInfo.getInstance().getUserVoByUid(i).getGender(),r="";if(r="action_tuidaohu_"+o.toString()+"_"+e.toString()+"_mp3",!RES.hasRes(r))if(1==n)r="action_"+t.RoomInfo.getInstance().languageMode+"_"+o.toString()+"_zimo_mp3";else{var h=parseInt(2*Math.random()+"");r="action_pu_"+o.toString()+"1_"+h.toString()+"_mp3"}if(RES.hasRes(r)&&uniLib.SoundMgr.instance.playSound(r),this.setPosition(this._winEffect,a),this._effectName=table.TableMahjongMulti.selectCartoonById(e),""==this._effectName&&1==n&&(this._effectName="zimo"),"zimo"==this._effectName)return void this.playMcTween(6,a);if(""==this._effectName)return void this.playMcTween(5,a);this.addChild(this._winEffect),this._winEffect.play(this._effectName,1)}},i.prototype.showEffect=function(e,i){this._effectName="";var n=t.RoomInfo.getInstance().getSeatNoByUserId(i),s=t.RoomInfo.getInstance().getUserVoByUid(i).getGender();if(e==Cmd.MahjongOpCardType.MahjongOpCardType_Win)this.playHuMusic(s,e);else{if(e>100){if(101==e)var a=parseInt(2*Math.random()+""),o="action_pu_"+s.toString()+"2_"+a.toString()+"_mp3";else if(102==e)var o="action_pu_"+s.toString()+"2_2_mp3";else if(103==e)var o="action_pu_"+s.toString()+"2_3_mp3";e=2}else var a=parseInt(3*Math.random()+""),o="action_pu_"+s.toString()+e.toString()+"_"+a.toString()+"_mp3";if(!RES.hasRes(o))var o=table.TableCard.resSoundAction(e,s);""!=o&&uniLib.SoundMgr.instance.playSound(o)}switch(e){case Cmd.MahjongOpCardType.MahjongOpCardType_Touch:return void this.playMcTween(2,n);case Cmd.MahjongOpCardType.MahjongOpCardType_Bar:case Cmd.MahjongOpCardType.MahjongOpCardType_BarOther:case Cmd.MahjongOpCardType.MahjongOpCardType_BarSelf:case Cmd.MahjongOpCardType.MahjongOpCardType_BarTouch:return void this.playMcTween(3,n);case Cmd.MahjongOpCardType.MahjongOpCardType_Eat:return void this.playMcTween(1,n);case Cmd.MahjongOpCardType.MahjongOpCardType_Win:return void this.playMcTween(5,n)}},i.prototype.setPosition=function(e,i){0==i?(e.x=Math.round(t.DataCache.defaultWidth/2),e.y=t.DataCache.defaultHeight-120):1==i?(e.y=Math.round(t.DataCache.defaultHeight/2),e.x=t.DataCache.defaultWidth-150):2==i?(e.y=80,e.x=Math.round(t.DataCache.defaultWidth/2)):3==i&&(e.x=150,e.y=Math.round(t.DataCache.defaultHeight/2))},i.prototype.playMc=function(e,i){e.isPlaying&&(e.stop(),e.removeEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this)),-1==i?(e.x=Math.round(t.DataCache.defaultWidth/2),e.y=Math.round(t.DataCache.defaultHeight/2)):this.setPosition(e,i),e.addEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this),this.addChild(e),e.gotoAndPlay(1,1)},i.prototype.playMcTween=function(e,i){var n=this,s="";switch(e){case 1:s="action_chi";break;case 2:s="action_peng";break;case 3:s="action_gang";break;case 4:s="action_bu";break;case 5:s="action_win";break;case 6:s="action_zimo"}if(""!=s){var a=t.ResUtil.createBitmapByName(s),o=this.getSeatPlaceById(i);this.addChild(a),this.actionList.push(a),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=o[0],a.y=o[1],a.width=a.width-10,a.height=a.height-10,egret.Tween.get(a).wait(500).to({alpha:.7},200).call(function(){a&&(egret.Tween.removeTweens(a),n.removeChild(a)),a=null})}},i.prototype.getSeatPlaceById=function(t){var t=t,e=[];switch(t){case 0:return e[0]=uniLib.Global.screenWidth/2,e[1]=uniLib.Global.screenHeight-220,e;case 1:return e[0]=uniLib.Global.screenWidth-310,e[1]=uniLib.Global.screenHeight/2-60,e;case 2:return e[0]=uniLib.Global.screenWidth/2,e[1]=150,e;case 3:return e[0]=310,e[1]=uniLib.Global.screenHeight/2-60,e}},i.prototype.onMcPlayComplete=function(t){var e=t.target;e&&(e.stop(),e.removeEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this),uniLib.DisplayUtils.removeFromParent(e))},i.prototype.loop=function(t){this._winEffect.stop()},i.prototype.clearEffect=function(){uniLib.DisplayUtils.removeFromParent(this._winEffect),this.actionList&&this.actionList.forEach(function(t){egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeFromParent(t),t=null}),this.actionList=[]},i.prototype.playHuMusic=function(e,i){this._gender=e,this._muitiType=i,uniLib.SoundMgr.instance.playSound(t.SoundConsts.HU_MUSIC),this._index=0,this._time_100.start()},i.prototype.countSecond=function(){if(this._index++,this._index>=5){if(this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_ThreeGold||this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_FourGold||this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_FiveGold||this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_SixGold){var t=table.TableCard.resSoundAction(Cmd.MahjongOpCardType.MahjongOpCardType_Win,this._gender);""!=t&&uniLib.SoundMgr.instance.playSound(t)}else{var t=table.TableCard.resSoundAction(this._muitiType,this._gender);
""!=t&&uniLib.SoundMgr.instance.playSound(t)}this._time_100.stop(),this._index=0,this._muitiType=Cmd.MahjongOpCardType.MahjongOpCardType_Win,this._gender=0}},i.prototype.showCommonChat=function(e,i){var n=t.RoomInfo.getInstance().getSeatNoByUserId(e),s=t.RoomInfo.getInstance().getUserVoByUid(e).getGender();switch(this._facePanel[n].x=t.GameData.getInstance().TempeLocation[n][0],this._facePanel[n].y=t.GameData.getInstance().TempeLocation[n][1],n){case 0:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2+100,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 1:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2-180,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 2:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2-180,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 3:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2+100,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor}var a;if("1"==i.charAt(0)){a=i.substr(1,i.length-1);var o=uniLib.DisplayUtils.createMovieClicp("face_"+a+"_new");this._facePanel[n].addChild(o),o.scaleX=1,o.scaleY=1,o.play(-1),GX.GameLayerManager.addUIToEffect(o),t.Timer.setTimeout(function(){o.stop(),GX.GameLayerManager.removeUI(o)},this,2e3)}else"2"==i.charAt(0)&&(a=i.substr(1,i.length-1),uniLib.SoundMgr.instance.playSound(t.SoundConsts.COMMON+"_"+s+"_"+a+"_mp3"),this.creatChatPop(n,t.GameData.getInstance().ShortTalkArr[a],this._quickTalkPanel[n]),egret.Tween.get(this._quickTalkPanel[n]).wait(3e3).call(this.quickTalkCompelete,this,[this._quickTalkPanel[n],n]))},i.prototype.showCommonTalk=function(e,i){var n=t.RoomInfo.getInstance().getSeatNoByUserId(e);switch(n){case 0:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2+100,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 1:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2-180,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 2:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2-180,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 3:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2+100,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor}this.creatChatPop(n,i,this._talkPanel[n]),egret.Tween.get(this._quickTalkPanel[n]).wait(3e3).call(this.talkCompelete,this,[this._talkPanel[n],n])},i.prototype.showCompelete=function(t,e){t&&egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(this._facePanel[e])},i.prototype.quickTalkCompelete=function(t,e){t&&egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(this._quickTalkPanel[e])},i.prototype.talkCompelete=function(t,e){t&&egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(this._talkPanel[e])},i.prototype.creatChatPop=function(e,i,n){var s=t.ResUtil.createBitmapByName("chat_pop");s.scale9Grid=new egret.Rectangle(28,33,13,5),s.width=245,n.addChild(s);var a=t.ResUtil.createTextFeild(1456961,egret.HorizontalAlign.LEFT,"",28,35,10,210,!1,4);a.text=i,n.addChild(a),s.height=10+a.height+20,1==e||2==e?(s.scaleX=-1,s.x=180,a.x=-45):a.x-=10,s=null,a=null},i.prototype.destory=function(){e.prototype.destory.call(this),egret.Tween.removeTweens(this),this._time_100&&this._time_100.stop(),this._time_100=null,this._winEffect&&(this._winEffect.removeEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this.loop,this),dragonBones.removeMovieGroup("win_effect"),this._winEffect.stop(),this._winEffect&&t.ResUtil.removeFromParent(this._winEffect),this._winEffect=null);for(var i=0;4>i;i++){var n=this._facePanel[i];uniLib.DisplayUtils.removeAllChildren(n),uniLib.DisplayUtils.removeFromParent(n),n=null}this._facePanel=null;for(var i=0;4>i;i++){var n=this._quickTalkPanel[i];uniLib.DisplayUtils.removeAllChildren(n),uniLib.DisplayUtils.removeFromParent(n),n=null}this._quickTalkPanel=null;for(var i=0;4>i;i++){var n=this._talkPanel[i];uniLib.DisplayUtils.removeAllChildren(n),uniLib.DisplayUtils.removeFromParent(n),n=null}this._talkPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.ActionEffectMc=e,__reflect(e.prototype,"game.ActionEffectMc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.clearDrag=function(){this._bankerMC&&(this._bankerMC.removeEventListener(egret.Event.COMPLETE,this.onMCComplete,this),this._bankerMC&&t.ResUtil.removeFromParent(this._bankerMC)),this._bankerMC=null},i.prototype.destory=function(){this._bankBmp=null,this._bankerMC&&(this._bankerMC.removeEventListener(egret.Event.COMPLETE,this.onMCComplete,this),this._bankerMC&&t.ResUtil.removeFromParent(this._bankerMC)),this._bankerMC=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.initUI=function(){this._bankerMC=uniLib.DisplayUtils.createMovieClicp("zhuang")},i.prototype.show=function(e){if(void 0===e&&(e=!0),e){if(uniLib.DisplayUtils.removeAllChildren(this),!this._bankerMC)return;this._bankerMC.x=uniLib.Global.screenWidth-this._bankerMC.width+2*t.CountVc.OFFSET_Y>>1,this._bankerMC.y=uniLib.Global.screenHeight-this._bankerMC.height+2*t.CountVc.OFFSET_Y>>1,this._bankerMC.parent||this.addChild(this._bankerMC),this._bankerMC.addEventListener(egret.Event.COMPLETE,this.onMCComplete,this),this._bankerMC.play(1)}else this.bankerMCEnd(null)},i.prototype.onMCComplete=function(e){var i=t.PositionData.seatPosArr[t.RoomInfo.getInstance().bankerSeatId];this._bankerMC.removeEventListener(egret.Event.COMPLETE,this.onMCComplete,this),egret.Tween.get(this._bankerMC).to({x:i.x-4,y:i.y-4},200).call(this.bankerMCEnd,this,[this._bankerMC])},i.prototype.bankerMCEnd=function(e){e&&egret.Tween.removeTweens(e),this._bankerMC&&this.clearDrag(),uniLib.DisplayUtils.removeAllChildren(this),this._bankBmp=t.ResUtil.createBitmapByName("bank");var i=t.SeatPlayVc.seatPosArr[t.RoomInfo.getInstance().bankerSeatId];null!=i&&(this._bankBmp.x=i.x-5,this._bankBmp.y=i.y-5,this.addChild(this._bankBmp))},i}(t.BaseVc);t.BankerEffectMc=e,__reflect(e.prototype,"game.BankerEffectMc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._initCardsPointX=[],t._initCardPointX=[],t._initCardsPointY=uniLib.Global.screenHeight/3,t._stepX=120,t._sendCardPoint=new egret.Point(uniLib.Global.screenWidth/2,50),t}return __extends(i,e),i.prototype.initUI=function(){this._catoonPoint=new egret.Point(670,500),this._initCardsPointX=[],this._initCardPointX=[],this._zmEffectMc=uniLib.DisplayUtils.createDragonBonesDisplay("tuidaohu_zm_effect_ske_json","tuidaohu_zm_effect_tex_json","tuidaohu_zm_effect_tex_png","MovieClip"),dragonBones.WorldClock.clock.add(this._zmEffectMc),this._zmEffectMc.addEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,this.loop_com,this),this._lizi=uniLib.DisplayUtils.createMovieClicp("lizi")},i.prototype.createPanel=function(t){var e=this;this._winHorseNum=t.winHorse;var i=300,n=340;this._initCardsPointX=[],this._initCardPointX=[];for(var s=0;6>s;s++)this._initCardsPointX.push(i+this._stepX*s);for(var s=0;5>s;s++)this._initCardPointX.push(n+this._stepX*s);if(t.horseSet)for(var a=function(i){egret.setTimeout(function(){return e.createCard(t.horseSet[i].thisId,t.horseSet.length,i,t.horseSet[i].bWin)},null,100*i)},s=0;s<t.horseSet.length;s++)a(s);this._zmEffectMc.display.x=this._catoonPoint.x,this._zmEffectMc.display.y=this._catoonPoint.y,0==t.winHorse?egret.setTimeout(function(){e._zmEffectMc.animation.play("meizhong",1),e.addChild(e._zmEffectMc.display)},null,1500):egret.setTimeout(function(){e._zmEffectMc.animation.play("0"+t.winHorse,1),e.addChild(e._zmEffectMc.display)},null,1500)},i.prototype.createCard=function(e,i,n,s){var a=new t.HorseCard;a.createHorseCard(),this.addChild(a),a.x=this._sendCardPoint.x,a.y=this._sendCardPoint.y;var o=egret.Tween.get(a);(6-i)%2==0?o.to({x:this._initCardsPointX[(6-i)/2+n],y:this._initCardsPointY},100).wait(100+40*(n+i)).call(a.createHorseCardEff,null,[e,s]):o.to({x:this._initCardPointX[Math.floor((6-i)/2)+n],y:this._initCardsPointY},100).wait(100+40*(n+i)).call(a.createHorseCardEff,null,[e,s])},i.prototype.loop_com=function(t){var e=this;this._zmEffectMc.animation.stop(),this._winHorseNum>0&&(this._lizi.x=this._catoonPoint.x,this._lizi.y=this._catoonPoint.y,this.addChild(this._lizi),this._lizi.addEventListener(egret.Event.COMPLETE,this.onLiziComplete,this),this._lizi.play(1)),egret.setTimeout(function(){e.destroyEff()},null,2e3)},i.prototype.onLiziComplete=function(t){this._lizi.stop(),this._lizi.removeEventListener(egret.Event.COMPLETE,this.onLiziComplete,this),uniLib.DisplayUtils.removeFromParent(this._lizi)},i.prototype.destroyEff=function(){egret.Tween.removeTweens(this),this._zmEffectMc&&(this._zmEffectMc.removeEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,this.loop_com,this),dragonBones.WorldClock.clock.remove(this._zmEffectMc),this._zmEffectMc.animation.stop(),this._zmEffectMc.display&&uniLib.DisplayUtils.removeFromParent(this._zmEffectMc.display),this._zmEffectMc=null),this._lizi&&(this._lizi.stop(),uniLib.DisplayUtils.removeFromParent(this._lizi)),this._lizi=null,t.PopupManager.removePopUp(this),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.destory=function(){this.destroyEff(),e.prototype.destory.call(this)},i}(t.BaseVc);t.BuyHorsePanel=e,__reflect(e.prototype,"game.BuyHorsePanel")}(game||(game={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._stepX=-170,t._stepKongX=-200,t}return __extends(i,e),i.prototype.initUI=function(){this._cancleBtn||(this._cancleBtn=new t.GameButton(["operate_cancel1","operate_cancel2"],null,!1)),this._defaultPoint=new egret.Point((uniLib.Global.screenWidth-1136)/2+866,uniLib.Global.screenHeight-230)},i.prototype.createChowPanel=function(){uniLib.DisplayUtils.removeAllChildren(this),this._chowCards=null,this._cancleBtn||(this._cancleBtn=new t.GameButton(["operate_cancel1","operate_cancel2"],null,!1)),this._cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeChow,this),this._chowCards=t.GroupCardsFactory.getInstance().getChowCards(),this._cancleBtn.x=this._defaultPoint.x,this._cancleBtn.y=this._defaultPoint.y+3,this.addChild(this._cancleBtn),this.sortChowCards()},i.prototype.sortChowCards=function(){for(var e=0;e<this._chowCards.length;e++){this._bg=new egret.Sprite,this.addChild(this._bg),this._bg.x=this._defaultPoint.x+(this._chowCards.length-e)*this._stepX,this._bg.y=this._defaultPoint.y+15;var i=new egret.Bitmap,n=new egret.Bitmap;0==e?(n=t.ResUtil.createBitmapByName("eatIcon"),n.x=-50,n.y=18,i=t.ResUtil.createBitmapByName("eatCardKuang_bg1"),i.scale9Grid=new egret.Rectangle(84,15,7,96),n.visible=!0):(i=t.ResUtil.createBitmapByName("eatCardKuang_bg2"),i.scale9Grid=new egret.Rectangle(27,13,15,96),n.visible=!1),i.width=this._chowCards[e].width+50,i.height=this._chowCards[e].height+50,this._chowCards[e].x=25,this._chowCards[e].y=22,this._chowCards[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectChowCards,this),this._chowCards[e].touchEnabled=!0,this._bg.addChild(i),this._bg.addChild(this._chowCards[e]),this._bg.addChild(n)}},i.prototype.selectChowCards=function(e){var i=e.target.data.split(",");t.CardInfo.getInstance().eatObj.one=Number(i[0]),t.CardInfo.getInstance().eatObj.two=Number(i[1]),this.dispatchEventWith(t.UIEventConsts.ACTION_BEGIN_CHOW)},i.prototype.createKongPanel=function(e){uniLib.DisplayUtils.removeAllChildren(this),this._kongCards=null,this._cancleBtn||(this._cancleBtn=new t.GameButton(["operate_cancel1","operate_cancel2"],null,!1)),this._cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeChow,this),this._kongCards=t.GroupCardsFactory.getInstance().getKongCards(e),this._cancleBtn.x=this._defaultPoint.x,this._cancleBtn.y=this._defaultPoint.y+3,this.addChild(this._cancleBtn),this.sortKongCards()},i.prototype.sortKongCards=function(){for(var e=0;e<this._kongCards.length;e++){this._bg=new egret.Sprite,this.addChild(this._bg),this._bg.x=this._defaultPoint.x+(this._kongCards.length-e)*this._stepKongX,this._bg.y=this._defaultPoint.y+15;var i=new egret.Bitmap,n=new egret.Bitmap;0==e?(n=t.ResUtil.createBitmapByName("kongIcon"),n.x=-50,n.y=18,i=t.ResUtil.createBitmapByName("eatCardKuang_bg1"),i.scale9Grid=new egret.Rectangle(84,15,7,96),i.visible=!0):(i=t.ResUtil.createBitmapByName("eatCardKuang_bg2"),i.scale9Grid=new egret.Rectangle(27,13,15,96),n.visible=!1),i.width=this._kongCards[e].width+50,i.height=this._kongCards[e].height+50,this._kongCards[e].x=25,this._kongCards[e].y=22,this._kongCards[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectKongCards,this),this._kongCards[e].touchEnabled=!0,this._bg.addChild(i),this._bg.addChild(this._kongCards[e]),this._bg.addChild(n)}},i.prototype.selectKongCards=function(e){t.CardInfo.getInstance().kongThisId=e.target.data,this.dispatchEventWith(t.UIEventConsts.ACTION_BEGIN_KONG)},i.prototype.destory=function(){if(e.prototype.destory.call(this),this._chowCards&&this._chowCards[0])for(var t=0;t<this._chowCards.length;t++)this._chowCards[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.selectChowCards,this),this._chowCards[t].destory();if(this._chowCards=null,this._kongCards&&this._kongCards[0])for(var t=0;t<this._kongCards.length;t++)this._kongCards[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.selectKongCards,this),this._kongCards[t].destory();this._cancleBtn&&(this._cancleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeChow,this),this._cancleBtn=null),this._bg&&(uniLib.DisplayUtils.removeAllChildren(this._bg),uniLib.DisplayUtils.removeFromParent(this._bg)),this._bg=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.closeChow=function(){this.dispatchEventWith(t.UIEventConsts.ACTION_STOP_CHOW),this.destory(),t.PopupManager.removePopUp(this)},i}(t.BaseVc);t.ChowCardsPanel=e,__reflect(e.prototype,"game.ChowCardsPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._seatId=t,i}return __extends(i,e),i.prototype.initUI=function(){this._blurBitMap=t.ResUtil.createBitmapByName("out_blur"),this._seatId%2+1==1?(this._blurBitMap.x=10,this._blurBitMap.y=13):(this._blurBitMap.rotation=90,this._blurBitMap.x=-15,this._blurBitMap.y=-8),this.addChild(this._blurBitMap),this._outCard=new t.OutPutCard,this._outCard.alpha=.2,this.addChildAt(this._outCard,0)},i.prototype.setCard=function(t){this._outCard.setCard(this._seatId,t)},i.prototype.destory=function(){this._outCard&&this._outCard.destory(),this._outCard=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._blurBitMap=null},i}(t.BaseVc);t.DiscardBlurMc=e,__reflect(e.prototype,"game.DiscardBlurMc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._cardMc=new egret.DisplayObjectContainer,this.addChild(this._cardMc)},Object.defineProperty(i.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),i.prototype.addCard=function(t,e){void 0===e&&(e=!0),e?this._cardMc.addChild(t):this._cardMc.addChildAt(t,0)},i.prototype.destory=function(){this._cardMc&&(uniLib.DisplayUtils.removeAllChildren(this._cardMc),uniLib.DisplayUtils.removeFromParent(this._cardMc)),this._cardMc=null,this._flagIcon=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.getFlagIcon=function(e){return void 0===e&&(e=-1),-1==e?this._flagIcon:(this._flagIcon?this._flagIcon.texture=t.ResUtil.createTexture("group_flag"+e):(this._flagIcon=t.ResUtil.createBitmapByName("group_flag"+e),this.addChild(this._flagIcon)),this._flagIcon)},Object.defineProperty(i.prototype,"flagIcon",{set:function(t){!this._flagIcon,this._flagIcon=t},enumerable:!0,configurable:!0}),i}(t.BaseVc);t.GroupCard=e,__reflect(e.prototype,"game.GroupCard")}(game||(game={}));var game;!function(t){var e=function(){function e(){this._resultX=40,this._stepXArr=[40,0,-37,0],this._stepYArr=[0,-28,0,28],this._backScale=[1,.88,1,.88],this._scaleArr=[1,.8,.95,.8],this._selfKongXArr=[1,1,0,-1],this._selfKongYArr=[-10,-9,-10,-9],this._flagXArr=[16,32,14,-5],this._flagYArr=[50,8,-4,7],this._kongOtherFlagX=[16,-6,14,33],this._kongOtherFlagY=[-8,8,44,9],this._flagScale=[1,.8,.8,.8]}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getPongCard=function(t,e){void 0===e&&(e=!1);for(var i=[],n=0;3>n;n++)i.push(t.thisId);var s=(t.seatId-t.fromSeatId+4)%4,a=this.showCards(i,t.seatId,s,e);return a.type=Cmd.MahjongOpCardType.MahjongOpCardType_Touch,a.data=t,a},e.prototype.getGangCard=function(e,i){void 0===i&&(i=!1);var n;if(e.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarTouch||e.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarOther)return n=this.getPongCard(e,i),this.changePongToKong(n,e,i),n;if(e.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarSelf){var s;n=new t.GroupCard,n.type=Cmd.MahjongOpCardType.MahjongOpCardType_Bar;for(var a=0;3>a;a++)s=new t.OutPutBackCard,i?(s.setCard(e.seatId,1),s.x=this._resultX*a):(s.setCard(e.seatId,this._backScale[e.seatId]),s.x=this._stepXArr[e.seatId]*a),s.y=this._stepYArr[e.seatId]*a,this._stepYArr[e.seatId]<0?n.addCard(s,!1):n.addCard(s);if(0==e.seatId){var o=new t.OutPutCard;i?(o.setCard(e.seatId,e.thisId,1,i),o.x=this._resultX):(o.setCard(e.seatId,e.thisId,this._scaleArr[e.seatId],i),o.x=1*this._stepXArr[e.seatId]+this._selfKongXArr[e.seatId]),o.y=1*this._stepYArr[e.seatId]+this._selfKongYArr[e.seatId],n.addCard(o)}else if(1==e.seatId||3==e.seatId){var r=new t.OutPutBackCard;r.setCard(e.seatId,this._backScale[e.seatId]),r.x=1*this._stepXArr[e.seatId]+this._selfKongXArr[e.seatId],r.y=1*this._stepYArr[e.seatId]+this._selfKongYArr[e.seatId],n.addCard(r)}else{var r=new t.OutPutBackCard;r.setCard(e.seatId,this._backScale[e.seatId]),r.x=1*this._stepXArr[e.seatId]+this._selfKongXArr[e.seatId],r.y=1*this._stepYArr[e.seatId]+this._selfKongYArr[e.seatId],n.addCard(r)}}return n},e.prototype.changePongToKong=function(e,i,n){void 0===n&&(n=!1);var s=new t.OutPutCard,a=e.data;0==i.seatId?s.setCard(i.seatId,a.thisId,1,n):s.setCard(i.seatId,a.thisId,this._scaleArr[i.seatId]),n?s.x=1*this._resultX:s.x=1*this._stepXArr[i.seatId]+this._selfKongXArr[i.seatId],s.y=1*this._stepYArr[i.seatId]+this._selfKongYArr[i.seatId],e.type=Cmd.MahjongOpCardType.MahjongOpCardType_Bar,e.addCard(s);var o=(i.seatId-i.fromSeatId+4)%4,r=e.getFlagIcon();i.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarTouch?2==o&&(r.scaleX=r.scaleY=this._flagScale[i.seatId],r.x=s.x+this._flagXArr[i.seatId],r.y=s.y+this._flagYArr[i.seatId],r.visible=!0):(r.scaleX=r.scaleY=this._flagScale[i.seatId],r.x=s.x+this._kongOtherFlagX[i.seatId],r.y=s.y+this._kongOtherFlagY[i.seatId],r.visible=!0),n&&r&&(r.visible=!1)},e.prototype.getChowCard=function(t,e){void 0===e&&(e=!1);for(var i=[],n=0;n<t.cardSet.length;n++)i.push(t.cardSet[n]);i.push(t.thisId),i.sort(function(t,e){return t-e});var s=(t.seatId-t.fromSeatId+4)%4,a=this.showCards(i,t.seatId,s,e,!1,t.thisId);return a.type=Cmd.MahjongOpCardType.MahjongOpCardType_Eat,a.data=t,a},e.prototype.getChowCards=function(){if(!t.RoomInfo.getInstance().OutCard.eatSet||!t.RoomInfo.getInstance().OutCard.eatSet[0])return null;for(var e=[],i=0;i<t.RoomInfo.getInstance().OutCard.eatSet.length;i++){var n=[];n.push(t.RoomInfo.getInstance().OutCard.eatSet[i].one),n.push(t.RoomInfo.getInstance().OutCard.eatSet[i].two),n.push(t.RoomInfo.getInstance().OutCard.thisId),n.sort(function(t,e){return t-e});var s=this.showCards(n,0,0,!1,!0);s.type=Cmd.MahjongOpCardType.MahjongOpCardType_Eat,s.data=t.RoomInfo.getInstance().OutCard.eatSet[i].one.toString()+","+t.RoomInfo.getInstance().OutCard.eatSet[i].two.toString(),e.push(s)}return e},e.prototype.getKongCards=function(t){if(t&&t.length){for(var e=[],i=0;i<t.length;i++){var n=t[i],s=[n,n,n,n],a=this.showCards(s,0,0,!1,!0);a.type=Cmd.MahjongOpCardType.MahjongOpCardType_BarSelf,a.data=n,e.push(a)}return e}},e.prototype.showCards=function(e,i,n,s,a,o){void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===o&&(o=0);var r,h,d=new t.GroupCard,l=0;l=2==n?90+-90*i:3==n?180+-90*i:0+-90*i,l=(l+360)%360;for(var c=d.getFlagIcon(l),u=0;u<e.length;u++)r=e[u],h=new t.OutPutCard,0==i?s?h.setCard(i,r,1,s):h.setCard(i,r,this._scaleArr[i],s):h.setCard(i,r,this._scaleArr[i]),s?h.x=this._resultX*u:h.x=this._stepXArr[i]*u,h.y=this._stepYArr[i]*u,this._stepYArr[i]<0?d.addCard(h,!1):d.addCard(h),a?c.visible=!1:0==o||s?(u==n-1&&(c.scaleX=c.scaleY=this._flagScale[i],c.x=h.x+this._flagXArr[i],c.y=h.y+this._flagYArr[i],c.visible=!0),s&&c&&(c.visible=!1)):h.data==o&&(c.scaleX=c.scaleY=this._flagScale[i],c.x=h.x+this._flagXArr[i],c.y=h.y+this._flagYArr[i],c.visible=!0);return d},e}();t.GroupCardsFactory=e,__reflect(e.prototype,"game.GroupCardsFactory")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._stepX=22,t._stepY=22,t}return __extends(i,e),i.prototype.initUI=function(){this._panel=new egret.Sprite,this.addChild(this._panel)},i.prototype.createHorseCard=function(){var t=uniLib.DisplayUtils.createBitmapByName("HorseCard_back"),e=uniLib.DisplayUtils.createBitmapByName("HorseCard_bg");t.x=this._stepX,t.y=this._stepY,this._panel.addChild(t),this._panel.addChild(e),this._defaultWidth=e.width,this._defaultHeighht=e.height},i.prototype.createHorseCardEff=function(e,i){uniLib.DisplayUtils.removeAllChildren(this._panel),this._card=new t.MySelfCard,this._card.setCard(e,1),this._card.width=this._defaultWidth,this._card.height=this._defaultHeighht,this._card.x=this._stepX,this._card.y=this._stepY;var n=new egret.Bitmap;1==i?(n=uniLib.DisplayUtils.createBitmapByName("HorseCard_hand"),this.createLizi()):n=uniLib.DisplayUtils.createBitmapByName("HorseCard_miss"),this._panel.addChild(this._card),this._panel.addChild(n)},i.prototype.createLizi=function(){this._huangg||(this._huangg=uniLib.DisplayUtils.createMovieClicp("huangg")),this._huangg.x=60,this._huangg.y=77,this.addChildAt(this._huangg,0),this._huangg.gotoAndPlay(1,-1)},i.prototype.loop_com=function(t){},i.prototype.destroy=function(){this._huangg&&(this._huangg.stop(),uniLib.DisplayUtils.removeFromParent(this._huangg)),this._huangg=null,this._panel&&(uniLib.DisplayUtils.removeAllChildren(this._panel),uniLib.DisplayUtils.removeFromParent(this._panel)),this._panel=null,this._card&&uniLib.DisplayUtils.removeFromParent(this._card),this._card=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.HorseCard=e,__reflect(e.prototype,"game.HorseCard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._stepX=50,this._defaultPoint=new egret.Point(uniLib.Global.screenWidth/2,uniLib.Global.screenHeight-230),this._bgPanel=new egret.Sprite,this._bgPanel.x=this._defaultPoint.x,this._bgPanel.y=this._defaultPoint.y+10,this.addChild(this._bgPanel),this._bgBitmap=uniLib.DisplayUtils.createBitmapByName("listenBg"),this._bgBitmap.scale9Grid=new egret.Rectangle(13,12,23,76),this._bgBitmap.height=98,this._bgPanel.addChild(this._bgBitmap)},i.prototype.setListenScene=function(e){if(e)if(this.removeListenCardData(),34==e.length||27==e.length){this._bgBitmap.width=65,this._bgPanel.x=uniLib.Global.screenWidth/2-this._bgBitmap.width/2;var i=new t.OutPutCard;i.showListenCard(e[0],1,!0),i.name="1000",this._bgPanel.addChild(i),i.x=12,i.y=15}else{this._bgBitmap.width=65+50*(e.length-1),this._bgPanel.x=uniLib.Global.screenWidth/2-this._bgBitmap.width/2;for(var n=0;n<e.length;n++){var s=new t.OutPutCard;s.showListenCard(e[n]),s.name=e[n].thisId.toString(),this._bgPanel.addChild(s),s.x=12+this._stepX*n,s.y=15}}},i.prototype.removeListenCardData=function(){for(var t=this._bgPanel.numChildren-1;t>=1;t--)this._bgPanel.removeChildAt(t)},i.prototype.destory=function(){this._bgPanel&&uniLib.DisplayUtils.removeAllChildren(this._bgPanel),this._bgPanel=null,this._bgBitmap=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.ListenCardPanel=e,__reflect(e.prototype,"game.ListenCardPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.isSelect=!1,t}return __extends(i,e),i.prototype.initUI=function(){},i.prototype.setCard=function(t,e){void 0===e&&(e=1),this.data=t,this.scale=null==e?uniLib.Global.screenWidth/1280:e*(uniLib.Global.screenWidth/1280),null!=t&&(this.cardName=table.TableCard.resNormal(t),this.showCard(),this.card.alpha=1)},i.prototype.setOpenCard=function(e){this.data=e,this.scale=t.GameConst.scaleFactor,this.goldName="GoldOpenIcon",this.cardName=table.TableCard.resOpen(e),this.showCard(),this.card.alpha=1},i.prototype.setGolden=function(t){this.isGold=t},i.prototype.getData=function(){return this.data},i.prototype.reset=function(){},i.prototype.setSelect=function(t){this.select=t,this.isSelect=t},i.prototype.getSelect=function(){return this.isSelect},i.prototype.destory=function(){uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._maskIcon=null,this.stopTimer()},i}(t.CardMJ);t.MySelfCard=e,__reflect(e.prototype,"game.MySelfCard")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){},e.prototype.setCard=function(t,e){void 0===e&&(e=1),this.scale=e;var i;i=0==t?"Wall_Card0":1==t||3==t?"Wall_Card1":"Wall_Card0",this.cardName=i,this.showCard()},e.prototype.destory=function(){uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},e}(t.CardMJ);t.OutPutBackCard=e,__reflect(e.prototype,"game.OutPutBackCard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){},i.prototype.setCard=function(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=!1),this.scale=i,this._seatId=t,this.data=e,this.cardName=table.TableCard.resPutOut(e,t),n?this.goldName="GoldIcon2":2==t||0==t?this.goldName="GoldIcon2":this.goldName="GoldIcon1",this.showCard()},i.prototype.showListenCard=function(e,i,n){void 0===i&&(i=1),void 0===n&&(n=!1),n?(this.data=1e3,this.listenNum=1e3,this.cardName="AllCard"):(this.data=e.thisId,this.listenNum=t.RoomInfo.getInstance().getShowCardRemainNum(e.thisId),this.cardName=table.TableCard.resPutOut(e.thisId,0)),this.scale=i,this.goldName="GoldIcon2",this.showCard()},Object.defineProperty(i.prototype,"seatId",{get:function(){return this._seatId},set:function(t){this._seatId=t},enumerable:!0,configurable:!0}),i.prototype.destory=function(){uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.CardMJ);t.OutPutCard=e,__reflect(e.prototype,"game.OutPutCard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._initPoint=new egret.Point(387,503),t.stepX=26,t.stepY=0,t.lineX=0,t.lineY=-36,t.numArr=[12,12],t._cardWidth=48,t}return __extends(i,e),Object.defineProperty(i.prototype,"initPoint",{get:function(){return this._initPoint},set:function(t){this._initPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),i.prototype.initCards=function(){this.cardTotal=0;for(var e=0;e<this.numArr.length;e++)this.cardTotal+=this.numArr[e];if(!this.cardArr||this.cardArr.length!=this.cardTotal){this.cardArr=new Array;for(var i,n,s=0;s<this.cardTotal;s++)i=new t.OutPutCard,n=this.getLintNum(s),i.x=Math.round(this._initPoint.x+Math.round(this.stepX)*(n.index+n.offN)+n.line*Math.round(this.lineX)),i.y=Math.round(this._initPoint.y+Math.round(this.stepY)*(n.index+n.offN)+n.line*Math.round(this.lineY)),this.stepY<0||this.lineY<0?this.addChildAt(i,0):this.addChild(i),this.cardArr.push(i);this._curIndex=0,this.outCardsGroup=[]}},i.prototype.getLintNum=function(t){for(var e={},i=0,n=0;n<this.numArr.length;n++){if(t<i+this.numArr[n])return e.line=n,e.index=t-i,e.offN=(this.numArr[0]-this.numArr[n])/2,e;i+=this.numArr[n]}return e},i.prototype.removeOutPutCard=function(e){this.outCardsGroup=ArrayUtil.removeValue(t.CardInfo.getInstance().getOutCardBySeat(this._type),e);var i=t.CardInfo.getInstance().getFlowerCardBySeat(this._type);this.outCardsGroup=i.concat(this.outCardsGroup);for(var n,s=0;s<this.cardArr.length;s++)n=this.cardArr[s],n.visible=!1,n.data=null;this._curIndex=0;for(var s=0;s<this.outCardsGroup.length;s++)this.showOutPutCard(this.outCardsGroup[s])},i.prototype.getCurOutPutPos=function(){return 0==this._curIndex?new egret.Point(Math.round(this.cardArr[0].x+this.cardArr[0].width/2),Math.round(this.cardArr[0].y)):new egret.Point(Math.round(this.cardArr[this._curIndex-1].x+this.cardArr[this._curIndex-1].width/2),Math.round(this.cardArr[this._curIndex-1].y))},i.prototype.getNextOutPutPos=function(){return null==this.cardArr[this._curIndex]?null:new egret.Point(Math.round(this.cardArr[this._curIndex].x),Math.round(this.cardArr[this._curIndex].y))},i.prototype.getNextPointPos=function(){var t=0==this.stepX?this._cardWidth:Math.abs(this.stepX);return new egret.Point(Math.round(this.cardArr[this._curIndex].x+t/2),Math.round(this.cardArr[this._curIndex].y))},i.prototype.showOutPutCard=function(t){for(var e,i=0;i<this.cardArr.length;i++)if(e=this.cardArr[i],e.data==t)return this._curIndex=i+1,this.getCurOutPutPos();return null==this.cardArr[this._curIndex]&&(this._curIndex=0),this.cardArr[this._curIndex].visible=!0,this.cardArr[this._curIndex].setCard(this._type,t),this._curIndex++,new egret.Point(Math.round(this.cardArr[this._curIndex-1].x+this.cardArr[this._curIndex-1].width/2),Math.round(this.cardArr[this._curIndex-1].y))},i.prototype.resetCard=function(){for(var t,e=0;e<this.cardArr.length;e++)t=this.cardArr[e],t.visible=!1,t.data=null;this._curIndex=0,this.outCardsGroup=[]},i.prototype.showOutPutCardArr=function(t){this._curIndex=0;for(var e=0;e<t.length;e++)this.showOutPutCard(t[e])},i.prototype.fillFlower=function(e){if(null!=e){var i=t.CardInfo.getInstance().getOutCardBySeat(this._type),n=t.CardInfo.getInstance().getFlowerCardBySeat(this._type);i=n.concat(i),this._curIndex=0;for(var s=0;s<i.length;s++){var a=i[s];null==this.cardArr[this._curIndex]&&(this._curIndex=0),this.cardArr[this._curIndex].visible=!0,this.cardArr[this._curIndex].setCard(this._type,a),this._curIndex++}}},i.prototype.destory=function(){for(var t=0;t<this.cardArr.length;t++){var e=this.cardArr[t];e.destory()}this.cardArr=null,this.outCardsGroup=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)
},i}(t.BaseVc);t.OutPutCards=e,__reflect(e.prototype,"game.OutPutCards")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.width=uniLib.Global.screenWidth,t}return __extends(i,e),i.prototype.start=function(){this.initGameSpecialData(),e.prototype.start.call(this),t.GameInfo.uiLayer=this.uiLayer,t.GameInfo.mainUILayer=this.topLayer,t.GameInfo.topLayer=this.mainUILayer,t.GameInfo.main=this.tipsLayer,this.initPositionData(),t.MahJongFourFacede.getInstance().startUp(this)},i.prototype.destroy=function(){e.prototype.destroy.call(this),t.MahJongFourFacede.getInstance().sendNotification(t.MahjongFourFacadeConst.DESTORY)},i.prototype.initGameSpecialData=function(){t.GameData.getInstance().ShortTalkArr=["哎，一手烂牌臭到底","财运来的时候，真是档也挡不住啊","出啊，好牌留着存银行啊","哈哈哈，胡牌胡到手软了","快点吧，我等的花儿都谢了","没梦游吧，都在等你呢","你的牌打的真好，让我意乱神迷了","你们是一伙的吧","牌这么好，想输都难啊","辛辛苦苦二十年，一把输到解放前","呦，牌技不错嘛","这么慢，你是属蜗牛的吧"],t.RoomInfo.getInstance().GM_Mode=!1,t.ColorConst.setGreen(1),t.RoomInfo.getInstance().setPlayType("大连推倒胡"),1042==MJLobby.MJLobbyData.getInstance().lobbyId&&t.RoomInfo.getInstance().setPlayType("通辽推倒胡"),t.RoomInfo.getInstance().gameId=5049,"pu"!=uniLib.Utils.getLocalStorage("languageMode")&&uniLib.Utils.getLocalStorage("languageMode")?t.RoomInfo.getInstance().languageMode="pu":t.RoomInfo.getInstance().languageMode="pu"},i.prototype.initPositionData=function(){this.width=t.DataCache.defaultWidth=uniLib.Global.screenWidth,this.height=t.DataCache.defaultHeight=uniLib.Global.screenHeight},i}(uniLib.GameScene);t.MJGameScene=e,__reflect(e.prototype,"game.MJGameScene")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.isDisCarding=!0,i.waitObjtimerId=0,i.timeOuttimerId=0,i.selectCard=null,i.OrginLocation=[],i.initPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.displayPos=new egret.Point(60*t.GameConst.scaleFactor,640-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.defaultPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.stepX=88*uniLib.Global.screenWidth/1280,i.stepY=0,i.takeCardStepX=10,i.takeCardStepY=0,i.userSeat=0,i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepX=44,this.outPutCards.lineY=52,this.outPutCards.stepY=0,this.outPutCards.lineX=0,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1280)/2+210,t.ResUtil.changeYAxis(335)),this.outPutCards.numArr=[18,18,18]):(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1280)/2+424,t.ResUtil.changeYAxis(335)),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.resetSelfCardPool=function(){for(var e=t.CardInfo.getInstance().MySelfCardPool.length,i=0;e>i;i++){var n=t.CardInfo.getInstance().MySelfCardPool[i];n.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),n.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)}t.CardInfo.getInstance().MySelfCardPool=[]},i.prototype.getMySelfCard=function(e){var i;if(e)for(var n=t.CardInfo.getInstance().MySelfCardPool.length,s=0;n>s;s++){var a=t.CardInfo.getInstance().MySelfCardPool[s];if(e==a.data){i=a;break}}return i||(i=new t.MySelfCard,t.CardInfo.getInstance().MySelfCardPool.push(i),i.reset()),i.setCard(e),i},i.prototype.sendCards=function(t){if(this.handsCard){var e=this.handsCard.numChildren;if(this.handCardsArr&&!(this.handCardsArr.length<=0))for(var i,n=0;t>n;n++){var s=this.handCardsArr[e+n];if(null==s)break;i=this.getMySelfCard(s),i.x=this.initPoint.x+(e+n)*Math.round(this.stepX),i.y=this.initPoint.y+(e+n)*Math.round(this.stepY),i.index=e+n,e+n==13&&(i.x+=Math.round(this.takeCardStepX),i.y+=Math.round(this.takeCardStepY)),i.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),i.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.handsCard.addChild(i)}}},i.prototype.setSigleCard=function(e,i,n){void 0===n&&(n=!1);var s;n?(s=new t.MySelfCard,s.reset(),s.setOpenCard(i)):s=this.getMySelfCard(i),s.x=this.initPoint.x+e*Math.round(this.stepX)+Math.round(this.takeCardStepX),s.y=this.initPoint.y+e*Math.round(this.stepY)+Math.round(this.takeCardStepY),s.index=e,this.stepY<0?this.handsCard.addChildAt(s,0):this.handsCard.addChild(s),s.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),s.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.prototype.GetStepLocationX=function(){return Math.floor((uniLib.Global.screenWidth-t.CardMJ.CardWidth)/2)},i.prototype.GetStepLocationY=function(){return uniLib.Global.screenHeight-Math.floor(2*t.CardMJ.CardHeight)-50},i.prototype.onTouchBegin=function(e){0==t.GameData.getInstance().waitCard&&(e.currentTarget.data>500||(2==t.RoomInfo.getInstance().playerNumber,3==t.RoomInfo.getInstance().playerNumber,4==t.RoomInfo.getInstance().playerNumber,this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),t.GameData.getInstance().isMyTime?(this.draggedObject=e.currentTarget,this.draggedObject.parent?this.draggedObject.parent.addChild(this.draggedObject):this.handsCard.addChild(this.draggedObject)):(this.draggedObject=new t.MySelfCard,this.draggedObjectDel=this.draggedObject,this.draggedObject.reset(),this.draggedObject.setCard(e.currentTarget.data),this.draggedObject.alpha=.8,this.draggedObject.x=e.currentTarget.x,this.draggedObject.y=e.currentTarget.y,this.handsCard.addChild(this.draggedObject)),this.draggedObject.getSelect()&&this.isInclude(this.draggedObject.data,t.GameData.getInstance().goldOutCardSet)&&(this.selectCard=this.draggedObject),this.OrginLocation=[e.currentTarget.x,e.currentTarget.y],this.offsetX=e.stageX-e.currentTarget.x,this.offsetY=e.stageY-e.currentTarget.y,egret.MainContext.instance.stage.hasEventListener(egret.TouchEvent.TOUCH_MOVE)&&egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),egret.MainContext.instance.stage.hasEventListener(egret.TouchEvent.TOUCH_END)&&egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)))},i.prototype.onMove=function(t){this.draggedObject&&(this.draggedObject.x=t.stageX-this.offsetX,this.draggedObject.y=t.stageY-this.offsetY,t.stageY>uniLib.Global.screenHeight-30?egret.Tween.get(this.draggedObject).to({x:this.OrginLocation[0],y:this.OrginLocation[1]},100).call(this.cancelSelect,this,[this.draggedObject]):(t.stageX<0||t.stageX>uniLib.Global.screenWidth-30||t.stageY<0)&&this.onTouchEnd(null))},i.prototype.onTouchEnd=function(e){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this);var i=this;return egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.draggedObject?0==t.GameData.getInstance().isMyTime?this.selectCard&&this.selectCard.data==this.draggedObject.data&&this.selectCard.getSelect()?(this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),void(this.draggedObject=null)):(this.selectCard&&this.selectCard.setSelect(!1),this.draggedObject&&(this.selectCard=this.getMySelfCard(this.draggedObject.data),this.selectCard.setSelect(!0),this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),this.dispatchEventWith(t.UIEventConsts.SHOW_OUTCARD,!1,this.selectCard.data)),this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),void(this.draggedObject=null)):t.GameVc.isTing&&this.draggedObject.data!=t.GameData.getInstance().lastCard?(this.isDisCarding=!1,void egret.Tween.get(this.draggedObject).to({x:this.OrginLocation[0],y:this.OrginLocation[1]},100).call(this.finishMove,this,[this.draggedObject,!1])):void(this.draggedObject.y<=uniLib.Global.screenHeight-Math.floor(2*t.CardMJ.CardHeight)?(t.GameData.getInstance().waitCard=this.draggedObject.data,this.dispatchEventWith(t.UIEventConsts.ACTION_DISCARD,!1,this.draggedObject.data),this.draggedObjectWait=this.draggedObject,this.addChild(this.draggedObjectWait),this.waitObjtimerId=setTimeout(function(){i.removeWaitObj(i.draggedObjectWait)},200),this.isDisCarding=!0,egret.Tween.get(this.draggedObject).to({x:this.GetStepLocationX(),y:this.GetStepLocationY()},1).wait(200).call(this.finishMove,this,[this.draggedObject,!0])):this.selectCard&&this.selectCard.data==this.draggedObject.data?(this.dispatchEventWith(t.UIEventConsts.REMOVE_READYHAND),t.GameData.getInstance().waitCard=this.draggedObject.data,this.dispatchEventWith(t.UIEventConsts.ACTION_DISCARD,!1,this.draggedObject.data),this.draggedObjectWait=this.draggedObject,this.addChild(this.draggedObjectWait),this.waitObjtimerId=setTimeout(function(){i.removeWaitObj(i.draggedObjectWait)},200),this.isDisCarding=!0,egret.Tween.get(this.draggedObject).to({x:this.GetStepLocationX(),y:this.GetStepLocationY()},1).wait(200).call(this.finishMove,this,[this.draggedObject,!0])):(this.isDisCarding=!1,egret.Tween.get(this.draggedObject).to({x:this.OrginLocation[0],y:this.OrginLocation[1]},100).call(this.finishMove,this,[this.draggedObject,!1]))):void 0},i.prototype.movieEnd=function(t){},i.prototype.removeWaitObj=function(){this.draggedObjectWait&&(this.draggedObjectWait.parent&&this.removeChild(this.draggedObjectWait),0!=t.GameData.getInstance().waitCard&&this.dispatchEventWith(t.UIEventConsts.USER_DODISCARD),this.draggedObjectWait=null)},i.prototype.finishMove=function(e,i){var n=this;if(e&&(egret.Tween.removeTweens(e),this.draggedObject))if(i)this.timeOuttimerId=setTimeout(function(){n.timeOutHandler()},5e3),this.selectCard=null,this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),this.draggedObject=null;else if(this.selectCard?this.selectCard&&this.draggedObject!=this.selectCard&&(this.selectCard.setSelect(!1),this.selectCard=this.draggedObject,this.selectCard.setSelect(!0)):(this.draggedObject.setSelect(!0),this.selectCard=this.draggedObject),this.checkListenCards(),t.RoomInfo.getInstance().isShowGMTool){for(var s=0;s<this.handsCard.numChildren;s++){var a=this.handsCard.getChildAt(s);this.selectCard.data!=a.data&&a.setSelect(!1)}var o=t.MahJongFourFacede.getInstance().retrieveMediator(t.DLTDHGameMJMediator.NAME),r=o.getViewComponent();r.dispatchEventWith(t.UIEventConsts.GM_SELECT_HANDCARD,!1,this.getSelectCard()),setTimeout(function(){this.selectCard=null,this.draggedObject=null},10)}},i.prototype.timeOutHandler=function(){0!=t.GameData.getInstance().waitCard&&(this.dispatchEventWith(t.UIEventConsts.USER_DODISCARD_FAIL,!1,t.GameData.getInstance().waitCard),t.GameData.getInstance().waitCard=0,t.GameData.getInstance().lastCard>0&&t.CardInfo.getInstance().removeMyCard(t.GameData.getInstance().lastCard)?(this.refreshHandCards(),t.CardInfo.getInstance().addMyCard(t.GameData.getInstance().lastCard)):this.refreshHandCards(),this.setEnable(!0))},i.prototype.cancelSelect=function(t){egret.Tween.removeTweens(t),this.initSelect(),this.selectCard=null,this.draggedObject=null},i.prototype.sortCard=function(){for(var e,i,n=this.handsCard.numChildren,s=[],a=t.RoomInfo.getInstance().goldenCard,o=!1,r=!1,h=0;n>h;h++)i=this.handsCard.getChildAt(h),i.setInitY(),e={},e.value=i.data,e.mc=i,e.isGold=!1,47==e.value&&(e.value=a[0]),s.push(e);s.sort(function(t,e){return t.value>e.value?1:t.value==e.value?0:-1}),this.curIndex+s.length>14&&this.curIndex>0&&this.curIndex--;for(var d=0;d<s.length;d++){i=s[d].mc,i.x=Math.round(this.initPoint.x+(this.curIndex+d)*Math.round(this.stepX)),i.y=this.initPoint.y+(this.curIndex+d)*Math.round(this.stepY),i.index=this.curIndex+d,this.curIndex+d==13&&(i.x+=Math.round(this.takeCardStepX),i.y+=Math.round(this.takeCardStepY));var l=t.GameData.getInstance().isGoldenCard(i.data);i.setGolden(l),this.handsCard.setChildIndex(i,d)}o=!1,r=!1},i.prototype.setEnable=function(t){console.error("setEnable",t);for(var e,i=this.handsCard.numChildren,n=0;i>n;n++)e=this.handsCard.getChildAt(n),t?(e.touchEnabled=!0,e.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)||e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),e.hasEventListener(egret.TouchEvent.TOUCH_END)||e.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)):(e.touchEnabled=!1,e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this))},i.prototype.doDraw=function(t){void 0===t&&(t=null);var e=this.getMySelfCard(t);e.x=this.initPoint.x+this.drawIndex*Math.round(this.stepX)+Math.round(this.takeCardStepX),e.y=this.initPoint.y+this.drawIndex*Math.round(this.stepY)+Math.round(this.takeCardStepY),e.index=this.drawIndex,this.stepY<0?this.handsCard.addChildAt(e,0):this.handsCard.addChild(e),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.prototype.resetHandleCardPos=function(e){void 0===e&&(e=!1),this.displayCardsMc.numChildren>0?this.initPoint.x=this.displayPos.x+this.displayCardsMc.width+20:this.initPoint.x=this.defaultPoint.x;var i,n;i=this.handsCard.numChildren;for(var s=e?70+70*(t.GameConst.scaleFactor-1):this.stepX,a=0;i>a;a++)n=this.handsCard.getChildAt(a),e?(n.x=Math.round(this.initPoint.x+a*Math.round(s)),this.initPoint.x==this.defaultPoint.x&&(n.x=Math.round(125+a*Math.round(s))),n.y=Math.round(this.initPoint.y+30+n.index*Math.round(this.stepY))):(n.x=Math.round(this.initPoint.x+n.index*Math.round(s)),n.y=Math.round(this.initPoint.y+n.index*Math.round(this.stepY))),n.index==this.drawIndex&&(n.x+=Math.round(this.takeCardStepX))},i.prototype.removeHandleCards=function(){var t,e;t=this.handsCard.numChildren;for(var i=0;t>i;i++)e=this.handsCard.getChildAt(0),e.hasEventListener(egret.TouchEvent.TOUCH_END)&&(e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)),e.destory(),e=null;uniLib.DisplayUtils.removeAllChildren(this.handsCard),this.resetSelfCardPool()},i.prototype.initSelect=function(){for(var t,e=this.handsCard.numChildren,i=0;e>i;i++)t=this.handsCard.getChildAt(i),t.setSelect(!1)},i.prototype.disposeHandCards=function(){for(var t,e=this.handsCard.numChildren,i=e-1;i>=0;i--)t=this.handsCard.getChildAt(i),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.setInitY(),t.destory(),t=null;uniLib.DisplayUtils.removeAllChildren(this.handsCard),this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),this.draggedObject=null,this.handCardsArr=[]},i.prototype.refreshHandCards=function(e,i){void 0===e&&(e=0),void 0===i&&(i=null),clearTimeout(this.timeOuttimerId),1==e&&(this.removeWaitObj(),this.dispatchEventWith(t.UIEventConsts.USER_DODISCARD_FAIL,!1,i),this.draggedObjectWait=null,clearTimeout(this.waitObjtimerId)),this.curIndex=3*this.displayCardsMc.numChildren,this.OrginLocation=[],this.disposeHandCards(),this.handCardsArr=t.CardInfo.getInstance().getHandCardBySeat(0);for(var n=0;n<this.handCardsArr.length;n++)this.setSigleCard(n,this.handCardsArr[n]);this.resetHandleCardPos(),this.displayCardsMc.numChildren>0?this.initPoint.x=this.displayPos.x+this.displayCardsMc.width+20-3*this.displayCardsMc.numChildren*this.stepX:this.initPoint.x=this.defaultPoint.x,this.sortCard()},i.prototype.selectGoldOut=function(){this.initSelect();for(var e,i=t.GameData.getInstance().goldOutCardSet,n=this.handsCard.numChildren,s=0;n>s;s++)e=this.handsCard.getChildAt(s),this.isInclude(e.data,i)&&e.setSelect(!0)},i.prototype.getSelectCard=function(){return this.selectCard?this.selectCard.data+"":""},i.prototype.isInclude=function(t,e){for(var i=!1,n=0;n<e.length;n++)t==e[n]&&(i=!0);return i},i.prototype.addListenMark=function(){this._mask=uniLib.DisplayUtils.createMask(.5,this.handsCard.width,this.handsCard.height),this._mask.x=this.initPoint.x,this._mask.y=this.initPoint.y,this._mask.touchEnabled=!0,this.addChild(this._mask)},i.prototype.removeListenMark=function(){uniLib.DisplayUtils.removeFromParent(this._mask)},i.prototype.addHostMask=function(){this.hostMask||(this.hostMask=t.ResUtil.createBitmapByName("host_mask"),this.hostMask.x=(uniLib.Global.screenWidth-this.hostMask.width)/2,this.hostMask.y=this.initPoint.y-this.hostMask.height+20,this.addChild(this.hostMask),this.hostMask.touchEnabled=!0,this.hostMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hostMaskTouch,this))},i.prototype.removeHostMask=function(){this.hostMask&&(this.hostMask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hostMaskTouch,this),uniLib.DisplayUtils.removeFromParent(this.hostMask)),this.hostMask=null},i.prototype.hostMaskTouch=function(e){this.dispatchEventWith(t.UIEventConsts.ACTION_HOST)},i.prototype.destory=function(){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._mask&&(uniLib.DisplayUtils.removeAllChildren(this._mask),uniLib.DisplayUtils.removeFromParent(this._mask)),this._mask=null,this.hostMask&&(this.hostMask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hostMaskTouch,this),uniLib.DisplayUtils.removeFromParent(this.hostMask)),this.hostMask=null,this.draggedObject&&(uniLib.DisplayUtils.removeAllChildren(this.draggedObject),uniLib.DisplayUtils.removeFromParent(this.draggedObject)),this.draggedObject=null,this.resetSelfCardPool();var t;for(this.handsCard.numChildren;this.handsCard.numChildren>0;)t=this.handsCard.getChildAt(this.handsCard.numChildren-1),t&&(t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.destory());t=null,e.prototype.destory.call(this)},i.prototype.checkListenCards=function(){var e=this;e.selectCard&&(this.dispatchEventWith(t.UIEventConsts.REMOVE_READYHAND,!1,this.selectCard.data),setTimeout(function(){if(e.selectCard&&0==e.isDisCarding&&t.RoomInfo.getInstance().last_SendCardMahjong&&t.RoomInfo.getInstance().last_SendCardMahjong.listenSet){e.showListenIcon();for(var i=0;i<t.RoomInfo.getInstance().last_SendCardMahjong.listenSet.length;i++)if(Number(t.RoomInfo.getInstance().last_SendCardMahjong.listenSet[i].toString().slice(0,2))==Number(e.selectCard.data.toString().slice(0,2))){var n=new Cmd.ListenObjMahjongCmd_C;return n.thisId=e.selectCard.data,uniLib.NetMgr.tcpSend(n),void e.selectCard.showListenIcon()}}},100))},i.prototype.getSelectCardThisId=function(){return this.selectCard?this.selectCard.data:0},i.prototype.showListenIcon=function(e){if(void 0===e&&(e=0),t.CardInfo.getInstance().drawData.listenSet){this.cacheAsBitmap=!1;for(var i=0;i<t.CardInfo.getInstance().drawData.listenSet.length;i++){var n=this.getHansCardById(t.CardInfo.getInstance().drawData.listenSet[i]);if(n)if(e)for(var s=this.getHandsCardByThisIDToBaseId(n.data),a=0;a<s.length;a++)s[a].data===e?s[a].hideListenIcon():s[a].showListenIcon();else for(var s=this.getHandsCardByThisIDToBaseId(t.CardInfo.getInstance().drawData.listenSet[i]),a=0;a<s.length;a++)this.selectCard?this.selectCard.data!=s[a].data&&s[a].showListenIcon():s[a].showListenIcon()}}},i.prototype.hideListenIcon=function(){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.listenSet)for(var e=0;e<t.CardInfo.getInstance().drawData.listenSet.length;e++){var i=this.getHansCardById(t.CardInfo.getInstance().drawData.listenSet[e]);i&&i.hideListenIcon(!0)}},i.prototype.getHansCardById=function(t){for(var e=0;e<this.handsCard.numChildren;e++){var i=this.handsCard.getChildAt(e);if(i.data==t)return i}return null},i.prototype.getHandsCardByThisIDToBaseId=function(t){for(var e=[],i=0;i<this.handsCard.numChildren;i++){var n=this.handsCard.getChildAt(i);Math.floor(n.data/10)==Math.floor(t/10)&&e.push(n)}return e},i.prototype.showUserHandCard=function(e,i,n){if(void 0===n&&(n=!1),t.RoomInfo.getInstance().GM_Mode||n){this.curIndex=3*this.displayCardsMc.numChildren,this.OrginLocation=[],this.disposeHandCards();for(var s=0;s<i.length;s++)this.setSigleCard(s,i[s],!0);for(var a=t.CardInfo.getInstance().getHandCardBySeat(e),s=0;s<a.length;s++)ArrayUtil.isInArray(a[s],i)||this.setSigleCard(s,this.handCardsArr[s]);this.resetHandleCardPos(!0)}},i.prototype.resetPoint=function(){this.initPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.displayPos=new egret.Point(60*t.GameConst.scaleFactor,640-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.defaultPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1))},i}(t.UserSideCard);t.UserSideCard0=e,__reflect(e.prototype,"game.UserSideCard0")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.defaultPoint=i.initPoint=new egret.Point(1070*t.GameConst.scaleFactor,510-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.stepX=0,i.stepY=-32,i.takeCardStepX=0,i.takeCardStepY=-10,i.userSeat=1,i.displayPos=new egret.Point(1070*t.GameConst.scaleFactor,530-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(i.stepY=-36),i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepX=0,this.outPutCards.stepY=-38,this.outPutCards.lineX=57,this.outPutCards.lineY=0,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point(860+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,t.ResUtil.changeYAxis(420)),this.outPutCards.numArr=[20,20,20]):(this.outPutCards.initPoint=new egret.Point(900*t.GameConst.scaleFactor,510-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.resetPoint=function(){this.defaultPoint=this.initPoint=new egret.Point(1070*t.GameConst.scaleFactor,510-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(this.stepY=-36)},i}(t.UserSideCard);t.UserSideCard1=e,__reflect(e.prototype,"game.UserSideCard1")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.defaultPoint=i.initPoint=new egret.Point(850*t.GameConst.scaleFactor,12),i.stepX=-44,i.stepY=0,i.takeCardStepX=-10,i.takeCardStepY=0,i.userSeat=2,i.displayPos=new egret.Point(850*t.GameConst.scaleFactor,17),1==t.RoomInfo.getInstance().video&&(i.stepX=-42),i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepY=0,this.outPutCards.lineX=0,this.outPutCards.stepX=-44,this.outPutCards.lineY=-52,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1280)/2+960,180),this.outPutCards.numArr=[18,18,18]):(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1280)/2+824,180),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.resetPoint=function(){this.defaultPoint=this.initPoint=new egret.Point(850*t.GameConst.scaleFactor,12)},i}(t.UserSideCard);t.UserSideCard2=e,__reflect(e.prototype,"game.UserSideCard2")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.defaultPoint=i.initPoint=new egret.Point(190*t.GameConst.scaleFactor,100-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.stepX=0,i.stepY=32,i.takeCardStepX=0,i.takeCardStepY=10,i.userSeat=3,i.displayPos=new egret.Point(190*t.GameConst.scaleFactor,80-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(i.stepY=36,i.displayPos.y=i.initPoint.y=40),i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepX=0,this.outPutCards.stepY=38,this.outPutCards.lineX=-58,this.outPutCards.lineY=0,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point(340+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,155),this.outPutCards.numArr=[20,20,20]):(this.outPutCards.initPoint=new egret.Point(340*t.GameConst.scaleFactor,155-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.resetPoint=function(){this.defaultPoint=this.initPoint=new egret.Point(190*t.GameConst.scaleFactor,100-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(this.stepY=36,this.displayPos.y=this.initPoint.y=40)},i}(t.UserSideCard);t.UserSideCard3=e,__reflect(e.prototype,"game.UserSideCard3")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this,2)||this;return t._colorArr=[16740864,1151744,16714752],t}return __extends(i,e),i.prototype.initPanel=function(){this.touchEnabled=!0,this.setSize(635,500),this.hideClose(),this.yesBtn=new t.GameButton(["button11","button12"]),this.yesBtn.x=36,this.yesBtn.y=398,this.addChild(this.yesBtn),this.noBtn=new t.GameButton(["button21","button22"]),this.noBtn.x=346,this.noBtn.y=398,this.addChild(this.noBtn);var e=t.ResUtil.createBitmapByName("word_agree");e.x=Math.round(this.yesBtn.x+(this.yesBtn.width-e.width)/2),e.y=this.yesBtn.y+10,e.name="infoIcon1",this.addChild(e);var i=t.ResUtil.createBitmapByName("word_refuse");i.x=Math.round(this.noBtn.x+(this.noBtn.width-i.width)/2),i.name="infoIcon2",i.y=this.noBtn.y+10,this.addChild(i),this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeHandler,this),this.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefuse,this),this.info=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"",32,50,30,500),this.info.lineSpacing=10,this.addChild(this.info);for(var n=0;4>n;n++)this["_userName"+n]=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"",32,137,173+53*n,222),this.addChild(this["_userName"+n]),this["_status"+n]=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.CENTER,"",32,328,173+53*n,150),this.addChild(this["_status"+n]);this._timeTxt=t.ResUtil.createTextFeild(14370056,egret.HorizontalAlign.RIGHT,"",25,540,15,50),this.addChild(this._timeTxt)},i.prototype.stopTimer=function(){this._timer&&(this._timer.removeEventListener(egret.TimerEvent.TIMER,this.timerHandle,this),this._timer.stop(),this._timer=null)},i.prototype.timerHandle=function(e){var i=new Date,n=i.getTime(),s=this._totalTime-(n-this._startTime)/1e3;s>0?this._timeTxt.text=Math.floor(this._totalTime-(n-this._startTime)/1e3).toString():this.dispatchEventWith(t.UIEventConsts.CLOSE)},i.prototype.setData=function(e){if(this._dissGame=1,e.waitTime){this._dissGame=0,this._totalTime=e.waitTime,this.stopTimer();var i=new Date;this._startTime=i.getTime(),this._timer=new egret.Timer(200,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.timerHandle,this),this._timer.start(),this._timeTxt.text=this._totalTime.toString()}var n=t.RoomInfo.getInstance().getUserVoByUid(e.uid);if(n){var s=t.DataCache.langObj.uiTxt.DismissPanel.info,a=s.split("#");if(e.waitTime)var o=a[0]+n.nickName+a[1];else var o=a[0]+n.nickName+"\n申请将房间人数设置为"+t.RoomInfo.getInstance().userList.length;this.info.text=o}var r=t.RoomInfo.getInstance().userList;this._userList=[];for(var h=0,d=0;d<r.length;d++)r[d]&&(this["_userName"+h].text=r[d].nickName.slice(0,7),this["_status"+h].text=t.DataCache.langObj.uiTxt.DismissPanel.status0,this["_status"+h].textColor=this._colorArr[0],this._userList.push(r[d].uid),r[d].uid==e.uid&&(this["_status"+h].textColor=this._colorArr[1],this["_status"+h].text=t.DataCache.langObj.uiTxt.DismissPanel.status1),h++);e.uid==uniLib.NetMgr.UID&&this.enableBtns()},i.prototype.setChangeUserNumData=function(t){},i.prototype.enableBtns=function(){if(this.yesBtn){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeHandler,this),this.yesBtn.visible=!1;var t=this.getChildByName("infoIcon1");t&&(t.visible=!1)}if(this.noBtn){this.noBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefuse,this),this.noBtn.visible=!1;var e=this.getChildByName("infoIcon2");e&&(e.visible=!1)}},i.prototype.updateStatus=function(e,i){0==e&&(e=2);var n=this._userList.indexOf(i);n>=0&&(this["_status"+n].text=t.DataCache.langObj.uiTxt.DismissPanel["status"+e],this["_status"+n].textColor=this._colorArr[e])},i.prototype.onAgreeHandler=function(e){0==this._dissGame?this.dispatchEventWith(t.UIEventConsts.DISMISS_BACK,!1,1):this.dispatchEventWith(t.UIEventConsts.AGREE_CHANGE_USERNUM,!1,1),this.enableBtns()},i.prototype.onRefuse=function(e){0==this._dissGame?this.dispatchEventWith(t.UIEventConsts.DISMISS_BACK,!1,0):this.dispatchEventWith(t.UIEventConsts.AGREE_CHANGE_USERNUM,!1,0),this.enableBtns()},i.prototype.destory=function(){this.enableBtns(),this.yesBtn&&this.yesBtn.destory(),this.yesBtn=null,this.noBtn&&this.noBtn.destory(),this.noBtn=null,this._timer&&(this._timer.removeEventListener(egret.TimerEvent.TIMER,this.timerHandle,this),this._timer.stop()),this._timer=null,this.info=null,this._timeTxt=null,this._userList=null,e.prototype.destory.call(this)},i}(t.BasePanel);t.DismissPanel=e,__reflect(e.prototype,"game.DismissPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this.touchEnabled=!0,this.touchChildren=!0;var e=t.ResUtil.createBitmapByName("common_bg");e.scale9Grid=new egret.Rectangle(152,130,64,31),e.width=1080,e.height=630,e.x=uniLib.Global.screenWidth-e.width>>1,e.y=uniLib.Global.screenHeight-e.height>>1,this.addChild(e),this._scroll=new egret.ScrollView,this._scroll.width=430,this._scroll.height=500,this._scroll.x=e.x+50,this._scroll.y=150,this.addChild(this._scroll),this._scroll.horizontalScrollPolicy="off",this._scroll.verticalScrollPolicy="on";var i=t.ResUtil.createBitmapByName("help_bamboo");i.x=e.x+28,i.y=e.y+20,this.addChild(i);var n=t.ResUtil.createBitmapByName("help_bamboo");n.scaleX=-1,n.x=e.x+e.width-32,n.y=e.y+20,this.addChild(n);var s=t.ResUtil.createBitmapByName("help_line");s.x=e.x+(e.width-s.width)/2,s.y=e.y+(e.height-s.height)/2,this.addChild(s),this._closeBtn=new t.GameButton(["userInfo_close1","userInfo_close2"]),this._closeBtn.x=e.x+e.width-61,this._closeBtn.y=e.y-20,this.addChild(this._closeBtn),this._closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this);var a=t.ResUtil.createBitmapByName("help_txt2");a.x=270,a.y=86,this.addChild(a);var o=t.ResUtil.createBitmapByName("help_txt1");o.x=770,o.y=86,this.addChild(o),this._txt_left=t.ResUtil.createTextFeild(402982,egret.HorizontalAlign.LEFT,"",24,0,20,430),this._txt_left.lineSpacing=6;var r="";RES.hasRes("help_5049_txt")&&(r=RES.getRes("help_5049_txt"),console.log("ok")),this._txt_left.textFlow=(new egret.HtmlTextParser).parser(r),this.addChild(this._txt_left),this._scroll.setContent(this._txt_left),this._txt_right=t.ResUtil.createTextFeild(12734997,egret.HorizontalAlign.CENTER,"",30,e.x+561,180,430),this._txt_right.height=300,this._txt_right.verticalAlign=egret.VerticalAlign.MIDDLE,this._txt_right.lineSpacing=6,this._txt_right.textFlow=(new egret.HtmlTextParser).parser(r),this.addChild(this._txt_right);
var h="",d=t.RoomInfo.getInstance().getPlayTypeByList();if(d.length<=0)return void(this._txt_right.textFlow=(new egret.HtmlTextParser).parser("房主什么都没选择,你们随意"));for(var l=0;l<d.length;l++)h=h+d[l]+"  ";this._txt_right.textFlow=(new egret.HtmlTextParser).parser(h)},i.prototype.destory=function(){e.prototype.destory.call(this),this._closeBtn&&(this._closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),this._closeBtn.destory()),this._closeBtn=null,this._scroll&&this._scroll.removeChildren(),this._scroll=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.closeHandle=function(e){this.dispatchEventWith(t.UIEventConsts.CLOSE)},i}(t.BaseVc);t.gameHelpPanel=e,__reflect(e.prototype,"game.gameHelpPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._noticeArr=[],t}return __extends(i,e),i.prototype.initUI=function(){this._buffer=30;var e=t.ResUtil.createBitmapByName("mjl_lobby_systembg");e.scale9Grid=new egret.Rectangle(100,41,14,23),e.width=624,this._txtWidth=528,this.addChild(e),this._msgTxt=t.ResUtil.createTextFeild(16777215,egret.HorizontalAlign.LEFT,"系统公告",32,55,23),this._msgTxt.verticalAlign=egret.VerticalAlign.MIDDLE,this._msgTxt.multiline=!1,uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_GM,this.onNoticeCome,this),uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_HORN,this.onNoticeCome,this),uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_SYSTEM,this.onNoticeCome,this),uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_IMPORTANT,this.onNoticeCome,this),this._txtMc=new egret.DisplayObjectContainer,this._txtMc.addChild(this._msgTxt),this._txtMc.x=75,this.addChild(this._txtMc),this._txtMc.scrollRect=new egret.Rectangle(0,0,this._txtWidth,e.height),this.visible=!1},i.prototype.startScroll=function(){this.visible=!0,egret.Tween.removeTweens(this._msgTxt),this._msgTxt.x=this._txtWidth+this._buffer;var t=this._msgTxt.textWidth<this._txtWidth?this._txtWidth:this._msgTxt.textWidth;egret.Tween.get(this._msgTxt).to({x:-(this._msgTxt.textWidth+this._buffer)},20*(t+this._buffer)).call(this.scrollEnd,this)},i.prototype.scrollEnd=function(){egret.Tween.removeTweens(this._msgTxt),this.visible=!1},i.prototype.onNoticeCome=function(t){var e=t.param;null==this._noticeArr&&(this._noticeArr=[]),this._noticeArr.push(e.info),this._msgTxt.text=this._noticeArr.shift(),this.startScroll()},i.prototype.destory=function(){e.prototype.destory.call(this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_GM,this.onNoticeCome,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_HORN,this.onNoticeCome,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_SYSTEM,this.onNoticeCome,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_IMPORTANT,this.onNoticeCome,this),this.scrollEnd(),this._txtMc&&(uniLib.DisplayUtils.removeAllChildren(this._txtMc),uniLib.DisplayUtils.removeFromParent(this._txtMc)),this._txtMc=null,this._msgTxt=null,this._noticeArr=null},i}(t.BaseVc);t.GameSysMsg=e,__reflect(e.prototype,"game.GameSysMsg")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._step=.1,"yellow_"==t.ColorConst.color?(i._lightPosArr=[new egret.Point(13,92),new egret.Point(95,13),new egret.Point(12,7),new egret.Point(8,12)],i._dirPosArr=[new egret.Point(65,106),new egret.Point(109,66),new egret.Point(65,20),new egret.Point(20,66)]):(i._lightPosArr=[new egret.Point(0,0),new egret.Point(0,0),new egret.Point(0,0),new egret.Point(0,0)],i._dirPosArr=[new egret.Point(54,86),new egret.Point(86,54),new egret.Point(54,22),new egret.Point(22,54)]),i}return __extends(i,e),i.prototype.initLight=function(e){this._seatId=e,this._highLight||(this._highLight=t.ResUtil.createBitmapByName("count_light"+(e+1)),this.addChild(this._highLight)),this._highLight.visible=!1},i.prototype.setDir=function(e){this._grayDirIcon?this._grayDirIcon.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_direction"+e+"1"):(this._grayDirIcon=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_direction"+e+"1"),this.addChild(this._grayDirIcon)),this._grayDirIcon.x=this._dirPosArr[this._seatId].x-Math.round(this._grayDirIcon.width/2),this._grayDirIcon.y=this._dirPosArr[this._seatId].y-Math.round(this._grayDirIcon.height/2),this._lightDirIcon?this._lightDirIcon.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_direction"+e+"1"):(this._lightDirIcon=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_direction"+e+"1"),this.addChild(this._lightDirIcon)),this._lightDirIcon.x=this._grayDirIcon.x,this._lightDirIcon.y=this._grayDirIcon.y,this._lightDirIcon.visible=!1},i.prototype.flash=function(t){void 0===t&&(t=0),this.stopTimer(),this._highLight.visible=!0,this._lightDirIcon.visible=!0,this._highLight.alpha=1},i.prototype.onTimer=function(t){this._highLight.alpha>=1?this._step=-Math.abs(this._step):this._highLight.alpha<=0&&(this._step=Math.abs(this._step)),this._highLight.alpha+=this._step},i.prototype.stopTimer=function(){this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer=null)},i.prototype.stop=function(){this._highLight.visible=!1,this._lightDirIcon.visible=!1,this.stopTimer()},i.prototype.destory=function(){this.stopTimer(),this._grayDirIcon=null,this._lightDirIcon=null,this._highLight=null},i}(t.BaseVc);t.HighLightItem=e,__reflect(e.prototype,"game.HighLightItem")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new RedPacketSkin_TDH,t.init(),t.addEvent(),t}return __extends(i,e),Object.defineProperty(i,"Instatnce",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.clearInstance=function(){this._instance&&(this._instance=null)},i.prototype.init=function(){this.receiveButton.visible=!1,this.amountLabel.visible=!1,this.redpacketEffect_1||(this.redpacketEffect_1=uniLib.DisplayUtils.createMovieClicp("RedPacketEffect_Stage1")),this.redpacketEffect_2||(this.redpacketEffect_2=uniLib.DisplayUtils.createMovieClicp("RedPacketEffect_Stage2")),this.redpacketEffect_3||(this.redpacketEffect_3=uniLib.DisplayUtils.createMovieClicp("RedPacketEffect_Stage3")),this.Amount=100},i.prototype.addEvent=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandle,this)},i.prototype.clickHandle=function(e){if(e.target==this.redpacketButton)this.redpacketButton.visible=!1,this.playMc(this.redpacketEffect_1,this._effectGroup,!1);else if(e.target==this._rect)this.close();else if(e.target==this.receiveButton){var i="你已经成功领取"+this.amountLabel.text+"红包,请到大厅红包管理查看！";t.GameInfo.manage.showConfirmPanel(i,["确定"],[this.close],null,this)}},i.prototype.removeEvent=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandle,this)},i.prototype.close=function(){this.dispatchEventWith(t.UIEventConsts.CLOSE)},Object.defineProperty(i.prototype,"Amount",{set:function(t){t=null!=t?t:0,this.amountLabel.textFlow=[{text:t,style:{size:50}},{text:"元",style:{size:25}}]},enumerable:!0,configurable:!0}),i.prototype.openEffectTween=function(){var t=this;egret.Tween.get(this.receiveButton).to({visible:!0,alpha:0}).to({alpha:1},500,egret.Ease.sineIn).call(function(){return t.playMc(t.redpacketEffect_3,t,!0)}),egret.Tween.get(this.amountLabel).to({visible:!0,alpha:0}).to({alpha:1},500,egret.Ease.sineIn)},i.prototype.removeOpenEffectTween=function(){egret.Tween.removeTweens(this.amountLabel),egret.Tween.removeTweens(this.receiveButton)},i.prototype.playMc=function(t,e,i){t.isPlaying&&(t.stop(),t.removeEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this)),t==this.redpacketEffect_3?(t.x=this.receiveButton.x,t.y=this.receiveButton.y-30):(t.x=0,t.y=0),t.addEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this),e.addChild(t),i?t.gotoAndPlay(1,-1):t.gotoAndPlay(1,1)},i.prototype.onMcPlayComplete=function(t){var e=this,i=t.target;i&&(i.stop(),i.removeEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this),i==this.redpacketEffect_1?egret.setTimeout(function(){uniLib.DisplayUtils.removeFromParent(i),e.playMc(e.redpacketEffect_2,e._effectGroup,!0),e.openEffectTween()},null,100):uniLib.DisplayUtils.removeFromParent(i))},i.prototype.destroy=function(){this.removeEvent(),this.removeOpenEffectTween(),i.clearInstance()},i}(eui.Component);t.RedpacketPanel=e,__reflect(e.prototype,"game.RedpacketPanel")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t.setGreen=function(t){void 0===t&&(t=0),1==t?(this.color="green_",this.colorFont=7337615,this.greenFanghao=4161647,this.resetFont=7337615):2==t&&(this.color="yellow_",this.colorFont=16773465)},t}();e.color="",e.colorFont=7055559,e.greenFanghao=4161647,e.green="green_",e.resetFont=16774656,t.ColorConst=e,__reflect(e.prototype,"game.ColorConst")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this._headMc&&(this._headMc.destory(),this._headMc=null),t.ResUtil.removeAllChildren(this),t.ResUtil.removeFromParent(this),this._userVo=null,this._nameTxt=null,this._chipTxt=null,this._grayBg=null,this._status=null},i.prototype.initUI=function(){var e=t.ResUtil.createBitmapByName("seat_bg");this.addChild(e),this._nameTxt=t.ResUtil.createTextFeild(16777215,egret.HorizontalAlign.CENTER,"",20,2,91,90),this._nameTxt.height=20,this.addChild(this._nameTxt),this._chipTxt=t.ResUtil.createTextFeild(16111946,egret.HorizontalAlign.CENTER,"",24,0,115,90),this._chipTxt.multiline=!1,this._chipTxt.height=25,this.addChild(this._chipTxt),this._headMc=new t.HeadMc(80,80),this._headMc.x=8,this._headMc.y=8,this.addChild(this._headMc),this._grayBg=t.ResUtil.createBitmapByName("seat_gray"),this._grayBg.x=0,this.addChild(this._grayBg),this._status=t.ResUtil.createBitmapByName(""),this._status.x=25,this._status.y=25,this.addChild(this._status),this._signal=t.ResUtil.createBitmapByName("nosignal"),this._signal.x=25,this._signal.y=15,this.addChild(this._signal),this._host=t.ResUtil.createBitmapByName("host"),this._host.x=10,this._host.y=25,this.addChild(this._host),this.updateStatus()},i.prototype.updateData=function(t){this._userVo=t,null!=t&&(this._nameTxt.text=t.nickName,this._headMc.headUrl=this._userVo.headUrl,this._chipTxt.text=t.remainder.toString())},i.prototype.updataChips=function(t){this._chipTxt.text=t.toString()},i.prototype.floatClear=function(t){var e=new egret.Sprite;e.x=0,e.y=75,e.alpha=0;var i;if(t>=0)i=this.createAlignBitmapText("winFloat_fnt","",0,0,120,egret.HorizontalAlign.CENTER),i.text="+"+t;else{i=this.createAlignBitmapText("loseFloat_fnt","",0,0,120,egret.HorizontalAlign.CENTER);var n=t+"";i.text="-"+Number(n.substring(1))}e.addChild(i),this.addChild(e);egret.Tween.get(e).wait(2500).to({alpha:1},100).to({y:25},500).wait(1500).to({y:5},200).call(this.moveComplete,this,[e,t])},i.prototype.moveComplete=function(t,e){this.updataChips(e),t&&(egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(t),uniLib.DisplayUtils.removeAllChildren(t))},i.prototype.updateStatus=function(t){switch(void 0===t&&(t=Cmd.OnlineState.OnlineState_Online),t){case Cmd.OnlineState.OnlineState_Online:this._grayBg.visible=!1,this._status.visible=!1,this._signal.visible=!1,this._host.visible=!1;break;case Cmd.OnlineState.OnlineState_Offline:this._status.texture=RES.getRes("offline"),this._grayBg.visible=!0,this._status.visible=!0,this._signal.visible=!1,this._host.visible=!1;break;case Cmd.OnlineState.OnlineState_Leave:this._status.texture=RES.getRes("leave"),this._grayBg.visible=!0,this._status.visible=!0,this._signal.visible=!1,this._host.visible=!1;break;case Cmd.OnlineState.OnlineState_Slow:this._grayBg.visible=!1,this._status.visible=!1,this._signal.visible=!0,this._host.visible=!1;break;case Cmd.OnlineState.OnlineState_Calling:this._grayBg.visible=!1,this._status.visible=!1,this._signal.visible=!1,this._host.visible=!1;break;case Cmd.OnlineState.OnlineState_Hosting:}},i.prototype.reset=function(){},Object.defineProperty(i.prototype,"seatId",{get:function(){return this._seatId},set:function(t){this._seatId=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._userVo},enumerable:!0,configurable:!0}),i.prototype.createAlignBitmapText=function(t,e,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=-1),void 0===a&&(a="left");var o=new ui.AlignBitmapText;return-1!=s&&(o.width=s),o.font=RES.getRes(t),o.text=e,o.x=i,o.y=n,o.hAlign=a,o},i}(t.BaseVc);t.SeatPlayer=e,__reflect(e.prototype,"game.SeatPlayer")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this,1)||this}return __extends(i,e),i.prototype.initPanel=function(){this._soundCheckArr=[],this._musicCheckArr=[],this._audioControlArr=[],this._languageArr=[],this._tableclothArr=[],this._majiangArr=[],this.setSize(625,580);var e=t.ResUtil.createBitmapByName("setting_title",45,15);this.addChild(e);var i=t.ResUtil.createBitmapByName("setting_music",53,105);this.addChild(i);var n=t.ResUtil.createBitmapByName("setting_sound",52,200);this.addChild(n);var s=t.ResUtil.createBitmapByName("setting_tablecloth",43,280);this.addChild(s);var a=(t.DataCache.langObj.uiTxt.SettingPanel,t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"音效",36,110,112,104));this.addChild(a);var o=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"音乐",36,110,200,104);this.addChild(o);var r=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"桌布",36,110,288,104);if(this.addChild(r),t.GameConst.MaJiongChange){var h=t.ResUtil.createBitmapByName("setting_majiang",52,368);this.addChild(h);var d=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"麻将",36,110,376,104);this.addChild(d)}var l=t.ResUtil.createBitmapByName("userInfo_line",30,440);l.width=550,this.addChild(l),this._restartGameBtn=new t.GameButton(["exitGame_btn1","exitGame_btn2"]),this._restartGameBtn.x=230,this._restartGameBtn.y=450,this._restartGameBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this),this.addChild(this._restartGameBtn),this._backBtn=new t.GameButton(["dismiss1","dismiss2"]),this._backBtn.touchEnabled=!0,this._backBtn.touchChildren=!0,this._backBtn.x=100,this._backBtn.y=450,this._restartGameBtn.x=350,this._backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDismiss,this),this.addChild(this._backBtn),0!=uniLib.Global.is_sandbox&&(this._restartGameBtn.visible=!1,this._backBtn.x=200);for(var c,u=0;2>u;u++)c=new t.CheckMc,c.x=226+180*u,c.y=95,c.name="sound"+u,this.addChild(c),c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.soundCheckHandle,this),this._soundCheckArr.push(c),c=new t.CheckMc,c.x=226+180*u,c.y=190,this.addChild(c),this._musicCheckArr.push(c),c.touchEnabled=!0,c.name="music"+u,c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.musicCheckHandle,this),c=new t.CheckMc,c.x=226+180*u,c.y=280,c.name="language"+u,this._languageArr.push(c),c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.languageCheckHandle,this),c=new t.CheckMc,c.x=226+180*u,c.y=280,c.name="tablecloth"+u,this.addChild(c),c.touchEnabled=!0,"tablecloth1"==c.name&&(c.touchEnabled=!0),c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tableclothCheckHandle,this),this._tableclothArr.push(c),t.GameConst.MaJiongChange&&(c=new t.CheckMc,c.x=226+180*u,c.y=370,this.addChild(c),c.touchEnabled=!0,this._majiangArr.push(c),c.name="ma"+u,c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.majiangCheckHandle,this));for(var _=t.GameConst.MaJiongChange?4:3,u=0;_>u;u++)if(a=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"开",32,299,105+95*u,100),this.addChild(a),o=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"关",32,480,105+95*u,100),this.addChild(o),2==u&&(a.text="绿色",o.text="蓝色"),3==u){var g=t.ResUtil.createBitmapByName("Card_1_1_1",300,368),p=t.ResUtil.createBitmapByName("LSH_Card_1_1_1",481,368);g.width=p.width=46,g.height=p.height=66,this.addChild(g),this.addChild(p)}uniLib.SoundMgr.instance.soundOpen?this._soundIndex=0:this._soundIndex=1,this._soundCheckArr[this._soundIndex].check=!0,uniLib.SoundMgr.instance.musicOpen?(this._musicIndex=0,uniLib.SoundMgr.instance.musicVolume=.7):this._musicIndex=1,this._musicCheckArr[this._musicIndex].check=!0,1==t.GameData.getInstance().audioPlayMode?this._audioIndex=0:this._audioIndex=1,"pu"!=uniLib.Utils.getLocalStorage("languageMode")&&uniLib.Utils.getLocalStorage("languageMode")?(this._languageIndex=1,t.RoomInfo.getInstance().languageMode="pu"):(this._languageIndex=0,t.RoomInfo.getInstance().languageMode="pu"),this._languageArr[this._languageIndex].check=!0,"green"!=uniLib.Utils.getLocalStorage("tableclothMode")&&uniLib.Utils.getLocalStorage("tableclothMode")?(this._tableclothIndex=1,t.RoomInfo.getInstance().tableclothMode="blue"):(this._tableclothIndex=0,t.RoomInfo.getInstance().tableclothMode="green"),this._tableclothArr[this._tableclothIndex].check=!0,t.GameConst.MaJiongChange&&this.updateMajiangtype()},i.prototype.updateMajiangtype=function(){var e=1==uniLib.Utils.getLocalStorage("majiangType_"+t.RoomInfo.getInstance().gameId)?1:0;0==e?this._majiangArr[0].check=!0:this._majiangArr[1].check=!0},i.prototype.languageCheckHandle=function(e){var i=Number(e.currentTarget.name.slice(8));this._languageIndex=i,this.updataLanguageCheck(),0==this._languageIndex?t.RoomInfo.getInstance().languageMode="pu":t.RoomInfo.getInstance().languageMode="pu",uniLib.Utils.setLocalStorage("languageMode",t.RoomInfo.getInstance().languageMode)},i.prototype.updataLanguageCheck=function(){for(var t=0;2>t;t++)this._languageArr[t].check=!1;this._languageArr[this._languageIndex].check=!0},i.prototype.tableclothCheckHandle=function(e){var i=Number(e.currentTarget.name.slice(10));this._tableclothIndex=i,this.updataTableclothCheck(),0==this._tableclothIndex?t.RoomInfo.getInstance().tableclothMode="green":t.RoomInfo.getInstance().tableclothMode="blue",uniLib.Utils.setLocalStorage("tableclothMode",t.RoomInfo.getInstance().tableclothMode),this.dispatchEventWith(t.UIEventConsts.CHANGE_TABLECLOTH)},i.prototype.majiangCheckHandle=function(e){for(var i=0;2>i;i++)this._majiangArr[i].check=!1;var n=0;e.target==this._majiangArr[1]&&(n=1),this._majiangArr[n].check=!0,t.GameInfo.manage.showConfirmPanel("下一局将会为您切换麻将样式！",["确定"],[],null,this),uniLib.Utils.setLocalStorage("majiangType_"+t.RoomInfo.getInstance().gameId,n)},i.prototype.updataTableclothCheck=function(){for(var t=0;2>t;t++)this._tableclothArr[t].check=!1;this._tableclothArr[this._tableclothIndex].check=!0},i.prototype.onDismiss=function(e){this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME),this.destory()},i.prototype.getSoundData=function(){var e=new Cmd.SetInfo;return e.sound=uniLib.SoundMgr.instance.soundOpen,e.music=uniLib.SoundMgr.instance.musicOpen,e.control=t.GameData.getInstance().audioPlayMode,"pu"==t.RoomInfo.getInstance().languageMode?e.dialect=1:e.dialect=2,e},i.prototype.destory=function(){if(e.prototype.destory.call(this),this._backBtn&&(this._backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDismiss,this),this._backBtn=null),this._restartGameBtn&&(this._restartGameBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this),this._restartGameBtn=null),this._soundCheckArr)for(var t=0;t<this._soundCheckArr.length;t++){var i=this._soundCheckArr[t];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.soundCheckHandle,this),i.destory()}if(this._musicCheckArr)for(var t=0;t<this._musicCheckArr.length;t++){var i=this._musicCheckArr[t];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.musicCheckHandle,this),i.destory()}if(this._audioControlArr)for(var t=0;t<this._audioControlArr.length;t++){var i=this._audioControlArr[t];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.audioContrlHandle,this),i.destory()}if(this._languageArr)for(var t=0;t<this._languageArr.length;t++){var i=this._languageArr[t];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.languageCheckHandle,this),i.destory()}if(this._majiangArr)for(var t=0;t<this._majiangArr.length;t++){var i=this._majiangArr[t];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.majiangCheckHandle,this),i.destory()}uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._audioControlArr=null,this._musicCheckArr=null,this._soundCheckArr=null,this._languageArr=null,this._majiangArr=null},i.prototype.onClose=function(e){this.dispatchEventWith(t.UIEventConsts.CLOSE)},i.prototype.soundCheckHandle=function(t){var e=Number(t.currentTarget.name.slice(5));this._soundIndex=e,this.updataSoundCheck(),0==this._soundIndex?(uniLib.SoundMgr.instance.soundVolume=1,uniLib.SoundMgr.instance.soundOpen=!0):(uniLib.SoundMgr.instance.soundVolume=0,uniLib.SoundMgr.instance.soundOpen=!1),uniLib.Utils.setLocalStorage("SoundVolime",uniLib.SoundMgr.instance.soundVolume)},i.prototype.updataSoundCheck=function(){for(var t=0;2>t;t++)this._soundCheckArr[t].check=!1;this._soundCheckArr[this._soundIndex].check=!0},i.prototype.musicCheckHandle=function(t){var e=Number(t.currentTarget.name.slice(5));this._musicIndex=e,this.updataMusicCheck(),0==this._musicIndex?(uniLib.SoundMgr.instance.musicVolume=.7,uniLib.SoundMgr.instance.musicOpen=!0,uniLib.SoundMgr.instance.playBgMusic(["bg_mp3"])):(uniLib.SoundMgr.instance.musicVolume=0,uniLib.SoundMgr.instance.musicOpen=!1),uniLib.Utils.setLocalStorage("MusicVolime",uniLib.SoundMgr.instance.musicVolume)},i.prototype.audioContrlHandle=function(e){var i=Number(e.currentTarget.name.slice(5));this._audioIndex=i,this.updataAudioCheck(),0==this._audioIndex?t.GameData.getInstance().audioPlayMode=!1:t.GameData.getInstance().audioPlayMode=!1},i.prototype.updataAudioCheck=function(){for(var t=0;2>t;t++)this._audioControlArr[t].check=!1;this._audioControlArr[this._audioIndex].check=!0},i.prototype.updataMusicCheck=function(){for(var t=0;2>t;t++)this._musicCheckArr[t].check=!1;this._musicCheckArr[this._musicIndex].check=!0},i.prototype.restartGame=function(t){uniLib.ZQGameSdk.getConfig("确定要更新游戏吗?","","确定","取消")},i}(t.BasePanel);t.SettingPanel=e,__reflect(e.prototype,"game.SettingPanel")}(game||(game={}));var game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=new XJ_ShuffleButtonSkin,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addListener,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeListener,e),e}return __extends(e,t),e.prototype.addListener=function(){this.shuffleButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},e.prototype.removeListener=function(){this.shuffleButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.shuffleButton.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addListener,this),this.shuffleButton.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListener,this)},e.prototype.onTouchTap=function(t){switch(t.target){case this.shuffleButton:var e=new Cmd.ReadyStartMahjongCmd_C;e.shuffle=1,uniLib.NetMgr.tcpSend(e)}},e.prototype.updateCost=function(t){this.shuffleButton.label=t+""},e}(eui.Component);t.ShuffleButton=e,__reflect(e.prototype,"game.ShuffleButton")}(game||(game={}));var game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=new TotalRecord_2d5_new_Skin,t.width=uniLib.Global.screenWidth,t.initUI(),t}return __extends(n,e),n.prototype.initUI=function(){this.list.itemRenderer=i,this.shareButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.againButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgain,this),this.againButton.visible=!0,0!=uniLib.Global.is_sandbox&&(this.shareButton.visible=!1),t.DataCache.platParam?this.roomIdLabel.text="房号: "+t.DataCache.platParam.roomId+"   "+t.RoomInfo.getInstance().totalNumber+"局":this.roomIdLabel.text="",this.roomTitleLabel.text=""+t.RoomInfo.getInstance().getPlayType(),1==uniLib.Global.is_sandbox&&(this.roomTitleLabel.text=""),t.GameData.getInstance().resultReason?(this.reason.text=t.GameData.getInstance().resultReason,this.reason.alpha=.65,this.reason.visible=!0):(this.reason.text=null,this.reason.visible=!1);var e=new Date,n=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();this.roomTimeLabel.text=n+"  "+this.setTimeFormat(e.getHours())+":"+this.setTimeFormat(e.getMinutes())+":"+this.setTimeFormat(e.getSeconds())},n.prototype.setTimeFormat=function(t){var e="";return e=10>t?"0"+t:t+""},n.prototype.onBack=function(e){this.dispatchEventWith(t.UIEventConsts.EXIT_GAME)},n.prototype.onAgain=function(e){this.dispatchEventWith(t.UIEventConsts.EXIT_GAME),uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"game_request_continue")},n.prototype.setData=function(e){if(this.list.dataProvider=new eui.ArrayCollection(e),e){var i,n=e.length;if(t.DataCache.platParam.roomId<1e6)for(var s=0;n>s;s++)e[s].isOwner&&e[s].uid==uniLib.UserInfo.uid&&(this.againButton.visible=!0);t.DataCache.platParam.shareInfo&&t.DataCache.platParam.shareInfo.codeUrl?i&&(i.headUrl=t.DataCache.platParam.shareInfo.codeUrl,this.addChild(i)):i&&uniLib.DisplayUtils.removeFromParent(i)}},n.prototype.onShare=function(t){var e=new uniLib.WXShareVo;e.shareWay=0;var i=new egret.Bitmap(uniLib.DisplayUtils.catchScreenToTex(this,new egret.Rectangle(0,0,this.width,this.height),.6));e.shareImageData=uniLib.DisplayUtils.catchScreen(i,new egret.Rectangle(0,0,this.width,this.height)),MJLobby.MJLobbyData.getInstance().hasXianLiao?uniLib.Global.dispatchEvent(uniLib.ZqEvent.SHARE,e,!1):uniLib.ZQGameSdk.share(e,null,this)},n.prototype.destory=function(){this.shareButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.againButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},n}(eui.Component);t.TotalRecordPanel=e,__reflect(e.prototype,"game.TotalRecordPanel");var i=function(e){function i(){var t=e.call(this)||this;return t.skinName=new TotalRecordItem_2d5_new_Skin,t}return __extends(i,e),i.prototype.dataChanged=function(){var e=this.data;if(this.hostImage.source="total_host",this.nameLabel.text=e.nickname,this.idLabel.text=e.uid+"",this.headMc.source=e.headurl,this.hostImage.visible=null==e.isOwner?!1:e.isOwner,e.isWinner?this.winIcon.visible=!0:this.winIcon.visible=!1,e.totalScore>=0?(this.winBitMapLabel.font="win_fnt",this.winBitMapLabel.text="+"+e.totalScore==null?null:e.totalScore.toString()):(this.winBitMapLabel.font="lose_fnt",this.winBitMapLabel.text=null==e.totalScore?null:e.totalScore.toString()),this.group.removeChildren(),e.perSorce)for(var i=t.DataCache.langObj.uiTxt.TotalRecordPanel,n=0;5>n;n++){var s=new eui.Label;s.size=25,s.textColor=11622706,s.textAlign=egret.HorizontalAlign.LEFT,s.width=270,s.height=27,s.text="      "+i["label"+n]+"	      "+e.perSorce[n],this.group.addChild(s)}},i}(eui.ItemRenderer);t.TotalRecordItem=i,__reflect(i.prototype,"game.TotalRecordItem")}(game||(game={}));var game;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.setResultDatas(t),i}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this._content&&(uniLib.DisplayUtils.removeAllChildren(this._content),uniLib.DisplayUtils.removeFromParent(this._content)),t.ResUtil.removeAllChildren(this),t.ResUtil.removeFromParent(this),this._goldenMjGroup=null},i.prototype.initUI=function(){this.touchEnabled=!0,this.touchChildren=!0;var e=t.ResUtil.createBitmapByName("common_bg");e.scale9Grid=new egret.Rectangle(152,130,64,31),e.width=uniLib.Global.screenWidth-238,e.height=uniLib.Global.screenHeight-210,this.addChild(e),this._closeBtn=new t.GameButton(["userInfo_close1","userInfo_close2"]),this._closeBtn.x=e.x+e.width-61,this._closeBtn.y=e.y-20,this.addChild(this._closeBtn),this._closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),this._content=new egret.Sprite,this.addChild(this._content);t.RoomInfo.getInstance().playType},i.prototype.setResultDatas=function(e){this._data=e;for(var i=t.RoomInfo.getInstance().huID,n=t.RoomInfo.getInstance().chipsSets,s=(t.RoomInfo.getInstance().cashChicken,0),a=n.length;a>s;s++){var o=n[s];1===o.winType||2===o.winType?this._content.addChild(this.setHandler(14,110*s+30,o,i)):this._content.addChild(this.setHandler(14,110*s+30,o,0))}var r=table.TableCard.resNormal(e.horseSet[0].thisId);this._goldenMjGroup=t.ResUtil.createBitmapByName(r),this._goldenMjGroup.x=897,this._goldenMjGroup.y=180,this.addChild(this._goldenMjGroup),1==t.RoomInfo.getInstance().playType?this._goldenIcon=t.ResUtil.createBitmapByName("treasure",895,185):2==t.RoomInfo.getInstance().playType&&(this._goldenIcon=t.ResUtil.createBitmapByName("treasure2",893,185)),this._goldenIcon&&this.addChild(this._goldenIcon)},i.prototype.setHandler=function(e,i,n,s){var a=new egret.Sprite;a.x=e,a.y=i;var o;o=1===n.winType||2===n.winType?t.ResUtil.createBitmapByName("result_winpop"):t.ResUtil.createBitmapByName("result_losepop"),o.scale9Grid=new egret.Rectangle(14,39,6,22),o.width=840,o.height=105,o.x=23,a.addChild(o);var r=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"力",25,125,10,810);r.text=n.nickname,a.addChild(r);var h=new t.HeadMc(80,80);h.x=30,h.y=10,a.addChild(h),h.headUrl=t.RoomInfo.getInstance().getUserVoByUid(n.uid).headUrl;var d=new egret.Sprite;d.x=120,d.y=40,a.addChild(d);n.uid;return n.userCard&&this.setCardOrder(n.userCard,s,d),a},i.prototype.setCardOrder=function(e,i,n){void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=null);var s,a=[],o=new t.OperatVo;if(e.eatSet&&e.eatSet.length>0)for(var r=0;r<e.eatSet.length;r++)o.setEatData(e.eatSet[r]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getChowCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);if(e.touchSet&&e.touchSet.length>0)for(var h=0;h<e.touchSet.length;h++)o.setPongData(e.touchSet[h]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getPongCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);if(e.barSet&&e.barSet.length>0)for(var d=0;d<e.barSet.length;d++)o.setKongData(e.barSet[d]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getGangCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);e.handCardSet||(e.handCardSet=[]);for(var l=e.handCardSet,c=0;c<l.length;c++){var u=l[c];u!=i&&a.push(u)}a.sort(function(t,e){return t>e?1:t==e?0:-1}),0!=i&&a.push(i);for(var _,g=n.width+4,c=0;c<a.length;c++)_=new t.OutPutCard,_.setCard(0,a[c],1,!0),_.x=g+42*c,c==a.length-1&&0!=i&&(_.x+=8),n.addChild(_)},i.prototype.closeHandle=function(e){this.dispatchEventWith(t.UIEventConsts.CLOSE)},i}(t.BaseVc);t.cardInfo=e,__reflect(e.prototype,"game.cardInfo")}(game||(game={}));var ResultItem=function(t){function e(){var e=t.call(this)||this;return e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.imageSorce=new egret.TextField,this.addChild(this.imageSorce),this.mutilType=new egret.TextField,this.addChild(this.mutilType)},e.prototype.setData=function(t,e,i,n){void 0===t&&(t=""),void 0===e&&(e="bank"),this.imageSorce.text=e,this.mutilType.text=t.toString(),this.isWinner=i,this.isCard=n},e.prototype.destory=function(){},e}(egret.Sprite);__reflect(ResultItem.prototype,"ResultItem");var resultItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){this.winInfo=new egret.TextField,this.winInfo.x=55,this.winInfo.y=-1,this.addChild(this.winInfo),this.winInfo.size=24,this.winInfo.textColor=16777215,this.winSorce=new egret.TextField,this.winSorce.x=160,this.winSorce.y=1,this.addChild(this.winSorce),this.winSorce.size=20,this.winSorce.textColor=16777215},e.prototype.dataChanged=function(){if(0!=this.data.$children.length){this.winInfo.text=this.data.$children[1].text,this.winSorce.text=this.data.mutilSorce;
var t=this.data.$children[0].text;this.data.isCard?this.wintype=game.ResUtil.createBitmapByName(t,18,-10,.6):this.wintype=game.ResUtil.createBitmapByName(t,15,-10),this.addChild(this.wintype),this.data.isWinner?this.winLine=game.ResUtil.createBitmapByName("win_line",10,30):this.winLine=game.ResUtil.createBitmapByName("lose_line",10,30),this.addChild(this.winLine)}},e}(eui.ItemRenderer);__reflect(resultItemRenderer.prototype,"resultItemRenderer");var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this._startBtn&&(this._startBtn.touchEnabled=!1,this._startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReady,this),this._startBtn=null),this._changeBtn&&(this._changeBtn.touchEnabled=!1,this._changeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this._changeBtn=null),this._leaveBtn&&(this._leaveBtn.touchEnabled=!1,this._leaveBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeave,this),this._leaveBtn=null),this._content&&(uniLib.DisplayUtils.removeAllChildren(this._content),uniLib.DisplayUtils.removeFromParent(this._content)),this._content=null,t.ResUtil.removeAllChildren(this),t.ResUtil.removeFromParent(this),this._data=null,this._shuffleBtn&&(this._shuffleBtn=null)},i.prototype.initUI=function(){this.touchEnabled=!0,this.touchChildren=!0;var e=t.ResUtil.createBitmapByName("public_client3");e.scale9Grid=new egret.Rectangle(430,120,15,30),e.width=uniLib.Global.screenWidth-10,e.height=620,e.y=70,this.addChild(e),this.titleBg=new eui.Image,this.addChild(this.titleBg),this._startBtn||(this._startBtn=t.ResUtil.createBitmapByName("restart_0",(uniLib.Global.screenWidth-224)/2-50,590),this._startBtn.touchEnabled=!0,this._startBtn.x=uniLib.Global.screenWidth/2-this._startBtn.width/2,this._startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReady,this),this.addChild(this._startBtn)),t.RoomInfo.getInstance().playTypeList instanceof Array&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)&&(this._changeBtn||(this._changeBtn=t.ResUtil.createBitmapByName("green_changeDesk1",150,590),this._changeBtn.touchEnabled=!0,this._changeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.addChild(this._changeBtn)),this._leaveBtn||(this._leaveBtn=t.ResUtil.createBitmapByName("green_leaveRoom1",uniLib.Global.screenWidth-224,590),this._leaveBtn.touchEnabled=!0,this._leaveBtn.x=uniLib.Global.screenWidth-this._leaveBtn.width-150,this._leaveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeave,this),this.addChild(this._leaveBtn))),this._content=new egret.Sprite,this.addChild(this._content),this._shuffleBtn=new t.ShuffleButton,this._shuffleBtn.x=(uniLib.Global.screenWidth-this._shuffleBtn.width)/2+50+300,this._shuffleBtn.y=610,this.addChild(this._shuffleBtn),this._shuffleBtn.visible=!1},i.prototype.setResultData=function(e){this._horseSet=[],this._winUID=0,this._horseWinNum=0,e.horseSet&&(this._horseSet=e.horseSet),e.winHorse&&(this._horseWinNum=e.winHorse),this.reset(),this._data=e;for(var i=e.rewardSet,n=!1,s=0;s<i.length;s++){var a=i[s];a.uid!=uniLib.NetMgr.UID||1!=a.winType&&2!=a.winType||(n=!0),0!=a.winType?((2==a.winType||1==a.winType)&&(this._winUID=a.uid),this._content.addChild(this.setHandler(0,124*s+80,a,this._data.thisId))):this._content.addChild(this.setHandler(0,124*s+80,a,0))}this._content.x=(uniLib.Global.screenWidth-this._content.width)/2,this._content.y=15,n?(uniLib.SoundMgr.instance.playSound(t.SoundConsts.WIN),this.titleBg.source="win_title"):(uniLib.SoundMgr.instance.playSound(t.SoundConsts.LOSE),this.titleBg.source="lose_title"),this.titleBg.width=758,this.titleBg.y=-150,this.titleBg.x=(uniLib.Global.screenWidth-this.titleBg.width)/2,t.RoomInfo.getInstance().host_mode&&egret.setTimeout(this.onReady,this,4e3);var o=t.RoomInfo.getInstance().playTypeList.first(function(t){return 88==t});o&&this.showShuffleBtn(e.shuffleUid,e.shuffleCost)},i.prototype.showShuffleBtn=function(t,e){void 0===e&&(e=.1),t==uniLib.NetMgr.UID?(this._shuffleBtn.visible=!0,this._startBtn.x=300,this._shuffleBtn.x=800,this._shuffleBtn.y=600,this._shuffleBtn.updateCost(e)):(this._shuffleBtn.visible=!1,this._startBtn.x=(uniLib.Global.screenWidth-this._startBtn.width)/2+50)},i.prototype.setHandler=function(e,i,n,s){var a=new egret.Sprite;a.x=e,a.y=i;var o;o=n.winType>0?t.ResUtil.createBitmapByName("result_winBg"):t.ResUtil.createBitmapByName("result_loseBg"),o.scale9Grid=new egret.Rectangle(14,39,6,22),o.width=1230,o.height=122,o.x=0,a.addChild(o);var r=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"力",20,115,10,810);r.text=n.nickname,r.x=(uniLib.Global.screenWidth-1280)/2+120;var h=new t.HeadMc(60,60),d=t.RoomInfo.getInstance().getUserVoByUid(n.uid);if(d&&(h.headUrl=d.headUrl,h.x=r.x,h.y=r.y+r.height+10),r.text=n.nickname+"     "+this.getRewardDeatail(n),a.addChild(r),a.addChild(h),n.uid==t.RoomInfo.getInstance().bankerId){var l=t.ResUtil.createBitmapByName("bank",150,2);l.scaleX=l.scaleY=.85,l.x=r.x-l.width/2,l.y=h.y-5,a.addChild(l)}if(n.winType>0){var c=new egret.Bitmap;1==n.winType?c=t.ResUtil.createBitmapByName("result_zimo",22,8):2==n.winType?c=t.ResUtil.createBitmapByName("result_win",22,37):3==n.winType&&(c=t.ResUtil.createBitmapByName("result_fangpao",23,30)),a.addChild(c)}var u=new egret.Sprite;u.x=(uniLib.Global.screenWidth-1280)/2+220,u.y=40,a.addChild(u),this.setCardOrder(n.userCard,s,u),this.setFlowerCard(n.userCard.flowerCardSet,u);var _;return n.totalReward>=0?(_=this.createAlignBitmapText("win_fnt","",(uniLib.Global.screenWidth-1280)/2+900,40,65,egret.HorizontalAlign.CENTER),_.text="+"+n.totalReward.toString()):(_=this.createAlignBitmapText("lose_fnt","",(uniLib.Global.screenWidth-1280)/2+900,40,65,egret.HorizontalAlign.CENTER),_.text=n.totalReward.toString()),a.addChild(_),a},i.prototype.setCardOrder=function(e,i,n){void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=null);var s,a=[],o=new t.OperatVo;if(e.eatSet&&e.eatSet.length>0)for(var r=0;r<e.eatSet.length;r++)o.setEatData(e.eatSet[r]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getChowCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);if(e.touchSet&&e.touchSet.length>0)for(var h=0;h<e.touchSet.length;h++)o.setPongData(e.touchSet[h]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getPongCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);if(e.barSet&&e.barSet.length>0)for(var d=0;d<e.barSet.length;d++)o.setKongData(e.barSet[d]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getGangCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);e.handCardSet||(e.handCardSet=[]);for(var l=e.handCardSet,c=0;c<l.length;c++){var u=l[c];a.push(u)}if(0!=i){var _=a.indexOf(i);-1!=_&&a.splice(_,1),a.push(i)}for(var g,p=n.width+4,c=0;c<a.length;c++)g=new t.OutPutCard,g.setCard(0,a[c],1,!0),g.x=p+46*c,c==a.length-1&&0!=i&&(g.x+=8),n.addChild(g);if(this._winUID&&this._horseSet&&this._winUID==e.uid)for(var C=780,m=-31,v=0;v<this._horseSet.length;v++){var f=this.crearteHorseCard(this._horseSet[v].thisId,this._horseSet[v].bWin);v%2==0?f.y=m:f.y=f.height+m-10,f.x=C+Math.floor(v/2)*f.width,n.addChild(f)}},i.prototype.crearteHorseCard=function(e,i){void 0===i&&(i=0);var n=new t.OutPutCard;if(n.setCard(0,e,.9,!0),0==i){var s=new egret.Sprite;s.graphics.beginFill(0,.3),s.graphics.drawRect(0,0,n.width,n.height),s.graphics.endFill(),n.addChild(s)}return n},i.prototype.setFlowerCard=function(e,i){void 0===i&&(i=null);var n,s=0;if(e){s=e.length<=4?-3:-30;for(var a=0;a<e.length;a++)n=new t.OutPutCard,n.setCard(0,e[a],1,!0),n.x=680+37*a,n.y=s,a>3&&(n.x=680+37*(a-4),n.y=18),i.addChild(n)}},i.prototype.onReady=function(){this.dispatchEventWith(t.UIEventConsts.READY)},i.prototype.onChange=function(){this.dispatchEventWith(t.UIEventConsts.EXCHANGE_DESK)},i.prototype.onLeave=function(){this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME)},i.prototype.reset=function(){this._data=null,uniLib.DisplayUtils.removeAllChildren(this._content)},i.prototype.createAlignBitmapText=function(t,e,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=-1),void 0===a&&(a="left");var o=new ui.AlignBitmapText;return-1!=s&&(o.width=s),o.font=RES.getRes(t),o.text=e,o.x=i,o.y=n,o.hAlign=a,o},i.prototype.getRewardDeatail=function(t){var e=t.multiDetailSet;if(!e||e.length<=0)return"";for(var i="",n=0;n<e.length;n++){var s=e[n];0!==s.reward&&(i=5==s.multiType||1==s.multiType?i+"  "+this.getRewardTxt(s.multiType,0):12==s.multiType||13==s.multiType?i+"  "+this.getRewardTxt(s.multiType,0)+" "+this.getReward(s.reward):i+"  "+this.getRewardTxt(s.multiType,0)+" "+this.getReward2(s.reward))}return i},i.prototype.getReward=function(t){var e="";return e=t>=0?"+"+t:t+""},i.prototype.getReward2=function(t){var e="";return e=t+"番"},i.prototype.getRewardTxt=function(t,e){return void 0===e&&(e=0),table.TableMahjongMulti.selectNameById(t)},i}(t.BaseVc);t.ResultPanel=e,__reflect(e.prototype,"game.ResultPanel")}(game||(game={}));var ui;!function(t){var e=function(t){function e(e,i,n,s,a){void 0===n&&(n=!0),void 0===s&&(s=15461355),void 0===a&&(a=1);var o=t.call(this)||this;return o.maxX=0,o.minX=0,o.maxY=0,o.minY=0,o.isCanRollY=!0,o.isShowBg=!0,o.bgColor=16777215,o.bgAlpha=1,o.lastGapX=0,o.lastGapY=0,o.touchEnabled=!0,o.content=e,o.content.touchEnabled=!0,o.addChild(o.content),o.maskRect=i,o.mask=o.maskRect,o.isShowBg=n,o.bgColor=s,o.bgAlpha=a,o.updateBg(),o.minX=o.maskRect.width-o.content.width>0?0:o.maskRect.width-o.content.width,o.minY=o.maskRect.height-o.content.height>0?0:o.maskRect.height-o.content.height,o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,o.onTouchBegin,o),o.content.addEventListener(egret.Event.RESIZE,o.onContentResize,o),o.lastTouchPoint=new egret.Point,o}return __extends(e,t),e.prototype.updateMask=function(t){this.maskRect=t,this.mask=this.maskRect,this.updateBg(),this.onContentResize(null)},e.prototype.updateBg=function(){this.isShowBg&&(this.bgSh||(this.bgSh=new egret.Shape,this.addChildAt(this.bgSh,0)),this.bgSh.graphics.clear(),this.bgSh.graphics.beginFill(this.bgColor,this.bgAlpha),this.bgSh.graphics.drawRect(0,0,this.mask.width,this.mask.height),this.bgSh.graphics.endFill())},e.prototype.onContentResize=function(t){this.minX=this.maskRect.width-this.content.width>0?0:this.maskRect.width-this.content.width;var e=this.maskRect.height-this.content.height>0?0:this.maskRect.height-this.content.height;this.minY<e?(egret.Tween.removeTweens(this.content),this.content.y=e):(egret.Tween.removeTweens(this.content),egret.Tween.get(this.content).to({y:e},100)),this.minY=e},e.prototype.onTouchBegin=function(t){this.minX=this.maskRect.width-this.content.width>0?0:this.maskRect.width-this.content.width,this.minY=this.maskRect.height-this.content.height>0?0:this.maskRect.height-this.content.height,egret.Tween.removeTweens(this.content),this.lastTouchPoint=new egret.Point(t.stageX,t.stageY),this.firstTouchPoint=new egret.Point(t.stageX,t.stageY);var e=this.stage;e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.addEventListener(egret.Event.LEAVE_STAGE,this.onLeave,this),t.preventDefault()},e.prototype.onTouchMove=function(t){this.isCanRollX&&this.checkX(t.stageX),this.isCanRollY&&this.checkY(t.stageY)},e.prototype.checkX=function(t){var e=0;if(this.firstTouchPoint.x>0){if(e=t-this.firstTouchPoint.x,Math.abs(e)<20)return;this.firstTouchPoint.x=-1}e=t-this.lastTouchPoint.x,this.lastGapX=e,this.content.x+e>0?this.content.x=this.content.x+e/2:this.content.x+e<this.minX?this.content.x=this.content.x+e/2:this.content.x=this.content.x+e,this.lastTouchPoint.x=t},e.prototype.checkY=function(t){var e=0;if(this.firstTouchPoint.y>0){if(e=t-this.firstTouchPoint.y,Math.abs(e)<20)return;this.firstTouchPoint.y=-1}e=t-this.lastTouchPoint.y,this.lastGapY=e,this.content.y+e>0?this.content.y=this.content.y+e/2:this.content.y+e<this.minY?this.content.y=this.content.y+e/2:this.content.y=this.content.y+e,this.lastTouchPoint.y=t},e.prototype.onTouchEnd=function(t){t.stopPropagation(),t.stopImmediatePropagation(),this.content.touchChildren=!0,egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this);var e=1e3;if(this.isCanRollX)if(Math.abs(this.lastGapX)>5&&this.content.x<0&&this.content.x>this.minX){var i=this.content.x+30*this.lastGapX;i>0?i/=2:i<this.minX&&(i-=(i-this.minX)/2),egret.Tween.get(this.content).to({x:i},e,egret.Ease.circOut).call(function(){this.rollEnd()},this)}else this.rollEnd();if(this.isCanRollY)if(Math.abs(this.lastGapY)>5&&this.content.y<0&&this.content.y>this.minY){var n=this.content.y+30*this.lastGapY;n>0?(n/=2,n>this.maskRect.height/2&&(n=this.maskRect.height/2),e=500):n<this.minY&&(n-=(n-this.minY)/2,n<this.minY-this.maskRect.height/2&&(n=this.minY-this.maskRect.height/2),e=500),egret.Tween.get(this.content).to({y:n},e,egret.Ease.circOut).call(function(){this.rollEnd()},this)}else this.rollEnd()},e.prototype.rollEnd=function(){this.content.x>0?egret.Tween.get(this.content).to({x:0},200):this.content.x<this.minX&&egret.Tween.get(this.content).to({x:this.minX},200),this.content.y>0?egret.Tween.get(this.content,null,null,!0).to({y:0},200):this.content.y<this.minY&&egret.Tween.get(this.content).to({y:this.minY},200)},e.prototype.onLeave=function(t){this.onTouchEnd(null)},e}(egret.Sprite);t.Scroller=e,__reflect(e.prototype,"ui.Scroller")}(ui||(ui={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._mask=new egret.Sprite,this._mask.graphics.beginFill(0,.01),this._mask.graphics.drawRect(0,0,t.DataCache.defaultWidth,t.DataCache.defaultHeight),this._mask.graphics.endFill(),this._mask.touchEnabled=!0,this.addChild(this._mask);var e=uniLib.DisplayUtils.createBitmapByName("video_bg");this.addChild(e),e.y=uniLib.Global.screenHeight/2+t.CountVc.HEIGHT/2,e.x=uniLib.Global.screenWidth/2-e.width/2,this._backBtn=new t.GameButton(["video_back1","video_back2"]),this.addChild(this._backBtn),this._backBtn.name="back",this._stopBtn=new t.GameButton(["video_stop1","video_stop2"]),this.addChild(this._stopBtn),this._stopBtn.name="stop",this._advanceBtn=new t.GameButton(["video_advance1","video_advance2"]),this.addChild(this._advanceBtn),this._advanceBtn.name="advance",this._closeBtn=new t.GameButton(["video_close1","video_close2"]),this.addChild(this._closeBtn),this._closeBtn.name="close",this._backBtn.x=e.x+2,this._stopBtn.x=this._backBtn.x+this._backBtn.width+5,this._advanceBtn.x=this._stopBtn.x+this._stopBtn.width+5,this._closeBtn.x=this._advanceBtn.x+this._advanceBtn.width+3,this._backBtn.y=this._stopBtn.y=this._advanceBtn.y=this._closeBtn.y=e.y+5,this._backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._stopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._advanceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.btnClick=function(e){var i=e.currentTarget.name;switch(i){case"back":this.dispatchEventWith(t.UIEventConsts.VIDEO_BACK);break;case"stop":this.dispatchEventWith(t.UIEventConsts.VIDEO_STOP);break;case"advance":this.dispatchEventWith(t.UIEventConsts.VIDEO_ADVANCE);break;case"close":this.dispatchEventWith(t.UIEventConsts.VIDEO_CLOSE)}},i.prototype.destory=function(){this._backBtn&&(this._backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._backBtn=null),this._stopBtn&&(this._stopBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._stopBtn=null),this._advanceBtn&&(this._advanceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._advanceBtn=null),this._closeBtn&&(this._closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._closeBtn=null),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.VideoPanel=e,__reflect(e.prototype,"game.VideoPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s.initGame(),s._cardVc=n,s._cardVc.addEventListener(t.UIEventConsts.ACTION_HOST,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.USER_DODISCARD,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.ACTION_DISCARD,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.REMOVE_READYHAND,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.ACTION_READYHAND,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,s.onOperate,s),s}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),egret.MainContext.instance.stage.removeEventListener(egret.Event.DEACTIVATE,this.onDeactivateHandler,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_ACTIVE_SOCKET_CACHE_OK,this.onActivateHandler,this),this._cardVc&&(this._cardVc.removeEventListener(t.UIEventConsts.ACTION_HOST,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.USER_DODISCARD,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.ACTION_DISCARD,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.ACTION_READYHAND,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onOperate,this),this._cardVc.destory(),this._cardVc=null)},i.prototype.onOperate=function(e){var i,n=e.type;switch(n){case t.UIEventConsts.ACTION_DISCARD:i=new Cmd.OutCardMahjongCmd_C,i.thisId=e.data,t.OperateVc.isSelectTing&&(i.listen=1,t.OperateVc.isSelectTing=!1);var s=(new Date).getTime();if(this.thisId==i.thisId&&s-this.timeStamp<200)return;this.thisId=i.thisId,this.timeStamp=s;break;case t.UIEventConsts.ACTION_READYHAND:this._cardVc.showListenPanel(e.data);break;case t.UIEventConsts.ACTION_CANCEL:i=new Cmd.CancelOpMahjongCmd_C;break;case t.UIEventConsts.REMOVE_READYHAND:this._cardVc.removeListenPanel();break;case t.UIEventConsts.ACTION_HOST:i=new Cmd.HostMahjongCmd_C,i.hostType=0;break;case t.UIEventConsts.USER_DODISCARD:this._cardVc.doDiscard(uniLib.UserInfo.uid,t.GameData.getInstance().waitCard);break;case t.UIEventConsts.USER_DODISCARD_FAIL:this._cardVc.removeOutPutCard(0,e.data)}i&&(this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA),uniLib.NetMgr.setMsgTimeout(8,"OutCardMahjongCmd_C"))},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.DRAW_NOTICE,t.MahjongFourFacadeConst.SEND_CARDS,t.MahjongFourFacadeConst.CHOW_NOTICE,t.MahjongFourFacadeConst.KONG_NOTICE,t.MahjongFourFacadeConst.PONG_NOTICE,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.GM_CHANGE_CARD,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.OUT_CARD_REFRESH,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.GAME_SET_BANKER,t.MahjongFourFacadeConst.NOTIFY_COMMON_CHAT,t.MahjongFourFacadeConst.NOTICE_CARD_ENABLE,t.MahjongFourFacadeConst.SUPPLY_FLOWER_NOTICE,t.MahjongFourFacadeConst.SELF_HANDCARD_CHANGE,t.MahjongFourFacadeConst.NOTIFY_SELECT_GOLDOUT,t.MahjongFourFacadeConst.DRAW,t.MahjongFourFacadeConst.NOTIFY_HOST,t.MahjongFourFacadeConst.REFRESH_LISTEN_SCENE,t.MahjongFourFacadeConst.SELF_OUTCARD_REFRESH,t.MahjongFourFacadeConst.VIDEO_REFRESH_HANDCARD]},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.RESET_TABLE:this._cardVc.resetTable(),this._cardVc.removeListenPanel();break;case t.MahjongFourFacadeConst.GAME_START:this._cardVc.startGame(),this._cardVc.removeListenPanel();break;case t.MahjongFourFacadeConst.GAME_SET_BANKER:this._cardVc.setBanker(e.getBody());break;case t.MahjongFourFacadeConst.USER_ENTER_ROOM:this._cardVc.creatUserCardSide(),1==t.RoomInfo.getInstance().isHostMode&&this._cardVc.setHostMask(1);break;case t.MahjongFourFacadeConst.SELF_HANDCARD_CHANGE:var i=e.getBody();if(t.RoomInfo.getInstance().isTween)return;i?this._cardVc.draw(i):this._cardVc.refreshHandCards(),this._cardVc.removeListenPanel(),this._cardVc.setEnable(!0);break;case t.MahjongFourFacadeConst.SEND_CARDS:this._cardVc.setUserCards(),this._cardVc.startSendCards();break;case t.MahjongFourFacadeConst.DRAW_NOTICE:this._cardVc.drawNotice(e.getBody());break;case t.MahjongFourFacadeConst.KONG_NOTICE:var n=e.getBody();this._cardVc.doKong(n);break;case t.MahjongFourFacadeConst.PONG_NOTICE:var s=e.getBody();this._cardVc.doPong(s);break;case t.MahjongFourFacadeConst.CHOW_NOTICE:var a=e.getBody();this._cardVc.doChow(a);break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:this._cardVc.doDiscard(t.RoomInfo.getInstance().outerId,t.RoomInfo.getInstance().OutCard.thisId),t.RoomInfo.getInstance().OutCard.isFollow&&this._cardVc.showWinEffect(20,-1,0);break;case t.MahjongFourFacadeConst.RELOGIN:this._cardVc.creatUserCardSide(),this._cardVc.refreshBanker(),this._cardVc.setRelogindata(e.getBody()),1==t.RoomInfo.getInstance().isHostMode&&this._cardVc.setHostMask(1);break;case t.MahjongFourFacadeConst.SUPPLY_FLOWER_NOTICE:this._cardVc.fillFlower(e.getBody());break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._cardVc.doWin(e.getBody()),this._cardVc.hideCardListenIcon(),this._cardVc.removeListenPanel(),this._cardVc.setEnable(!1);break;case t.MahjongFourFacadeConst.NOTIFY_COMMON_CHAT:var o=e.getBody();o.voiceId?this._cardVc.showCommonChat(o.uid,String(o.voiceId)):o.words&&this._cardVc.showCommonTalk(o.uid,o.words);break;case t.MahjongFourFacadeConst.NOTIFY_SELECT_GOLDOUT:this._cardVc.selectGoldOut();break;case t.MahjongFourFacadeConst.OUT_CARD_REFRESH:this._cardVc.refreshHandCards(1,e.getBody()),this._cardVc.removeOutPutCard(0,e.getBody());break;case t.MahjongFourFacadeConst.GM_CHANGE_CARD:this._cardVc.refreshHandCards();break;case t.MahjongFourFacadeConst.NOTICE_CARD_ENABLE:var r=e.getBody();this._cardVc.setEnable(r);break;case t.MahjongFourFacadeConst.DRAW:t.CardInfo.getInstance().drawData.listenSet&&0!=t.CardInfo.getInstance().drawData.listenSet.length&&this._cardVc.setListenCard();break;case t.MahjongFourFacadeConst.REFRESH_LISTEN_SCENE:this._cardVc.showListenPanel1(e.getBody());break;case t.MahjongFourFacadeConst.NOTIFY_HOST:var h=e.getBody();h.uid==uniLib.UserInfo.uid&&this._cardVc.setHostMask(h.hostType);break;case t.MahjongFourFacadeConst.VIDEO_REFRESH_HANDCARD:this._cardVc.videoRefresh(e.getBody());break;case t.MahjongFourFacadeConst.SELF_OUTCARD_REFRESH:this._cardVc.refreshOutCards()}},i.prototype.initGame=function(){egret.MainContext.instance.stage.addEventListener(egret.Event.DEACTIVATE,this.onDeactivateHandler,this),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_ACTIVE_SOCKET_CACHE_OK,this.onActivateHandler,this)},i.prototype.onActivateHandler=function(t){this._cardVc.refreshBanker(),this._cardVc.refreshTempCard()},i.prototype.onDeactivateHandler=function(){this._cardVc.hidePointMc()},i}(puremvc.Mediator);e.NAME="CardMJMediator",t.CardMJMediator=e,__reflect(e.prototype,"game.CardMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(t){var n=e.call(this,i.NAME,t)||this;return n._countVc=t,n}return __extends(i,e),i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.SEND_CARDS,t.MahjongFourFacadeConst.PONG_NOTICE,t.MahjongFourFacadeConst.KONG_NOTICE,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.DRAW_NOTICE,t.MahjongFourFacadeConst.CHOW_NOTICE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.GAME_SET_BANKER,t.MahjongFourFacadeConst.NOTIFY_EAST_LOCATION]},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.SEND_CARDS:this._countVc.setCount(t.RoomInfo.getInstance().bankerSeatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.USER_ENTER_ROOM:break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:if(t.RoomInfo.getInstance().opCount){var i=t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().outerId);2==t.RoomInfo.getInstance().playerNumber?(1==t.RoomInfo.getInstance().OutCard.isOp,this._countVc.setCount((i+2)%4,t.RoomInfo.getInstance().opCount,t.RoomInfo.getInstance().OutCard.isOp)):3==t.RoomInfo.getInstance().playerNumber?1==i?this._countVc.setCount((i+2)%4,t.RoomInfo.getInstance().opCount):this._countVc.setCount((i+1)%4,t.RoomInfo.getInstance().opCount):this._countVc.setCount((i+1)%4,t.RoomInfo.getInstance().opCount,t.RoomInfo.getInstance().OutCard.isOp)}break;case t.MahjongFourFacadeConst.DRAW_NOTICE:t.RoomInfo.getInstance().outCount&&this._countVc.setCount(t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().outerId),t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.KONG_NOTICE:var n=e.getBody();this._countVc.setCount(n.seatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.PONG_NOTICE:var s=e.getBody();this._countVc.setCount(s.seatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.CHOW_NOTICE:var a=e.getBody();this._countVc.setCount(a.seatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.RELOGIN:if(t.RoomInfo.getInstance().eastUid){var o=t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().eastUid);this._countVc.setEast(o)}break;case t.MahjongFourFacadeConst.RESET_TABLE:this._countVc.reset();break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._countVc.reset();break;case t.MahjongFourFacadeConst.NOTIFY_EAST_LOCATION:var r=t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().eastUid);this._countVc.setEast(r);break;case t.MahjongFourFacadeConst.GAME_SET_BANKER:this._countVc.setCount(t.RoomInfo.getInstance().bankerSeatId,t.RoomInfo.getInstance().outCount)}},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this._countVc&&(this._countVc.destory(),this._countVc=null)},i}(puremvc.Mediator);e.NAME="CountMJMediator",t.CountMJMediator=e,__reflect(e.prototype,"game.CountMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s._mySelect="",s._gmSelect="",s._stopVideo=!1,s._isClick=!0,s._gameVc=s.viewComponent=new t.GameVc,t.GameInfo.uiLayer.addChild(s._gameVc),s.initGame(),s._gameVc.addEventListener(t.UIEventConsts.READY,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.EXCHANGE_DESK,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.DESTORY,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_HELP,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_GPS,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.EXIT_GAME,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.DISMISS_GAME,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHARE_GAME,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_GM_Tool,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_SETTING,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.ACTION_HOST,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_STOP_SERVICE,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_SHORT_CHAT,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GET_SCORE_DATA,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GM_SELECT_CARDS,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GM_SELECT_HANDCARD,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GM_SELECT_HEAPCARD,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.REQUEST_CHANGE_USERNUM,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_BACK,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_ADVANCE,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_CLOSE,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_STOP,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.START_READY,s.uiHandle,s),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_L2G,s.onMoon,s),s}return __extends(i,e),i.prototype.uiHandle=function(e){switch(e.type){case t.UIEventConsts.GET_SCORE_DATA:this.getScoreList();break;case t.UIEventConsts.START_READY:1==e.data?this.cancelReady():this.startReady();break;case t.UIEventConsts.EXCHANGE_DESK:this.changeDeak();break;case t.UIEventConsts.DESTORY:this.sendNotification(t.MahjongFourFacadeConst.DESTORY);break;case t.UIEventConsts.READY:if(t.GameData.getInstance().recordInfo)this.showTotal(t.GameData.getInstance().recordInfo);else{var i=new Cmd.ReadyStartMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA)}break;case t.UIEventConsts.SHOW_SETTING:this.showSetting();break;case t.UIEventConsts.SHOW_GM_Tool:this.showGmTool();break;case t.UIEventConsts.EXIT_GAME:this.exitGame();break;case t.UIEventConsts.SHARE_GAME:this.showShare();break;case t.UIEventConsts.DISMISS_GAME:1==e.data?this.showDismissConfirm():this.showLeaveRoom();break;case t.UIEventConsts.SHOW_SHORT_CHAT:this._shortChat&&this._shortChat.visible?this.hideShortChat():this.showShortChat();break;case t.UIEventConsts.GM_SELECT_HANDCARD:var n=e.data;this._mySelect=n,this.requestChange();break;case t.UIEventConsts.GM_SELECT_HEAPCARD:var s=e.data;this._gmSelect=s,this.requestChange();break;case t.UIEventConsts.GM_SELECT_CARDS:this.requestChanges(e.data);break;case t.UIEventConsts.SHOW_STOP_SERVICE:this.showStopServiceNotice();break;case t.UIEventConsts.ACTION_HOST:var a=new Cmd.HostMahjongCmd_C;1==t.RoomInfo.getInstance().isHostMode?a.hostType=0:a.hostType=1,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,a,t.DataRequestCommand.GAME_DATA);break;case t.UIEventConsts.SHOW_HELP:this.showHelp();break;case t.UIEventConsts.REQUEST_CHANGE_USERNUM:var o=new Cmd.RequestChangeUserNbrRoom_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,o,t.DataRequestCommand.GAME_DATA);break;case t.UIEventConsts.VIDEO_BACK:uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_back");break;case t.UIEventConsts.VIDEO_ADVANCE:uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_advance");break;case t.UIEventConsts.VIDEO_CLOSE:this.showVideoFinish(1);break;case t.UIEventConsts.VIDEO_STOP:uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_stop");break;case t.UIEventConsts.SHOW_GPS:var r=new Cmd.RequestIpGPSCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,r,t.DataRequestCommand.GAME_DATA),this.showGps()}},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.DESTORY,t.MahjongFourFacadeConst.GM_DELETE,t.MahjongFourFacadeConst.EXIT_GAME,t.MahjongFourFacadeConst.SEND_CARDS,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.DISS_NOTICE,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.GM_HEAP_CARD,t.MahjongFourFacadeConst.GM_CHANGE_CARD,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.NOTIFY_SAME_IP,t.MahjongFourFacadeConst.LASTCARD_CHANGE,t.MahjongFourFacadeConst.TURNGOLD_NOTICE,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.TOTAL_RECORD_DATA,t.MahjongFourFacadeConst.DISS_RESULT_NOTICE,t.MahjongFourFacadeConst.NOTIFY_CHAT_RECORD,t.MahjongFourFacadeConst.RESET_RESULT_PANEL,t.MahjongFourFacadeConst.SELF_DISCARD_NOTICE,t.MahjongFourFacadeConst.DISS_REQUEST_NOTICE,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.GAME_SET_BANKER,t.MahjongFourFacadeConst.STOP_SREVICE_NOTICE,t.MahjongFourFacadeConst.CHANGE_USERNUM_NOTICE,t.MahjongFourFacadeConst.CHANGE_USERNUM_BACK,t.MahjongFourFacadeConst.SHOW_CHANGE_BTN,t.MahjongFourFacadeConst.TIMEOUT_WAIT,t.MahjongFourFacadeConst.CANCEL_READY_NOTICE,t.MahjongFourFacadeConst.READY_NOTICE,t.MahjongFourFacadeConst.READY_SHOW,t.MahjongFourFacadeConst.START_lISTEN_NOTICE,t.MahjongFourFacadeConst.DRAW,t.MahjongFourFacadeConst.ReturnIpAndGPS]
},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.USER_ENTER_ROOM:this._gameVc.updateRoomId(),this._gameVc.updateEnterRoom(),this._gameVc.updateGhostData(),this._gameVc.showDissBtn(),this._gameVc.createRoomRules();break;case t.MahjongFourFacadeConst.GAME_START:this._gameVc.reset(),this._gameVc.updateRound(),this._gameVc.disposeBtn(),this._gameVc.updateRoomId();break;case t.MahjongFourFacadeConst.CANCEL_READY_NOTICE:e.getBody()===uniLib.UserInfo.uid&&this._gameVc.cancelReady();break;case t.MahjongFourFacadeConst.SEND_CARDS:this._gameVc.disposeBtn(),this._gameVc.refreshCard(),this._gameVc.setGoldenMj();break;case t.MahjongFourFacadeConst.RESET_TABLE:this._gameVc.reset();break;case t.MahjongFourFacadeConst.RESULT_NOTICE:var i=e.getBody();this._gameVc.showResult(i),this._gameVc.clearListenPanel();break;case t.MahjongFourFacadeConst.LASTCARD_CHANGE:this._gameVc.refreshCard();break;case t.MahjongFourFacadeConst.RELOGIN:this._gameVc.updateRound(),this._gameVc.updateRoomId(),this._gameVc.updateEnterRoom(),this._gameVc.setGoldenMj();var n=e.getBody();n.userCard&&n.userCard.handCardSet&&n.userCard.handCardSet.length>0&&(this._gameVc.disposeBtn(),this._gameVc.refreshCard());break;case t.MahjongFourFacadeConst.TURNGOLD_NOTICE:this._gameVc.setGoldenMj(1);break;case t.MahjongFourFacadeConst.SELF_DISCARD_NOTICE:this._gameVc.showListenIcon(t.CardInfo.getInstance().winCardSet);break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:t.CardInfo.getInstance().freshListenData&&(t.CardInfo.getInstance().freshListenData=!1,this._gameVc.refreshListenPanel());break;case t.MahjongFourFacadeConst.TOTAL_RECORD_DATA:this.showTotal(e.getBody());break;case t.MahjongFourFacadeConst.DISS_RESULT_NOTICE:var s=e.getBody();this.dissData=s;var a,o="";s.bOk?(o=t.DataCache.langObj.uiTxt.DismissPanel.success,a=s.agreeUsers):(o=t.DataCache.langObj.uiTxt.DismissPanel.fail,a=s.disagreeUsers);var r=o.split("#");s.bOk?t.GameInfo.manage.showConfirmPanel(r[0]+a.toString()+r[1],["确定"],[this.dismissok],null,this,0,!1):t.GameInfo.manage.showConfirmPanel(r[0]+a.toString()+r[1],["确定"],[],null,this,0,!1),this.removeDissPanel();break;case t.MahjongFourFacadeConst.CHANGE_USERNUM_NOTICE:case t.MahjongFourFacadeConst.DISS_REQUEST_NOTICE:var h=t.RoomInfo.getInstance().getUserVoByUid(e.getBody().uid);h&&this.showDissPanel(e.getBody());break;case t.MahjongFourFacadeConst.CHANGE_USERNUM_BACK:case t.MahjongFourFacadeConst.DISS_NOTICE:if(this._dismissPanel){var d=e.getBody();this._dismissPanel.updateStatus(d.isAgree,d.uid)}break;case t.MahjongFourFacadeConst.NOTIFY_CHAT_RECORD:this._shortChat&&this._shortChat.setRecordData(e.getBody());break;case t.MahjongFourFacadeConst.EXIT_GAME:this.exitGame();break;case t.MahjongFourFacadeConst.RESET_RESULT_PANEL:this._gameVc.removeResultPanel();break;case t.MahjongFourFacadeConst.NOTIFY_SAME_IP:var l=e.getBody();l.sameSet&&l.sameSet.length>0&&this.ipWarnPanel(l.sameSet);break;case t.MahjongFourFacadeConst.GM_HEAP_CARD:this._gmTool&&(t.GameInfo.topLayer.addChild(this._gmTool),this._gmTool.setHeapCard(t.CardInfo.getInstance().heapCard),this._gmTool.setTypeButton(e.getBody()));break;case t.MahjongFourFacadeConst.GM_CHANGE_CARD:this._gmTool&&this._gmTool.setHeapCard(t.CardInfo.getInstance().heapCard);break;case t.MahjongFourFacadeConst.GM_DELETE:t.PublicManage.getInstance().showMildWarnShow("请等待发牌后，执行GM"),this._gmTool&&this._gmTool.destory(),this._gmTool=null;break;case t.MahjongFourFacadeConst.STOP_SREVICE_NOTICE:this._gameVc.setStopService();break;case t.MahjongFourFacadeConst.GAME_SET_BANKER:this._gameVc.updateNetWork(!0);break;case t.MahjongFourFacadeConst.SHOW_CHANGE_BTN:this._gameVc.ShowChangeIcon();break;case t.MahjongFourFacadeConst.TIMEOUT_WAIT:var c=e.getBody();this._gameVc.updateTimeout(c);break;case t.MahjongFourFacadeConst.READY_SHOW:case t.MahjongFourFacadeConst.READY_NOTICE:e.getBody()===uniLib.UserInfo.uid&&this._gameVc.changeReay(),this._gameVc.updateReadyState();break;case t.MahjongFourFacadeConst.START_lISTEN_NOTICE:}},i.prototype.ipWarnPanel=function(e){for(var i="",n=0;n<e.length;n++)n==e.length-1?i+=e[n]:i=i+e[n]+",";t.GameInfo.manage.showConfirmPanel("玩家"+i+"IP相同,请注意",["确定"],[],null,this,0,!1)},i.prototype.initGame=function(){var e=new t.CountVc;e.x=(uniLib.Global.screenWidth-e.width)/2,e.y=uniLib.Global.screenHeight-e.height-t.CountVc.OFFSET_Y>>1,t.GameInfo.uiLayer.addChild(e),this.facade.registerMediator(new t.CountMJMediator(e));var i=new t.SeatPlayVc;t.GameInfo.uiLayer.addChild(i),this.facade.registerMediator(new t.SeatPlayerMJMediator(i));var n=new t.VoiceChat;n.updateBtnRes(["game_NDvoice_btn1","game_NDvoice_btn2"]),t.GameInfo.uiLayer.addChild(n),n.voiceButtonX=uniLib.Global.screenWidth-88,n.voiceButtonY=500,this.facade.registerMediator(new t.VoiceChatMediator(n));var s=new t.CardsVc;t.GameInfo.uiLayer.addChild(s),this.facade.registerMediator(new t.CardMJMediator(s));var a=new t.OperateVc;t.GameInfo.topLayer.addChild(a),this.facade.registerMediator(new t.OperateMJMediator(a)),this.facade.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,null,t.DataRequestCommand.CONNECT_GAME_SERVER),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_SERVER_DEBUG_LEVEL,this.setDebugState,this)},i.prototype.setDebugState=function(t){this._gameVc.showDebugButton()},i.prototype.onTouchHandler=function(t){var e=t.target.name;e.indexOf("short")>=0||this._shortChat&&this._shortChat.visible&&this.hideShortChat()},i.prototype.getScoreList=function(){var e=new Cmd.GetRankingListRoomCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.facade.removeMediator(t.CountMJMediator.NAME),this.facade.removeMediator(t.SeatPlayerMJMediator.NAME),this.facade.removeMediator(t.CardMJMediator.NAME),this.facade.removeMediator(t.OperateMJMediator.NAME),this.facade.removeMediator(t.VoiceChatMediator.NAME),this._gameVc&&(this._gameVc.removeEventListener(t.UIEventConsts.READY,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.DESTORY,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_HELP,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.EXIT_GAME,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.DISMISS_GAME,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHARE_GAME,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.ACTION_HOST,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_GM_Tool,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_SETTING,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_STOP_SERVICE,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_SHORT_CHAT,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GET_SCORE_DATA,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GM_SELECT_CARDS,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GM_SELECT_HANDCARD,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GM_SELECT_HEAPCARD,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.REQUEST_CHANGE_USERNUM,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_BACK,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_ADVANCE,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_CLOSE,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.START_READY,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_STOP,this.uiHandle,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_L2G,this.onMoon,this),uniLib.Global.removeEventListener(t.UIEventConsts.EXCHANGE_DESK,this.onMoon,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_GPS,this.uiHandle,this),this._gameVc.destory(),this._gameVc=null),this.removeShortChat(),this.removeDissPanel(),this.removeTotalPanel(),this.removeHelp(),this.removeSetting(),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_SERVER_DEBUG_LEVEL,this.setDebugState,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this)},i.prototype.showGps=function(){t.GpsPanel.Instance&&t.GpsPanel.Instance.addEventListener(t.UIEventConsts.CLOSE,this.removeGps,this),t.PopupManager.addPopUp(t.GpsPanel.Instance,!0,!0);var e=t.RoomInfo.getInstance().userList;if(e&&e.length>0)for(var i=0,n=e;i<n.length;i++){var s=n[i],a=t.RoomInfo.getInstance().getSeatNoByUserId(s.uid);t.GpsPanel.Instance.addUserGpsIcon(a)}},i.prototype.removeGps=function(){t.GpsPanel.Instance&&(t.GpsPanel.Instance.removeEventListener(t.UIEventConsts.CLOSE,this.removeGps,this),t.PopupManager.removePopUp(t.GpsPanel.Instance))},i.prototype.showTotal=function(t){egret.Tween.removeTweens(this),this.showResultPanel(t),t=null!=t&&t instanceof Array?t:[];var e=t.first(function(t){return t.uid==uniLib.NetMgr.UID});null!=e&&null!=e.redpack&&e.redpack>0&&(this._redpacketPanel||this.showRedPacketPanel(),this._redpacketPanel.Amount=e.redpack)},i.prototype.showResultPanel=function(e){egret.Tween.removeTweens(this),this._gameVc.removeResultPanel(),this._recordPanel||(this._recordPanel=new t.TotalRecordPanel,this._recordPanel.setData(e),this._recordPanel.addEventListener(t.UIEventConsts.EXIT_GAME,this.exitGame,this),t.PopupManager.addPopUp(this._recordPanel,!0,!1,!1,930,480))},i.prototype.removeTotalPanel=function(){this._recordPanel&&(t.PopupManager.removePopUp(this._recordPanel),this._recordPanel.destory(),this._recordPanel=null)},i.prototype.showHelp=function(){this._helpPanel||(this._helpPanel=new t.gameHelpPanel,this._helpPanel.addEventListener(t.UIEventConsts.CLOSE,this.removeHelp,this)),t.PopupManager.addPopUp(this._helpPanel,!0)},i.prototype.removeHelp=function(){this._helpPanel&&(this._helpPanel.removeEventListener(t.UIEventConsts.CLOSE,this.removeSetting,this),uniLib.DisplayUtils.removeFromParent(this._helpPanel),this._helpPanel.destory(),t.PopupManager.removePopUp(this._helpPanel),this._helpPanel=null)},i.prototype.showSetting=function(){this._settingPanel||(this._settingPanel=new t.SettingPanel,this._settingPanel.addEventListener(t.UIEventConsts.CLOSE,this.removeSetting,this),this._settingPanel.addEventListener(t.UIEventConsts.CHANGE_TABLECLOTH,this.tableclothChange,this),this._settingPanel.addEventListener(t.UIEventConsts.DISMISS_GAME,this.showDismissConfirm,this)),t.PopupManager.addPopUp(this._settingPanel,!0,!0)},i.prototype.removeSetting=function(){this._settingPanel&&(this._settingPanel.removeEventListener(t.UIEventConsts.CLOSE,this.removeSetting,this),this._settingPanel.removeEventListener(t.UIEventConsts.DISMISS_BACK,this.showDismissConfirm,this),this._settingPanel.removeEventListener(t.UIEventConsts.AGREE_CHANGE_USERNUM,this.showDismissConfirm,this),t.PopupManager.removePopUp(this._settingPanel),this._settingPanel.destory(),this._settingPanel=null)},i.prototype.tableclothChange=function(){this._gameVc.changeTablecloth()},i.prototype.showShortChat=function(){this._shortChat?(this._shortChat.visible=!0,t.PopupManager.addPopUp(this._shortChat,!0)):(this._shortChat=new t.RoomFacePanel,this._shortChat.x=uniLib.Global.screenWidth/2-this._shortChat.width/2,this._shortChat.addEventListener(t.UIEventConsts.SEND_CHAT_RECORD,this.requestRecord,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_TALK,this.commonTalkHandler,this),t.PopupManager.addPopUp(this._shortChat))},i.prototype.requestRecord=function(){var e=new Cmd.VoiceChatRecord_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.commonTalkHandler=function(e){var i=this;if(!this._isClick)return void t.PublicManage.getInstance().showMildWarnShow("您的操作太频繁了！请休息一下吧");var n=e.data,s=new Cmd.CommonChat_C;s.words=n,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,s,t.DataRequestCommand.GAME_DATA),uniLib.NetMgr.setMsgTimeout(8,"CommonChat_C"),this._isClick=!1,setTimeout(function(){i._isClick=!0},3e3),this.hideShortChat()},i.prototype.commonChatHandler=function(e){var i=this;if(!this._isClick)return void t.PublicManage.getInstance().showMildWarnShow("您的操作太频繁了！请休息一下吧");var n=e.data,s=new Cmd.CommonChat_C;s.voiceId=Number(n),this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,s,t.DataRequestCommand.GAME_DATA),this._isClick=!1,setTimeout(function(){i._isClick=!0},3e3),this.hideShortChat()},i.prototype.hideShortChat=function(){this._shortChat&&(this._shortChat.visible=!1,t.PopupManager.removePopUp(this._shortChat))},i.prototype.removeShortChat=function(){this._shortChat&&(this._shortChat.removeEventListener(t.UIEventConsts.SEND_CHAT_RECORD,this.requestRecord,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_TALK,this.commonTalkHandler,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.destory()),this._shortChat=null},i.prototype.showGmTool=function(){this._gmTool?(t.RoomInfo.getInstance().isShowGMTool=!1,this._gmTool.destory(),this._gmTool=null):(this._gmTool=new t.RoomGmTool,t.RoomInfo.getInstance().isShowGMTool=!0,this.requestGm())},i.prototype.requestGm=function(){var e=new Cmd.HeapCardGmMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.showShare=function(){var e=new uniLib.WXShareVo;e.shareWay=0,t.DataCache.platParam&&(e.title=t.DataCache.platParam.shareInfo.title,e.description=t.DataCache.platParam.shareInfo.content+t.RoomInfo.getInstance().getAllNames(),e.webpageUrl=t.DataCache.platParam.shareInfo.webPageUrl),MJLobby.MJLobbyData.getInstance().hasXianLiao?uniLib.Global.dispatchEvent(uniLib.ZqEvent.SHARE,e,!1):uniLib.ZQGameSdk.share(e,null,this)},i.prototype.showDismissConfirm=function(){var e=e=t.DataCache.langObj.alertTxt.dismissTip;this.removeSetting(),t.GameInfo.manage.showConfirmPanel(e,["确定","取消"],[this.onDismissYesHandler],null,this)},i.prototype.showLeaveRoom=function(){t.GameInfo.manage.showConfirmPanel("确定要退出房间",["确定","取消"],[this.onLeaveRoom],null,this)},i.prototype.startReady=function(){var e=new Cmd.ReadyStartMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.cancelReady=function(){var e=new Cmd.ReadyStartMahjongCmd_C;e.type=0,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.changeDeak=function(){var e=new Cmd.ChangeRoomMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.onLeaveRoom=function(){var e=new Cmd.LeaveMahjongCmd_C;e.state=0,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.onDismissYesHandler=function(e){var i=new Cmd.RequestDissolveRoom_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA)},i.prototype.dismissok=function(e){this.removeDissPanel();var i=t.GameData.getInstance().recordInfo;i?this.showResultPanel(i):this.exitGame()},i.prototype.showDissPanel=function(e){null!=e&&(this._dismissPanel&&this.removeDissPanel(),this._dismissPanel||(this._dismissPanel=new t.DismissPanel,this._dismissPanel.x=uniLib.Global.screenWidth-this._dismissPanel.width>>1,this._dismissPanel.y=uniLib.Global.screenHeight-this._dismissPanel.height>>1,this._dismissPanel.setData(e),this._dismissPanel.addEventListener(t.UIEventConsts.CLOSE,this.dissHandle,this),this._dismissPanel.addEventListener(t.UIEventConsts.DISMISS_BACK,this.dissHandle,this),this._dismissPanel.addEventListener(t.UIEventConsts.AGREE_CHANGE_USERNUM,this.dissHandle,this)),t.PopupManager.addPopUp(this._dismissPanel,!0,!0))},i.prototype.removeDissPanel=function(){this._dismissPanel&&(this._dismissPanel.removeEventListener(t.UIEventConsts.CLOSE,this.dissHandle,this),this._dismissPanel.removeEventListener(t.UIEventConsts.DISMISS_BACK,this.dissHandle,this),this._dismissPanel.removeEventListener(t.UIEventConsts.AGREE_CHANGE_USERNUM,this.dissHandle,this),t.PopupManager.removePopUp(this._dismissPanel),this._dismissPanel.destory()),this._dismissPanel=null},i.prototype.dissHandle=function(e){switch(e.type){case t.UIEventConsts.DISMISS_BACK:var i=new Cmd.ReplyDissolveRoom_C;i.isAgree=e.data,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA);break;case t.UIEventConsts.CLOSE:this.removeDissPanel();break;case t.UIEventConsts.AGREE_CHANGE_USERNUM:var n=new Cmd.ReturnChangeUserNbrRoom_C;n.isAgree=e.data,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,n,t.DataRequestCommand.GAME_DATA),this.removeDissPanel()}},i.prototype.updateSoundSet=function(){var e=t.RoomInfo.getInstance().musicSetInfo;null!=e&&(e.music=uniLib.SoundMgr.instance.musicOpen,e.sound=uniLib.SoundMgr.instance.soundOpen,e.control=t.GameData.getInstance().audioPlayMode,1==e.dialect?t.RoomInfo.getInstance().languageMode="pu":t.RoomInfo.getInstance().languageMode="pu")},i.prototype.exitGame=function(){if(0==t.RoomInfo.getInstance().video){var e=new Cmd.LeaveMahjongCmd_C;e.state=0,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)}t.DataCache.gameInfo&&t.DataCache.gameInfo.defaultOrientation!=egret.OrientationMode.LANDSCAPE&&(uniLib.ScreenUtils.landscape=!1),uniLib.GameModuleUtils.ExitGame(!1),uniLib.Global.lobbyMode?(RES.destroyRes("self_res_DLTDH",!0),uniLib.ResUtils.clearResConfigByGroupName(["self_res_DLTDH"])):(RES.destroyRes("TDHpreLoadAll",!0),uniLib.ResUtils.clearResConfigByGroupName(["TDHpreLoadAll"])),t.DataCache.destroyResOnExit},i.prototype.requestChange=function(){if(""!=this._mySelect&&""!=this._gmSelect){var e=new Cmd.ChangeCardGmMahjongCmd_C;e.newCardId=Number(this._gmSelect),e.oldCardId=Number(this._mySelect),this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA),this._gmSelect="",this._mySelect=""}},i.prototype.requestChanges=function(e){var i=new Cmd.ChangeCardGmMahjongCmd_C;i.cardButtonId=e,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA)},i.prototype.showStopServiceNotice=function(){this._stopServicePanel||(this._stopServicePanel=new t.StopServicePanel),t.PopupManager.addPopUp(this._stopServicePanel,!0,!0),this._stopServicePanel.addEventListener(t.UIEventConsts.CLOSE,this.removeStopNotice,this)},i.prototype.removeStopNotice=function(){this._stopServicePanel&&(this._stopServicePanel.removeEventListener(t.UIEventConsts.CLOSE,this.removeStopNotice,this),t.PopupManager.removePopUp(this._stopServicePanel),this._stopServicePanel.destory(),this._stopServicePanel=null)},i.prototype.onMoon=function(t){switch(t.param){case"video_play_finish":this.showVideoFinish(0)}},i.prototype.showVideoFinish=function(e){var i="";0==e?(i="录像播放完毕!",t.PublicManage.getInstance().showVideoCommonPanel(i,["是"],[this.videoExit],null,this)):(i="确定退出录像？",t.PublicManage.getInstance().showVideoCommonPanel(i,["是","否"],[this.videoExit],null,this))},i.prototype.videoExit=function(){uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_close"),this.exitGame(),t.RoomInfo.getInstance().GM_Mode=!1},i.prototype.videoReplay=function(){uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_replay")},i.prototype.showRedPacketPanel=function(){this._redpacketPanel||(this._redpacketPanel=t.RedpacketPanel.Instatnce,this._redpacketPanel.addEventListener(t.UIEventConsts.CLOSE,this.closeRedPacketPanel,this)),t.PopupManager.addPopUp(this._redpacketPanel,!0)},i.prototype.closeRedPacketPanel=function(){this._redpacketPanel&&(this._redpacketPanel.removeEventListener(t.UIEventConsts.CLOSE,this.closeRedPacketPanel,this),uniLib.DisplayUtils.removeFromParent(this._redpacketPanel),this._redpacketPanel.destroy(),t.PopupManager.removePopUp(this._redpacketPanel),this._redpacketPanel=null)},i}(puremvc.Mediator);e.NAME="DLTDHGameMJMediator",e.ShouListenButton="shouListenButton",t.DLTDHGameMJMediator=e,__reflect(e.prototype,"game.DLTDHGameMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s._menuVc=n,s._menuVc.addEventListener(t.UIEventConsts.ACTION_CANCEL,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_CHOW,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_PONG,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_KONG,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.STOP_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ARROW_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.STOP_ARROW_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_WIN,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_TRUSTEESHIP,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_RECORD,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.START_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_OPERATE,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_LISTEN,s.onOperate,s),s}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this._menuVc&&(this._menuVc.removeEventListener(t.UIEventConsts.ACTION_CANCEL,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_CHOW,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_PONG,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_KONG,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.STOP_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ARROW_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.STOP_ARROW_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_WIN,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_TRUSTEESHIP,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_RECORD,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.START_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_OPERATE,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_LISTEN,this.onOperate,this),this._menuVc.destory(),this._menuVc=null)},i.prototype.onOperate=function(e){var i,n=e.type;switch(n){case t.UIEventConsts.ACTION_CANCEL:i=new Cmd.CancelOpMahjongCmd_C;break;case t.UIEventConsts.ACTION_PONG:i=new Cmd.TouchCardMahjongCmd_C,i.thisId=e.data;break;case t.UIEventConsts.ACTION_KONG:i=new Cmd.BarCardMahjongCmd_C,i.thisId=e.data;break;case t.UIEventConsts.ACTION_WIN:i=new Cmd.WinMahjongCmd_C;break;case t.UIEventConsts.ACTION_TRUSTEESHIP:i=new Cmd.HostMahjongCmd_C,i.bHost=e.data;break;case t.UIEventConsts.ACTION_RECORD:break;case t.UIEventConsts.ACTION_OPERATE:this.sendNotification(t.MahjongFourFacadeConst.NOTIFY_SELECT_GOLDOUT);break;case t.UIEventConsts.ACTION_CHOW:i=new Cmd.EatCardMahjongCmd_C,i.one=t.CardInfo.getInstance().eatObj.one,i.two=t.CardInfo.getInstance().eatObj.two;break;case t.UIEventConsts.ACTION_LISTEN:t.OperateVc.isSelectTing=!0,this._menuVc.removeAction()}i&&(this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA),t.MahJongFourFacede.getInstance().sendNotification(t.MahjongFourFacadeConst.REMOVE_ACTION),uniLib.NetMgr.setMsgTimeout(8,"OutCardMahjongCmd_C"))},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.DRAW,t.MahjongFourFacadeConst.PONG,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.DRAW_NOTICE,t.MahjongFourFacadeConst.SHOW_ACTION,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.KONG_NOTICE,t.MahjongFourFacadeConst.PONG_NOTICE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.REMOVE_ACTION,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.START_WIN_NOTICE,t.MahjongFourFacadeConst.CHOW_NOTICE]},i.prototype.handleNotification=function(e){var i=0;switch(e.getName()){case t.MahjongFourFacadeConst.RESET_TABLE:this._menuVc.startGame();break;case t.MahjongFourFacadeConst.GAME_START:this._menuVc.startGame();break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:t.RoomInfo.getInstance().outerId==uniLib.UserInfo.uid&&this._menuVc.removeAction(),t.RoomInfo.getInstance().OutCard.opType&&t.RoomInfo.getInstance().OutCard.opType[0]&&this._menuVc.showAction(t.RoomInfo.getInstance().OutCard.thisId,t.RoomInfo.getInstance().OutCard.opType);break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._menuVc.removeAction();var n=e.getBody();0==n.thisId&&this._menuVc.startOver();break;case t.MahjongFourFacadeConst.REMOVE_ACTION:this._menuVc.removeAction();break;case t.MahjongFourFacadeConst.SHOW_ACTION:this._menuVc.showAction(null,e.getBody().opType);break;case t.MahjongFourFacadeConst.PONG:break;case t.MahjongFourFacadeConst.CHOW_NOTICE:case t.MahjongFourFacadeConst.KONG_NOTICE:case t.MahjongFourFacadeConst.PONG_NOTICE:this._menuVc.removeAction();break;case t.MahjongFourFacadeConst.DRAW:this._menuVc.removeAction();var s=e.getBody();i=s.barSet&&0!=s.barSet.length?s.barSet[0]:s.thisId,this._menuVc.showAction(i,s.opType);break;case t.MahjongFourFacadeConst.DRAW_NOTICE:var a=e.getBody();a.uid!=uniLib.UserInfo.uid&&this._menuVc.removeAction();break;case t.MahjongFourFacadeConst.START_WIN_NOTICE:}},i}(puremvc.Mediator);e.NAME="OperateMJMediator",t.OperateMJMediator=e,__reflect(e.prototype,"game.OperateMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s._requestUid=0,s._isClick=!0,s._seatVc=n,s._seatVc.addEventListener(t.UIEventConsts.SHOW_USER_INFO,s.uiEventHandle,s),s._seatVc.addEventListener(t.UIEventConsts.DISMISS_GAME,s.uiEventHandle,s),s}return __extends(i,e),i.prototype.uiEventHandle=function(e){var i=e.type;switch(i){case t.UIEventConsts.SHOW_USER_INFO:this._requestUid!=e.data&&(this.getUserData(e.data),this._requestUid=e.data),this.showUserInfoPanel();break;case t.UIEventConsts.DISMISS_GAME:var n=new Cmd.RequestDissolveRoom_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,n,t.DataRequestCommand.GAME_DATA)}},i.prototype.onRegister=function(){e.prototype.onRegister.call(this)},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.NOTIFY_HOST,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.PLAYER_LEFT,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.READY_NOTICE,t.MahjongFourFacadeConst.CANCEL_READY_NOTICE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.USERINFO_DATA,t.MahjongFourFacadeConst.PLAYER_CONNECT,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.PLAYER_ENTER_ROOM,t.MahjongFourFacadeConst.PLAYER_DISCONNECT,t.MahjongFourFacadeConst.SEND_GIFTS_NOTICE,t.MahjongFourFacadeConst.NOTIFY_POINT_CHANGE,t.MahjongFourFacadeConst.NOTIFY_ONLINE_STATE,t.MahjongFourFacadeConst.UPDATA_USER_POINT,t.MahjongFourFacadeConst.SEND_CARDS]},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.SEND_CARDS:break;case t.MahjongFourFacadeConst.USER_ENTER_ROOM:this._seatVc.initSeat();break;case t.MahjongFourFacadeConst.PLAYER_ENTER_ROOM:var i=e.getBody();i.uid!=uniLib.UserInfo.uid&&(this._seatVc.addSeatPlayer(i),this._seatVc.updateStatus(i.uid,Cmd.OnlineState.OnlineState_Online));break;case t.MahjongFourFacadeConst.PLAYER_LEFT:this._seatVc.removePlayer(e.getBody());break;case t.MahjongFourFacadeConst.RELOGIN:this._seatVc.initSeat();var n=e.getBody();n.userCard.handCardSet&&n.userCard.handCardSet.length>0&&this._seatVc.resetReady();break;case t.MahjongFourFacadeConst.READY_NOTICE:this._seatVc.refreshPlayerReady(t.RoomInfo.getInstance().readyUsers);break;case t.MahjongFourFacadeConst.CANCEL_READY_NOTICE:this._seatVc.cancelReady(e.getBody());break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._seatVc.updatePlayers(t.RoomInfo.getInstance().chipsSets),this._seatVc.resultDiamond(e.getBody());break;case t.MahjongFourFacadeConst.USERINFO_DATA:this._userInfoPanel&&this._userInfoPanel.setData(e.getBody());break;case t.MahjongFourFacadeConst.SEND_GIFTS_NOTICE:this._seatVc.showGift(e.getBody()),this._seatVc.updateDiamond(e.getBody());break;case t.MahjongFourFacadeConst.GAME_START:this._seatVc.reset(),this._seatVc.resetReady(),this._seatVc.updateDiamond(e.getBody());break;case t.MahjongFourFacadeConst.RESET_TABLE:break;case t.MahjongFourFacadeConst.PLAYER_CONNECT:var s=e.getBody();if(this._seatVc.updateStatus(s.uid,Cmd.OnlineState.OnlineState_Online),s.uid!=uniLib.UserInfo.uid){var a=t.RoomInfo.getInstance().getUserVoByUid(s.uid).nickName;t.PublicManage.getInstance().showMildWarnShow("玩家"+a+"已回来")}break;case t.MahjongFourFacadeConst.PLAYER_DISCONNECT:var o=e.getBody();this._seatVc.updateStatus(o.uid,o.state);var a=t.RoomInfo.getInstance().getUserVoByUid(o.uid).nickName;if(o.state==Cmd.OnlineState.OnlineState_Leave&&o.uid!=uniLib.UserInfo.uid)return;if(o.state==Cmd.OnlineState.OnlineState_Online)return;t.PublicManage.getInstance().showMildWarnShow("玩家"+a+"已断线，请等待");break;case t.MahjongFourFacadeConst.NOTIFY_ONLINE_STATE:var r=e.getBody();this._seatVc.updateStatus(r.uid,r.state);break;case t.MahjongFourFacadeConst.NOTIFY_POINT_CHANGE:break;case t.MahjongFourFacadeConst.UPDATA_USER_POINT:if(!t.RoomInfo.getInstance().pointSet)return;for(var h=0;h<t.RoomInfo.getInstance().pointSet.length;h++)this._seatVc.floatPoint(t.RoomInfo.getInstance().pointSet[h]);break;case t.MahjongFourFacadeConst.NOTIFY_HOST:var d=e.getBody();1==d.hostType?this._seatVc.updateStatus(d.uid,5):this._seatVc.updateStatus(d.uid,1)}},i.prototype.showUserInfoPanel=function(){this._userInfoPanel?this._userInfoPanel.reset():(this._userInfoPanel=new t.UserInfoPanel,this._userInfoPanel.x=uniLib.Global.screenWidth-this._userInfoPanel.width>>1,this._userInfoPanel.y=uniLib.Global.screenHeight-this._userInfoPanel.height>>1,this._userInfoPanel.addEventListener(t.UIEventConsts.GIFT_SEND,this.onUserPanelHandle,this),this._userInfoPanel.addEventListener(t.UIEventConsts.CLOSE,this.onUserPanelHandle,this)),t.PopupManager.addPopUp(this._userInfoPanel,!0,!1)},i.prototype.onUserPanelHandle=function(e){var i=this,n=e.type;switch(n){case t.UIEventConsts.GIFT_SEND:if(this._isClick){var s=new Cmd.SendGiftMahjongCmd_C;s.gift=e.data,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,s,t.DataRequestCommand.GAME_DATA),t.PopupManager.removePopUp(this._userInfoPanel),this.hideUserInfo(),this._isClick=!1,setTimeout(function(){i._isClick=!0},2600)}else t.PublicManage.getInstance().showMildWarnShow("您的操作太频繁了！请休息一下吧");break;case t.UIEventConsts.CLOSE:t.PopupManager.removePopUp(this._userInfoPanel),this.hideUserInfo()}},i.prototype.hideUserInfo=function(){this._isClick=!0,this._requestUid=0},i.prototype.removeUserInfo=function(){this._isClick=!0,this._userInfoPanel&&(this._userInfoPanel.removeEventListener(t.UIEventConsts.GIFT_SEND,this.onUserPanelHandle,this),this._userInfoPanel.removeEventListener(t.UIEventConsts.CLOSE,this.onUserPanelHandle,this),this._userInfoPanel.destory(),this._userInfoPanel=null),this._requestUid=0},i.prototype.getUserData=function(e){var i=new Cmd.GetPersonalPanel_C;i.uid=e,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA),uniLib.NetMgr.setMsgTimeout(8,"GetPersonalPanel_C")},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.removeUserInfo(),this._seatVc&&(this._seatVc.removeEventListener(t.UIEventConsts.SHOW_USER_INFO,this.uiEventHandle,this),this._seatVc.destory(),this._seatVc=null)
},i}(puremvc.Mediator);e.NAME="SeatPlayerMJMediator",t.SeatPlayerMJMediator=e,__reflect(e.prototype,"game.SeatPlayerMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._sendCardNArr=[12,12,12,12,1,1,1,1,1],t._timerList=[],t}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),egret.Tween.removeAllTweens(),this._lieTu&&uniLib.DisplayUtils.removeFromParent(this._lieTu),this._lieTu=null,this._listenCardPanel&&this._listenCardPanel.destory(),this._listenCardPanel=null,this._actionEffect&&this._actionEffect.destory(),this._actionEffect=null,this._diceMc&&this._diceMc.destory(),this._diceMc=null,this._pointMc&&(this._pointMc.stop(),t.ResUtil.removeFromParent(this._pointMc)),this._pointMc=null,this._startMc&&this._startMc.destory(),this._startMc=null,this._bankMc&&this._bankMc.destory(),this._bankMc=null,this._bankPanel&&(uniLib.DisplayUtils.removeAllChildren(this._bankPanel),uniLib.DisplayUtils.removeFromParent(this._bankPanel)),this._bankPanel=null;var i;if(this._cardSideArr)for(i=0;4>i;i++)0==i&&(this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this)),this._cardSideArr[i]&&this._cardSideArr[i].destory();if(this._cardSideArr=null,this._moveCardArr)for(i=0;i<this._moveCardArr.length;i++)this._moveCardArr[i].destory();if(this._moveCardArr=null,this._moveStackArr)for(i=0;i<this._moveStackArr.length;i++)this._moveStackArr[i].destory();this._moveStackArr=null,this._sendCardNArr=null},i.prototype.initUI=function(){if(this._moveStackArr=[],this._moveCardArr=[],this._cardSideArr=[],this._actionEffect=new t.ActionEffectMc,this._bankPanel=new egret.Sprite,this.addChild(this._bankPanel),t.GameConst.MaJiongChange){var e=uniLib.Utils.getLocalStorage("majiangType_"+t.RoomInfo.getInstance().gameId);e=1==e?1:0,t.GameConst.cardStylePer=t.GameConst.cardStypePerStrList[e]}},i.prototype.creatUserCardSide=function(){if(this._cardSideArr){for(var e=0;e<this._cardSideArr.length;e++)0==e&&(this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this)),this._cardSideArr[e]&&this._cardSideArr[e].destory();this._cardSideArr.length=0}var i=t.RoomInfo.getInstance().playerNumber;if(!(this._cardSideArr.length>0)){if(2==i){var n=new t.UserSideCard0;n.addEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this),this._cardSideArr[0]=n;var s=new t.UserSideCard2;this.addChild(s),this._cardSideArr[2]=s,this.addChild(n)}else if(3==i){var n=new t.UserSideCard0;n.addEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this),this._cardSideArr[0]=n;var s=new t.UserSideCard1;this.addChild(s),this._cardSideArr[1]=s;var a=new t.UserSideCard3;this.addChild(a),this._cardSideArr[3]=a,this.addChild(n)}else{var n=new t.UserSideCard0;n.addEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this),this._cardSideArr.push(n);var o=new t.UserSideCard1;this.addChild(o),this._cardSideArr.push(o);var s=new t.UserSideCard2;this.addChild(s),this._cardSideArr.push(s);var a=new t.UserSideCard3;this.addChild(a),this._cardSideArr.push(a),this.addChild(n)}this._actionEffect&&this.addChild(this._actionEffect)}},i.prototype.onUserSideHandle=function(t){this.dispatchEvent(t)},i.prototype.resetTable=function(){this.resetCards(),this._actionEffect.clearEffect(),this._bankMc&&this._bankMc.destory(),this._bankMc=null,uniLib.DisplayUtils.removeFromParent(this._lieTu),this._lieTu=null,uniLib.DisplayUtils.removeAllChildren(this._bankPanel),this._timerList&&this._timerList.forEach(function(t){egret.clearTimeout(t)}),this._timerList=[]},i.prototype.startGame=function(){if(this.resetTable(),t.GameConst.MaJiongChange){var e=uniLib.Utils.getLocalStorage("majiangType_"+t.RoomInfo.getInstance().gameId);if(e=1==e?1:0,t.GameConst.cardStylePer!=t.GameConst.cardStypePerStrList[e]){t.GameConst.cardStylePer=t.GameConst.cardStypePerStrList[e];for(var i=0;i<this._cardSideArr.length;i++){var n=this._cardSideArr[i];n&&n.resetCardBitArr()}}}this.showStartEffect(),uniLib.SoundMgr.instance.playSound(t.SoundConsts.START)},i.prototype.setBanker=function(e){var i=this;this._startMc&&this._startMc.destory(),this._startMc=null,this.showBanker(),0!=t.RoomInfo.getInstance().diceTime&&(e.one||(e.one=1,e.two=1),this._timerList.push(egret.setTimeout(function(){i.showDice(e)},this,1e3)),this._timerList.push(egret.setTimeout(function(){i.clearDice()},this,3e3)))},i.prototype.startSendCards=function(){for(var e=0;4>e;e++)this._cardSideArr[e]&&this._cardSideArr[e].resetCard();if(t.RoomInfo.getInstance().shuffleUid&&1!=t.RoomInfo.getInstance().video){this.addShuffleMc();var i=this;uniLib.SetUniEventTimeout(this,function(){i.removeShuffleMc(),i.sendCards()},2e3,1,this,null)}else this.sendCards()},i.prototype.addShuffleMc=function(){this._fingerClickMc=uniLib.DisplayUtils.createMovieClicp("fingerClick_mc"),this.addChild(this._fingerClickMc),this._fingerClickMc.x=uniLib.Global.screenWidth/2-35,this._fingerClickMc.y=uniLib.Global.screenHeight/2-60,this._fingerClickMc.play(1),uniLib.SetUniEventTimeout(this,function(){uniLib.SoundMgr.instance.playSound("shuffleCard_mp3")},1e3,1,this,null);var e=t.RoomInfo.getInstance().getUserVoByUid(t.RoomInfo.getInstance().shuffleUid);e&&(this._shuffleBg=new eui.Image("shuffle_bg"),this._shuffleBg.x=(uniLib.Global.screenWidth-this._shuffleBg.width)/2-220,this._shuffleBg.y=uniLib.Global.screenHeight/2+140,this.addChild(this._shuffleBg),this._shuffleLabel=new eui.Label,this._shuffleLabel.text=e.nickName+"开始洗牌...",this._shuffleLabel.textColor=16767334,this._shuffleLabel.x=(uniLib.Global.screenWidth-this._shuffleLabel.width)/2,this._shuffleLabel.y=uniLib.Global.screenHeight/2+150,this.addChild(this._shuffleLabel))},i.prototype.removeShuffleMc=function(){uniLib.SoundMgr.instance.stopSound("shuffleCard_mp3"),this._fingerClickMc&&this._fingerClickMc.parent&&(this._fingerClickMc.stop(),this.removeChild(this._fingerClickMc),this._fingerClickMc=null),this._shuffleLabel&&this._shuffleLabel.parent&&(this.removeChild(this._shuffleLabel),this._shuffleLabel=null),this._shuffleBg&&this._shuffleBg.parent&&(this.removeChild(this._shuffleBg),this._shuffleBg=null)},i.prototype.showStartEffect=function(){this._startMc||(this._startMc=new t.StartEffectMc,this.addChild(this._startMc)),this._startMc.play()},i.prototype.showDice=function(e){this._diceMc||(this._diceMc=new t.DiceMc,this.addChild(this._diceMc)),this._diceMc.showDice(e)},i.prototype.showBanker=function(e){void 0===e&&(e=!0),uniLib.DisplayUtils.removeAllChildren(this._bankPanel),this._bankMc||(this._bankMc=new t.BankerEffectMc,this._bankPanel.addChild(this._bankMc)),this._bankMc.show(e)},i.prototype.refreshBanker=function(){if(null!=this._bankPanel){uniLib.DisplayUtils.removeAllChildren(this._bankPanel);var e=t.ResUtil.createBitmapByName("bank"),i=t.SeatPlayVc.seatPosArr[t.RoomInfo.getInstance().bankerSeatId];if(i)e.x=i.x-5,e.y=i.y-5,this._bankPanel.addChild(e);else if(t.RoomInfo.getInstance().isStart){var n=this,s=setTimeout(function(){n.refreshBanker()},1e3);this._timerList.push(s)}}},i.prototype.sendCards=function(){for(var e,i,n,s,a,o=new egret.Point(560+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,280),r=0;r<this._sendCardNArr.length;r++)4==this._sendCardNArr[r]?(e=n=new t.CardStack,n.x=o.x,n.y=o.y,n.setType(r%4+1),this.addChild(n)):(e=s=new t.BlurBackCard,s.x=o.x,s.y=o.y,s.setType(r%4+1),this.addChild(s)),e.visible=!1,a=this._cardSideArr[r%4],a&&(i=a.getSendPos(4*Math.ceil(r/4)),r==this._sendCardNArr.length-1?egret.Tween.get(e).wait(1).call(this.startMovie,this,[e,i,a,this._sendCardNArr[r],!0]):egret.Tween.get(e).wait(1).call(this.startMovie,this,[e,i,a,this._sendCardNArr[r],!1]))},i.prototype.startMovie=function(e,i,n,s,a){void 0===a&&(a=!1),null!=e&&(egret.Tween.removeTweens(e),e.visible=!0,t.RoomInfo.getInstance().shuffleUid&&1!=t.RoomInfo.getInstance().video&&(e.visible=!1),egret.Tween.get(e).to({x:i.x,y:i.y},100,egret.Ease.circOut).call(this.movieEnd,this,[e,n,s,a]))},i.prototype.movieEnd=function(e,i,n,s){if(void 0===i&&(i=null),void 0===n&&(n=1),void 0===s&&(s=!1),null!=e&&(egret.Tween.removeTweens(e),e&&e.parent&&(1==n?this._moveCardArr.push(e):this._moveStackArr.push(e),e.parent.removeChild(e)),i&&i.sendCards(n),s)){if(t.RoomInfo.getInstance().isTween=!1,null==this._cardSideArr)return;for(var a=0;4>a;a++)if(this._cardSideArr[a]){t.CardInfo.getInstance().getHandCardBySeat(a);this._cardSideArr[a].refreshOperate(a),this._cardSideArr[a].sortCard(),t.RoomInfo.getInstance().shuffleUid&&1!=t.RoomInfo.getInstance().video&&this._cardSideArr[a].groupingSendCards()}t.CardInfo.getInstance().bankerThisId&&(t.CardInfo.getInstance().addMyCard(t.CardInfo.getInstance().bankerThisId),t.CardInfo.getInstance().bankerThisId=null),t.GameData.getInstance().isMyTime&&this.setEnable(!0)}},i.prototype.reloginFlower=function(e){e.userCard.flowerCardSet&&this._cardSideArr[0]&&this._cardSideArr[0].reloginFlower(e.userCard.flowerCardSet);var i=e.otherCard;if(!(null==i||i.length<=0))for(var n=0;n<i.length;n++){var s=t.RoomInfo.getInstance().getSeatNoByUserId(i[n].uid);this._cardSideArr[s]&&this._cardSideArr[s].reloginFlower(i[n].flowerCardSet)}},i.prototype.fillFlower=function(e){this.showOperateEffect(0,e.uid);var i=t.RoomInfo.getInstance().getSeatNoByUserId(e.uid);this._cardSideArr[i]&&this._cardSideArr[i].fillFlower(i,e.flowerSet)},i.prototype.setUserCards=function(){for(var e,i=t.RoomInfo.getInstance().userList,n=0;n<i.length;n++)e=t.RoomInfo.getInstance().getSeatNoByUserId(i[n].uid),this._cardSideArr[e]&&(this._cardSideArr[e].uid=i[n].uid,this._cardSideArr[e].handCardsArr=t.CardInfo.getInstance().getHandCardBySeat(e))},i.prototype.setEnable=function(e){e?(t.GameData.getInstance().waitCard=0,this._cardSideArr[0].setEnable(!0)):this._cardSideArr[0].setEnable(!1)},i.prototype.clearWaitCard=function(){for(var t=0;4>t;t++)this._cardSideArr[t]&&this._cardSideArr[t].movieEnd(null)},i.prototype.drawNotice=function(e){var i;if(this.clearWaitCard(),i=1==t.RoomInfo.getInstance().video?t.RoomInfo.getInstance().getSeatNoByUserId(e.ownerid):t.RoomInfo.getInstance().getSeatNoByUserId(e.uid),0==i)return void uniLib.SoundMgr.instance.playSound(t.SoundConsts.DRAW_MY_TURN);e.uid!=uniLib.UserInfo.uid&&this._cardSideArr[i]&&this._cardSideArr[i].doDraw(e.thisId);var n=new egret.Point(560,280),s=new egret.Point;this._cardSideArr[i]&&(s=this._cardSideArr[i].getSendPos(13));var a;this._moveCardArr.length>0?(a=this._moveCardArr[0],a.name="BlurCard",this._moveCardArr.splice(0,1)):(a=new t.BlurBackCard,a.name="BlurCard"),a.setType(i%2+1),a.x=n.x,a.y=n.y,this.addChild(a),egret.Tween.get(a).to({x:s.x,y:s.y,alpha:.5},100,egret.Ease.circOut).call(this.movieEnd,this,[a])},i.prototype.draw=function(t){this.doDraw(t)},i.prototype.doDraw=function(t){this._cardSideArr[0].cacheAsBitmap=!0,egret.Tween.removeTweens(this),this._cardSideArr[0].doDraw(t),this.setEnable(!0)},i.prototype.doDiscard=function(e,i){var n=t.RoomInfo.getInstance().getSeatNoByUserId(e),s=new egret.Point;this._cardSideArr[n]&&(s=this._cardSideArr[n].doDiscard(i,n),0==n?this._lastOutCardPoint=this._cardSideArr[n].outPutCards.getCurOutPutPos():this._lastOutCardPoint=s),0!=n&&this._cardSideArr[n].refreshOperate(n),egret.Tween.removeTweens(this._cardSideArr[n]),this.showPointMc(this._lastOutCardPoint,this._cardSideArr[n])},i.prototype.showPointMc=function(t,e){e&&egret.Tween.removeTweens(e),this._pointMc||(this._pointMc=uniLib.DisplayUtils.createMovieClicp("baoshi"),this.addChild(this._pointMc)),null!=t&&(this._pointMc.x=t.x,this._pointMc.y=t.y-20,this._pointMc.visible=!0,this._pointMc.play(-1))},i.prototype.hidePointMc=function(){this._pointMc&&(this._pointMc.stop(),this._pointMc&&t.ResUtil.removeFromParent(this._pointMc)),this._pointMc=null},i.prototype.showOperateEffect=function(e,i){this._actionEffect&&(this._actionEffect.showEffect(e,i),t.GameInfo.topLayer.addChild(this._actionEffect))},i.prototype.showWinEffect=function(e,i,n){this._actionEffect&&(this._actionEffect.showWinEffect(e,i,n),t.GameInfo.topLayer.addChild(this._actionEffect)),this.clearWaitCard()},i.prototype.doKong=function(t){this._cardSideArr[t.seatId]&&this._cardSideArr[t.seatId].refreshOperate(t.seatId),t.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarOther&&this.removeOutPutCard(t.fromSeatId,t.thisId),this.showOperateEffect(t.type,t.uid),this.clearWaitCard()},i.prototype.doPong=function(t){this._cardSideArr[t.seatId]&&this._cardSideArr[t.seatId].refreshOperate(t.seatId),this.removeOutPutCard(t.fromSeatId,t.thisId),this.showOperateEffect(Cmd.MahjongOpCardType.MahjongOpCardType_Touch,t.uid),this.clearWaitCard()},i.prototype.doChow=function(t){this._cardSideArr[t.seatId]&&this._cardSideArr[t.seatId].refreshOperate(t.seatId),this.removeOutPutCard(t.fromSeatId,t.thisId),this.showOperateEffect(Cmd.MahjongOpCardType.MahjongOpCardType_Eat,t.uid),this.clearWaitCard()},i.prototype.setRelogindata=function(t){this.resetCards();for(var e=0;4>e;e++)0==e?(this._cardSideArr[0].setReloginData(),this._cardSideArr[0].refreshHandCards()):this._cardSideArr[e]&&this._cardSideArr[e].setReloginData();this.reloginFlower(t)},i.prototype.resetCards=function(){this.hidePointMc();for(var t=0;4>t;t++)this._cardSideArr[t]&&this._cardSideArr[t].resetCard()},i.prototype.doWin=function(t){this._winCard=t.thisId;var e=t.rewardSet;this.showWinEff(e)},i.prototype.showWinEff=function(t){var e=this;this._timerList.push(egret.setTimeout(function(){e.showOtherHandCard(t)},null,1e3));for(var i=0;i<t.length;i++){var n=t[i];0!=n.animation&&this.showWinEffect(n.animation,n.uid,n.winType)}},i.prototype.showOtherHandCard=function(e){if(null!=this._cardSideArr)for(var i=0;i<e.length;i++){var n=t.RoomInfo.getInstance().getSeatNoByUserId(e[i].uid);1==e[i].winType&&this._winCard&&e[i].userCard.handCardSet.push(this._winCard),this._cardSideArr[n].showUserHandCard(n,e[i].userCard.handCardSet,!0)}},i.prototype.showLightEff=function(e){var i=t.RoomInfo.getInstance().getSeatNoByUserId(1),n=t.CardInfo.getInstance().getOutCardBySeat(i).indexOf(e.thisId);-1!=n&&this._lastOutCardPoint&&(this._lightMc.x=this._lastOutCardPoint.x,this._lightMc.y=this._lastOutCardPoint.y,this._lightMc.addEventListener(egret.Event.COMPLETE,this.onMcPlayerComplete,this),this.addChild(this._lightMc),this._lightMc.gotoAndPlay(1,1),0==i?(this._lieTu=uniLib.DisplayUtils.createBitmapByName("lietu"),this._lieTu.width=43,this._lieTu.height=60,this._lieTu.x=this._lastOutCardPoint.x-25):2==i?(this._lieTu=uniLib.DisplayUtils.createBitmapByName("lietu03"),this._lieTu.width=44,this._lieTu.height=60,this._lieTu.x=this._lastOutCardPoint.x-24):(this._lieTu=uniLib.DisplayUtils.createBitmapByName("lietu02"),this._lieTu.width=60,this._lieTu.height=46,this._lieTu.x=this._lastOutCardPoint.x-30),this._lieTu.y=this._lastOutCardPoint.y,uniLib.SoundMgr.instance.playSound(t.SoundConsts.LIGHT),setTimeout(function(){this._lieTu&&this.addChild(this._lieTu)},500))},i.prototype.onMcPlayerComplete=function(t){var e=t.target;e&&(e.stop(),e.removeEventListener(egret.Event.COMPLETE,this.onMcPlayerComplete,this),uniLib.DisplayUtils.removeFromParent(e),e=null)},i.prototype.showCommonChat=function(t,e){this._actionEffect.showCommonChat(t,e)},i.prototype.showCommonTalk=function(t,e){this._actionEffect.showCommonTalk(t,e)},i.prototype.selectGoldOut=function(){this._cardSideArr[0].selectGoldOut()},i.prototype.clearDice=function(){this._diceMc&&this._diceMc.destory(),this._diceMc=null},i.prototype.refreshTempCard=function(){for(var t=0;4>t;t++)this._cardSideArr[t]&&this._cardSideArr[t].refreshTempCard()},i.prototype.refreshHandCards=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null),this._cardSideArr[0].refreshHandCards(t,e)},i.prototype.setListenCard=function(){this._cardSideArr[0].showListenIcon()},i.prototype.hideCardListenIcon=function(){this._cardSideArr[0].hideListenIcon()},i.prototype.setHostMask=function(t){1==t?this._cardSideArr[0].addHostMask():this._cardSideArr[0].removeHostMask()},i.prototype.showListenPanel=function(e){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.listenSet&&t.CardInfo.getInstance().drawData.listenObjSet){var i=t.CardInfo.getInstance().drawData.listenSet.indexOf(e);-1!=i?(this._listenCardPanel||(this._listenCardPanel=new t.ListenCardPanel),this._listenCardPanel.setListenScene(t.CardInfo.getInstance().drawData.listenObjSet[i].listenCardSet),this.addChild(this._listenCardPanel)):this.removeListenPanel(),this._cardSideArr[0].showListenIcon(e)}},i.prototype.showListenPanel1=function(e){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.listenSet&&this._cardSideArr[0].getSelectCardThisId()===e.thisId&&t.CardInfo.getInstance().drawData.listenSet.length>=1){for(var i=-1,n=0,s=this._cardSideArr[0].getHandsCardByThisIDToBaseId(e.thisId).length;s>n;n++)if(ArrayUtil.isInArray(this._cardSideArr[0].getHandsCardByThisIDToBaseId(e.thisId)[n].data,t.CardInfo.getInstance().drawData.listenSet)){i=0;break}-1!=i?(this._listenCardPanel||(this._listenCardPanel=new t.ListenCardPanel),this._listenCardPanel.setListenScene(e.los.listenCardSet),this.addChild(this._listenCardPanel)):this.removeListenPanel(),this._cardSideArr[0].showListenIcon(e.thisId)}},i.prototype.removeListenPanel=function(){this._listenCardPanel&&(this._listenCardPanel.destory(),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),uniLib.DisplayUtils.removeFromParent(this._listenCardPanel)),this._listenCardPanel=null},i.prototype.removeOutPutCard=function(t,e){this._cardSideArr[t]&&this._cardSideArr[t].removeOutPutCard(e),this.hidePointMc()},i.prototype.videoRefresh=function(t){this._cardSideArr[t]&&(this._cardSideArr[t].refreshOperate(t),this._cardSideArr[t].refreshOutCards())},i.prototype.refreshOutCards=function(){this._cardSideArr[0]&&this._cardSideArr[0].refreshOutCards()},i}(t.BaseVc);t.CardsVc=e,__reflect(e.prototype,"game.CardsVc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.dirArr=[[1,2,3,4],[2,3,4,1],[3,4,1,2],[4,1,2,3]],t._step=.1,t}return __extends(i,e),i.prototype.initUI=function(){var e=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_bg");this.addChild(e),this._dirArr=[];for(var i,n=0;4>n;n++)i=new t.HighLightItem,i.initLight(n),this.addChild(i),this._dirArr.push(i),i.setDir(n+1);"yellow_"==t.ColorConst.color?(this._countNum1=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",39,42),this._countNum2=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",52,42)):(this._countNum1=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",39,42),this._countNum2=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",52,42)),this.addChild(this._countNum1),this.addChild(this._countNum2)},i.prototype.setEast=function(t){for(var e=this.dirArr[t],i=0;4>i;i++){var n=e[i];this._dirArr[n-1].setDir(i+1)}},i.prototype.setCount=function(t,e,i){void 0===i&&(i=0),t||(t=0),this._countSecond=e,this._dirArr[this._countSeatId]&&this._dirArr[this._countSeatId].stop(),this._dirArr[t].flash(i),this._countSeatId=t,this.stopTimer(),this.startCount()},i.prototype.startCount=function(){this._countIndex=0,this._timer=new egret.Timer(1e3),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.start()},i.prototype.onTimer=function(e){this._countIndex++;var i=this._countSecond-Math.floor(this._countIndex);i>=99?(this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"green_num9"),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"green_num9"),this._countNum1.alpha>=1?this._step=-Math.abs(this._step):this._countNum1.alpha<=0&&(this._step=Math.abs(this._step)),this._countNum1.alpha+=this._step,this._countNum2.alpha+=this._step):i>0?(this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num"+Math.floor(i/10)),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num"+i%10),this._countNum1.alpha=1,this._countNum2.alpha=1,i%5==2&&uniLib.NetMgr.checkMsgTimeout(8e3)&&uniLib.NetMgr.setMsgTimeout(8,"ClientEchoMahjongCmd_SC")&&uniLib.NetMgr.tcpSend(new Cmd.ClientEchoMahjongCmd_SC)):0>=i&&(uniLib.NetMgr.checkMsgTimeout(5e3)&&uniLib.NetMgr.setMsgTimeout(5,"ClientEchoMahjongCmd_SC")&&uniLib.NetMgr.tcpSend(new Cmd.ClientEchoMahjongCmd_SC),this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0"),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0"),this._countNum1.alpha=1,this._countNum2.alpha=1,this.stopTimer())},i.prototype.stopTimer=function(){this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer=null)},i.prototype.reset=function(){this.stopTimer();for(var e=0;4>e;e++)this._dirArr[e].stop();this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0"),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0")},i.prototype.destory=function(){this.stopTimer();for(var t=0;t<this._dirArr.length;t++){var e=this._dirArr[t];e.destory()}this._dirArr=null,this._countNum1=null,this._countNum2=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);e.HEIGHT=134,e.OFFSET_Y=70,t.CountVc=e,__reflect(e.prototype,"game.CountVc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._timerList=[],t._defaultPoint=new egret.Point((uniLib.Global.screenWidth-1136)/2+866,uniLib.Global.screenHeight-230),t.tingMCArr=[],t._step=.1,t._countIndex=0,t}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this._sysMsgVc&&(this._sysMsgVc.destory(),this._sysMsgVc=null),uniLib.Global.removeEventListener(uniLib.ZqEvent.NATIVE_TO_EGERET,this.onNativeMessage,this),this._timer_1000&&this._timer_1000.stop(),this._timer_1000=null,this._listenTimer&&(this._listenTimer.stop(),this._listenTimer.removeEventListener(egret.TimerEvent.TIMER,this.listenTimerEvt,this)),this._listenTimer=null,this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.showLeftTime,this),this._timer=null),this.StopServiceInfo&&(this.StopServiceInfo.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showstopServicePanel,this),uniLib.DisplayUtils.removeFromParent(this.StopServiceInfo)),this.StopServiceInfo=null,this._setBtn&&(this._setBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSet,this),this._setBtn.destory(),this._setBtn=null),this._chatBtn&&(this._chatBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShortChat,this),this._chatBtn.destory(),this._chatBtn=null),this._shareBtn&&(this._shareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnTouch,this),this._shareBtn.destory()),this._shareBtn=null,this._readyBtn&&(this._readyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReadyBtnTouch,this),this._readyBtn.destory()),this._readyBtn=null,this._cancelreadyBtn&&(this._cancelreadyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancelReadyBtnTouch,this),this._cancelreadyBtn.destory()),this._cancelreadyBtn=null,this._backBtn&&(this._backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackBtnTouch,this),this._backBtn.destory()),this._backBtn=null,this._dissBtn&&(this._dissBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDissBtnTouch,this),this._dissBtn.destory()),this._dissBtn=null,this._leaveBtn&&(this._leaveBtn.destory(),uniLib.DisplayUtils.removeFromParent(this._leaveBtn),this._leaveBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeaveRoom,this)),this._leaveBtn=null,this._hostBtn&&(this._hostBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHostBtnTouch,this),this._hostBtn.destory()),this._hostBtn=null,this._helpBtn&&(this._helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelpBtnTouch,this),this._helpBtn.destory()),this._helpBtn=null,this._gpsBtn&&(this._gpsBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGpsBtnTouch,this),this._gpsBtn.destory()),this._gpsBtn=null,this._listenPanel&&(uniLib.DisplayUtils.removeAllChildren(this._listenPanel),uniLib.DisplayUtils.removeFromParent(this._listenPanel)),this._listenPanel=null,this._gmIcon&&(this._gmIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.gmTool,this),uniLib.DisplayUtils.removeAllChildren(this._gmIcon),uniLib.DisplayUtils.removeFromParent(this._gmIcon)),this._gmIcon=null,this._hostIcon&&(this._hostIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHostTouchHandler,this),uniLib.DisplayUtils.removeAllChildren(this._hostIcon),uniLib.DisplayUtils.removeFromParent(this._hostIcon)),this._hostIcon=null,this._changeIcon&&(this._changeIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showChangeUserNumConfirm,this),uniLib.DisplayUtils.removeAllChildren(this._changeIcon),uniLib.DisplayUtils.removeFromParent(this._changeIcon)),this._changeIcon=null,this._changeRoom&&(this._changeRoom.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showChangeRoomConfirm,this),uniLib.DisplayUtils.removeAllChildren(this._changeRoom),uniLib.DisplayUtils.removeFromParent(this._changeRoom)),this._changeRoom=null,this._dingBao&&uniLib.DisplayUtils.removeFromParent(this._dingBao),this._dingBao=null,this._huanBao&&uniLib.DisplayUtils.removeFromParent(this._huanBao),this._huanBao=null,this._kanBao&&uniLib.DisplayUtils.removeFromParent(this._kanBao),this._kanBao=null,this._tingCard=null,this._tingCard1&&uniLib.DisplayUtils.removeFromParent(this._tingCard1),this._tingCard1=null,this._tingCard2&&uniLib.DisplayUtils.removeFromParent(this._tingCard2),this._tingCard2=null,this._tingCard3&&uniLib.DisplayUtils.removeFromParent(this._tingCard3),this._tingCard3=null,this._leaveBtn&&(this._leaveBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showChangeRoomConfirm,this),uniLib.DisplayUtils.removeAllChildren(this._leaveBtn),uniLib.DisplayUtils.removeFromParent(this._leaveBtn)),this._leaveBtn=null,this._listenCardPanel&&(uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),uniLib.DisplayUtils.removeFromParent(this._listenCardPanel)),this._listenCardPanel=null,this._listenBtnIcon&&this._listenBtnIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._notice&&this._notice.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showstopServicePanel,this),this._notice=null,this._resultPanel&&this._resultPanel.destory(),this._buyHorsePanel&&(this._buyHorsePanel.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.showResultPanel,this),uniLib.DisplayUtils.removeAllChildren(this._buyHorsePanel),uniLib.DisplayUtils.removeFromParent(this._buyHorsePanel)),this._buyHorsePanel=null,this._resultPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._dateTxt=null,this._timeTxt=null,this._recordTime=null,this._signal=null,this._signalTxt=null,this._roomType=null,this._goldenIcon=null,this._roomNumber=null,this._restCardNum&&egret.Tween.removeTweens(this._restCardNum),this._restCardNum=null,this._gameState&&egret.Tween.removeTweens(this._gameState),this._gameState=null,this._roomPlayerNum=null,this._roomRules=null,this._betteryPercent=null,this._goldenMjGroup=null,this._enterTips&&egret.Tween.removeTweens(this._enterTips),this._enterTips=null,this._listenBtnIcon=null,this._listenBtnBg=null,this._bg=null,egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStateTap,this)},i.prototype.initUI=function(){"green"!=uniLib.Utils.getLocalStorage("tableclothMode")&&uniLib.Utils.getLocalStorage("tableclothMode")?this._bg=t.ResUtil.createBitmapByName("2d_tableBg2_big",0,0):this._bg=t.ResUtil.createBitmapByName("2d_tableBg1_big",0,0),this._bg.x=(uniLib.Global.screenWidth-this._bg.width)/2,this._bg.y=(uniLib.Global.screenHeight-this._bg.height)/2,this.addChild(this._bg),this.setControlButton=new t.GameButton(["game_setting_control1","game_setting_control2"]),this.setControlButton.x=uniLib.Global.screenWidth-88,this.setControlButton.y=108,this.setControlButton.touchEnabled=!0,t.GameInfo.mainUILayer.addChild(this.setControlButton),this.setControlButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSetControlButton,this),this.settingBg=new eui.Image,this.settingBg.x=uniLib.Global.screenWidth-160,this.settingBg.y=40,this.settingBg.touchEnabled=!1,this.settingBg.source="game_setting_bg",t.GameInfo.mainUILayer.addChild(this.settingBg),this._setBtn=new t.GameButton(["game_NDsetting1","game_NDsetting2"]),this._setBtn.x=uniLib.Global.screenWidth-88,this._setBtn.y=178,this._setBtn.touchEnabled=!0,t.GameInfo.mainUILayer.addChild(this._setBtn),this._setBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSet,this),this._chatBtn=new t.GameButton(["game_NDchat1","game_NDchat2"]),this._chatBtn.name="short_btn",this._chatBtn.x=uniLib.Global.screenWidth-88,this._chatBtn.y=400,this._chatBtn.touchEnabled=!0,this.addChild(this._chatBtn),this._chatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShortChat,this),this._goldenMjGroup=[],this._gmIcon=uniLib.DisplayUtils.createMask(1,20,20,16711935),this._gmIcon.touchEnabled=!0,this._gmIcon.x=0,this._gmIcon.y=606,this.addChild(this._gmIcon),this._gmIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gmTool,this),this._hostIcon=uniLib.DisplayUtils.createMask(1,20,20,16776960),this._hostIcon.touchEnabled=!0,this._hostIcon.x=0,this._hostIcon.y=647,this.addChild(this._hostIcon),this._hostIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHostTouchHandler,this),this._listenPanel=new egret.Sprite,this._listenPanel.name="listenPanel",this._listenPanel.x=(uniLib.Global.screenWidth-1136)/2+170,this._listenPanel.y=uniLib.Global.screenHeight-(t.CardMJ.CardHeight+60)*t.GameConst.scaleFactor,t.GameInfo.mainUILayer.addChild(this._listenPanel),this._listenPanel.visible=!1,this._listenBtnBg=uniLib.DisplayUtils.createBitmapByName("listenBtn_bg"),this._listenBtnBg.scale9Grid=new egret.Rectangle(94,22,19,79),this._listenBtnBg.x=3,this._listenBtnBg.y=-19,this._listenBtnBg.height=95,this._listenPanel.addChild(this._listenBtnBg),this._listenBtnBg.visible=!1,this._listenBtnIcon=new t.GameButton(["listen_btn1","listen_btn2"]),this._listenBtnIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._listenPanel.addChild(this._listenBtnIcon),this._listenBtnIcon.visible=!1,this._listenCardPanel=new egret.Sprite,this._listenPanel.addChild(this._listenCardPanel),this._listenCardPanel.visible=!1,this._listenTimer=new egret.Timer(4e3,1),this._listenTimer.addEventListener(egret.TimerEvent.TIMER,this.listenTimerEvt,this),t.DataCache.platParam?(this._roomIdTxf=t.ResUtil.createTextFeild(t.ColorConst.greenFanghao,egret.HorizontalAlign.LEFT,"房号:"+t.DataCache.platParam.roomId,22,23,21,180),this._roomIdTxf.textFlow=[{text:"房号",style:{textColor:t.ColorConst.greenFanghao}},{text:t.DataCache.platParam.roomId,style:{textColor:14936289}}]):this._roomIdTxf=t.ResUtil.createTextFeild(t.ColorConst.greenFanghao,egret.HorizontalAlign.LEFT,"房号:",22,23,21,180),this.addChild(this._roomIdTxf),this._roomType=t.ResUtil.createTextFeild(14936289,egret.HorizontalAlign.LEFT,"",22,22,49,120),this.addChild(this._roomType),this._roomPlayerNum=t.ResUtil.createTextFeild(t.ColorConst.greenFanghao,egret.HorizontalAlign.LEFT,"几人场",22,112,49,150),this.addChild(this._roomPlayerNum),this._roomNumber=t.ResUtil.createTextFeild(t.ColorConst.greenFanghao,egret.HorizontalAlign.CENTER,"未开局",25,22,77,120),this._roomNumber.x=(uniLib.Global.screenWidth-this._roomNumber.width)/2+150,this._roomNumber.height=30,this._roomNumber.y=uniLib.Global.screenHeight/2-47,this.addChild(this._roomNumber),this._restCardNum=t.ResUtil.createTextFeild(t.ColorConst.greenFanghao,egret.HorizontalAlign.CENTER,"剩余牌数",25),this._restCardNum.width=120,this._restCardNum.height=30,this._restCardNum.x=(uniLib.Global.screenWidth-this._restCardNum.width)/2-152,this._restCardNum.y=uniLib.Global.screenHeight/2-47,this.addChild(this._restCardNum),this._gameState=t.ResUtil.createTextFeild(t.ColorConst.greenFanghao,egret.HorizontalAlign.CENTER,"游戏状态",22),this._gameState.width=600,this._gameState.textAlign=egret.HorizontalAlign.CENTER,this._gameState.x=(uniLib.Global.screenWidth-this._gameState.width)/2,this._gameState.y=385,this.addChild(this._gameState),this._backBtn=new t.GameButton([t.ColorConst.color+"back1",t.ColorConst.color+"back2"]),this._backBtn.touchEnabled=!0,this._backBtn.touchChildren=!0,this._backBtn.x=(uniLib.Global.screenWidth-1136)/2+180,this._backBtn.y=uniLib.Global.screenHeight-260,this._backBtn.visible=!1,this._backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackBtnTouch,this),this.addChild(this._backBtn),this._shareBtn=new t.GameButton([t.ColorConst.color+"invite1",t.ColorConst.color+"invite2"]),this._shareBtn.touchEnabled=!0,this._shareBtn.touchChildren=!0,this._shareBtn.x=(uniLib.Global.screenWidth-1136)/2+400,this._shareBtn.y=uniLib.Global.screenHeight-260,this._shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnTouch,this),this.addChild(this._shareBtn),this._shareBtn.visible=!1,1==uniLib.Global.is_sandbox&&(this._shareBtn.visible=!1),this._readyBtn=new t.GameButton([t.ColorConst.green+"ready1",t.ColorConst.green+"ready2"]),this._readyBtn.touchEnabled=!0,this._readyBtn.x=(uniLib.Global.screenWidth-1136)/2+465,this._readyBtn.y=uniLib.Global.screenHeight-100,this._readyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReadyBtnTouch,this),this.addChild(this._readyBtn),this._readyBtn.visible=!1,this._cancelreadyBtn=new t.GameButton([t.ColorConst.green+"cancelready1",t.ColorConst.green+"cancelready2"]),this._cancelreadyBtn.touchEnabled=!0,this._cancelreadyBtn.x=(uniLib.Global.screenWidth-1136)/2+465,this._cancelreadyBtn.y=uniLib.Global.screenHeight-100,this._cancelreadyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancelReadyBtnTouch,this),this.addChild(this._cancelreadyBtn),this._cancelreadyBtn.visible=!0,this._dissBtn=new t.GameButton([t.ColorConst.green+"dismiss1",t.ColorConst.green+"dismiss2"]),this._dissBtn.touchEnabled=!0,this._dissBtn.touchChildren=!0,this._dissBtn.x=(uniLib.Global.screenWidth-1136)/2+750,this._dissBtn.y=uniLib.Global.screenHeight-260,this._dissBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDissBtnTouch,this),this.addChild(this._dissBtn),this._dissBtn.visible=!1,this._changeIcon=new t.GameButton([t.ColorConst.color+"change_btn2",t.ColorConst.color+"change_btn1"]),this._changeIcon.touchEnabled=!0,this._changeIcon.x=(uniLib.Global.screenWidth-1136)/2+180,this._changeIcon.y=uniLib.Global.screenHeight-105,this.addChild(this._changeIcon),this._changeIcon.visible=!1,this._changeRoom=new t.GameButton([t.ColorConst.green+"changeDesk1",t.ColorConst.green+"changeDesk2"]),this._changeRoom.touchEnabled=!0,this._changeRoom.x=(uniLib.Global.screenWidth-1136)/2+180,this._changeRoom.y=uniLib.Global.screenHeight-260,this.addChild(this._changeRoom),this._changeRoom.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showChangeRoomConfirm,this),this._changeRoom.visible=!1,this._leaveBtn=new t.GameButton([t.ColorConst.green+"leaveRoom1",t.ColorConst.green+"leaveRoom2"]),this._leaveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeaveRoom,this),this._leaveBtn.touchEnabled=!0,this.addChild(this._leaveBtn),this._leaveBtn.x=this._dissBtn.x,this._leaveBtn.y=this._dissBtn.y,this._leaveBtn.visible=!1,this._signal=t.ResUtil.createBitmapByName(""),this._signal.x=uniLib.Global.screenWidth-120,this._signal.y=25,this.addChild(this._signal),this._signalTxt=t.ResUtil.createTextFeild(16711680,egret.HorizontalAlign.LEFT,"没网络",13,uniLib.Global.screenWidth-160,12,100),this.addChild(this._signalTxt),this._signalTxt.visible=!1,this._signal.visible=!0;
var e=t.ResUtil.createBitmapByName(t.ColorConst.color+"bettery");e.x=uniLib.Global.screenWidth-60,e.y=25,this.addChild(e),this._betteryPercent=t.ResUtil.createBitmapByName(t.ColorConst.color+"betteryPercent"),this._betteryPercent.scale9Grid=new egret.Rectangle(1,5,0,2),this._betteryPercent.x=uniLib.Global.screenWidth-58,this._betteryPercent.y=28,this._betteryPercent.width=23,this.addChild(this._betteryPercent),this._timeTxt=t.ResUtil.createTextFeild(t.ColorConst.colorFont,egret.HorizontalAlign.LEFT,"00:00",18,uniLib.Global.screenWidth-70,50,100),this.addChild(this._timeTxt),this._dateTxt=t.ResUtil.createTextFeild(t.ColorConst.colorFont,egret.HorizontalAlign.LEFT,"11-14",18,uniLib.Global.screenWidth-130,50,100),this.addChild(this._dateTxt);var n=new Date,s=n.getMonth()+1+"-"+this.setTimeFormat(n.getDate());this._dateTxt.text=s,this._timeTxt.text=this.setTimeFormat(n.getHours())+":"+this.setTimeFormat(n.getMinutes()),0!=t.RoomInfo.getInstance().video&&(this._recordTime=t.ResUtil.createTextFeild(t.ColorConst.colorFont,egret.HorizontalAlign.LEFT,"00:00",18,uniLib.Global.screenWidth-155,50,160),this.addChild(this._recordTime),this._recordTime.text=i.FormatDate(MJLobby.MJLobbyData.getInstance().videoStartTime),this._timeTxt.visible=this._dateTxt.visible=!1),this._timer_1000=new uniLib.TimerBase(1e4,this.countSecond,this),this._timer_1000.start(1),uniLib.SoundMgr.instance.playBgMusic([t.SoundConsts.BG_MUSIC]),this._signalTxt.visible=!1,this._signal.visible=!0,this._signal.texture=RES.getRes(t.ColorConst.color+"data"),this.updateJoinRoom();var a=t.ResUtil.createTextFeild(7186632,egret.HorizontalAlign.LEFT,"版本：",18,uniLib.Global.screenWidth-126,uniLib.Global.screenHeight-20,200);a.text=uniLib.Global.version.toString(),this.addChild(a),uniLib.Global.addEventListener(uniLib.ZqEvent.NATIVE_TO_EGERET,this.onNativeMessage,this),this._sysMsgVc=new t.GameSysMsg,this._sysMsgVc.x=320,this._sysMsgVc.y=13,t.GameInfo.topLayer.addChild(this._sysMsgVc),this._hostBtn=new t.GameButton(["game_NDoperate_host1","game_NDoperate_host2"]),this._hostBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHostBtnTouch,this),this._hostBtn.touchEnabled=!0,this._hostBtn.x=uniLib.Global.screenWidth-88,this._hostBtn.y=35,t.GameInfo.mainUILayer.addChild(this._hostBtn),this._helpBtn=new t.GameButton(["game_help1","game_help2"]),this._helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelpBtnTouch,this),this._helpBtn.touchEnabled=!0,this._helpBtn.x=uniLib.Global.screenWidth-160,this._helpBtn.y=108,t.GameInfo.mainUILayer.addChild(this._helpBtn),this.showDebugButton(),this.showEnterButtons(),this.showDebugButton(),this.showEnterButtons(),this.showVideoPanel(),this._setBtn.visible=!1,this._hostBtn.visible=!1,this._helpBtn.visible=!1,this.settingBg.visible=!1,egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStateTap,this),this._gpsBtn=new t.GameButton(["gps_3","gps_3"]),this._gpsBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGpsBtnTouch,this),this._gpsBtn.touchEnabled=!0,this._gpsBtn.x=uniLib.Global.screenWidth-220,this._gpsBtn.y=35,this._gpsBtn.scaleX=this._gpsBtn.scaleY=.8,this.addChild(this._gpsBtn),0!=uniLib.Global.is_sandbox&&(this._gpsBtn.visible=!1)},i.prototype.onStateTap=function(t){t.target!=this.setControlButton&&(this._setBtn.visible=!1,this._hostBtn.visible=!1,this._helpBtn.visible=!1,this.settingBg.visible=!1)},i.prototype.onSetControlButton=function(){var t=!this._hostBtn.visible;this._setBtn.visible=t,this._hostBtn.visible=t,this._helpBtn.visible=t,this.settingBg.visible=t},i.FormatDate=function(t,e){if(void 0===e&&(e=!1),null==t)return"";var i=new Date(1e3*t),n=i.getFullYear(),s=i.getMonth()+1,a=s.toString().padLeft(2,"0"),o=i.getDate(),r=o.toString().padLeft(2,"0"),h=i.getHours(),d=h.toString().padLeft(2,"0"),l=i.getMinutes(),c=l.toString().padLeft(2,"0"),u=i.getSeconds(),_=u.toString().padLeft(2,"0");return e?n+"-"+a+"-"+r+" "+d+":"+c:a+"-"+r+" "+d+":"+c+":"+_},i.prototype.createRoomRules=function(){if(this._roomRules)"green"!=uniLib.Utils.getLocalStorage("tableclothMode")&&uniLib.Utils.getLocalStorage("tableclothMode")?this._roomRules.textColor=1791889:this._roomRules.textColor=1072691;else{for(var e="",i=t.RoomInfo.getInstance().getPlayTypeByList(),n=0;n<i.length;n++)e=e+i[n]+"  ";this._roomRules=t.ResUtil.createTextFeild(16777215,egret.HorizontalAlign.CENTER,"",30,0,224,920),"green"!=uniLib.Utils.getLocalStorage("tableclothMode")&&uniLib.Utils.getLocalStorage("tableclothMode")?this._roomRules.textColor=1791889:this._roomRules.textColor=1072691,this._roomRules.x=uniLib.Global.screenWidth/2-this._roomRules.width/2,this._roomRules.text=e,this._roomRules.fontFamily="微软雅黑"}},i.prototype.onHostBtnTouch=function(e){this.dispatchEventWith(t.UIEventConsts.ACTION_HOST)},i.prototype.onHelpBtnTouch=function(e){this.dispatchEventWith(t.UIEventConsts.SHOW_HELP)},i.prototype.onGpsBtnTouch=function(e){function i(t){if(0==t.code){n.lng=t.data.longitude,n.lat=t.data.latitude;var e=new Cmd.GetGPSLocationCmd_C;e.lat=n.lat,e.lng=n.lng,uniLib.NetMgr.tcpSend(e)}}var n;n=uniLib.ZQGameSdk.getLocation(i,this),this.dispatchEventWith(t.UIEventConsts.SHOW_GPS)},i.prototype.showDebugButton=function(){uniLib.Global.debugLevel>=1?(this._gmIcon.visible=!0,this._hostIcon.visible=!0):(this._gmIcon.visible=!1,this._hostIcon.visible=!1)},i.prototype.onNativeMessage=function(e){e.param.cmd==uniLib.ZQGameSdk.NETSTATE&&0==e.param.code?(uniLib.ZQGameSdk.lastNetState&&uniLib.ZQGameSdk.lastNetState.data[uniLib.ZQGameSdk.NETSTATE]!=e.param.data[uniLib.ZQGameSdk.NETSTATE]&&(uniLib.NetMgr.tcpSend(new Cmd.ClientEchoMahjongCmd_SC),uniLib.NetMgr.setMsgTimeout(5,"ClientEchoMahjongCmd_SC")),e.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.NO_SIGNAL?(this._signalTxt.visible=!0,this._signal.visible=!1):e.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.WIFI?(this._signalTxt.visible=!1,this._signal.visible=!0,this._signal.texture=RES.getRes(t.ColorConst.color+"wifi")):e.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.DATA_FLOWS?(this._signalTxt.visible=!1,this._signal.visible=!0,this._signal.texture=RES.getRes(t.ColorConst.color+"data")):e.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.WIFI_AND_DATA&&(this._signalTxt.visible=!1,this._signal.visible=!0,this._signal.texture=RES.getRes(t.ColorConst.color+"wifi"))):e.param.cmd==uniLib.ZQGameSdk.BATTERY&&0==e.param.code&&(this._betteryPercent.width=e.param.data[uniLib.ZQGameSdk.BATTERY]/100*23)},i.prototype.countSecond=function(){var t=new Date,e=t.getMonth()+1+"-"+this.setTimeFormat(t.getDate());this._dateTxt.text=e,this._timeTxt.text=this.setTimeFormat(t.getHours())+":"+this.setTimeFormat(t.getMinutes()),uniLib.ZQGameSdk.getNetStateType(),uniLib.ZQGameSdk.getBatteryPer()},i.prototype.setTimeFormat=function(t){var e="";return e=10>t?"0"+t:t+""},i.prototype.showEnterButtons=function(){this._backBtn&&this._shareBtn&&this._dissBtn&&(1==uniLib.Global.is_sandbox&&5216!=t.RoomInfo.getInstance().gameId&&(this._helpBtn.visible=!1),t.RoomInfo.getInstance().playTypeList&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)?(this._shareBtn.visible=!1,this._changeIcon.visible=!1,this._helpBtn.visible=!0,this._cancelreadyBtn.visible=!1,this._readyBtn.visible=!0,this._changeRoom.visible=!0,this._cancelreadyBtn.y=this._readyBtn.y=this._dissBtn.y,this._dissBtn.visible=!1,this._leaveBtn.visible=!0,this._backBtn.visible=!1):(1!=uniLib.Global.is_sandbox&&(this._shareBtn.visible=!0),this._readyBtn.visible=!0,this._cancelreadyBtn.y=this._readyBtn.y=uniLib.Global.screenHeight-100,this._cancelreadyBtn.visible=!1,this._dissBtn.visible=!0,this._changeIcon.visible=!1,this._changeRoom.visible=!1,this._leaveBtn.visible=!1,this._backBtn.visible=!0))},i.prototype.showChangeRoom=function(){this.showEnterButtons()},i.prototype.changeReay=function(){this._cancelreadyBtn.visible=this._readyBtn.visible,this._readyBtn.visible=!this._readyBtn.visible},i.prototype.cancelReady=function(){this._readyBtn.visible=!0,this._cancelreadyBtn.visible=!1},i.prototype.ShowChangeIcon=function(){t.RoomInfo.getInstance().playTypeList&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)||this._changeIcon&&(this._changeIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showChangeUserNumConfirm,this),this._changeIcon.visible=!0)},i.prototype.showDissBtn=function(){t.RoomInfo.getInstance().playTypeList&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)||uniLib.UserInfo.uid!=t.RoomInfo.getInstance().houseOwnerUID&&this._dissBtn&&1==this._dissBtn.visible&&(this._dissBtn.visible=!1,this._leaveBtn.visible=!0)},i.prototype.onShareBtnTouch=function(){this.dispatchEventWith(t.UIEventConsts.SHARE_GAME)},i.prototype.onReadyBtnTouch=function(){this.dispatchEventWith(t.UIEventConsts.START_READY)},i.prototype.onCancelReadyBtnTouch=function(){this.dispatchEventWith(t.UIEventConsts.START_READY,!1,1)},i.prototype.onBackBtnTouch=function(){this.dispatchEventWith(t.UIEventConsts.EXIT_GAME)},i.prototype.onDissBtnTouch=function(){this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME,!1,1)},i.prototype.onLeaveRoom=function(){this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME,!1,0)},i.prototype.showListenIcon=function(e){this._listenPanel.visible=!0,e.length>0?(this._listenBtnBg||(this._listenBtnBg=uniLib.DisplayUtils.createBitmapByName("listenBtn_bg"),this._listenBtnBg.x=3,this._listenBtnBg.y=-19,this._listenBtnBg.height=95,this._listenBtnBg.scale9Grid=new egret.Rectangle(94,22,19,79),this._listenPanel.addChild(this._listenBtnBg),this._listenBtnBg.visible=!1),this._listenBtnIcon||(this._listenBtnIcon=new t.GameButton(["listen_btn1","listen_btn2"]),this._listenBtnIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._listenPanel.addChild(this._listenBtnIcon)),this._listenCardPanel||(this._listenCardPanel=new egret.Sprite,this._listenPanel.addChild(this._listenCardPanel),this._listenCardPanel.visible=!1),this._listenBtnBg.visible&&this.refreshListenPanel(),this._listenBtnIcon.visible=!0):(this._listenBtnIcon&&(this._listenBtnIcon.visible=!1),this._listenBtnBg&&(this._listenBtnBg.visible=!1),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel))},i.prototype.setListenCard=function(){var e=t.CardInfo.getInstance().winCardSet;if(this._listenBtnBg.visible?(this._listenBtnBg.visible=!1,this._listenTimer.stop()):(this._listenBtnBg.visible=!0,this._listenTimer.start()),this._listenBtnBg.width=155+47*(e.length-1),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),this._listenCardPanel.visible)this._listenCardPanel.visible=!1;else{if(34==e.length||27==e.length){this._listenBtnBg.width=155;var i=new t.OutPutCard;i.showListenCard(e[0],1,!0),i.x=100,this._listenCardPanel.addChild(i)}else for(var n=0;n<e.length;n++){var s=new t.OutPutCard;s.showListenCard(e[n],1),s.x=n*(s.width+5)+100,this._listenCardPanel.addChild(s)}this._listenCardPanel.visible=!0}},i.prototype.shouListenButton=function(){null==this.listenButton&&(this.listenButton=new t.GameButton(["operate_listen1","operate_listen1"]),this.listenButton.x=this._defaultPoint.x-160,this.listenButton.y=this._defaultPoint.y+3,this.listenButton.touchEnabled=!0,this.listenButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showOperate,this)),null==this.passButton&&(this.passButton=new t.GameButton(["operate_cancel1","operate_cancel1"]),this.passButton.x=this._defaultPoint.x,this.passButton.y=this._defaultPoint.y+3,this.passButton.touchEnabled=!0,this.passButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeButton,this)),t.PopupManager.addPopUp(this.listenButton,!1,!1),t.PopupManager.addPopUp(this.passButton,!1,!1),t.CardsVc.defaultTouchEnabled=!1},i.prototype.showOperate=function(t){this.closeButton()},i.prototype.closeButton=function(){t.CardsVc.defaultTouchEnabled=!0,this.passButton&&this.passButton.parent&&(this.passButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeButton,this),t.PopupManager.removePopUp(this.passButton),this.passButton.destory(),this.passButton=null),this.listenButton&&this.listenButton.parent&&(this.listenButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showOperate,this),t.PopupManager.removePopUp(this.listenButton),this.listenButton.destory(),this.listenButton=null)},i.prototype.refreshListenPanel=function(){if(this._listenCardPanel&&0!=t.CardInfo.getInstance().winCardSet.length&&0!=this._listenCardPanel.numChildren&&this._listenCardPanel.visible){var e=t.CardInfo.getInstance().winCardSet;if(this._listenBtnBg.width=155+47*(e.length-1),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),34==e.length||27==e.length){this._listenBtnBg.width=155;var i=new t.OutPutCard;i.showListenCard(e[0],1,!0),i.x=100,this._listenCardPanel.addChild(i)}else for(var n=0;n<e.length;n++){var s=new t.OutPutCard;s.showListenCard(e[n],1),s.x=n*(s.width+5)+100,this._listenCardPanel.addChild(s)}}},i.prototype.listenTimerEvt=function(t){this._listenBtnBg&&(this._listenBtnBg.visible=!1),this._listenCardPanel&&(this._listenCardPanel.visible=!1,uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel)),this._listenTimer.stop()},i.prototype.clearListenPanel=function(){uniLib.DisplayUtils.removeAllChildren(this._listenPanel),this._listenBtnBg=null,this._listenBtnIcon&&this._listenBtnIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._listenBtnIcon=null,this._listenCardPanel&&uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),this._listenCardPanel=null,i.isTing=null},i.prototype.gmTool=function(){this.dispatchEventWith(t.UIEventConsts.SHOW_GM_Tool)},i.prototype.onHostTouchHandler=function(e){t.RoomInfo.getInstance().host_mode?(t.RoomInfo.getInstance().host_mode=0,t.GameInfo.manage.showMildWarnShow("取消托管")):(t.RoomInfo.getInstance().host_mode=1,t.GameInfo.manage.showMildWarnShow("托管"))},i.prototype.onChangeTouchHandler=function(e){this.dispatchEventWith(t.UIEventConsts.REQUEST_CHANGE_USERNUM)},i.prototype.onChangeRoomHandler=function(e){this.dispatchEventWith(t.UIEventConsts.EXCHANGE_DESK)},i.prototype.showChangeUserNumConfirm=function(){if(t.RoomInfo.getInstance().userList){if(1==t.RoomInfo.getInstance().userList.length)return void t.PublicManage.getInstance().showMildWarnShow("当前房间只有您自己，不可提前开局");var e="是否将房间改为"+t.RoomInfo.getInstance().userList.length+"人模式，提前开局？";t.GameInfo.manage.showConfirmPanel(e,["确定","取消"],[this.onChangeTouchHandler],null,this)}},i.prototype.showChangeRoomConfirm=function(){var e="是否换桌？";t.GameInfo.manage.showConfirmPanel(e,["确定","取消"],[this.onChangeRoomHandler],null,this)},i.prototype.playTing=function(e){var i=(t.RoomInfo.getInstance().getUserVoByUid(e),t.RoomInfo.getInstance().getSeatNoByUserId(e)),n=t.PositionData.seatPosArr[i];if(!this.tingMCArr[i]){var s=uniLib.DisplayUtils.createMovieClicp("ting");s.x=n.x+48,s.y=n.y+s.width/2-10,s.addEventListener(egret.Event.ADDED_TO_STAGE,this.onTingADDED_TO_STAGE,this),t.GameInfo.topLayer.addChild(s),this.tingMCArr[i]=s}},i.prototype.onTingADDED_TO_STAGE=function(t){t.target.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onTingADDED_TO_STAGE,this),t.target.play(-1)},i.prototype.setHearCard=function(e){var i=t.RoomInfo.getInstance().goldenCard;if(uniLib.UserInfo.uid==e)if(i&&null!=i[0])if(999!=i[0]){var n=table.TableCard.resNormal(i[0]);this._goldenMjGroup[0].bitmapData=RES.getRes(n)}else this._goldenMjGroup[0].bitmapData=RES.getRes("HorseCard_back"),this._goldenMjGroup[0].visible=!0;else this._goldenMjGroup[0].bitmapData=RES.getRes("Card_dark")},i.prototype.setGoldenMj=function(e){void 0===e&&(e=0),0==t.RoomInfo.getInstance().playType;var i=t.RoomInfo.getInstance().goldenCard,n=t.RoomInfo.getInstance().displayCard;if(!i||0==i.length)return void(this._goldenIcon&&(this._goldenIcon.visible=!1));if(t.RoomInfo.getInstance().displayCard=[],e&&999!=i[0]){if((0!=t.RoomInfo.getInstance().video||i[0])&&i[0]){var s=table.TableCard.resNormal(i[0]);this._goldenMjGroup[0].bitmapData=RES.getRes(s)}if(this._dingBao)if(n instanceof Array&&n.length>0){console.error("看宝"),this._kanBao||(this._kanBao=t.ResUtil.createBitmapByName("kanbao_png"),this._kanBao.x=0+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,this._kanBao.y=0,t.GameInfo.topLayer.addChild(this._kanBao)),this._kanBao.visible=!0;var a=egret.setTimeout(function(){this._kanBao&&(this._kanBao.visible=!1),egret.clearTimeout(a)},this,1200);this._timerList.push(a);var o=t.RoomInfo.getInstance().getUserVoByUid(uniLib.UserInfo.uid).getGender(),r="action_pu_kanbao_"+o.toString()+"_mp3";RES.hasRes(r)||(r=""),""!=r&&uniLib.SoundMgr.instance.playSound(r)}else{console.error("换宝"),this._huanBao||(this._huanBao=t.ResUtil.createBitmapByName("huanbao_png"),this._huanBao.x=0+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,this._huanBao.y=0,t.GameInfo.topLayer.addChild(this._huanBao)),this._huanBao.visible=!0;var h=egret.setTimeout(function(){this._huanBao&&(this._huanBao.visible=!1),egret.clearTimeout(h)},this,1200);this._timerList.push(h);var o=t.RoomInfo.getInstance().getUserVoByUid(uniLib.UserInfo.uid).getGender(),r="action_pu_huanbao_"+o.toString()+"_mp3";RES.hasRes(r)||(r=""),""!=r&&uniLib.SoundMgr.instance.playSound(r)}else{this._dingBao=t.ResUtil.createBitmapByName("dingbao_png"),this._dingBao.x=0+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,this._dingBao.y=0,t.GameInfo.topLayer.addChild(this._dingBao),this._dingBao.visible=!0;var d=egret.setTimeout(function(){this._dingBao&&(this._dingBao.visible=!1),egret.clearTimeout(d)},this,1200);this._timerList.push(d);var o=t.RoomInfo.getInstance().getUserVoByUid(uniLib.UserInfo.uid).getGender(),r="action_pu_tingbao_"+o.toString()+"_mp3";RES.hasRes(r)||(r=""),""!=r&&uniLib.SoundMgr.instance.playSound(r),console.error("定宝")}}else{var l=t.GameConst.cardStylePer+"HorseCard_back";this._goldenMjGroup[0].bitmapData=RES.getRes(l),this._goldenMjGroup[0].visible=!0}t.RoomInfo.getInstance().playType;uniLib.Console.info("setGoldenMj",t.RoomInfo.getInstance().playType),1==t.RoomInfo.getInstance().playType?(this._goldenIcon.bitmapData=RES.getRes("treasure"),this._goldenIcon.x=22):(this._goldenIcon.bitmapData=RES.getRes("treasure2"),this._goldenIcon.x=20),this._goldenIcon.visible=!0},i.prototype.onSet=function(){this.dispatchEventWith(t.UIEventConsts.SHOW_SETTING)},i.prototype.onShortChat=function(){this.dispatchEventWith(t.UIEventConsts.SHOW_SHORT_CHAT)},i.prototype.removeTingMc=function(e){e.stop(),e.parent&&t.ResUtil.removeFromParent(e),e=null},i.prototype.showResult=function(e){for(var n=0;4>n;n++)this.tingMCArr[n]&&this.tingMCArr[n].parent&&this.removeTingMc(this.tingMCArr[n]);this.tingMCArr=[],i.isResult=!0,this._dingBao&&(this._dingBao.visible=!1,uniLib.DisplayUtils.removeFromParent(this._dingBao)),this._dingBao=null,this._huanBao&&(this._huanBao.visible=!1,uniLib.DisplayUtils.removeFromParent(this._huanBao)),this._huanBao=null,this._kanBao&&(this._kanBao.visible=!1,uniLib.DisplayUtils.removeFromParent(this._kanBao)),this._kanBao=null,t.RoomInfo.getInstance().winRes=e,egret.Tween.removeTweens(this),egret.Tween.get(this).wait(3e3).call(this.showResultPanel,this,[e])},i.prototype.showBuyHorsePanel=function(e){this._buyHorsePanel||(this._buyHorsePanel=new t.BuyHorsePanel),this._buyHorsePanel.createPanel(e),t.PopupManager.addPopUp(this._buyHorsePanel,!0,!1),this._buyHorsePanel.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.showResultPanel,this)},i.prototype.showResultPanel=function(e){e=t.RoomInfo.getInstance().winRes,this._buyHorsePanel&&(t.PopupManager.removePopUp(this._buyHorsePanel),this._buyHorsePanel.destory(),this._buyHorsePanel=null),this._resultPanel||(this._resultPanel=new t.ResultPanel,this._resultPanel.name="result",this._resultPanel.x=(uniLib.Global.screenWidth-this._resultPanel.width)/2,this._resultPanel.y=(uniLib.Global.screenHeight-this._resultPanel.height)/2),this._resultPanel.setResultData(e),this._resultPanel.addEventListener(t.UIEventConsts.READY,this.onResultHandle,this),this._resultPanel.addEventListener(t.UIEventConsts.EXCHANGE_DESK,this.onResultHandle,this),this._resultPanel.addEventListener(t.UIEventConsts.DISMISS_GAME,this.onResultHandle,this),t.GameInfo.topLayer.addChild(this._resultPanel)},i.prototype.onResultHandle=function(t){this.dispatchEvent(t)},i.prototype.removeResultPanel=function(){this._resultPanel&&(this._resultPanel.hasEventListener(t.UIEventConsts.READY)&&this._resultPanel.removeEventListener(t.UIEventConsts.READY,this.onResultHandle,this),this._resultPanel.hasEventListener(t.UIEventConsts.EXCHANGE_DESK)&&this._resultPanel.removeEventListener(t.UIEventConsts.EXCHANGE_DESK,this.onResultHandle,this),this._resultPanel.hasEventListener(t.UIEventConsts.DISMISS_GAME)&&this._resultPanel.removeEventListener(t.UIEventConsts.DISMISS_GAME,this.onResultHandle,this),this._resultPanel.reset(),uniLib.DisplayUtils.removeFromParent(this._resultPanel)),i.isResult=null},i.prototype.reset=function(){for(var t=0;t<this._goldenMjGroup.length;t++)this._goldenMjGroup[t].visible=!1;this._listenPanel.visible=!1,egret.Tween.removeTweens(this),this.removeResultPanel(),this.clearListenPanel(),this._timerList&&this._timerList.forEach(function(t){egret.clearTimeout(t)}),this._timerList=[]},i.prototype.updateGhostData=function(){var e=t.RoomInfo.getInstance().playType;console.info("刷新鬼牌数据",e);for(var i=0;e>i;i++){var n=new egret.Bitmap;n.x=29+77*i,n.y=110,n.scaleX=n.scaleY=.9,this._goldenMjGroup.push(n),this.addChild(n)}switch(e){case 0:this._goldenIcon&&(this._goldenIcon.visible=!1);break;case 1:this._goldenIcon=t.ResUtil.createBitmapByName("treasure",20,105),this._goldenIcon.visible=!0;break;case 2:this._goldenIcon=t.ResUtil.createBitmapByName("treasure2",20,105),this._goldenIcon.visible=!0}this._goldenIcon&&this.addChild(this._goldenIcon)},i.prototype.changeTablecloth=function(){"green"!=uniLib.Utils.getLocalStorage("tableclothMode")&&uniLib.Utils.getLocalStorage("tableclothMode")?(this._bg.texture=RES.getRes("2d_tableBg2_big"),this.createRoomRules()):(this._bg.texture=RES.getRes("2d_tableBg1_big"),this.createRoomRules())},i.prototype.updateEnterRoom=function(){if(egret.Tween.removeTweens(this._enterTips),this._enterTips.text="",5260==t.RoomInfo.getInstance().gameId||5300==t.RoomInfo.getInstance().gameId?t.RoomInfo.getInstance().setPlayType("大瓦穷胡"):5298==t.RoomInfo.getInstance().gameId&&t.RoomInfo.getInstance().setPlayType("大连穷胡"),uniLib.Utils.setLocalStorage("majiangType_"+t.RoomInfo.getInstance().gameId,1),this._roomType.text=t.RoomInfo.getInstance().getPlayType(),this._roomPlayerNum.text=t.RoomInfo.getInstance().playerNumber+"人场",this._roomPlayerNum.x=this._roomType.x+this._roomType.width+3,t.GameConst.MaJiongChange){var e=uniLib.Utils.getLocalStorage("majiangType_"+t.RoomInfo.getInstance().gameId);e=1==e?1:0,t.GameConst.cardStylePer=t.GameConst.cardStypePerStrList[e]}1==t.RoomInfo.getInstance().canHostMode},i.prototype.updateRound=function(){t.RoomInfo.getInstance().playTypeList&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)?this._roomNumber.text="金币场":2==t.RoomInfo.getInstance().roomType?this._roomNumber.text=t.RoomInfo.getInstance().curNumber+"/"+t.RoomInfo.getInstance().totalNumber+"局":1==t.RoomInfo.getInstance().roomType&&(this._roomNumber.text=t.RoomInfo.getInstance().curNumber+"/"+t.RoomInfo.getInstance().totalNumber+"圈")},i.prototype.updateRoomId=function(){this._roomIdTxf.textFlow=[{text:"房号",style:{textColor:t.ColorConst.greenFanghao}},{text:t.DataCache.platParam.roomId,style:{textColor:14936289}}]},i.prototype.updateJoinRoom=function(){this._enterTips=t.ResUtil.createTextFeild(t.ColorConst.colorFont,egret.HorizontalAlign.LEFT,"正在加载房间数据.",18,0,0,200),this._enterTips.x=uniLib.Global.screenWidth-this._enterTips.width+48>>1,this._enterTips.y=uniLib.Global.screenHeight-300*uniLib.ScreenUtils.scaleFactor,this.addChild(this._enterTips),egret.Tween.get(this._enterTips,{loop:!0}).to({text:this._enterTips.text+"."},500).to({text:this._enterTips.text+".."},500).wait(500)},i.prototype.updateNetWork=function(t){this._gameState&&(egret.Tween.removeTweens(this._gameState),t?(this._gameState.text="发牌中，请稍等.",egret.Tween.get(this._gameState,{loop:!0}).to({text:this._gameState.text+"."},500).to({text:this._gameState.text+".."},500).wait(500)):(egret.Tween.removeTweens(this._gameState),this._gameState.text=""))},i.prototype.updateReadyState=function(){this._gameState&&t.RoomInfo.getInstance().firstReady&&(egret.Tween.removeTweens(this._gameState),t.RoomInfo.getInstance().firstReady=!1,this._gameState.text="准备中.",egret.Tween.get(this._gameState,{loop:!0}).to({text:this._gameState.text+"."},500).to({text:this._gameState.text+".."},500).wait(500))},i.prototype.refreshCard=function(){if(egret.Tween.removeTweens(this._restCardNum),this._restCardNum.text="剩:"+t.RoomInfo.getInstance().getRemainCardNum()+"张",t.RoomInfo.getInstance().getRemainCardNum()<18&&t.RoomInfo.getInstance().getRemainCardNum()>1){var e=t.RoomInfo.getInstance().getUserVoByUid(uniLib.UserInfo.uid).getGender(),i="action_pu_fenzhang_"+e.toString()+"_mp3";RES.hasRes(i)||(i=""),""!=i&&uniLib.SoundMgr.instance.playSound(i)}this.updateNetWork(!1)},i.prototype.updateTimeout=function(e){egret.Tween.removeTweens(this._gameState);var i=[{text:""+e.nickname,style:{textColor:16777215}},{text:"超时暂停中.",style:{textColor:t.ColorConst.resetFont}}],n=[{text:""+e.nickname,style:{textColor:16777215}},{text:"超时暂停中..",style:{textColor:t.ColorConst.resetFont}}],s=[{text:""+e.nickname,style:{textColor:16777215}},{text:"超时暂停中...",style:{textColor:t.ColorConst.resetFont}}];this._gameState.textFlow=i,egret.Tween.get(this._gameState,{loop:!0}).to({textFlow:n},500).to({textFlow:s},500).wait(500)},i.prototype.disposeBtn=function(){this._shareBtn&&(this._shareBtn.destory(),t.ResUtil.removeFromParent(this._shareBtn),this._shareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnTouch,this)),this._shareBtn=null,this._backBtn&&(this._backBtn.destory(),t.ResUtil.removeFromParent(this._backBtn),this._backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackBtnTouch,this)),this._backBtn=null,this._dissBtn&&(this._dissBtn.destory(),t.ResUtil.removeFromParent(this._dissBtn),this._dissBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDissBtnTouch,this)),this._dissBtn=null,this._readyBtn.visible=!1,this._changeRoom.visible=!1,this._leaveBtn.visible=!1,this._cancelreadyBtn.visible=!1,this._changeIcon&&(this._changeIcon.destory(),t.ResUtil.removeFromParent(this._changeIcon),this._changeIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showChangeUserNumConfirm,this)),this._changeIcon=null},i.prototype.setStopService=function(){this.StopServiceInfo=new egret.Bitmap(RES.getRes("notice_serviceStop")),this.StopServiceInfo.touchEnabled=!0,this.StopServiceInfo.x=uniLib.Global.screenWidth/2-610,this.StopServiceInfo.y=uniLib.Global.screenHeight-715,this.StopServiceInfo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showstopServicePanel,this),this.addChild(this.StopServiceInfo),this._notice=new egret.BitmapText;var e=RES.getRes("notice_service_fnt");this._notice.font=e,this._notice.x=uniLib.Global.screenWidth/2-600,this._notice.y=uniLib.Global.screenHeight-705,this.addChild(this._notice),this._notice.touchEnabled=!0,this._notice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showstopServicePanel,this),this._countIndex=t.RoomInfo.getInstance().leftTime,this.stopTimer(),this._timer=new egret.Timer(1e3),this._timer.addEventListener(egret.TimerEvent.TIMER,this.showLeftTime,this),this._timer.start()},i.prototype.showLeftTime=function(){this._countIndex--,this._countIndex<=0&&this.stopTimer();var t=this.formatSeconds(this._countIndex);this._notice.text=t},i.prototype.formatSeconds=function(t){if(!(0>t)){var e=t,i=0,n=0;e>60&&(i=Math.floor(e/60),e=Math.floor(e%60),i>60&&(n=Math.floor(i/60),i=Math.floor(i%60)));var s=" "+this.getzf(e.toString());return i>=0&&(s=""+this.getzf(i.toString())+s),n>=0&&(s=this.getzf(n.toString())+s),s}},i.prototype.getzf=function(t){return parseInt(t)<10&&parseInt(t)>0?t="0"+t:0==parseInt(t)&&(t="00"),t},i.prototype.stopTimer=function(){this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.showLeftTime,this),this._timer=null)},i.prototype.showstopServicePanel=function(){this.dispatchEventWith(t.UIEventConsts.SHOW_STOP_SERVICE)},i.prototype.showVideoPanel=function(){0!=t.RoomInfo.getInstance().video&&(this.showGameVc(!1),t.RoomInfo.getInstance().GM_Mode=!0,this._videoPanel=new t.LibVideoPanel,t.GameInfo.main.addChild(this._videoPanel),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_BACK,this.videoDisEvent,this),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_STOP,this.videoDisEvent,this),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_ADVANCE,this.videoDisEvent,this),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_CLOSE,this.videoDisEvent,this))},i.prototype.videoDisEvent=function(t){this.dispatchEventWith(t.type)},i.prototype.showGameVc=function(t){this._roomIdTxf,this._chatBtn&&(this._chatBtn.visible=t),this._roomNumber,this._hostBtn&&(this._hostBtn.visible=t),this._setBtn&&(this._setBtn.visible=t),this._helpBtn&&(this._helpBtn.visible=t),this._roomPlayerNum,this._gpsBtn&&(this._gpsBtn.visible=t)},i}(t.BaseVc);e.isResult=null,e.isTing=null,t.GameVc=e,__reflect(e.prototype,"game.GameVc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._second=0,t}return __extends(i,e),i.prototype.destory=function(){if(e.prototype.destory.call(this),this.timer_100&&this.timer_100.stop(),this.timer_100=null,this.actionCard&&this.actionCard.destory(),this.actionCard=null,this._actMcArr){for(var i,n,s=0;s<this._actMcArr.length;s++)i=this._actMcArr[s],n=i.actionMc,n.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onActionHandle,this),n.touchEnabled=!1,n.destory();i=0,this._actMcArr=null}this._overPanel&&(uniLib.DisplayUtils.removeAllChildren(this._overPanel),uniLib.DisplayUtils.removeFromParent(this._overPanel)),this._overPanel=null,this._actionMc&&(t.ResUtil.removeAllChildren(this._actionMc),t.ResUtil.removeFromParent(this._actionMc)),this._actionMc=null,this._chowPanel&&(this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_KONG)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_KONG,this.onUserOpera,this),uniLib.DisplayUtils.removeAllChildren(this._chowPanel),uniLib.DisplayUtils.removeFromParent(this._chowPanel)),this._chowPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._second=0,this._initPoint=null,this._actionMcStrArr=null,this._operateCard=null},i.prototype.initUI=function(){this._stepX=-160,this._actMcArr=[];var e,i;this._initPoint=new egret.Point((uniLib.Global.screenWidth-1136)/2+866,uniLib.Global.screenHeight-250-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this._actionMcStrArr=["operate_win","operate_rob","operate_kong","operate_pong","operate_eat","operate_thirdDown","operate_listen","operate_cancel","operate_singleTour","operate_duoTour","operate_thirdTour","operate_fourDown","operate_fiveDown","operate_sixDown","operate_check"];for(var n=0;n<this._actionMcStrArr.length;n++)i=new t.GameButton([this._actionMcStrArr[n]+"1",this._actionMcStrArr[n]+"2"],null,!1),e={},e.index=n,e.actionMc=i,i.name="action"+n,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onActionHandle,this),this._actMcArr.push(e);this._actionMc=new egret.DisplayObjectContainer,this.addChild(this._actionMc),this._overPanel=new egret.Sprite,this.addChild(this._overPanel),this.timer_100=new uniLib.TimerBase(100,this.countSecond,this),this.timer_100.stop()},i.prototype.startGame=function(){this.removeAction(),this._second=0,uniLib.DisplayUtils.removeAllChildren(this._overPanel)},i.prototype.showAction=function(e,i){if(1!=t.RoomInfo.getInstance().video&&i&&i[0]&&0!=i.length){uniLib.SoundMgr.instance.playSound(t.SoundConsts.DRAW_OTHER_TURN),this._operateCard=e;
for(var n,s=[],a=0;a<i.length;a++)n=this.addAction(i[a]),n&&-1==s.indexOf(n)&&s.push(n);s.push(this._actMcArr[14]),s.sort(function(t,e){return t.index>e.index?1:t.index==e.index?0:-1});for(var o,r=s.length-1;r>=0;r--)if(o=s[r].actionMc,r==s.length-2?o.x=this._initPoint.x+-150*(s.length-r-1):o.x=this._initPoint.x+(s.length-r-1)*Math.round(this._stepX),o.y=this._initPoint.y,this._actionMc.addChild(o),2==s[r].index||3==s[r].index||4==s[r].index&&null!=e){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.barSet&&t.CardInfo.getInstance().drawData.barSet.length>1)continue;this.actionCard=new t.MySelfCard,this.actionCard.setCard(e,.45),this.actionCard.x=o.x+o.width,this.actionCard.y=o.y+35,this._actionMc.addChild(this.actionCard)}if(t.RoomInfo.getInstance().host_mode){var h=new egret.TouchEvent(egret.TouchEvent.TOUCH_TAP,!1);h.$currentTarget=s[0].actionMc,this.onActionHandle(h)}}},i.prototype.addAction=function(t){switch(t){case Cmd.MahjongOpCardType.MahjongOpCardType_Win:return this._actMcArr[0];case Cmd.MahjongOpCardType.MahjongOpCardType_BarOther:case Cmd.MahjongOpCardType.MahjongOpCardType_Bar:case Cmd.MahjongOpCardType.MahjongOpCardType_BarSelf:case Cmd.MahjongOpCardType.MahjongOpCardType_BarTouch:return this._actMcArr[2].type=t,this._actMcArr[2];case Cmd.MahjongOpCardType.MahjongOpCardType_Touch:return this._actMcArr[3];case Cmd.MahjongOpCardType.MahjongOpCardType_Eat:return this._actMcArr[4];case Cmd.MahjongOpCardType.MahjongOpCardType_ThreeGold:return this._actMcArr[5];case Cmd.MahjongOpCardType.MahjongOpCardType_SkyWin:return this._actMcArr[0];case Cmd.MahjongOpCardType.MahjongOpCardType_GrabGold:return this._actMcArr[1];case Cmd.MahjongOpCardType.MahjongOpCardType_GoldSwim:return this._actMcArr[8];case Cmd.MahjongOpCardType.MahjongOpCardType_DoubleSwim:return this._actMcArr[9];case Cmd.MahjongOpCardType.MahjongOpCardType_ThreeSwim:return this._actMcArr[10];case Cmd.MahjongOpCardType.MahjongOpCardType_FourGold:return this._actMcArr[11];case Cmd.MahjongOpCardType.MahjongOpCardType_FiveGold:return this._actMcArr[12];case Cmd.MahjongOpCardType.MahjongOpCardType_SixGold:return this._actMcArr[13];case Cmd.MahjongOpCardType.MahjongOpCardType_Listen:return this._actMcArr[6]}return null},i.prototype.removeAction=function(){this.actionCard&&this.actionCard.destory(),this.actionCard=null,this.removeChowPanel(),this._actionMc&&uniLib.DisplayUtils.removeAllChildren(this._actionMc)},i.prototype.setActionVisible=function(t){this._actionMc&&(this._actionMc.visible=t)},i.prototype.dispatch=function(t,e){void 0===e&&(e=null),this.dispatchEventWith(t,!1,e)},i.prototype.onActionHandle=function(e){var i=e.currentTarget;this._curIndex=Number(i.name.slice(6));var n=new t.CardVo;switch(this._curIndex){case 0:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 1:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 3:this.dispatch(t.UIEventConsts.ACTION_PONG,this._operateCard);break;case 2:t.CardInfo.getInstance().drawData?t.RoomInfo.getInstance().host_mode||1==t.CardInfo.getInstance().drawData.barSet.length?this.dispatch(t.UIEventConsts.ACTION_KONG,this._operateCard):this.createKongScene():this.dispatch(t.UIEventConsts.ACTION_KONG,this._operateCard);break;case 4:t.RoomInfo.getInstance().host_mode||1==t.RoomInfo.getInstance().OutCard.eatSet.length?(t.CardInfo.getInstance().eatObj=t.RoomInfo.getInstance().OutCard.eatSet[0],this.dispatch(t.UIEventConsts.ACTION_CHOW)):this.createChowScene();break;case 5:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 6:this.dispatch(t.UIEventConsts.ACTION_LISTEN);break;case 8:this.dispatchEventWith(t.UIEventConsts.ACTION_OPERATE,!1,n);break;case 9:this.dispatchEventWith(t.UIEventConsts.ACTION_OPERATE,!1,n);break;case 10:this.dispatchEventWith(t.UIEventConsts.ACTION_OPERATE,!1,n);break;case 11:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 12:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 13:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 14:this.dispatch(t.UIEventConsts.ACTION_CANCEL),this.removeAction()}},i.prototype.startOver=function(){var e=t.ResUtil.createBitmapByName("heBg_png",350+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,0);this._overPanel.addChild(e),egret.Tween.get(e).to({y:180},800).call(this.bgDown,this,[e]);var i=t.ResUtil.createBitmapByName("liu",100+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,230);this._overPanel.addChild(i),egret.Tween.get(i).wait(300).to({x:490+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2},800).call(this.bgDown,this,[i]);var n=t.ResUtil.createBitmapByName("ju",1e3+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,230);this._overPanel.addChild(n),egret.Tween.get(n).wait(300).to({x:690+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2},800).call(this.bgDown,this,[n]),this.timer_100.start()},i.prototype.bgDown=function(t){egret.Tween.removeTweens(t)},i.prototype.countSecond=function(){this._second++,this._second>=20&&(uniLib.DisplayUtils.removeAllChildren(this._overPanel),this.timer_100.stop(),this._second=0)},i.prototype.createChowScene=function(){this.setActionVisible(!1),this._chowPanel||(this._chowPanel=new t.ChowCardsPanel),this._chowPanel.createChowPanel(),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW,this.onUserOpera,this),t.PopupManager.addPopUp(this._chowPanel,!1,!1)},i.prototype.createKongScene=function(){this.setActionVisible(!1),this._chowPanel||(this._chowPanel=new t.ChowCardsPanel),this._chowPanel.createKongPanel(t.CardInfo.getInstance().drawData.barSet),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_BEGIN_KONG,this.onUserOpera,this),t.PopupManager.addPopUp(this._chowPanel,!1,!1)},i.prototype.onUserOpera=function(e){switch(e.type){case t.UIEventConsts.ACTION_STOP_CHOW:this.setActionVisible(!0);break;case t.UIEventConsts.ACTION_BEGIN_CHOW:this.dispatch(t.UIEventConsts.ACTION_CHOW);break;case t.UIEventConsts.ACTION_BEGIN_KONG:this.dispatch(t.UIEventConsts.ACTION_KONG,t.CardInfo.getInstance().kongThisId)}},i.prototype.removeChowPanel=function(){this._chowPanel&&(this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_KONG)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_KONG,this.onUserOpera,this),t.PopupManager.removePopUp(this._chowPanel),this._chowPanel.destory(),uniLib.DisplayUtils.removeAllChildren(this._chowPanel),uniLib.DisplayUtils.removeFromParent(this._chowPanel)),this._chowPanel=null,this.setActionVisible(!0)},i}(t.BaseVc);e.isSelectTing=!1,t.OperateVc=e,__reflect(e.prototype,"game.OperateVc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._index=0,t}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this.removeGiftItems(),this._giftArr=null;var i;if(this._seatArr&&this._seatArr.length>0)for(var n=0;n<this._seatArr.length;n++)i=this._seatArr[n],i.destory();if(this._readyIconArr)for(var s=0;4>s;s++)t.ResUtil.removeFromParent(this._readyIconArr[s]);this.removeSeat(),this._seatMc=null,this._readyIconArr=null,this._seatArr=null,uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this)},i.prototype.initUI=function(){uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this),this._seatMc=new egret.DisplayObjectContainer,this.addChild(this._seatMc),this._seatArr=[],this._readyIconArr=[];for(var e,i=[new egret.Point((uniLib.Global.screenWidth-1280)/2+590,t.ResUtil.changeYAxis(455)),new egret.Point((uniLib.Global.screenWidth-1280)/2+1050,255),new egret.Point((uniLib.Global.screenWidth-1280)/2+590,53),new egret.Point((uniLib.Global.screenWidth-1136)/2+128,275)],n=0;4>n;n++)e=t.ResUtil.createBitmapByName("readyIcon"),e.x=i[n].x,e.y=i[n].y,this.addChild(e),e.visible=!1,this._readyIconArr.push(e)},i.prototype.onDismiss=function(e){this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME)},i.prototype.initSeat=function(){this.removeSeat();for(var e=t.RoomInfo.getInstance().userList,i=0,n=e.length;n>i;i++)this.addOnePlay(e[i])},i.prototype.refreshPlayerReady=function(t){if(t&&!(t.length<=0))for(var e=0;e<t.length;e++)this.showReady(t[e])},i.prototype.removeSeat=function(){for(var e,i=this._seatMc.numChildren,n=0;i>n;n++)e=this._seatMc.removeChildAt(0),e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showUseInfo,this),this._seatArr.push(e);this.resetReady(),t.GpsPanel.Instance&&t.GpsPanel.Instance.reset()},i.prototype.removePlayer=function(t){var e;e=this._seatMc.getChildByName("seat"+t),e&&(this._readyIconArr[e.seatId].visible=!1,e&&e.parent&&(this._seatMc.removeChild(e),e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showUseInfo,this),this._seatArr.push(e)))},i.prototype.addOnePlay=function(e){console.error("addOnePlay",e),this.removePlayer(e.uid);var i=t.RoomInfo.getInstance().getSeatNo(e.seatId);if(!isNaN(i)){var n;this._seatArr.length>0?(n=this._seatArr[0],this._seatArr.splice(0,1)):n=new t.SeatPlayer,n.name="seat"+e.uid,n.updateData(e),n.updateStatus(e.onlineState),n.seatId=i;var s=t.SeatPlayVc.seatPosArr[i];n.x=s.x,n.y=s.y,this._seatMc.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showUseInfo,this),e.bReady&&this.showReady(e.uid),t.GpsPanel.Instance&&t.GpsPanel.Instance.addUserGpsIcon(i)}},Object.defineProperty(i,"seatPosArr",{get:function(){return[new egret.Point(20,410),new egret.Point(uniLib.Global.screenWidth-117,230),new egret.Point(954*t.GameConst.scaleFactor,11),new egret.Point(20,250)]},enumerable:!0,configurable:!0}),i.prototype.showUseInfo=function(e){var i=e.currentTarget;this.dispatchEventWith(t.UIEventConsts.SHOW_USER_INFO,!1,i.data.uid)},i.prototype.getPlayByUserId=function(t){var e=this._seatMc.getChildByName("seat"+t);return e},i.prototype.addSeatPlayer=function(t){console.info("其他玩家进入游戏"),this.addOnePlay(t)},i.prototype.reset=function(){for(var t,e=this._seatMc.numChildren,i=0;e>i;i++)t=this._seatMc.getChildAt(i),t.reset()},i.prototype.updatePlayers=function(t){for(var e,i=0;i<t.length;i++)e=this.getPlayByUserId(t[i].uid),e.updataChips(t[i].points)},i.prototype.showGift=function(e){var i=this;this._giftArr=[];var n=t.RoomInfo.getInstance().getSeatNoByUserId(e.gift.fromUid),s=this.getPlayByUserId(e.gift.fromUid);if(s){var a=[];if(a=0==e.gift.toUid?t.RoomInfo.getInstance().getUidNotSendID(e.gift.fromUid):[e.gift.toUid],!(a.length<=0)){this._index=egret.setTimeout(function(){i.countTime()},null,2500);for(var o=0;o<a.length;o++)this.sendGift(e.gift.giftsId,a[o],n)}}},i.prototype.resultDiamond=function(e){for(var i,n=0;n<e.length;n++)i=this.getPlayByUserId(e[n].uid),6!=(t.DataCache.platParam.roomId+"").length&&t.RoomInfo.getInstance().getUserVoByUid(e[n].uid).setdiamond(e[n].diamond),i.updataChips(e[n].points)},i.prototype.updateDiamond=function(e){if(console.info("vo",e),e.diamond&&Array.isArray(e.diamond)){for(var i=e.diamond,n=e.diamond.length,s=0;n>s;s++)t.RoomInfo.getInstance().getUserVoByUid(i[s][0]).setdiamond(i[s][1]);for(var a=0;n>a;a++)if(6!=(t.DataCache.platParam.roomId+"").length){this.getPlayByUserId(i[a][0])}}},i.prototype.sendGift=function(e,i,n){var s,a,o;s=new t.GiftAnItem,s.giftId=e,o=t.RoomInfo.getInstance().getSeatNoByUserId(i),a=t.PositionData.seatPosArr[o],s.x=t.PositionData.seatPosArr[n].x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2+48,s.y=(t.PositionData.seatPosArr[n].y+46)*uniLib.ScreenUtils.scaleFactor,this._giftArr.push(s),t.GameInfo.topLayer.addChild(s),egret.Tween.get(s).to({x:a.x+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2+48,y:(a.y+46)*uniLib.ScreenUtils.scaleFactor},400,egret.Ease.circOut).call(this.giftMoveEnd,this,[s])},i.prototype.countTime=function(){egret.clearTimeout(this._index),this.removeGiftItems(),this._index=0},i.prototype.removeGiftItems=function(){if(this._giftArr){for(var t=0;t<this._giftArr.length;t++){var e=this._giftArr[t];e&&(uniLib.DisplayUtils.removeFromParent(e),egret.Tween.removeTweens(e),e.destory())}this._giftArr=[]}},i.prototype.giftMoveEnd=function(t){egret.Tween.removeTweens(t),t.play()},i.prototype.showReady=function(e){var i=t.RoomInfo.getInstance().getSeatNoByUserId(e);isNaN(i)||t.RoomInfo.getInstance().isStart||(this._readyIconArr[i].visible=!0)},i.prototype.resetReady=function(){for(var t=0;4>t;t++)this._readyIconArr[t].visible=!1},i.prototype.cancelReady=function(e){var i=t.RoomInfo.getInstance().getSeatNoByUserId(e);this._readyIconArr[i].visible=!1},i.prototype.updateStatus=function(t,e){var i=this.getPlayByUserId(t);i&&i.updateStatus(e)},i.prototype.floatPoint=function(t){var e=this.getPlayByUserId(t.uid);e&&e.floatClear(t.points)},i.prototype.diamondChange=function(e){if("diamondChange"==e.param&&6!==(t.DataCache.platParam.roomId+"").length){var i=void 0;i=this.getPlayByUserId(uniLib.UserInfo.uid),t.RoomInfo.getInstance().getUserVoByUid(uniLib.UserInfo.uid).setdiamond(uniLib.UserInfo.chips)}},i}(t.BaseVc);t.SeatPlayVc=e,__reflect(e.prototype,"game.SeatPlayVc")}(game||(game={}));var DLTDHMain=function(t){function e(e){var i=t.call(this,e)||this;return game.GameViewConfig.mainMediatorName=uniLib.getQualifiedClassName(game.DLTDHGameMJMediator),i._gameInfo&&(game.DataCache.gameInfo=i._gameInfo),e&&e.destroyResOnExit&&(game.DataCache.destroyResOnExit=e.destroyResOnExit),i._gameInfo&&i._gameInfo.extData&&(game.DataCache.platParam=i._gameInfo.extData),i._gameInfo&&i._gameInfo.extData&&i._gameInfo.extData.video?(game.RoomInfo.getInstance().video=i._gameInfo.extData.video,game.RoomInfo.getInstance().videoUid=i._gameInfo.extData.videoUid):(game.RoomInfo.getInstance().video=0,game.RoomInfo.getInstance().videoUid=0),i}return __extends(e,t),e.prototype.start=function(t){void 0===t&&(t=null);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter);var i={};i.designWidth=1280,i.designHeight=720,i.debug=!0,i.logLevel=0,i.scaleMode=egret.StageScaleMode.FIXED_HEIGHT,uniLib.init(i),RES.setMaxLoadingThread(6),MJLobby.ScreenFixedUtils.instance.init(egret.StageScaleMode.FIXED_HEIGHT),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/LDTDHmahjong.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(t){this.preLoadEnd()},e.prototype.onResourceLoadComplete=function(t){},e.prototype.preLoadEnd=function(){if(uniLib.UIMgr.instance.showProcessBar(null,2,100,"正在加载游戏资源..."),uniLib.Global.lobbyMode)uniLib.ResLoadMgr.instance.load("self_res_DLTDH",this.createGameScene,null,this,null);else{var t=[];t=["gameCommon","self_res_DLTDH"],RES.createGroup("TDHpreLoadAll",t),uniLib.ResLoadMgr.instance.load("TDHpreLoadAll",this.createGameScene,null,this,null)}},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.createGameScene=function(){game.DataCache.langObj=JSON.parse(RES.getRes("GameTxtND_cn_txt")),game.GameInfo.manage=game.PublicManage.getInstance();game.DataCache.langObj;game.DataCache.stageWidth=uniLib.Global.screenWidth,game.DataCache.stageHight=uniLib.Global.screenHeight,uniLib.UIMgr.instance.hideLoading(),uniLib.SceneMgr.instance.changeScene(game.MJGameScene)},e.prototype.resize=function(){this.scaleY=uniLib.Global.screenHeight/game.DataCache.defaultHeight,this.y=(uniLib.Global.screenHeight-game.DataCache.defaultHeight)/2},e}(uniLib.GameDoc);__reflect(DLTDHMain.prototype,"DLTDHMain");var GameViewType;!function(t){t[t.viewType_2d=0]="viewType_2d",t[t.viewType_2d5=1]="viewType_2d5"}(GameViewType||(GameViewType={}));var game;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"scaleFactor",{get:function(){return uniLib.Global.screenWidth/1280},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HeadStr",{get:function(){var t="";return 0!=e.cardTypeMode&&(t="Brown_"),t},enumerable:!0,configurable:!0}),e.resNormal=function(t){var i=e.getCardStr(t),n=e.HeadStr+"Card_1_"+i.charAt(0)+"_"+i.charAt(1);return n},e.resPutOut=function(t,i){var n=e.getCardStr(t),s=e.HeadStr+"PutOutCard"+i+"_"+n.charAt(0)+"_"+n.charAt(1);return s},e.setNormalSize=function(t){t&&(t.width=e.NormalCardWidth,t.height=e.NormalCardHeight)},e.setPutOutSize=function(t,i){t&&(i%2==0?(t.width=e.VPutOutCardWidth,t.height=e.VPutOutCardHeight):(t.width=e.HPutOutCardWidth,t.height=e.HPutOutCardWidth))},e.setWinSize=function(t){t&&(t.width=e.WinCardWidth,t.height=e.WinCardHeight)},e.resWin=function(t){var i=e.getCardStr(t),n=e.HeadStr+"WinCard0_"+i.charAt(0)+"_"+i.charAt(1);return n},e.resOpen=function(t){var i=e.getCardStr(t),n=e.HeadStr+"OpenCard0_"+i.charAt(0)+"_"+i.charAt(1);return n},e.getCardStr=function(t){var e,i=table.TableCard.thisIdToIcon(t);return e=0!=i?i.toString():t.toString()},e.Init=function(){"cardType1"==uniLib.Utils.getLocalStorage("cardTypeMode")?e.cardTypeMode=1:e.cardTypeMode=0},e.checkCreateProps=function(){for(var i=0,n=t.RoomInfo.getInstance().playTypeList;i<n.length;i++){var s=n[i];95==s&&(e.isGoldMode=!0)}},e}();e.viewType=GameViewType.viewType_2d5,e.revengeStr="pu",e.commonChatStr="",e.viewChange=!1,e.MaJiongChange=!1,e.cardStylePer="",e.cardStypePerStrList=["","LSH_"],e.cardTypeMode=0,e.NormalCardWidth=88,e.NormalCardHeight=133,e.VPutOutCardWidth=42,e.VPutOutCardHeight=61,e.HPutOutCardWidth=56,e.HPutOutCardHeight=50,e.WinCardWidth=46,e.WinCardHeight=70,e.isGoldMode=!1,t.GameConst=e,__reflect(e.prototype,"game.GameConst")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new GpsPanelSkin,t.initUI(),t}return __extends(i,e),Object.defineProperty(i,"Instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.initUI=function(){var e=t.RoomInfo.getInstance().playerNumber;this.gpsGroup.y=4==e?180:100,this.gpsTips.visible=2==e?!0:!1,this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this);var i="",n=t.RoomInfo.getInstance().getPlayTypeByList();if(n.length<=0)return void(this.ruleTxt.text="房主什么都没选择,你们随意");for(var s=0;s<n.length;s++)i=i+n[s]+"  ";this.ruleTxt.text=i},i.prototype.destory=function(){this.closeButton&&this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.closeHandle=function(e){this.dispatchEventWith(t.UIEventConsts.CLOSE)},i.prototype.addUserGpsIcon=function(t){var e=[[2,3],[1,3],[1,2]];if(0!=t)for(var i=e[t-1],n=0;n<i.length;n++)this.addUserBySeatId(t,i[n])},i.prototype.addUserBySeatId=function(e,i){var n=2!=t.RoomInfo.getInstance().playerNumber?!0:!1,s="";s=i>e?e+""+i:i+""+e;var a=-1,o=t.RoomInfo.getInstance().getUserIdBySeatNo(e),r=t.RoomInfo.getInstance().getUserIdBySeatNo(i);if(0!=o){var h=t.RoomInfo.getInstance().getUserVoByUid(o);if(h.headUrl){var d=this["headImage_"+e],l=this["headBg_"+e],c=this["playerName_"+e],u=this["address_"+e];l.visible=d.visible=n?!0:!1,d.source=h.headUrl,c.text=n?h.nickName:"",u.text=n&&h.address?h.address:""}}if(0!=r){var _=t.RoomInfo.getInstance().getUserVoByUid(r);_.address&&(this["address_"+i].text=_.address)}if(0!==o&&0!==r){var g=t.RoomInfo.getInstance().getUserVoByUid(r);if(h.lat&&h.lng&&g.lat&&g.lng&&(a=Math.floor(uniLib.Utils.getDistance(h.lat,h.lng,g.lat,g.lng))),a){var p="";p=a>1e3?Math.floor(a/1e3)+"km":a.toString()+"m"}var C=this["distance_"+s],m=this["line_"+s],v=this["lineBg_"+s];C.visible=m.visible=v.visible=n?!0:!1,C.text=p,0>=a&&(C.text="?")}},i.prototype.reset=function(){for(var t=0;4>t;t++)this.removePlayer(t)},i.prototype.removePlayer=function(t){if(!isNaN(t)){var e=[[2,3],[1,3],[1,2]];if(0!=t)for(var i=e[t-1],n=0;n<i.length;n++)this.removeLine(t,i[n])}},i.prototype.removeLine=function(t,e){var i="";i=e>t?t+""+e:e+""+t;var n=this["distance_"+i],s=this["line_"+i],a=this["lineBg_"+i],o=this["headImage_"+t],r=this["headBg_"+t],h=this["playerName_"+t],d=this["address_"+t];n.visible=!1,s.visible=!1,a.visible=!1,n.text="",o.visible=!1,r.visible=!1,h.text="",d.text=""},i}(eui.Component);t.GpsPanel=e,__reflect(e.prototype,"game.GpsPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new ChatSkin,t.width=uniLib.Global.screenWidth,t.initUI(),t}return __extends(i,e),i.prototype.initUI=function(){for(var e=1;31>=e;e++){var i=new eui.RadioButton;i.skinName=new FaceButtonSkin,i.iconDisplay.texture=RES.getRes("face"+e),i.groupName="face",i.value=e,this.faceGroup.addChild(i)}for(var n=t.GameData.getInstance().ShortTalkArr,e=0;e<n.length;e++){var s=new eui.RadioButton;s.skinName=new ChatRadioButtonSkin,s.groupName="chat",s.value=e,s.label=e+1+"."+n[e],s.y=56*e,this.chatGroup.addChild(s)}this.touchEnabled=!1,this.chatRadioButton.selected=!0,this.chatContent.visible=!0,this.faceContent.visible=!1,this.btnGroup=[],this.chatRadioButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRaduiButtonTap,this),this.faceRadioButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRaduiButtonTap,this),this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.faceGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceGroupTap,this),this.chatGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatGroupTap,this),this.textField.name="short_input",this.textField.size=28,this.textField.type=egret.TextFieldType.INPUT,this.textField.text="请输入聊天内容",this.touchEnabled=!0,this.textField.addEventListener(egret.FocusEvent.FOCUS_IN,this.onTextFieldFocusIn,this),this.textField.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onTextFieldFocusOut,this),this.sendBtn.name="short_send",this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendClickHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},i.prototype.onChatGroupTap=function(e){var i=e.target;if(i instanceof eui.RadioButton){var n="2"+i.value;this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_CHAT,!1,n)}},i.prototype.onFaceGroupTap=function(e){var i=e.target;if(i instanceof eui.RadioButton){var n="1"+i.value;this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_CHAT,!1,n)}},i.prototype.onRaduiButtonTap=function(t){t.target==this.chatRadioButton?(this.chatContent.visible=!0,this.faceContent.visible=!1):t.target==this.faceRadioButton&&(this.chatContent.visible=!1,this.faceContent.visible=!0)},i.prototype.onTouchTap=function(t){t.target==this.textField&&t.target.setFocus()},i.prototype.sendClickHandler=function(e){var i=this.textField.text;return-1!=i.indexOf("请输入聊天内容")?void(this.textField.text=""):(this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_TALK,!1,i),void(this.textField.text=""))},i.prototype.onTextFieldFocusIn=function(t){t.target.setFocus(),-1!=this.textField.text.indexOf("请输入聊天内容")&&(this.textField.text="")},i.prototype.onTextFieldFocusOut=function(t){""==this.textField.text&&(this.textField.text="请输入聊天内容")},i.prototype.btnClickHandler=function(t){var e=t.currentTarget.name;switch(e){case"short_chat":this.initBarStatus(),this.btnGroup[0].select=!0,this._yetOpen&&(this._yetOpen.visible=!1);break;case"short_record":this.initBarStatus(),this.btnGroup[1].select=!0,this.createRecordYetOpen()}},i.prototype.createRecordYetOpen=function(){this._yetOpen||(this._yetOpen=t.ResUtil.createTextFeild(1456961,egret.HorizontalAlign.CENTER,"此功能暂未开放",30),this.addChild(this._yetOpen),this._yetOpen.x=540,this._yetOpen.y=280),this._yetOpen.visible=!0},i.prototype.createBarBtn=function(e,i,n,s,a,o){var r=new t.ToggleButton(e,i,"",n);r.select=s,r.x=a,r.y=o,this.addChild(r),this.btnGroup.push(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this)},i.prototype.initBarStatus=function(){for(var t=0;t<this.btnGroup.length;t++){var e=this.btnGroup[t];e.select=!1}},i.prototype.destory=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this);for(var t=0;t<this.btnGroup.length;t++){var e=this.btnGroup[t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this)}this.chatRadioButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRaduiButtonTap,this),this.faceRadioButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRaduiButtonTap,this),this.bgRect.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.faceGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceGroupTap,this),this.chatGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatGroupTap,this),this.textField.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onTextFieldFocusIn,this),this.textField.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onTextFieldFocusOut,this),this.sendBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.sendClickHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.sendBtn=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.setRecordData=function(t){},i.prototype.onClose=function(e){this.visible=!1,t.PopupManager.removePopUp(this)},i}(eui.Component);t.RoomFacePanel=e,__reflect(e.prototype,"game.RoomFacePanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.animatable=!0,t._numRecord=0,t.skinName=new ScoreRecordPanel_Skin,t._profiles=[],t._totalScores=[],t._uids=[],t}return __extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._profiles.push(this._profile0),this._profiles.push(this._profile1),this._profiles.push(this._profile2),this._profiles.push(this._profile3),this._totalScores.push(this._totalScore0),this._totalScores.push(this._totalScore1),this._totalScores.push(this._totalScore2),this._totalScores.push(this._totalScore3)},Object.defineProperty(i.prototype,"displayed",{get:function(){return this._displayed=null!=this.parent,this._displayed},set:function(t){this._displayed=t},enumerable:!0,configurable:!0}),i.prototype.updateRecordData=function(e){var i=t.RoomInfo.getInstance().playerNumber;if(this._uids.length<i&&this.updatePlayerProfile(),e&&e.length>0){var n=e[0],s=0;n&&(s=n.score.length),s>0&&this._lblNoData&&(this._lblNoData.parent.removeChild(this._lblNoData),this._lblNoData=null);var a=this.parseTotalScores(e);this.updateTotalScore(a);for(var o=this._numRecord;s>o;o++){var r=this.parseOneRecord(e,o);this.addOneRecord(o+1,r)}this._numRecord=s}},i.prototype.setRightArrowPosition=function(t,e){null!=t&&(this._arrowR.x=t),null!=e&&(this._arrowR.y=e)},i.prototype.parseOneRecord=function(t,e){for(var i=[],n=0,s=t;n<s.length;n++){var a=s[n],o=this._uids.indexOf(a.uid);i[o]=a.score[e]}return i},i.prototype.parseTotalScores=function(t){for(var e=[],i=function(t){var i=n._uids.indexOf(t.uid),s=0;t.score.forEach(function(t){s+=t}),e[i]=s},n=this,s=0,a=t;s<a.length;s++){var o=a[s];i(o)}return e},i.prototype.updatePlayerProfile=function(){for(var e=t.RoomInfo.getInstance().userList,i=0,n=e.length;n>i;i++)this._uids[i]=e[i].uid,this._profiles[i].source=e[i].headUrl},i.prototype.updateTotalScore=function(t){for(var e=0,i=t.length;i>e;e++)this._totalScores[e].text=""+t[e]},i.prototype.addOneRecord=function(t,e){var i=54*(t-1);if(t%2===0){var n=new eui.Image;n.source="scoreRecord_json.record_bg_unit",n.width=this._detailScroller.width,n.y=i,this._detailScroller.addChild(n)}var s=this.createLabel("第"+t+"局",8,i+17.5);this._detailScroller.addChild(s);for(var a=112,o=0,r=e;o<r.length;o++){var h=r[o],d=this.createLabel(""+h,a,i+17.5);this._detailScroller.addChild(d),a+=90}},i.prototype.createLabel=function(t,e,i,n,s,a,o){void 0===n&&(n=18),void 0===s&&(s=9330238),void 0===a&&(a=80),void 0===o&&(o="center");var r=new eui.Label;return r.text=t,r.x=e,r.y=i,r.size=n,r.textColor=s,r.width=a,r.textAlign=o,r},i}(eui.Component);t.ScoreRecordPanel=e,__reflect(e.prototype,"game.ScoreRecordPanel")}(game||(game={}));var game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=new UserInfoPanelSkin,t.initUI(),t}return __extends(n,e),n.prototype.initUI=function(){this.bgRect.visible=!1,this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseHandle,this),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this);t.DataCache.langObj.uiTxt.PlayerInfoPanel;this._vipBmp=new egret.Bitmap,this._vipBmp.x=this.headGroup.x,this._vipBmp.y=this.headGroup.y;var e=new egret.Bitmap(RES.getRes("userinfo_fangka"));e.x=455,e.y=125,this._diamondTxt=t.ResUtil.createTextFeild(11622706,egret.HorizontalAlign.LEFT,"",24,535,130,136),this._scoreTxt=t.ResUtil.createTextFeild(11622706,egret.HorizontalAlign.LEFT,"",24,535,131,136),this._giftItemArr=[];var n,s=this.table();if(5006==t.RoomInfo.getInstance().gameId||5260==t.RoomInfo.getInstance().gameId){var a=s.filter(function(t){return"砖头"!=t.giftName&&"炸弹"!=t.giftName}),o=115*a.length;if(a&&a.length)for(var r=0;r<a.length;r++)if(6!==r){n=new i,n.data=a[r],this._giftItemArr[a[r].giftId]=n;var h=this.width/2-o/2;n.x=h+105*r,n.y=400,this.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickGift,this)}}else if(s&&s.length)for(var r=0;r<s.length;r++)6!==r&&(n=new i,n.data=s[r],this._giftItemArr[s[r].giftId]=n,n.x=316+107*r,6===r&&(n.x=169060),n.y=400,this.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickGift,this));this._headMc=new t.HeadMc(189,195),this.headGroup.addChild(this._headMc)},n.prototype.onCloseHandle=function(e){this.dispatchEventWith(t.UIEventConsts.CLOSE)},n.prototype.table=function(){var t;return t=loadTable("TableGiftND_json")},n.prototype.onClickGift=function(e){if(this._data.uid==uniLib.UserInfo.uid)return void t.GameInfo.manage.showMildWarnShow("不能给自己送礼物");var i=e.currentTarget,n=1;if(null!=this._data){if(this._data.uid==uniLib.UserInfo.uid&&(n=t.RoomInfo.getInstance().userList.length-1),0>=n)return t.GameInfo.manage.showMildWarnShow(t.DataCache.langObj.msgTxt.noOtherPlayer),void this.dispatchEventWith(t.UIEventConsts.CLOSE);if(this._data.uid==uniLib.UserInfo.uid){var s=new Cmd.GiftsInfo;s.giftsId=i.data.giftId,s.toUid=0,s.fromUid=this._data.uid,s.giftsNum=1,this.dispatchEventWith(t.UIEventConsts.GIFT_SEND,!1,s)}else{var s=new Cmd.GiftsInfo;s.giftsId=i.data.giftId,s.toUid=this._data.uid,s.fromUid=uniLib.UserInfo.uid,s.giftsNum=1,this.dispatchEventWith(t.UIEventConsts.GIFT_SEND,!1,s)}}},n.prototype.onYesHandler=function(){if(t.MyUserInfo.getInstance().remainder<this._givingChips)t.GameInfo.manage.showMildWarnShow(t.DataCache.langObj.alertTxt.giftFail);else{var e=new Cmd.GiftsInfo;e.giftsId=this._giftId,e.toUid=this._data.uid,e.fromUid=uniLib.UserInfo.uid,e.giftsNum=1,this.dispatchEventWith(t.UIEventConsts.GIFT_SEND,!1,e)}},n.prototype.reset=function(){this._data=null,this._idTxt.text="",this._nickTxt.text="",this._ipTxt.text="",this._distance.text="",this.playerAddress.text="",this._diamondTxt.text="",this._scoreTxt.text="",this._headMc.visible=!1},n.prototype.setData=function(e){this._data=e,this.closeButton.hasEventListener||this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseHandle,this);var i="game_user_woman";"男"==e.gender&&(i="game_user_man"),this._genderIcon.source=i,e.vip&&(this._vipBmp.texture=RES.getRes("nd_vip_"+e.vip),this.addChild(this._vipBmp)),this._idTxt.text="ID:"+e.uid.toString(),this._nickTxt.text="昵称:"+e.nickname,void 0!=e.ip&&(this._ipTxt.text="IP:"+e.ip),void 0!=e.diamond&&(this._diamondTxt.text=Math.floor(e.diamond)+"");
var n=t.RoomInfo.getInstance().getUserVoByUid(uniLib.NetMgr.UID),s=t.RoomInfo.getInstance().getUserVoByUid(e.uid);if(e.uid==uniLib.NetMgr.UID)this._distance.text="";else if(n.lat&&n.lng&&s.lat&&s.lng){var a=Math.floor(uniLib.Utils.getDistance(n.lat,n.lng,s.lat,s.lng));if(a){var o="";o=a>1e3?"与此玩家相距："+Math.floor(a/1e3)+"km":"与此玩家相距："+a.toString()+"m",this._distance.text=o}}else this._distance.text="未获取位置信息";if(s.address){var r="";r="位置："+s.address,this.playerAddress.text=r}this._scoreTxt.text=e.points.toString(),this._headMc.headUrl=e.headurl,this._headMc.visible=!0;for(var h=0;6>h;h++)this._giftItemArr[h+1]&&this._giftItemArr[h+1].setFlowerNum(0);if(e.flower instanceof Array)for(var h=0;h<e.flower.length;h++)this._giftItemArr[e.flower[h].id].setFlowerNum(e.flower[h].num)},n.prototype.diamondChange=function(t){"diamondChange"==t.param&&Number(this._idTxt.text)===uniLib.UserInfo.uid&&(this._diamondTxt.text=Math.floor(uniLib.UserInfo.chips)+"")},n.prototype.destory=function(){this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseHandle,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this),this._headMc&&(this._headMc.destory(),this._headMc=null);var t=table.TableGift.instance();if(t)for(var e=0;e<t.length;e++){var n=new i;n.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickGift,this),n.destory()}uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._data=null,this._diamondTxt=null,this._genderIcon=null},n}(eui.Component);t.UserInfoPanel=e,__reflect(e.prototype,"game.UserInfoPanel");var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._testBg=new egret.Bitmap(RES.getRes("testBg")),this._testBg.y=110,this._testBg.x=35,this._nameTxt=t.ResUtil.createTextFeild(419190,egret.HorizontalAlign.CENTER,"",20,5,110,100)},Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(e){this._nameTxt.text="0",this._giftIcon||(this._giftIcon=t.ResUtil.createBitmapByName("userInfo_free_gift"+e.giftId,0,0),this.addChildAt(this._giftIcon,0)),this._data=e,this.name=e.giftId.toString()},enumerable:!0,configurable:!0}),i.prototype.setFlowerNum=function(t){this._nameTxt.text=t.toString(),this._nameTxt.x=this._testBg.x+(this._testBg.width-this._nameTxt.width)/2},i.prototype.destory=function(){uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._data=null,this._nameTxt=null},i}(t.BaseVc);t.GiftItem=i,__reflect(i.prototype,"game.GiftItem")}(game||(game={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);