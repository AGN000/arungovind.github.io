var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._goldName="treasureIcon",t._scale=1,t._listenName="listenIcon",t._listenNum=-1,t._boo=!0,t.isMove=!1,t}return __extends(i,e),i.prototype.GetCardWidth=function(){return i.CardWidth},i.prototype.GetCardHeight=function(){return i.CardHeight},Object.defineProperty(i.prototype,"scale",{set:function(t){this._scale=t},enumerable:!0,configurable:!0}),i.prototype.initUI=function(){},i.prototype.showCard=function(){var e=this._cardName;this._card?this._card.texture=t.ResUtil.createTexture(e):this._card=t.ResUtil.createBitmapByName(e),this.addChildAt(this._card,0),this._card.scaleX=this._card.scaleY=this._scale,this.data&&(this.isGold=t.GameData.getInstance().isGoldenCard(this._data)),-1!=this._listenNum&&this.setListenData(this._listenNum)},i.prototype.setNameTxt=function(){this._nameTxt&&(uniLib.DisplayUtils.removeFromParent(this._nameTxt),this._nameTxt=null),t.RoomInfo.getInstance().GM_Mode&&(this._nameTxt=uniLib.DisplayUtils.createTextLabel(0,egret.HorizontalAlign.LEFT,""+this._data,12,50,15),this.addChild(this._nameTxt))},Object.defineProperty(i.prototype,"isGold",{set:function(e){e&&t.GameVc.isResult?this.showGoldIcon():this._goldIcon&&(this._goldIcon.visible=!1)},enumerable:!0,configurable:!0}),i.prototype.showGoldIcon=function(){this._goldIcon?(this._goldIcon.scaleX=this._goldIcon.scaleY=this._scale,this._goldIcon.visible=!0):(this._goldIcon=t.ResUtil.createBitmapByName(this._goldName),this._goldIcon.scaleX=this._goldIcon.scaleY=this._scale),"GoldIcon2"==this._goldName&&(this._goldIcon.y=-2),this._goldIcon.width=this._card.width,this._goldIcon.height=this._card.height,this.addChild(this._goldIcon)},i.prototype.showListenIcon=function(){this._listenIcon?this._listenIcon.visible=!0:(this._listenIcon=uniLib.DisplayUtils.createBitmapByName(this._listenName),this._listenIcon.x=(this._card.width-this._listenIcon.width)/2*t.GameConst.scaleFactor,this._listenIcon.y=-5,this.addChild(this._listenIcon),this.flash())},i.prototype.hideListenIcon=function(t){void 0===t&&(t=!1),t?this.stopTimer():this._listenIcon&&(this._listenIcon.visible=!1)},i.prototype.flash=function(){this._listenIcon&&egret.Tween.get(this._listenIcon,{loop:!0}).to({y:this._listenIcon.y-10},800).to({y:this._listenIcon.y},800)},i.prototype.stopTimer=function(){this._listenIcon&&(egret.Tween.removeTweens(this._listenIcon),uniLib.DisplayUtils.removeFromParent(this._listenIcon)),this._listenIcon=null},i.prototype.setListenData=function(t,e){void 0===e&&(e=!1),this._listenNumIcon||(1e3==t?this._listenNumIcon=uniLib.DisplayUtils.createBitmapByName("listenNum_All"):this._listenNumIcon=uniLib.DisplayUtils.createBitmapByName("listenNum_"+t)),e&&this._listenNumIcon&&(this._listenNumIcon=uniLib.DisplayUtils.createBitmapByName("listenNum_"+t)),this._listenNumIcon.y=50,1e3==t?this._listenNumIcon.x=-8:this._listenNumIcon.x=5,this.addChild(this._listenNumIcon)},Object.defineProperty(i.prototype,"card",{get:function(){return this._card},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"listenNum",{get:function(){return this._listenNum},set:function(t){this._listenNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cardName",{get:function(){return this._cardName},set:function(t){this._cardName=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"goldName",{set:function(t){this._goldName=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"select",{set:function(t){t&&!this.isMove&&0==this.card.y?(this.isMove=!0,egret.Tween.get(this.card).to({y:this.card.y-Math.floor(1*i.CardHeight/5)},50).call(this.finish,this,[this.card]),this._goldIcon&&egret.Tween.get(this._goldIcon).to({y:this._goldIcon.y-Math.floor(1*i.CardHeight/5)},50).call(this.finishGold,this,[this._goldIcon])):(egret.Tween.get(this.card).to({y:0},50).call(this.finish,this,[this.card]),this._goldIcon&&egret.Tween.get(this._goldIcon).to({y:0},50).call(this.finishGold,this,[this._goldIcon]))},enumerable:!0,configurable:!0}),i.prototype.setInitY=function(){this.card&&(egret.Tween.removeTweens(this.card),this.card.y=0),this._goldIcon&&(egret.Tween.removeTweens(this._goldIcon),this._goldIcon.y=0)},i.prototype.finish=function(t){egret.Tween.removeTweens(t),this.isMove=!1},i.prototype.finishGold=function(t){egret.Tween.removeTweens(t)},i.prototype.destory=function(){this._listenIcon&&egret.Tween.removeTweens(this._listenIcon),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._data=null,this._card=null,this._goldIcon=null,this._listenIcon=null,this._listenNumIcon=null},i}(t.BaseVc);e.CardWidth=78,e.CardHeight=135,t.CardMJ=e,__reflect(e.prototype,"game.CardMJ")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._curIndex=0,t._drawIndex=13,t.sendCardMcPointArr=[new egret.Point(200,500),new egret.Point(1e3,500),new egret.Point(1e3,100),new egret.Point(200,100)],t.seatCardPointArr=[[t.sendCardMcPointArr[0],t.sendCardMcPointArr[2]],[t.sendCardMcPointArr[0],t.sendCardMcPointArr[1],t.sendCardMcPointArr[3]],[t.sendCardMcPointArr[0],t.sendCardMcPointArr[1],t.sendCardMcPointArr[2],t.sendCardMcPointArr[3]]],t.cacheAsBitmap=!0,t}return __extends(i,e),i.prototype.initUI=function(){this.curIndex=0,this._cardsBitArr=[],this._handCardsArr=[],this.outPutCards=new t.OutPutCards,this.addChild(this.outPutCards),this._handsCard=new egret.DisplayObjectContainer,this.addChild(this._handsCard),this._displayCardsMc=new egret.DisplayObjectContainer,this._displayCardsMc.touchEnabled=!1,this._displayCardsMc.touchChildren=!1,this.addChild(this._displayCardsMc),this._otherHandMc=new egret.DisplayObjectContainer,this.addChild(this._otherHandMc),this._tempPanel=new egret.Sprite,this.addChild(this._tempPanel)},Object.defineProperty(i.prototype,"defaultPoint",{get:function(){return this._defaultPoint},set:function(t){this._defaultPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayCardsMc",{get:function(){return this._displayCardsMc},enumerable:!0,configurable:!0}),i.prototype.initOutPutCards=function(){},Object.defineProperty(i.prototype,"curIndex",{get:function(){return this._curIndex},set:function(t){this._curIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"handsCard",{get:function(){return this._handsCard},enumerable:!0,configurable:!0}),i.prototype.getSendPos=function(t){var e=new egret.Point;return e.x=this.initPoint.x+t*Math.round(this.stepX),e.y=this.initPoint.y+t*Math.round(this.stepY),e},Object.defineProperty(i.prototype,"stepX",{get:function(){return this._stepX},set:function(t){this._stepX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stepY",{get:function(){return this._stepY},set:function(t){this._stepY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"userSeat",{get:function(){return this._userSeat},set:function(t){this._userSeat=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"handCardsArr",{get:function(){return this._handCardsArr},set:function(t){this._handCardsArr=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayPos",{get:function(){return this._displayPos},set:function(t){this._displayPos=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"drawIndex",{get:function(){return this._drawIndex},enumerable:!0,configurable:!0}),i.prototype.showUserHandCard=function(e,i,n){if(void 0===n&&(n=!1),0!=e&&(t.RoomInfo.getInstance().GM_Mode||n)&&i&&!(i.length<=0)){uniLib.DisplayUtils.removeAllChildren(this._handsCard);for(var s,a=this._handsCard.numChildren+this._curIndex,o=0;o<i.length;o++)s=new t.OutPutCard,s.setCard(e,i[o],1,!1),s.name="card"+(a+o),s.x=Math.round(this.initPoint.x+(a+o)*this.stepX),s.y=Math.round(this.initPoint.y+(a+o)*this.stepY),a+o==13&&(s.x+=this.takeCardStepX,s.y+=this.takeCardStepY),this.stepY<0?this._handsCard.addChildAt(s,0):this._handsCard.addChild(s);t.CardInfo.getInstance().getHandCardBySeat(e);this.sendCards(t.CardInfo.getInstance().userHandCount[e]-i.length)}},i.prototype.sendCards=function(e){if(0!=this.userSeat){if(!this._handsCard)return;if(this._handsCard.numChildren>14)return;for(var i,n=this._handsCard.numChildren+this._curIndex,s=0;e>s;s++)this._cardsBitArr[n+s]?i=this._cardsBitArr[n+s]:(i=t.ResUtil.createBitmapByName("BackCard"+this.userSeat),this._cardsBitArr[n+s]=i),i.name="card"+(n+s),i.x=Math.round(this.initPoint.x+(n+s)*this.stepX),i.y=Math.round(this.initPoint.y+(n+s)*this.stepY),n+s==13&&(i.x+=this.takeCardStepX,i.y+=this.takeCardStepY),this.stepY<0?this._handsCard.addChildAt(i,0):this._handsCard.addChild(i)}},i.prototype.groupingSendCards=function(){for(var e=0;e<this._handsCard.numChildren;e++)this._handsCard.getChildAt(e).visible=!1;for(var i=this,n=function(e){uniLib.SetUniEventTimeout(s,function(){for(var e=t.RoomInfo.getInstance().playerNumber,n=i.seatCardPointArr[e-2],s=100,a=function(e){s+=60;var a=t.ResUtil.createBitmapByName("cardheap1");i.addChild(a),a.x=uniLib.Global.screenWidth/2-a.width/2,a.y=uniLib.Global.screenHeight/2-a.height/2-35,egret.Tween.get(a).wait(s).to({x:n[e].x,y:n[e].y},200).call(function(){a&&a.parent&&a.parent.removeChild(a)})},o=0;o<n.length;o++)a(o)},500*e,1,s,null),uniLib.SetUniEventTimeout(s,function(){for(var t=4*e;4*(e+1)-1>=t;t++)t<=i._handsCard.numChildren-1&&(i._handsCard.getChildAt(t).visible=!0);uniLib.SoundMgr.instance.playSound("DealSound_mp3")},500*(e+1),1,s,null)},s=this,e=0;4>e;e++)n(e)},i.prototype.sortCard=function(){},i.prototype.fillFlower=function(e,i){if(t.RoomInfo.getInstance().GM_Mode){var n=t.CardInfo.getInstance().getHandCardBySeat(e);this.showUserHandCard(e,n)}this.outPutCards.fillFlower(i)},i.prototype.setEnable=function(t){},i.prototype.addCard=function(t){if(this._handCardsArr||(this._handCardsArr=[]),this._handCardsArr.length<14){var e;e=t&&t.thisId?t.thisId:0,this._handCardsArr.push(e)}},i.prototype.doDraw=function(e){if(void 0===e&&(e=null),0==this.userSeat||t.RoomInfo.getInstance().GM_Mode){if(0!=this.userSeat&&t.RoomInfo.getInstance().GM_Mode){var i=e;this.showDrawCard(i)}}else this.addDrawCard()},i.prototype.addDrawCard=function(){var e;this._cardsBitArr[this._drawIndex]?e=this._cardsBitArr[this._drawIndex]:(e=t.ResUtil.createBitmapByName("BackCard"+this.userSeat),this._cardsBitArr[this._drawIndex]=e),e.name="card"+this._drawIndex,e.x=this.initPoint.x+this._drawIndex*this.stepX+this.takeCardStepX,e.y=this.initPoint.y+this._drawIndex*this.stepY+this.takeCardStepY,this.stepY<0?this.handsCard.addChildAt(e,0):this.handsCard.addChild(e)},i.prototype.showDrawCard=function(e){var i,n=table.TableCard.resPutOut(e,this.userSeat);i=t.ResUtil.createBitmapByName(n),this._cardsBitArr[this._drawIndex]=i,i.name="card"+this._drawIndex,i.x=this.initPoint.x+this._drawIndex*this.stepX+this.takeCardStepX,i.y=this.initPoint.y+this._drawIndex*this.stepY+this.takeCardStepY,this.stepY<0?this.handsCard.addChildAt(i,0):this.handsCard.addChild(i)},i.prototype.doDiscard=function(e,i){var n;if(this._cardsBitArr[this._drawIndex]&&this._cardsBitArr[this._drawIndex].parent&&0!=this.userSeat&&(n=new egret.Point(this._cardsBitArr[this._drawIndex].x,this._cardsBitArr[this._drawIndex].y),this._cardsBitArr[this._drawIndex].parent.removeChild(this._cardsBitArr[this._drawIndex])),this.sortCard(),this.outPutCards.showOutPutCard(e),0!=this.userSeat){var s=table.TableCard.resNormal(e);if(this._tempCard=t.ResUtil.createBitmapByName(s),this._tempCard&&egret.Tween.removeTweens(this._tempCard),!t.RoomInfo.getInstance().OutCard||!t.RoomInfo.getInstance().OutCard.opType||0==t.RoomInfo.getInstance().OutCard.opType.length)return this.outPutCards.getCurOutPutPos();this._tempCard.x=t.GameData.getInstance().TempeLocation[i][0],this._tempCard.y=t.GameData.getInstance().TempeLocation[i][1],this._tempPanel.addChild(this._tempCard)}else{var a=this.outPutCards.getNextOutPutPos();if(!a||null==n)return;this._discardEffect||(this._discardEffect=new t.DiscardBlurMc(this.userSeat),this._discardEffect.x=n.x,this._discardEffect.y=n.y,this._discardEffect.setCard(e),t.GameInfo.topLayer.addChild(this._discardEffect))}return this.outPutCards.getCurOutPutPos()},i.prototype.movieEnd=function(t){this._discardEffect&&this._discardEffect.parent&&this._discardEffect.parent.removeChild(this._discardEffect),this._discardEffect=null,this._tempCard&&egret.Tween.removeTweens(this._tempCard),uniLib.DisplayUtils.removeAllChildren(this._tempPanel)},i.prototype.refreshTempCard=function(){uniLib.DisplayUtils.removeAllChildren(this._tempPanel)},i.prototype.removeCard=function(t,e){if(void 0===e&&(e=!0),!this._cardsBitArr||0==this._cardsBitArr.length)return null;var i;if(!e){var n=this._cardsBitArr[this._drawIndex];if(n&&n.parent)return i=new egret.Point(n.x,n.y),uniLib.DisplayUtils.removeFromParent(n),i}for(var s=0;s<t.length;s++){var n=this._cardsBitArr[this._curIndex];n&&(n.parent&&(i=new egret.Point,i.x=n.x,i.y=n.y,uniLib.DisplayUtils.removeFromParent(n),i=new egret.Point),e&&this._curIndex++)}return this.refreshCard(),i},i.prototype.refreshCard=function(){var e;if(this._cardsBitArr&&!(this._cardsBitArr.length<=0))for(var i=0;i<this._cardsBitArr.length;i++)e=this._cardsBitArr[i],i>=this._curIndex?(e||(this._cardsBitArr[i]=e=t.ResUtil.createBitmapByName("BackCard"+this.userSeat),this._handsCard.addChild(this._cardsBitArr[i])),e.x=Math.round(this.initPoint.x+i*Math.round(this.stepX)),e.y=Math.round(this.initPoint.y+i*Math.round(this.stepY)),i==this._drawIndex&&(e.x+=Math.round(this.takeCardStepX),e.y+=Math.round(this.takeCardStepY))):e&&e.parent&&e.parent.removeChild(e)},i.prototype.showKong=function(e,i){void 0===i&&(i=!1);var n=t.GroupCardsFactory.getInstance().getGangCard(e);this.addGroupCards(n,i)},i.prototype.showPong=function(e,i){void 0===i&&(i=!1);var n=t.GroupCardsFactory.getInstance().getPongCard(e);this.addGroupCards(n,i)},i.prototype.showChow=function(e,i){void 0===i&&(i=!1);var n=t.GroupCardsFactory.getInstance().getChowCard(e);this.addGroupCards(n,i)},i.prototype.addGroupCards=function(t,e){void 0===e&&(e=!1);var i=new egret.Point;this._displayCardsMc.numChildren>0&&(0==this.userSeat?t.x=this._displayCardsMc.width+6:1==this.userSeat?t.y=-this._displayCardsMc.height-2:2==this.userSeat?t.x=-(this._displayCardsMc.width+5):3==this.userSeat&&(t.y=this._displayCardsMc.height+2)),e?(0==this.userSeat?(i.x=Math.round(t.x+t.width/2),i.y=Math.round(t.height/2)):1==this.userSeat?(i.y=Math.round(t.y),i.x=Math.round(t.width/2)):2==this.userSeat?(i.y=Math.round(t.height/2),i.x=Math.round(t.x+t.width/2)):3==this.userSeat&&(i.y=Math.round(t.y+t.height/2),i.x=Math.round(t.width/2)),this.showGroupCard(t)):(1==this.userSeat?this._displayCardsMc.addChildAt(t,0):this._displayCardsMc.addChild(t),this.resetHandleCardPos())},i.prototype.showGroupCard=function(t){1==this.userSeat?this._displayCardsMc.addChildAt(t,0):this._displayCardsMc.addChild(t),this.resetHandleCardPos()},i.prototype.resetHandleCardPos=function(){this.initPoint.x=this._defaultPoint.x,this.initPoint.y=this._defaultPoint.y,this._displayCardsMc.numChildren>0&&(1==this.userSeat?this.initPoint.y=this._displayPos.y-(this._displayCardsMc.height+10)-3*this._stepY*this._displayCardsMc.numChildren:3==this.userSeat?this.initPoint.y=this._displayPos.y+this._displayCardsMc.height+5-3*this._stepY*this._displayCardsMc.numChildren:2==this.userSeat&&(this.initPoint.x=this._displayPos.x-(this._displayCardsMc.width+10)-3*this._stepX*this._displayCardsMc.numChildren));var t,e;t=this.handsCard.numChildren;for(var i,n=0;t>n;n++)e=this.handsCard.getChildAt(n),e&&(i=Number(e.name.slice(4)),e.x=Math.round(this.initPoint.x+i*Math.round(this.stepX)),e.y=Math.round(this.initPoint.y+i*Math.round(this.stepY)),i==this._drawIndex&&(e.x+=Math.round(this.takeCardStepX),e.y+=Math.round(this.takeCardStepY)))},i.prototype.checkIndex=function(){this.curIndex=3*this.displayCardsMc.numChildren,t.RoomInfo.getInstance().outerId==this.uid&&this.curIndex++,0!=this.userSeat&&this.refreshCard()},i.prototype.refreshOperate=function(e){this._curIndex=0,this.removeHandleCards(),this.removeGroupCards();var i=t.CardInfo.getInstance().getOpCardBySeat(e);if(null!=i)for(var n=0;n<i.length;n++){var s=i[n];s.type==Cmd.MahjongOpCardType.MahjongOpCardType_Touch?this.showPong(s,!1):s.type==Cmd.MahjongOpCardType.MahjongOpCardType_Eat?this.showChow(s,!1):this.showKong(s,!1)}if(this._curIndex=3*i.length,t.RoomInfo.getInstance().GM_Mode){var a=t.CardInfo.getInstance().getHandCardBySeat(e);a.sort(function(t,e){return t>e?1:t==e?0:-1}),this.showUserHandCard(e,a)}else this.sendCards(t.CardInfo.getInstance().userHandCount[e])},i.prototype.refreshOutCards=function(){this.outPutCards.resetCard();var e=t.CardInfo.getInstance().getOutCardBySeat(this._userSeat);this.outPutCards.showOutPutCardArr(e)},i.prototype.removeOutPutCard=function(t){this.outPutCards.removeOutPutCard(t)},i.prototype.resetCard=function(){this.resetPoint(),this.removeResult(),this.outPutCards.resetCard(),this.removeHandleCards(),this.removeGroupCards(),this._curIndex=0,this.resetHandleCardPos()},i.prototype.removeGroupCards=function(){for(var t,e=this._displayCardsMc.numChildren,i=0;e>i;i++)t=this._displayCardsMc.removeChildAt(0),t.destory(),t=null;uniLib.DisplayUtils.removeAllChildren(this._displayCardsMc)},i.prototype.removeResult=function(){uniLib.DisplayUtils.removeAllChildren(this._otherHandMc)},i.prototype.removeHandleCards=function(){uniLib.DisplayUtils.removeAllChildren(this.handsCard)},i.prototype.setReloginData=function(){this.resetCard(),this._handCardsArr=t.CardInfo.getInstance().getHandCardBySeat(this._userSeat);var e=t.CardInfo.getInstance().getOutCardBySeat(this._userSeat);this.outPutCards.showOutPutCardArr(e),this.refreshOperate(this._userSeat)},i.prototype.doGm=function(t){},i.prototype.initSelect=function(){},i.prototype.reloginFlower=function(t){this.outPutCards.fillFlower(t)},i.prototype.refreshHandCards=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null)},i.prototype.selectGoldOut=function(){},i.prototype.showListenIcon=function(t){void 0===t&&(t=0)},i.prototype.getHandsCardByThisIDToBaseId=function(t){return[]},i.prototype.getSelectCardThisId=function(){return 0},i.prototype.hideListenIcon=function(){},i.prototype.addHostMask=function(){},i.prototype.removeHostMask=function(){},i.prototype.resetPoint=function(){},i.prototype.destory=function(){this.outPutCards&&this.outPutCards.destory(),this.outPutCards=null,this._handsCard&&(uniLib.DisplayUtils.removeAllChildren(this.handsCard),uniLib.DisplayUtils.removeFromParent(this._handsCard)),this._handsCard=null,this._otherHandMc&&(uniLib.DisplayUtils.removeAllChildren(this._otherHandMc),uniLib.DisplayUtils.removeFromParent(this._otherHandMc),this._otherHandMc=null),this._displayCardsMc&&(uniLib.DisplayUtils.removeAllChildren(this._displayCardsMc),uniLib.DisplayUtils.removeFromParent(this._displayCardsMc)),this._displayCardsMc=null,this._tempPanel&&(uniLib.DisplayUtils.removeAllChildren(this._tempPanel),uniLib.DisplayUtils.removeFromParent(this._tempPanel)),this._discardEffect&&(this._discardEffect.destory(),this._discardEffect=null),this._tempPanel=null,this._tempCard=null,this._handCardsArr=null,this._defaultPoint=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.UserSideCard=e,__reflect(e.prototype,"game.UserSideCard")}(game||(game={}));var game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return egret.MainContext.instance.stage.addEventListener(egret.Event.RESIZE,e.resize,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e.resize(),e}return __extends(e,t),e.prototype.resize=function(){this.width=uniLib.Global.screenWidth},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),egret.MainContext.instance.stage.removeEventListener(egret.Event.RESIZE,this.resize,this)},e}(eui.Component);t.BaseComponent=e,__reflect(e.prototype,"game.BaseComponent")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._scroll=new egret.ScrollView,this.addChild(this._scroll),this._scroll.verticalScrollPolicy="on",this._scroll.horizontalScrollPolicy="off",this._scroll.width=360,this._scroll.height=475,this.faceGroup=[],this.faceBgGroup=[],this._facePanel=new egret.Sprite,this.addChild(this._facePanel);for(var t=1;18>=t;t++)this.creatFaceItem(t);this._scroll.setContent(this._facePanel)},i.prototype.creatFaceItem=function(e){var i=t.ResUtil.createBitmapByName("faceBg");this._facePanel.addChild(i),i.touchEnabled=!0;var n=t.ResUtil.createBitmapByName("face_select");n.name="short_facebg",n.visible=!1,this._facePanel.addChild(n);var s=t.ResUtil.createBitmapByName("face"+e);s.name="short_"+e,s.touchEnabled=!0,s.x=15+116*Math.floor((e-1)%3),s.y=107*Math.floor((e-1)/3),n.x=s.x,n.y=s.y,i.x=n.x,i.y=n.y,this._facePanel.addChild(s),this.faceGroup.push(s),this.faceBgGroup.push(n),s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onFaceBegin,this),s.addEventListener(egret.TouchEvent.TOUCH_END,this.onFaceEnd,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceClick,this),s.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onFaceEnd,this)},i.prototype.onFaceClick=function(e){var i=e.target.name,n="1"+i.slice(6,i.length);this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_CHAT,!1,n);var s=Number(i.slice(6,i.length));this.faceBgGroup[s-1].visible=!1},i.prototype.onFaceBegin=function(t){var e=t.target.name,i=Number(e.slice(6,e.length));this.faceBgGroup[i-1].visible=!0},i.prototype.onFaceEnd=function(t){var e=t.target.name,i=Number(e.slice(6,e.length));this.faceBgGroup[i-1].visible=!1},i.prototype.destory=function(){for(var t=0;t<this.faceGroup.length;t++){var e=this.faceGroup[t];e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onFaceBegin,this),e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceClick,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onFaceEnd,this)}uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this.faceGroup=[],this.faceBgGroup=[]},i}(t.BaseVc);t.FaceItem=e,__reflect(e.prototype,"game.FaceItem")}(game||(game={}));var game;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"Instance",{get:function(){return this.m_insatance||(this.m_insatance=new e),this.m_insatance},enumerable:!0,configurable:!0}),e.prototype.showConfirmPanel=function(e,i,n,s,a,o,r){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=0),void 0===r&&(r=!0);var h=new t.messageBox(r);s||(s=""),h.setData(s,e,i,n,a,o),t.GameInfo.isAllSceneApa()?(h.x=Math.round((uniLib.Global.designWidth-h.width)/2),h.y=Math.round((uniLib.Global.designHeight*uniLib.ScreenUtils.scaleFactor-h.height)/2)):(h.x=Math.round((uniLib.Global.screenWidth-h.width)/2),h.y=Math.round((uniLib.Global.screenHeight*uniLib.ScreenUtils.scaleFactor-h.height)/2)),t.PopupManager.addPopUp(h,!0)},e}();t.PublicMethod=e,__reflect(e.prototype,"game.PublicMethod");var i=function(e){function i(t){var i=e.call(this)||this;return i.skinName=new boxPanel_2d5_new_Skin,i._needClose=t,i.closeButton.visible=t?!0:!1,i}return __extends(i,e),i.prototype.onClose=function(e){t.PopupManager.removePopUp(this),this.destory()},i.prototype.setData=function(t,e,i,n,s,a){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),void 0===a&&(a=0),this._backFn=n,this._backObj=s,this.title.text=t,this.info.text=e,1==i.length?(this.yesBtn.visible=!0,this.noBtn.visible=!1,this.yesBtn.horizontalCenter=0):2==i.length&&(this.yesBtn.visible=this.noBtn.visible=!0,this.yesBtn.horizontalCenter=118.5),this._backFn&&this._backFn[0]&&this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._backFn[0],this._backObj),this._backFn&&this._backFn[1]&&this.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this._backFn[1],this._backObj),this.yesBtn&&this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.noBtn&&this.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.closeButton.visible&&this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},i.prototype.destory=function(){this.yesBtn&&(this._backFn&&this._backFn[0]&&this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._backFn[0],this._backObj),this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),uniLib.DisplayUtils.removeAllChildren(this.yesBtn),uniLib.DisplayUtils.removeFromParent(this.yesBtn),this.yesBtn=null),this.noBtn&&(this.noBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this._backFn&&this._backFn[1]&&this.noBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._backFn[1],this._backObj),uniLib.DisplayUtils.removeAllChildren(this.noBtn),uniLib.DisplayUtils.removeFromParent(this.noBtn),this.noBtn=null),this.closeButton.visible&&this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.title=null,this.info=null,this._backFn=null,this._backObj=null,t.ResUtil.removeFromParent(this),t.ResUtil.removeAllChildren(this)},i}(eui.Component);t.messageBox=i,__reflect(i.prototype,"game.messageBox")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.Load=function(t,e,n,s){i.HeadLoad.load(t,e,null,s)},i.prototype.start=function(){this.initGameSpecialData(),e.prototype.start.call(this),t.DataCache.gameInfo&&t.DataCache.gameInfo.defaultOrientation!=egret.OrientationMode.LANDSCAPE&&(uniLib.ScreenUtils.landscape=!0),t.GameInfo.uiLayer=this.uiLayer,t.GameInfo.mainUILayer=this.topLayer,t.GameInfo.topLayer=this.mainUILayer,t.GameInfo.main=this.tipsLayer,this.initPositionData(),t.GameViewConfig.mainMediatorName=uniLib.getQualifiedClassName(t.HNHZGameMJMediator),t.MahJongFourFacede.getInstance().startUp(this)},i.prototype.destroy=function(){e.prototype.destroy.call(this),t.MahJongFourFacede.getInstance().sendNotification(t.MahjongFourFacadeConst.DESTORY)},i.prototype.initGameSpecialData=function(){t.GameData.getInstance().ShortTalkArr=["哎，一手烂牌臭到底","财运来的时候，真是档也挡不住啊","出啊，好牌留着存银行啊","哈哈哈，胡牌胡到手软了","快点吧，我等的花儿都谢了","没梦游吧，都在等你呢","你的牌打的真好，让我意乱神迷了","你们是一伙的吧","牌这么好，想输都难啊","辛辛苦苦二十年，一把输到解放前","呦，牌技不错嘛","这么慢，你是属蜗牛的吧"],t.RoomInfo.getInstance().GM_Mode=!1,t.ColorConst.setGreen(1),t.RoomInfo.getInstance().setPlayType("红中麻将"),1003==MJLobby.MJLobbyData.getInstance().lobbyId&&t.RoomInfo.getInstance().setPlayType("大连晃"),t.RoomInfo.getInstance().gameId=5066,t.GameConst.viewChange=!1,t.RoomInfo.getInstance().languageMode=t.GameConst.revengeStr},i.prototype.initPositionData=function(){t.DataCache.defaultWidth!=uniLib.Global.screenWidth&&(this.width=t.DataCache.defaultWidth=uniLib.Global.screenWidth,this.height=t.DataCache.defaultHeight=uniLib.Global.screenHeight)},i}(uniLib.GameScene);e.HeadLoad=new t.HeadLoader,t.MJGameScene=e,__reflect(e.prototype,"game.MJGameScene")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new ZZ_MsgBoxSkin,t}return __extends(i,e),i.show=function(e,n,s,a,o,r){var h=new i;h.x=uniLib.Global.screenWidth-h.width>>1,h.y=uniLib.Global.screenHeight-h.height>>1,h.setData(e,n,s,a,o,r),t.PopupManager.addPopUp(h,!0)},i.prototype.setData=function(t,e,i,n,s,a){this.titleLabel.text=t,this.desLabel.text=e,this.labelArray=i,this.funcArray=n,this._backObj=s,this.btnsGroup.removeChildren(),1==i.length?(this.btnsGroup.addChild(this.yesBtn),this.noBtn.parent&&this.btnsGroup.removeChild(this.noBtn)):2==i.length&&(this.btnsGroup.addChild(this.yesBtn),this.btnsGroup.addChild(this.noBtn)),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTap,this)},i.prototype.onClickTap=function(t){t.target==this.yesBtn?(this.onClose(),this.funcArray[0]&&this.funcArray[0].call(this._backObj)):t.target==this.noBtn?(this.onClose(),this.funcArray[1]&&this.funcArray[1].call(this._backObj)):t.target==this.closeBtn&&this.onClose()},i.prototype.onClose=function(){t.PopupManager.removePopUp(this),this.parent&&this.parent.removeChild(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTap,this)},i.prototype.destroy=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},i}(eui.Component);t.MsgBoxPanel=e,__reflect(e.prototype,"game.MsgBoxPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._effectName="",t._gender=0,t._muitiType=Cmd.MahjongOpCardType.MahjongOpCardType_Win,t._index=0,t}return __extends(i,e),i.prototype.initUI=function(){this._kang=uniLib.DisplayUtils.createMovieClicp("gang"),this._pong=uniLib.DisplayUtils.createMovieClicp("peng"),this._hu=uniLib.DisplayUtils.createMovieClicp("hu"),this._lizi=uniLib.DisplayUtils.createMovieClicp("lizi"),this._genpai=uniLib.DisplayUtils.createMovieClicp("genpai"),this._time_100=new uniLib.TimerBase(100,this.countSecond,this),this._time_100.stop(),this._facePanel=[];for(var t=0;4>t;t++){var e=new egret.Sprite;this._facePanel.push(e),this.addChild(e)}this._quickTalkPanel=[];for(var t=0;4>t;t++){var e=new egret.Sprite;this._quickTalkPanel.push(e),this.addChild(e)}this._talkPanel=[];for(var t=0;4>t;t++){var e=new egret.Sprite;this._talkPanel.push(e),this.addChild(e)}},i.prototype.showWinEffect=function(e,i,n){void 0===n&&(n=!1);var s=t.RoomInfo.getInstance().getSeatNoByUserId(i);if(2==e.winType){var a,o=t.RoomInfo.getInstance().getUserVoByUid(i).getGender();return a="cs"==t.RoomInfo.getInstance().languageMode?table.TableCard.resSoundAction(0,o):"action_pu_"+o+"1_mp3",""!=a&&uniLib.SoundMgr.instance.playSound(a),void this.playMcTween(5,s)}if(1==e.winType){var a,o=t.RoomInfo.getInstance().getUserVoByUid(i).getGender();return a="cs"==t.RoomInfo.getInstance().languageMode?table.TableCard.resSoundAction(Cmd.MahjongOpCardType.MahjongOpCardType_Win,o):"action_pu_"+o+"_zimo_mp3",""!=a&&uniLib.SoundMgr.instance.playSound(a),void this.playMcTween(5,s)}this.setPosition(this._lizi,s),this.addChild(this._winEffect.display),this._winEffect.animation.play(this._effectName,1)},i.prototype.showEffect=function(e,i){this._effectName="";var n=t.RoomInfo.getInstance().getSeatNoByUserId(i),s=t.RoomInfo.getInstance().getUserVoByUid(i).getGender();if(e==Cmd.MahjongOpCardType.MahjongOpCardType_Win)this.playHuMusic(s,e);else{var a=table.TableCard.resSoundAction(e,s);""!=a&&uniLib.SoundMgr.instance.playSound(a)}switch(e){case Cmd.MahjongOpCardType.MahjongOpCardType_Touch:return void this.playMcTween(2,n);case Cmd.MahjongOpCardType.MahjongOpCardType_Bar:return void this.playMcTween(3,n);case Cmd.MahjongOpCardType.MahjongOpCardType_Win:return void this.playMcTween(5,n)}},i.prototype.setPosition=function(e,i){0==i?(e.x=Math.round(t.DataCache.defaultWidth/2),e.y=t.DataCache.defaultHeight-120):1==i?(e.y=Math.round(t.DataCache.defaultHeight/2),e.x=t.DataCache.defaultWidth-150):2==i?(e.y=80,e.x=Math.round(t.DataCache.defaultWidth/2)):3==i&&(e.x=150,e.y=Math.round(t.DataCache.defaultHeight/2))},i.prototype.playMcTween=function(e,i){var n=this,s="";switch(e){case 1:s="action_chi";break;case 2:s="action_peng";break;case 3:s="action_gang";break;case 4:s="action_bu";break;case 5:s="action_win"}if(""!=s){var a=t.ResUtil.createBitmapByName(s),o=this.getSeatPlaceById(i);this.addChild(a),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=o[0],a.y=o[1],a.width=a.width-10,a.height=a.height-10,egret.Tween.get(a).wait(500).to({alpha:.7},200).call(function(){egret.Tween.removeTweens(a),n.removeChild(a),a=null
})}},i.prototype.getSeatPlaceById=function(t){var t=t,e=[];switch(t){case 0:return e[0]=uniLib.Global.screenWidth/2,e[1]=uniLib.Global.screenHeight-220,e;case 1:return e[0]=uniLib.Global.screenWidth-310,e[1]=uniLib.Global.screenHeight/2-60,e;case 2:return e[0]=uniLib.Global.screenWidth/2,e[1]=150,e;case 3:return e[0]=310,e[1]=uniLib.Global.screenHeight/2-60,e}},i.prototype.playMc=function(e,i){e.isPlaying&&(e.stop(),e.removeEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this)),-1==i?(e.x=Math.round(t.DataCache.defaultWidth/2),e.y=Math.round(t.DataCache.defaultHeight/2)):this.setPosition(e,i),e.addEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this),this.addChild(e),e.gotoAndPlay(1,1)},i.prototype.onMcPlayComplete=function(t){var e=t.target;e&&(e.stop(),e.removeEventListener(egret.Event.COMPLETE,this.onMcPlayComplete,this),e==this._hu?egret.setTimeout(function(){uniLib.DisplayUtils.removeFromParent(e)},null,1e3):uniLib.DisplayUtils.removeFromParent(e))},i.prototype.loop=function(t){this.addChild(this._lizi),this._lizi.addEventListener(egret.Event.COMPLETE,this.onLiziComplete,this),this._lizi.play(1)},i.prototype.onLiziComplete=function(t){this._lizi.stop(),this._lizi.removeEventListener(egret.Event.COMPLETE,this.onLiziComplete,this)},i.prototype.clearEffect=function(){uniLib.DisplayUtils.removeFromParent(this._lizi),this._winEffect&&uniLib.DisplayUtils.removeFromParent(this._winEffect.display)},i.prototype.playHuMusic=function(e,i){this._gender=e,this._muitiType=i,uniLib.SoundMgr.instance.playSound(t.SoundConsts.HU_MUSIC),this._index=0,this._time_100.start()},i.prototype.countSecond=function(){if(this._index++,this._index>=5){if(this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_ThreeGold||this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_FourGold||this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_FiveGold||this._muitiType==Cmd.MahjongOpCardType.MahjongOpCardType_SixGold){var t=table.TableCard.resSoundAction(Cmd.MahjongOpCardType.MahjongOpCardType_Win,this._gender);""!=t&&uniLib.SoundMgr.instance.playSound(t)}else{var t=table.TableCard.resSoundAction(this._muitiType,this._gender);""!=t&&uniLib.SoundMgr.instance.playSound(t)}this._time_100.stop(),this._index=0,this._muitiType=Cmd.MahjongOpCardType.MahjongOpCardType_Win,this._gender=0}},i.prototype.showCommonChat=function(e,i){var n=t.RoomInfo.getInstance().getSeatNoByUserId(e),s=t.RoomInfo.getInstance().getUserVoByUid(e).getGender();switch(this._facePanel[n].x=t.GameData.getInstance().TempeLocation[n][0],this._facePanel[n].y=t.GameData.getInstance().TempeLocation[n][1],n){case 0:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x+100,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 1:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x-180,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 2:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x-180,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 3:this._quickTalkPanel[n].x=t.PositionData.seatPosArr[n].x+100,this._quickTalkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor}var a;if("1"==i.charAt(0)){a=i.substr(1,i.length-1);var o=uniLib.DisplayUtils.createMovieClicp("face_"+a+"_new");this._facePanel[n].addChild(o),o.scaleX=1,o.scaleY=1,o.play(-1),GX.GameLayerManager.addUIToEffect(o),t.Timer.setTimeout(function(){o.stop(),GX.GameLayerManager.removeUI(o)},this,2e3)}else"2"==i.charAt(0)&&(a=i.substr(1,i.length-1),uniLib.SoundMgr.instance.playSound(t.SoundConsts.COMMON+"_"+s+"_"+a+"_mp3"),this.creatChatPop(n,t.GameData.getInstance().ShortTalkArr[a],this._quickTalkPanel[n]),egret.Tween.get(this._quickTalkPanel[n]).wait(3e3).call(this.quickTalkCompelete,this,[this._quickTalkPanel[n],n]))},i.prototype.showCommonTalk=function(e,i){var n=t.RoomInfo.getInstance().getSeatNoByUserId(e);switch(n){case 0:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x+100,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 1:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x-180,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 2:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x-180,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor;break;case 3:this._talkPanel[n].x=t.PositionData.seatPosArr[n].x+100,this._talkPanel[n].y=t.PositionData.seatPosArr[n].y*uniLib.ScreenUtils.scaleFactor}this.creatChatPop(n,i,this._talkPanel[n]),egret.Tween.get(this._quickTalkPanel[n]).wait(3e3).call(this.talkCompelete,this,[this._talkPanel[n],n])},i.prototype.showCompelete=function(t,e){t&&egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(this._facePanel[e])},i.prototype.quickTalkCompelete=function(t,e){t&&egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(this._quickTalkPanel[e])},i.prototype.talkCompelete=function(t,e){t&&egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(this._talkPanel[e])},i.prototype.creatChatPop=function(e,i,n){var s=t.ResUtil.createBitmapByName("chat_pop");s.scale9Grid=new egret.Rectangle(28,33,13,5),s.width=245,n.addChild(s);var a=t.ResUtil.createTextFeild(1456961,egret.HorizontalAlign.LEFT,"",28,35,10,210,!1,4);a.text=i,n.addChild(a),s.height=10+a.height+20,1==e||2==e?(s.scaleX=-1,s.x=180,a.x=-45):a.x-=10,s=null,a=null},i.prototype.destory=function(){e.prototype.destory.call(this),egret.Tween.removeTweens(this),this._time_100&&this._time_100.stop(),this._time_100=null,this._winEffect&&(this._winEffect.removeEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,this.loop,this),dragonBones.WorldClock.clock.remove(this._winEffect),this._winEffect.animation.stop(),this._winEffect.display&&t.ResUtil.removeFromParent(this._winEffect.display),this._winEffect=null),this._kang.stop(),this._kang=null,this._pong.stop(),this._pong=null,this._hu.stop(),this._hu=null,this._genpai.stop(),this._genpai=null;for(var i=0;4>i;i++){var n=this._facePanel[i];uniLib.DisplayUtils.removeAllChildren(n),uniLib.DisplayUtils.removeFromParent(n),n=null}this._facePanel=null;for(var i=0;4>i;i++){var n=this._quickTalkPanel[i];uniLib.DisplayUtils.removeAllChildren(n),uniLib.DisplayUtils.removeFromParent(n),n=null}this._quickTalkPanel=null;for(var i=0;4>i;i++){var n=this._talkPanel[i];uniLib.DisplayUtils.removeAllChildren(n),uniLib.DisplayUtils.removeFromParent(n),n=null}this._talkPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.ActionEffectMc=e,__reflect(e.prototype,"game.ActionEffectMc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.clearDrag=function(){this._bankerMC&&(this._bankerMC.removeEventListener(egret.Event.COMPLETE,this.onMCComplete,this),this._bankerMC&&t.ResUtil.removeFromParent(this._bankerMC)),this._bankerMC=null},i.prototype.destory=function(){this._bankBmp=null,this._bankerMC&&(this._bankerMC.removeEventListener(egret.Event.COMPLETE,this.onMCComplete,this),this._bankerMC&&t.ResUtil.removeFromParent(this._bankerMC)),this._bankerMC=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.initUI=function(){this._bankerMC=uniLib.DisplayUtils.createMovieClicp("zhuang")},i.prototype.show=function(e){if(void 0===e&&(e=!0),e){if(uniLib.DisplayUtils.removeAllChildren(this),!this._bankerMC)return;this._bankerMC.x=uniLib.Global.screenWidth-this._bankerMC.width+2*t.CountVc.OFFSET_Y>>1,this._bankerMC.y=uniLib.Global.screenHeight-this._bankerMC.height+2*t.CountVc.OFFSET_Y>>1,this._bankerMC.parent||this.addChild(this._bankerMC),this._bankerMC.addEventListener(egret.Event.COMPLETE,this.onMCComplete,this),this._bankerMC.play(1)}else this.bankerMCEnd(null)},i.prototype.onMCComplete=function(e){var i=t.SeatPlayVc.seatPosArr[t.RoomInfo.getInstance().bankerSeatId];this._bankerMC.removeEventListener(egret.Event.COMPLETE,this.onMCComplete,this),egret.Tween.get(this._bankerMC).to({x:i.x-4,y:(i.y-14)*uniLib.ScreenUtils.scaleFactor},200).call(this.bankerMCEnd,this,[this._bankerMC])},i.prototype.bankerMCEnd=function(e){e&&egret.Tween.removeTweens(e),this._bankerMC&&this.clearDrag(),uniLib.DisplayUtils.removeAllChildren(this),this._bankBmp=t.ResUtil.createBitmapByName("game_bank");var i=t.SeatPlayVc.seatPosArr[t.RoomInfo.getInstance().bankerSeatId];null!=i&&(this._bankBmp.x=i.x-5,this._bankBmp.y=i.y-5,this.addChild(this._bankBmp))},i}(t.BaseVc);t.BankerEffectMc=e,__reflect(e.prototype,"game.BankerEffectMc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._initCardsPointX=[],t._initCardsPointY=uniLib.Global.screenHeight/3,t._stepX=120,t._sendCardPoint=new egret.Point(uniLib.Global.screenWidth/2,50),t._horseCards=new Array,t}return __extends(i,e),i.prototype.initUI=function(){this._catoonPoint=new egret.Point(670,500),this._initCardsPointX=[],this._zmEffectMc=uniLib.DisplayUtils.createDragonBonesDisplay("tuidaohu_zm_effect_ske_json","tuidaohu_zm_effect_tex_json","tuidaohu_zm_effect_tex_png","MovieClip"),dragonBones.WorldClock.clock.add(this._zmEffectMc),this._zmEffectMc.addEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,this.loop_com,this),this._lizi=uniLib.DisplayUtils.createMovieClicp("lizi")},i.prototype.createPanel=function(e){var i=this;this._winHorseNum=e.winHorse;var n=300;this._initCardsPointX=[];for(var s=0;6>s;s++)this._initCardsPointX.push(n+this._stepX*s);if(e.horseSet&&e.horseSet instanceof Array){var a=e.horseSet.length;if(-1!=t.RoomInfo.getInstance().playTypeList.indexOf(10537)){for(var o=function(t){egret.setTimeout(function(){return i.createCard(e.horseSet[t].thisId,a,t,1)},null,100*t)},s=0;a>s;s++)o(s);return void egret.setTimeout(function(){i.destroyEff()},null,3e3+200*a)}for(var r=function(t){egret.setTimeout(function(){return i.createCard(e.horseSet[t].thisId,a,t,e.horseSet[t].bWin)},null,100*t)},s=0;a>s;s++)r(s)}this._zmEffectMc.display.x=this._catoonPoint.x,this._zmEffectMc.display.y=this._catoonPoint.y,e.winHorse?egret.setTimeout(function(){i._zmEffectMc.animation.play("0"+e.winHorse,1),i.addChild(i._zmEffectMc.display)},null,1500):egret.setTimeout(function(){i._zmEffectMc.animation.play("meizhong",1),i.addChild(i._zmEffectMc.display)},null,1500)},i.prototype.createCard=function(e,i,n,s){if(this._horseCards.length<=i){var a=new t.HorseCard;this._horseCards.push(a),this._horseCards[n].createHorseCard()}this.addChild(this._horseCards[n]),this._horseCards[n].x=this._sendCardPoint.x,this._horseCards[n].y=this._sendCardPoint.y;var o=egret.Tween.get(this._horseCards[n]);o.to({x:this._initCardsPointX[(6-i)/2+n],y:this._initCardsPointY},100).wait(100+40*(n+i)).call(this._horseCards[n].createHorseCardEff,null,[e,s])},i.prototype.loop_com=function(t){var e=this;this._zmEffectMc.animation.stop(),this._winHorseNum>0&&(this._lizi.x=this._catoonPoint.x,this._lizi.y=this._catoonPoint.y,this.addChild(this._lizi),this._lizi.addEventListener(egret.Event.COMPLETE,this.onLiziComplete,this),this._lizi.play(1)),egret.setTimeout(function(){e.destroyEff()},null,2e3)},i.prototype.onLiziComplete=function(t){this._lizi.stop(),this._lizi.removeEventListener(egret.Event.COMPLETE,this.onLiziComplete,this),uniLib.DisplayUtils.removeFromParent(this._lizi)},i.prototype.destroyEff=function(){console.error("destroyEff"),egret.Tween.removeTweens(this);for(var e=this._horseCards.length-1;e>=0;e--)this._horseCards[e]&&(this._horseCards[e].destroy(),this._horseCards.splice(e,1));this._zmEffectMc&&(this._zmEffectMc.removeEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,this.loop_com,this),dragonBones.WorldClock.clock.remove(this._zmEffectMc),this._zmEffectMc.animation.stop(),this._zmEffectMc.display&&uniLib.DisplayUtils.removeFromParent(this._zmEffectMc.display),this._zmEffectMc=null),this._lizi&&(this._lizi.stop(),uniLib.DisplayUtils.removeFromParent(this._lizi)),this._lizi=null,t.PopupManager.removePopUp(this),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.destory=function(){this.destroyEff(),e.prototype.destory.call(this)},i}(t.BaseVc);t.BuyHorsePanel=e,__reflect(e.prototype,"game.BuyHorsePanel")}(game||(game={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._stepX=-170,t._stepKongX=-200,t}return __extends(i,e),i.prototype.initUI=function(){this._cancleBtn||(this._cancleBtn=new t.GameButton(["operate_cancel1","operate_cancel2"],null,!1)),this._defaultPoint=new egret.Point((uniLib.Global.screenWidth-1136)/2+866,uniLib.Global.screenHeight-230)},i.prototype.createChowPanel=function(){uniLib.DisplayUtils.removeAllChildren(this),this._chowCards=null,this._cancleBtn||(this._cancleBtn=new t.GameButton(["operate_cancel1","operate_cancel2"],null,!1)),this._cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeChow,this),this._chowCards=t.GroupCardsFactory.getInstance().getChowCards(),this._cancleBtn.x=this._defaultPoint.x,this._cancleBtn.y=this._defaultPoint.y+3,this.addChild(this._cancleBtn),this.sortChowCards()},i.prototype.sortChowCards=function(){for(var e=0;e<this._chowCards.length;e++){this._bg=new egret.Sprite,this.addChild(this._bg),this._bg.x=this._defaultPoint.x+(this._chowCards.length-e)*this._stepX,this._bg.y=this._defaultPoint.y+15;var i=new egret.Bitmap,n=new egret.Bitmap;0==e?(n=t.ResUtil.createBitmapByName("game_eatIcon"),n.x=-50,n.y=18,i=t.ResUtil.createBitmapByName("game_eatCardKuang_bg1"),i.scale9Grid=new egret.Rectangle(20,57,14,5),n.visible=!0):(i=t.ResUtil.createBitmapByName("game_eatCardKuang_bg2"),i.scale9Grid=new egret.Rectangle(20,57,14,5),n.visible=!1),i.width=this._chowCards[e].width+50,i.height=this._chowCards[e].height+50,this._chowCards[e].x=25,this._chowCards[e].y=22,this._chowCards[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectChowCards,this),this._chowCards[e].touchEnabled=!0,this._bg.addChild(i),this._bg.addChild(this._chowCards[e]),this._bg.addChild(n)}},i.prototype.selectChowCards=function(e){var i=e.target.data.split(",");t.CardInfo.getInstance().eatObj.one=Number(i[0]),t.CardInfo.getInstance().eatObj.two=Number(i[1]),this.dispatchEventWith(t.UIEventConsts.ACTION_BEGIN_CHOW)},i.prototype.createKongPanel=function(e){uniLib.DisplayUtils.removeAllChildren(this),this._kongCards=null,this._cancleBtn||(this._cancleBtn=new t.GameButton(["operate_cancel1","operate_cancel2"],null,!1)),this._cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeChow,this),this._kongCards=t.GroupCardsFactory.getInstance().getKongCards(e),this._cancleBtn.x=this._defaultPoint.x,this._cancleBtn.y=this._defaultPoint.y+3,this.addChild(this._cancleBtn),this.sortKongCards()},i.prototype.sortKongCards=function(){for(var e=0;e<this._kongCards.length;e++){this._bg=new egret.Sprite,this.addChild(this._bg),this._bg.x=this._defaultPoint.x+(this._kongCards.length-e)*this._stepKongX,this._bg.y=this._defaultPoint.y+15;var i=new egret.Bitmap,n=new egret.Bitmap;0==e?(n=t.ResUtil.createBitmapByName("game_kongIcon"),n.x=-50,n.y=18,i=t.ResUtil.createBitmapByName("game_eatCardKuang_bg1"),i.scale9Grid=new egret.Rectangle(84,15,7,96),i.visible=!0):(i=t.ResUtil.createBitmapByName("game_eatCardKuang_bg2"),i.scale9Grid=new egret.Rectangle(27,13,15,96),n.visible=!1),i.width=this._kongCards[e].width+50,i.height=this._kongCards[e].height+50,this._kongCards[e].x=25,this._kongCards[e].y=22,this._kongCards[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectKongCards,this),this._kongCards[e].touchEnabled=!0,this._bg.addChild(i),this._bg.addChild(this._kongCards[e]),this._bg.addChild(n)}},i.prototype.selectKongCards=function(e){t.CardInfo.getInstance().kongThisId=e.target.data,this.dispatchEventWith(t.UIEventConsts.ACTION_BEGIN_KONG)},i.prototype.destory=function(){if(e.prototype.destory.call(this),this._chowCards&&this._chowCards[0])for(var t=0;t<this._chowCards.length;t++)this._chowCards[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.selectChowCards,this),this._chowCards[t].destory();if(this._chowCards=null,this._kongCards&&this._kongCards[0])for(var t=0;t<this._kongCards.length;t++)this._kongCards[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.selectKongCards,this),this._kongCards[t].destory();this._cancleBtn&&(this._cancleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeChow,this),this._cancleBtn=null),this._bg&&(uniLib.DisplayUtils.removeAllChildren(this._bg),uniLib.DisplayUtils.removeFromParent(this._bg)),this._bg=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.closeChow=function(){this.dispatchEventWith(t.UIEventConsts.ACTION_STOP_CHOW),this.destory(),t.PopupManager.removePopUp(this)},i}(t.BaseVc);t.ChowCardsPanel=e,__reflect(e.prototype,"game.ChowCardsPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._seatId=t,i}return __extends(i,e),i.prototype.initUI=function(){this._blurBitMap=t.ResUtil.createBitmapByName("game_out_blur"),this._seatId%2+1==1?(this._blurBitMap.x=10,this._blurBitMap.y=13):(this._blurBitMap.rotation=90,this._blurBitMap.x=-15,this._blurBitMap.y=-8),this.addChild(this._blurBitMap),this._outCard=new t.OutPutCard,this._outCard.alpha=.2,this.addChildAt(this._outCard,0)},i.prototype.setCard=function(t){this._outCard.setCard(this._seatId,t)},i.prototype.destory=function(){this._outCard&&this._outCard.destory(),this._outCard=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._blurBitMap=null},i}(t.BaseVc);t.DiscardBlurMc=e,__reflect(e.prototype,"game.DiscardBlurMc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._cardMc=new egret.DisplayObjectContainer,this.addChild(this._cardMc)},Object.defineProperty(i.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),i.prototype.addCard=function(t,e){void 0===e&&(e=!0),e?this._cardMc.addChild(t):this._cardMc.addChildAt(t,0)},i.prototype.destory=function(){this._cardMc&&(uniLib.DisplayUtils.removeAllChildren(this._cardMc),uniLib.DisplayUtils.removeFromParent(this._cardMc)),this._cardMc=null,this._flagIcon=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.getFlagIcon=function(e){return void 0===e&&(e=-1),-1==e?this._flagIcon:(this._flagIcon?this._flagIcon.texture=t.ResUtil.createTexture("game_group_flag"+e):(this._flagIcon=t.ResUtil.createBitmapByName("game_group_flag"+e),this.addChild(this._flagIcon)),this._flagIcon)},Object.defineProperty(i.prototype,"flagIcon",{set:function(t){!this._flagIcon,this._flagIcon=t},enumerable:!0,configurable:!0}),i}(t.BaseVc);t.GroupCard=e,__reflect(e.prototype,"game.GroupCard")}(game||(game={}));var game;!function(t){var e=function(){function e(){this._resultX=42,this._stepXArr=[44,0,-42,0],this._stepYArr=[0,-30,0,30],this._backScale=[1,.88,1,.88],this._scaleArr=[1,.8,.95,.8],this._selfKongXArr=[1,1,0,-1],this._selfKongYArr=[-10,-9,-10,-9],this._flagXArr=[16,32,14,-5],this._flagYArr=[50,8,-4,7],this._kongOtherFlagX=[16,-6,14,33],this._kongOtherFlagY=[-8,8,44,9],this._flagScale=[1,.8,.8,.8]}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getPongCard=function(t,e){void 0===e&&(e=!1);for(var i=[],n=0;3>n;n++)i.push(t.thisId);var s=(t.seatId-t.fromSeatId+4)%4,a=this.showCards(i,t.seatId,s,e);return a.type=Cmd.MahjongOpCardType.MahjongOpCardType_Touch,a.data=t,a},e.prototype.getGangCard=function(e,i){void 0===i&&(i=!1);var n;if(e.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarTouch||e.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarOther)return n=this.getPongCard(e,i),this.changePongToKong(n,e,i),n;if(e.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarSelf){var s;n=new t.GroupCard,n.type=Cmd.MahjongOpCardType.MahjongOpCardType_Bar;for(var a=0;3>a;a++)s=new t.OutPutBackCard,i?(s.setCard(e.seatId,1),s.x=this._resultX*a):(s.setCard(e.seatId,this._backScale[e.seatId]),s.x=this._stepXArr[e.seatId]*a),s.y=this._stepYArr[e.seatId]*a,this._stepYArr[e.seatId]<0?n.addCard(s,!1):n.addCard(s);if(0==e.seatId){var o=new t.OutPutCard;i?(o.setCard(e.seatId,e.thisId,1,i),o.x=this._resultX):(o.setCard(e.seatId,e.thisId,this._scaleArr[e.seatId],i),o.x=1*this._stepXArr[e.seatId]+this._selfKongXArr[e.seatId]),o.y=1*this._stepYArr[e.seatId]+this._selfKongYArr[e.seatId],n.addCard(o)}else{var o=new t.OutPutCard;o.setCard(e.seatId,e.thisId,this._backScale[e.seatId]),o.x=1*this._stepXArr[e.seatId]+this._selfKongXArr[e.seatId],o.y=1*this._stepYArr[e.seatId]+this._selfKongYArr[e.seatId],n.addCard(o)}}return n},e.prototype.changePongToKong=function(e,i,n){void 0===n&&(n=!1);var s=new t.OutPutCard,a=e.data;0==i.seatId?s.setCard(i.seatId,a.thisId,1,n):s.setCard(i.seatId,a.thisId,this._scaleArr[i.seatId]),n?s.x=1*this._resultX:s.x=1*this._stepXArr[i.seatId]+this._selfKongXArr[i.seatId],s.y=1*this._stepYArr[i.seatId]+this._selfKongYArr[i.seatId],e.type=Cmd.MahjongOpCardType.MahjongOpCardType_Bar,e.addCard(s);var o=(i.seatId-i.fromSeatId+4)%4,r=e.getFlagIcon();i.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarTouch?2==o&&(r.scaleX=r.scaleY=this._flagScale[i.seatId],r.x=s.x+this._flagXArr[i.seatId],r.y=s.y+this._flagYArr[i.seatId],r.visible=!0):(r.scaleX=r.scaleY=this._flagScale[i.seatId],r.x=s.x+this._kongOtherFlagX[i.seatId],r.y=s.y+this._kongOtherFlagY[i.seatId],r.visible=!0),n&&r&&(r.visible=!1)},e.prototype.getChowCard=function(t,e){void 0===e&&(e=!1);for(var i=[],n=0;n<t.cardSet.length;n++)i.push(t.cardSet[n]);i.push(t.thisId),i.sort(function(t,e){return t-e});var s=(t.seatId-t.fromSeatId+4)%4,a=this.showCards(i,t.seatId,s,e,!1,t.thisId);return a.type=Cmd.MahjongOpCardType.MahjongOpCardType_Eat,a.data=t,a},e.prototype.getChowCards=function(){if(!t.RoomInfo.getInstance().OutCard.eatSet||!t.RoomInfo.getInstance().OutCard.eatSet[0])return null;for(var e=[],i=0;i<t.RoomInfo.getInstance().OutCard.eatSet.length;i++){var n=[];n.push(t.RoomInfo.getInstance().OutCard.eatSet[i].one),n.push(t.RoomInfo.getInstance().OutCard.eatSet[i].two),n.push(t.RoomInfo.getInstance().OutCard.thisId),n.sort(function(t,e){return t-e});var s=this.showCards(n,0,0,!1,!0);s.type=Cmd.MahjongOpCardType.MahjongOpCardType_Eat,s.data=t.RoomInfo.getInstance().OutCard.eatSet[i].one.toString()+","+t.RoomInfo.getInstance().OutCard.eatSet[i].two.toString(),e.push(s)}return e},e.prototype.getKongCards=function(t){if(t&&t.length){for(var e=[],i=0;i<t.length;i++){var n=t[i],s=[n,n,n,n],a=this.showCards(s,0,0,!1,!0);a.type=Cmd.MahjongOpCardType.MahjongOpCardType_BarSelf,a.data=n,e.push(a)}return e}},e.prototype.showCards=function(e,i,n,s,a,o){void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===o&&(o=0);var r,h,d=new t.GroupCard,l=0;l=2==n?90+-90*i:3==n?180+-90*i:0+-90*i,l=(l+360)%360;for(var c=d.getFlagIcon(l),u=0;u<e.length;u++)r=e[u],h=new t.OutPutCard,0==i?s?h.setCard(i,r,1,s):h.setCard(i,r,this._scaleArr[i],s):h.setCard(i,r,this._scaleArr[i]),s?h.x=this._resultX*u:h.x=this._stepXArr[i]*u,h.y=this._stepYArr[i]*u,this._stepYArr[i]<0?d.addCard(h,!1):d.addCard(h),a?c.visible=!1:0==o||s?(u==n-1&&(c.scaleX=c.scaleY=this._flagScale[i],c.x=h.x+this._flagXArr[i],c.y=h.y+this._flagYArr[i],c.visible=!0),s&&c&&(c.visible=!1)):h.data==o&&(c.scaleX=c.scaleY=this._flagScale[i],c.x=h.x+this._flagXArr[i],c.y=h.y+this._flagYArr[i],c.visible=!0);return d},e}();t.GroupCardsFactory=e,__reflect(e.prototype,"game.GroupCardsFactory")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._stepX=22,t._stepY=20,t}return __extends(i,e),i.prototype.initUI=function(){this._panel=new egret.Sprite,this.addChild(this._panel)},i.prototype.createHorseCard=function(){var t=uniLib.DisplayUtils.createBitmapByName("HorseCard_back"),e=uniLib.DisplayUtils.createBitmapByName("HorseCard_bg");t.x=this._stepX,t.y=this._stepY,this._panel.addChild(t),this._panel.addChild(e),this._defaultWidth=e.width,this._defaultHeighht=e.height},i.prototype.createHorseCardEff=function(e,i){uniLib.DisplayUtils.removeAllChildren(this._panel),this._card=new t.MySelfCard,this._card.setCard(e,1),this._card.width=this._defaultWidth,this._card.height=this._defaultHeighht,this._card.x=this._stepX,this._card.y=this._stepY;var n=new egret.Bitmap;1==i?(n=uniLib.DisplayUtils.createBitmapByName("HorseCard_hand"),this.createLizi()):n=uniLib.DisplayUtils.createBitmapByName("HorseCard_miss"),this._panel.addChild(this._card),this._panel.addChild(n)},i.prototype.createLizi=function(){this._huangg||(this._huangg=uniLib.DisplayUtils.createMovieClicp("huangg")),this._huangg.x=60,this._huangg.y=77,this.addChildAt(this._huangg,0),this._huangg.gotoAndPlay(1,-1)},i.prototype.loop_com=function(t){},i.prototype.destroy=function(){egret.Tween.removeTweens(this),this._huangg&&(this._huangg.stop(),uniLib.DisplayUtils.removeFromParent(this._huangg)),this._huangg=null,this._card&&uniLib.DisplayUtils.removeFromParent(this._card),this._card=null,this._panel&&(uniLib.DisplayUtils.removeAllChildren(this._panel),uniLib.DisplayUtils.removeFromParent(this._panel)),this._panel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.HorseCard=e,__reflect(e.prototype,"game.HorseCard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._stepX=50,this._defaultPoint=new egret.Point(uniLib.Global.screenWidth/2,uniLib.Global.screenHeight-230),this._bgPanel=new egret.Sprite,this._bgPanel.x=this._defaultPoint.x,this._bgPanel.y=this._defaultPoint.y+10,this.addChild(this._bgPanel),this._bgBitmap=uniLib.DisplayUtils.createBitmapByName("game_listenBg"),this._bgBitmap.scale9Grid=new egret.Rectangle(15,8,91,34),this._bgBitmap.height=98,this._bgPanel.addChild(this._bgBitmap)},i.prototype.setListenScene=function(e){if(e)if(this.removeListenCardData(),34==e.length||27==e.length){this._bgBitmap.width=65,this._bgPanel.x=uniLib.Global.screenWidth/2-this._bgBitmap.width/2;var i=new t.OutPutCard;i.showListenCard(e[0],1,!0),i.name="1000",this._bgPanel.addChild(i),i.x=12,i.y=15}else{this._bgBitmap.width=65+50*(e.length-1),this._bgPanel.x=uniLib.Global.screenWidth/2-this._bgBitmap.width/2;for(var n=0;n<e.length;n++){var s=new t.OutPutCard;s.showListenCard(e[n]),s.name=e[n].thisId.toString(),this._bgPanel.addChild(s),s.x=12+this._stepX*n,s.y=15}}},i.prototype.removeListenCardData=function(){for(var t=this._bgPanel.numChildren-1;t>=1;t--)this._bgPanel.removeChildAt(t)},i.prototype.destory=function(){this._bgPanel&&uniLib.DisplayUtils.removeAllChildren(this._bgPanel),this._bgPanel=null,this._bgBitmap=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.ListenCardPanel=e,__reflect(e.prototype,"game.ListenCardPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.isSelect=!1,t}return __extends(i,e),i.prototype.initUI=function(){},i.prototype.setCard=function(t,e){void 0===e&&(e=1),this.data=t,this.scale=null==e?uniLib.Global.screenWidth/1280:e*(uniLib.Global.screenWidth/1280),null!=t&&(this.cardName=table.TableCard.resNormal(t),this.showCard(),this.card.alpha=1)},i.prototype.setOpenCard=function(e){this.data=e,this.scale=t.GameConst.scaleFactor,this.goldName="GoldOpenIcon",this.cardName=table.TableCard.resOpen(e),this.showCard(),this.card.alpha=1},i.prototype.setGolden=function(t){this.isGold=t},i.prototype.getData=function(){return this.data},i.prototype.reset=function(){},i.prototype.setSelect=function(t){this.select=t,this.isSelect=t},i.prototype.getSelect=function(){return this.isSelect},i.prototype.destory=function(){uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._maskIcon=null,this.stopTimer()},i}(t.CardMJ);t.MySelfCard=e,__reflect(e.prototype,"game.MySelfCard")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){},e.prototype.setCard=function(t,e){void 0===e&&(e=1),this.scale=e;var i;i=0==t?"Wall_Card0":1==t||3==t?"Wall_Card1":"Wall_Card0",this.cardName=i,this.showCard()},e.prototype.destory=function(){uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},e}(t.CardMJ);t.OutPutBackCard=e,__reflect(e.prototype,"game.OutPutBackCard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){},i.prototype.setCard=function(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=!1),this.scale=i,this._seatId=t,this.data=e,this.cardName=table.TableCard.resPutOut(e,t),n?this.goldName="GoldIcon2":2==t||0==t?this.goldName="GoldIcon2":this.goldName="GoldIcon1",this.showCard()},i.prototype.showListenCard=function(e,i,n){void 0===i&&(i=1),void 0===n&&(n=!1),n?(this.data=1e3,this.listenNum=1e3,this.cardName="AllCard"):(this.data=e.thisId,this.listenNum=t.RoomInfo.getInstance().getShowCardRemainNum(e.thisId),this.cardName=table.TableCard.resPutOut(e.thisId,0)),this.scale=i,this.goldName="GoldIcon2",this.showCard()},Object.defineProperty(i.prototype,"seatId",{get:function(){return this._seatId},set:function(t){this._seatId=t},enumerable:!0,configurable:!0}),i.prototype.destory=function(){uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.CardMJ);t.OutPutCard=e,__reflect(e.prototype,"game.OutPutCard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._initPoint=new egret.Point(387,503),t.stepX=26,t.stepY=0,t.lineX=0,t.lineY=-36,t.numArr=[12,12],t._cardWidth=48,t}return __extends(i,e),Object.defineProperty(i.prototype,"initPoint",{get:function(){return this._initPoint},set:function(t){this._initPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),i.prototype.initCards=function(){this.cardTotal=0;for(var e=0;e<this.numArr.length;e++)this.cardTotal+=this.numArr[e];if(!this.cardArr||this.cardArr.length!=this.cardTotal){this.cardArr=new Array;for(var i,n,s=0;s<this.cardTotal;s++)i=new t.OutPutCard,n=this.getLintNum(s),i.x=Math.round(this._initPoint.x+Math.round(this.stepX)*(n.index+n.offN)+n.line*Math.round(this.lineX)),i.y=Math.round(this._initPoint.y+Math.round(this.stepY)*(n.index+n.offN)+n.line*Math.round(this.lineY)),this.stepY<0||this.lineY<0?this.addChildAt(i,0):this.addChild(i),this.cardArr.push(i);this._curIndex=0,this.outCardsGroup=[]}},i.prototype.getLintNum=function(t){for(var e={},i=0,n=0;n<this.numArr.length;n++){if(t<i+this.numArr[n])return e.line=n,e.index=t-i,e.offN=(this.numArr[0]-this.numArr[n])/2,e;i+=this.numArr[n]}return e},i.prototype.removeOutPutCard=function(e){this.outCardsGroup=ArrayUtil.removeValue(t.CardInfo.getInstance().getOutCardBySeat(this._type),e);var i=t.CardInfo.getInstance().getFlowerCardBySeat(this._type);this.outCardsGroup=i.concat(this.outCardsGroup);for(var n,s=0;s<this.cardArr.length;s++)n=this.cardArr[s],n.visible=!1,n.data=null;this._curIndex=0;for(var s=0;s<this.outCardsGroup.length;s++)this.showOutPutCard(this.outCardsGroup[s])
},i.prototype.getCurOutPutPos=function(){return 0==this._curIndex?new egret.Point(Math.round(this.cardArr[0].x+this.cardArr[0].width/2),Math.round(this.cardArr[0].y)):new egret.Point(Math.round(this.cardArr[this._curIndex-1].x+this.cardArr[this._curIndex-1].width/2),Math.round(this.cardArr[this._curIndex-1].y))},i.prototype.getNextOutPutPos=function(){return null==this.cardArr[this._curIndex]?null:new egret.Point(Math.round(this.cardArr[this._curIndex].x),Math.round(this.cardArr[this._curIndex].y))},i.prototype.getNextPointPos=function(){var t=0==this.stepX?this._cardWidth:Math.abs(this.stepX);return new egret.Point(Math.round(this.cardArr[this._curIndex].x+t/2),Math.round(this.cardArr[this._curIndex].y))},i.prototype.showOutPutCard=function(t){for(var e,i=0;i<this.cardArr.length;i++)if(e=this.cardArr[i],e.data==t)return this._curIndex=i+1,this.getCurOutPutPos();return null==this.cardArr[this._curIndex]&&(this._curIndex=0),this.cardArr[this._curIndex].visible=!0,this.cardArr[this._curIndex].setCard(this._type,t),this._curIndex++,new egret.Point(Math.round(this.cardArr[this._curIndex-1].x+this.cardArr[this._curIndex-1].width/2),Math.round(this.cardArr[this._curIndex-1].y))},i.prototype.resetCard=function(){for(var t,e=0;e<this.cardArr.length;e++)t=this.cardArr[e],t.visible=!1,t.data=null;this._curIndex=0,this.outCardsGroup=[]},i.prototype.showOutPutCardArr=function(t){this._curIndex=0;for(var e=0;e<t.length;e++)this.showOutPutCard(t[e])},i.prototype.fillFlower=function(e){if(null!=e){var i=t.CardInfo.getInstance().getOutCardBySeat(this._type),n=t.CardInfo.getInstance().getFlowerCardBySeat(this._type);i=n.concat(i),this._curIndex=0;for(var s=0;s<i.length;s++){var a=i[s];this.cardArr[this._curIndex].visible=!0,this.cardArr[this._curIndex].setCard(this._type,a),this._curIndex++}}},i.prototype.destory=function(){for(var t=0;t<this.cardArr.length;t++){var e=this.cardArr[t];e.destory()}this.cardArr=null,this.outCardsGroup=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.OutPutCards=e,__reflect(e.prototype,"game.OutPutCards")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t.setGreen=function(t){void 0===t&&(t=0),1==t?(this.color="green_",this.colorFont=7337615,this.greenFanghao=5284689,this.resetFont=7337615):2==t&&(this.color="yellow_",this.colorFont=16773465)},t}();e.color="",e.colorFont=7055559,e.greenFanghao=7186632,e.green="green_",e.resetFont=16774656,t.ColorConst=e,__reflect(e.prototype,"game.ColorConst")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.isDisCarding=!0,i.waitObjtimerId=0,i.timeOuttimerId=0,i.selectCard=null,i.OrginLocation=[],i.initPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.displayPos=new egret.Point(60*t.GameConst.scaleFactor,640-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.defaultPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.stepX=88*uniLib.Global.screenWidth/1280,i.stepY=0,i.takeCardStepX=10,i.takeCardStepY=0,i.userSeat=0,i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepX=44,this.outPutCards.lineY=52,this.outPutCards.stepY=0,this.outPutCards.lineX=0,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1136)/2+140,uniLib.Global.screenHeight-(285+t.CardMJ.CardHeight*t.GameConst.scaleFactor/5)),this.outPutCards.numArr=[18,18,18]):(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1280)/2+424,uniLib.Global.screenHeight-(285+t.CardMJ.CardHeight*t.GameConst.scaleFactor/5)),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.retsetSelfCardPool=function(){for(var e=t.CardInfo.getInstance().MySelfCardPool.length,i=0;e>i;i++){var n=t.CardInfo.getInstance().MySelfCardPool[i];n.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),n.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)}t.CardInfo.getInstance().MySelfCardPool=[]},i.prototype.getMySelfCard=function(e){var i;if(e)for(var n=t.CardInfo.getInstance().MySelfCardPool.length,s=0;n>s;s++){var a=t.CardInfo.getInstance().MySelfCardPool[s];e==a.data&&(i=a)}return i||(i=new t.MySelfCard,t.CardInfo.getInstance().MySelfCardPool.push(i),i.reset(),e&&i.setCard(e)),i},i.prototype.sendCards=function(t){if(this.handsCard){var e=this.handsCard.numChildren;if(this.handCardsArr&&!(this.handCardsArr.length<=0))for(var i,n=0;t>n;n++){var s=this.handCardsArr[e+n];if(null==s)break;i=this.getMySelfCard(s),i.x=this.initPoint.x+(e+n)*Math.round(this.stepX),i.y=this.initPoint.y+(e+n)*Math.round(this.stepY),i.index=e+n,e+n==13&&(i.x+=Math.round(this.takeCardStepX),i.y+=Math.round(this.takeCardStepY)),i.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),i.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.handsCard.addChild(i)}}},i.prototype.setSigleCard=function(e,i,n){void 0===n&&(n=!1);var s=new t.MySelfCard;s.x=this.initPoint.x+e*Math.round(this.stepX)+Math.round(this.takeCardStepX),s.y=this.initPoint.y+e*Math.round(this.stepY)+Math.round(this.takeCardStepY),s.index=e,s.reset(),this.stepY<0?this.handsCard.addChildAt(s,0):this.handsCard.addChild(s),s.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),s.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),i&&!n?s.setCard(i):i&&n&&s.setOpenCard(i)},i.prototype.GetStepLocationX=function(){return Math.floor((uniLib.Global.screenWidth-t.CardMJ.CardWidth)/2)},i.prototype.GetStepLocationY=function(){return uniLib.Global.screenHeight-Math.floor(2*t.CardMJ.CardHeight)-50},i.prototype.onTouchBegin=function(e){0==t.GameData.getInstance().waitCard&&(e.currentTarget.data>500||(this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),t.GameData.getInstance().isMyTime?(this.draggedObject=e.currentTarget,this.draggedObject.parent?this.draggedObject.parent.addChild(this.draggedObject):this.handsCard.addChild(this.draggedObject)):(this.draggedObject=new t.MySelfCard,this.draggedObjectDel=this.draggedObject,this.draggedObject.reset(),this.draggedObject.setCard(e.currentTarget.data),this.draggedObject.alpha=.8,this.draggedObject.x=e.currentTarget.x,this.draggedObject.y=e.currentTarget.y,this.handsCard.addChild(this.draggedObject)),this.draggedObject.getSelect()&&this.isInclude(this.draggedObject.data,t.GameData.getInstance().goldOutCardSet)&&(this.selectCard=this.draggedObject),this.OrginLocation=[e.currentTarget.x,e.currentTarget.y],this.offsetX=e.stageX-this.draggedObject.x,this.offsetY=e.stageY-this.draggedObject.y,egret.MainContext.instance.stage.hasEventListener(egret.TouchEvent.TOUCH_MOVE)&&egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),egret.MainContext.instance.stage.hasEventListener(egret.TouchEvent.TOUCH_END)&&egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)))},i.prototype.onMove=function(t){this.draggedObject&&(this.draggedObject.x=t.stageX-this.offsetX,this.draggedObject.y=t.stageY-this.offsetY,t.stageY>uniLib.Global.screenHeight-30?egret.Tween.get(this.draggedObject).to({x:this.OrginLocation[0],y:this.OrginLocation[1]},100).call(this.cancelSelect,this,[this.draggedObject]):(t.stageX<0||t.stageX>uniLib.Global.screenWidth-30||t.stageY<0)&&this.onTouchEnd(null))},i.prototype.onTouchEnd=function(e){var i=this;return egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.draggedObject?0==t.GameData.getInstance().isMyTime?this.selectCard&&this.selectCard.data==this.draggedObject.data&&this.selectCard.getSelect()?(this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),void(this.draggedObject=null)):(this.selectCard&&this.selectCard.setSelect(!1),this.draggedObject&&(this.selectCard=this.getMySelfCard(this.draggedObject.data),this.selectCard.setSelect(!0),this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),this.dispatchEventWith(t.UIEventConsts.SHOW_OUTCARD,!1,this.selectCard.data)),this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),void(this.draggedObject=null)):void(this.draggedObject.y<=uniLib.Global.screenHeight-Math.floor(4*t.CardMJ.CardHeight/3)?(t.GameData.getInstance().waitCard=this.draggedObject.data,this.dispatchEventWith(t.UIEventConsts.ACTION_DISCARD,!1,this.draggedObject.data),this.draggedObjectWait=this.draggedObject,this.addChild(this.draggedObjectWait),this.waitObjtimerId=setTimeout(function(){i.removeWaitObj()},200),this.isDisCarding=!0,egret.Tween.get(this.draggedObject).to({x:this.GetStepLocationX(),y:this.GetStepLocationY()},1).wait(200).call(this.finishMove,this,[this.draggedObject,!0])):this.selectCard&&this.selectCard.data==this.draggedObject.data?(this.dispatchEventWith(t.UIEventConsts.REMOVE_READYHAND),t.GameData.getInstance().waitCard=this.draggedObject.data,this.dispatchEventWith(t.UIEventConsts.ACTION_DISCARD,!1,this.draggedObject.data),this.draggedObjectWait=this.draggedObject,this.addChild(this.draggedObjectWait),this.waitObjtimerId=setTimeout(function(){i.removeWaitObj()},200),this.isDisCarding=!0,egret.Tween.get(this.draggedObject).to({x:this.GetStepLocationX(),y:this.GetStepLocationY()},1).wait(200).call(this.finishMove,this,[this.draggedObject,!0])):(this.isDisCarding=!1,egret.Tween.get(this.draggedObject).to({x:this.OrginLocation[0],y:this.OrginLocation[1]},100).call(this.finishMove,this,[this.draggedObject,!1]))):void 0},i.prototype.movieEnd=function(t){},i.prototype.removeWaitObj=function(){this.draggedObjectWait&&-1!=this.getChildIndex(this.draggedObjectWait)&&(this.removeChild(this.draggedObjectWait),0!=t.GameData.getInstance().waitCard&&this.dispatchEventWith(t.UIEventConsts.USER_DODISCARD),this.draggedObjectWait=null)},i.prototype.finishMove=function(e,i){var n=this;if(e&&(egret.Tween.removeTweens(e),this.draggedObject))if(i)this.timeOuttimerId=setTimeout(function(){n.timeOutHandler()},5e3),this.selectCard=null,this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),this.draggedObject=null;else if(this.selectCard?this.selectCard&&this.draggedObject!=this.selectCard&&(this.selectCard.setSelect(!1),this.selectCard=this.draggedObject,this.selectCard.setSelect(!0)):(this.draggedObject.setSelect(!0),this.selectCard=this.draggedObject),this.checkListenCards(),t.RoomInfo.getInstance().isShowGMTool){for(var s=0;s<this.handsCard.numChildren;s++){var a=this.handsCard.getChildAt(s);this.selectCard.data!=a.data&&a.setSelect(!1)}var o=t.MahJongFourFacede.getInstance().retrieveMediator(t.HNHZGameMJMediator.NAME),r=o.getViewComponent();r.dispatchEventWith(t.UIEventConsts.GM_SELECT_HANDCARD,!1,this.getSelectCard()),setTimeout(function(){this.selectCard=null,this.draggedObject=null},10)}},i.prototype.timeOutHandler=function(){0!=t.GameData.getInstance().waitCard&&(this.dispatchEventWith(t.UIEventConsts.USER_DODISCARD_FAIL,!1,t.GameData.getInstance().waitCard),t.GameData.getInstance().waitCard=0,t.GameData.getInstance().lastCard>0&&t.CardInfo.getInstance().removeMyCard(t.GameData.getInstance().lastCard)?(this.refreshHandCards(),t.CardInfo.getInstance().addMyCard(t.GameData.getInstance().lastCard)):this.refreshHandCards(),this.setEnable(!0))},i.prototype.cancelSelect=function(t){egret.Tween.removeTweens(t),this.initSelect(),this.selectCard=null,this.draggedObject=null},i.prototype.sortCard=function(){for(var e,i,n=this.handsCard.numChildren,s=[],a=t.RoomInfo.getInstance().goldenCard,o=!1,r=!1,h=0;n>h;h++)i=this.handsCard.getChildAt(h),i.setInitY(),e={},e.value=i.data,e.mc=i,e.isGold=!1,t.GameData.getInstance().isGoldenCard(e.value)&&(o=!0,e.isGold=!0),47==e.value&&(e.value=a[0]),s.push(e);if(s.sort(function(t,e){return t.value>e.value?1:t.value==e.value?0:-1}),o)for(var d=0;d<s.length;d++){s[d].value;if(s[d].isGold){var l=s.splice(d,1);s.unshift(l[0])}}this.curIndex+s.length>14&&this.curIndex>0&&this.curIndex--;for(var c=0;c<s.length;c++){i=s[c].mc,i.x=Math.round(this.initPoint.x+(this.curIndex+c)*Math.round(this.stepX)),i.y=this.initPoint.y+(this.curIndex+c)*Math.round(this.stepY),i.index=this.curIndex+c,this.curIndex+c==13&&(i.x+=Math.round(this.takeCardStepX),i.y+=Math.round(this.takeCardStepY));var u=t.GameData.getInstance().isGoldenCard(i.data);i.setGolden(u),this.handsCard.setChildIndex(i,c)}o=!1,r=!1},i.prototype.setEnable=function(t){for(var e,i=this.handsCard.numChildren,n=0;i>n;n++)e=this.handsCard.getChildAt(n),t?(e.touchEnabled=!0,e.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)||e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),e.hasEventListener(egret.TouchEvent.TOUCH_END)||e.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)):(e.touchEnabled=!1,e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this))},i.prototype.doDraw=function(t){void 0===t&&(t=null);var e=this.getMySelfCard(t);e.x=this.initPoint.x+this.drawIndex*Math.round(this.stepX)+Math.round(this.takeCardStepX),e.y=this.initPoint.y+this.drawIndex*Math.round(this.stepY)+Math.round(this.takeCardStepY),e.index=this.drawIndex,this.stepY<0?this.handsCard.addChildAt(e,0):this.handsCard.addChild(e),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.prototype.removeCard=function(t,e){void 0===e&&(e=!0);for(var i,n,s,a=0;a<t.length;a++){i=this.handsCard.numChildren;for(var o=0;i>o;o++)if(n=this.handsCard.getChildAt(o),n&&n.data==t[a]){s=new egret.Point,s.x=n.x,s.y=n.y,n.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),n.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.handsCard.removeChild(n),n.setInitY(),n.destory(),n=null,e&&this.curIndex++;break}}return this.sortCard(),s},i.prototype.resetHandleCardPos=function(e){void 0===e&&(e=!1),this.displayCardsMc.numChildren>0?this.initPoint.x=this.displayPos.x+this.displayCardsMc.width+20:this.initPoint.x=this.defaultPoint.x;var i,n;i=this.handsCard.numChildren;for(var s=e?70+70*(t.GameConst.scaleFactor-1):this.stepX,a=0;i>a;a++)n=this.handsCard.getChildAt(a),e?(n.x=Math.round(this.initPoint.x+a*Math.round(s)),this.initPoint.x==this.defaultPoint.x&&(n.x=Math.round(125+a*Math.round(s))),n.y=Math.round(this.initPoint.y+30+n.index*Math.round(this.stepY))):(n.x=Math.round(this.initPoint.x+n.index*Math.round(s)),n.y=Math.round(this.initPoint.y+n.index*Math.round(this.stepY))),n.index==this.drawIndex&&(n.x+=Math.round(this.takeCardStepX))},i.prototype.removeHandleCards=function(){var t,e;t=this.handsCard.numChildren;for(var i=0;t>i;i++)e=this.handsCard.getChildAt(0),e.hasEventListener(egret.TouchEvent.TOUCH_END)&&(e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)),e.destory(),e=null;uniLib.DisplayUtils.removeAllChildren(this.handsCard),this.retsetSelfCardPool()},i.prototype.initSelect=function(){for(var t,e=this.handsCard.numChildren,i=0;e>i;i++)t=this.handsCard.getChildAt(i),t.setSelect(!1)},i.prototype.disposeHandCards=function(){for(var t,e=this.handsCard.numChildren,i=e-1;i>=0;i--)t=this.handsCard.getChildAt(i),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.setInitY(),t.destory(),t=null;uniLib.DisplayUtils.removeAllChildren(this.handsCard),this.draggedObjectDel&&(this.draggedObjectDel.destory(),this.draggedObjectDel=null),this.draggedObject=null,this.handCardsArr=[]},i.prototype.refreshHandCards=function(e,i){void 0===e&&(e=0),void 0===i&&(i=null),clearTimeout(this.timeOuttimerId),1==e&&(this.removeWaitObj(),this.dispatchEventWith(t.UIEventConsts.USER_DODISCARD_FAIL,!1,i),clearTimeout(this.waitObjtimerId)),this.curIndex=3*this.displayCardsMc.numChildren,this.OrginLocation=[],this.disposeHandCards(),this.handCardsArr=t.CardInfo.getInstance().getHandCardBySeat(0);for(var n=0;n<this.handCardsArr.length;n++)this.setSigleCard(n,this.handCardsArr[n]);this.resetHandleCardPos(),this.displayCardsMc.numChildren>0?this.initPoint.x=this.displayPos.x+this.displayCardsMc.width+20-3*this.displayCardsMc.numChildren*this.stepX:this.initPoint.x=this.defaultPoint.x,this.sortCard()},i.prototype.selectGoldOut=function(){this.initSelect();for(var e,i=t.GameData.getInstance().goldOutCardSet,n=this.handsCard.numChildren,s=0;n>s;s++)e=this.handsCard.getChildAt(s),this.isInclude(e.data,i)&&e.setSelect(!0)},i.prototype.getSelectCard=function(){return this.selectCard?this.selectCard.data+"":""},i.prototype.isInclude=function(t,e){for(var i=!1,n=0;n<e.length;n++)t==e[n]&&(i=!0);return i},i.prototype.addListenMark=function(){this._mask=uniLib.DisplayUtils.createMask(.5,this.handsCard.width,this.handsCard.height),this._mask.x=this.initPoint.x,this._mask.y=this.initPoint.y,this._mask.touchEnabled=!0,this.addChild(this._mask)},i.prototype.removeListenMark=function(){uniLib.DisplayUtils.removeFromParent(this._mask)},i.prototype.addHostMask=function(){this.hostMask||(this.hostMask=t.ResUtil.createBitmapByName("host_mask"),this.hostMask.x=(uniLib.Global.screenWidth-this.hostMask.width)/2,this.hostMask.y=this.initPoint.y-this.hostMask.height+20,this.addChild(this.hostMask),this.hostMask.touchEnabled=!0,this.hostMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hostMaskTouch,this))},i.prototype.removeHostMask=function(){this.hostMask&&(this.hostMask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hostMaskTouch,this),uniLib.DisplayUtils.removeFromParent(this.hostMask)),this.hostMask=null},i.prototype.hostMaskTouch=function(e){this.dispatchEventWith(t.UIEventConsts.ACTION_HOST)},i.prototype.destory=function(){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._mask&&(uniLib.DisplayUtils.removeAllChildren(this._mask),uniLib.DisplayUtils.removeFromParent(this._mask)),this._mask=null,this.hostMask&&(this.hostMask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hostMaskTouch,this),uniLib.DisplayUtils.removeFromParent(this.hostMask)),this.hostMask=null,this.draggedObject&&(uniLib.DisplayUtils.removeAllChildren(this.draggedObject),uniLib.DisplayUtils.removeFromParent(this.draggedObject)),this.draggedObject=null,this.retsetSelfCardPool();var t;for(this.handsCard.numChildren;this.handsCard.numChildren>0;)t=this.handsCard.getChildAt(this.handsCard.numChildren-1),t&&(t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.destory());t=null,e.prototype.destory.call(this)},i.prototype.checkListenCards=function(){var e=this;e.selectCard&&(this.dispatchEventWith(t.UIEventConsts.REMOVE_READYHAND,!1,this.selectCard.data),setTimeout(function(){if(e.selectCard&&0==e.isDisCarding&&t.RoomInfo.getInstance().last_SendCardMahjong&&t.RoomInfo.getInstance().last_SendCardMahjong.listenSet){e.showListenIcon();for(var i=0;i<t.RoomInfo.getInstance().last_SendCardMahjong.listenSet.length;i++)if(Number(t.RoomInfo.getInstance().last_SendCardMahjong.listenSet[i].toString().slice(0,2))==Number(e.selectCard.data.toString().slice(0,2))){var n=new Cmd.ListenObjMahjongCmd_C;return n.thisId=e.selectCard.data,uniLib.NetMgr.tcpSend(n),void e.selectCard.showListenIcon()}}},100))},i.prototype.getSelectCardThisId=function(){return this.selectCard?this.selectCard.data:0},i.prototype.showListenIcon=function(e){if(void 0===e&&(e=0),t.CardInfo.getInstance().drawData.listenSet){this.cacheAsBitmap=!1;for(var i=0;i<t.CardInfo.getInstance().drawData.listenSet.length;i++){var n=this.getHansCardById(t.CardInfo.getInstance().drawData.listenSet[i]);if(n)if(e)for(var s=this.getHandsCardByThisIDToBaseId(n.data),a=0;a<s.length;a++)s[a].data===e?s[a].hideListenIcon():s[a].showListenIcon();else for(var s=this.getHandsCardByThisIDToBaseId(t.CardInfo.getInstance().drawData.listenSet[i]),a=0;a<s.length;a++)this.selectCard?this.selectCard.data!=s[a].data&&s[a].showListenIcon():s[a].showListenIcon()}}},i.prototype.hideListenIcon=function(){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.listenSet)for(var e=0;e<t.CardInfo.getInstance().drawData.listenSet.length;e++){var i=this.getHansCardById(t.CardInfo.getInstance().drawData.listenSet[e]);i&&i.hideListenIcon(!0)}},i.prototype.getHansCardById=function(t){for(var e=0;e<this.handsCard.numChildren;e++){var i=this.handsCard.getChildAt(e);if(i.data==t)return i}return null},i.prototype.getHandsCardByThisIDToBaseId=function(t){for(var e=[],i=0;i<this.handsCard.numChildren;i++){var n=this.handsCard.getChildAt(i);Math.floor(n.data/10)==Math.floor(t/10)&&e.push(n)}return e},i.prototype.showUserHandCard=function(e,i,n){if(void 0===n&&(n=!1),t.RoomInfo.getInstance().GM_Mode||n){this.curIndex=3*this.displayCardsMc.numChildren,this.OrginLocation=[],this.disposeHandCards();for(var s=0;s<i.length;s++)this.setSigleCard(s,i[s],!0);for(var a=t.CardInfo.getInstance().getHandCardBySeat(e),s=0;s<a.length;s++)ArrayUtil.isInArray(a[s],i)||this.setSigleCard(s,this.handCardsArr[s]);this.resetHandleCardPos(!0)}},i.prototype.resetPoint=function(){this.initPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.displayPos=new egret.Point(60*t.GameConst.scaleFactor,640-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.defaultPoint=new egret.Point(20*t.GameConst.scaleFactor,580-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1))},i}(t.UserSideCard);t.UserSideCard0=e,__reflect(e.prototype,"game.UserSideCard0")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.defaultPoint=i.initPoint=new egret.Point(1070*t.GameConst.scaleFactor,510-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.stepX=0,i.stepY=-32,i.takeCardStepX=0,i.takeCardStepY=-10,i.userSeat=1,i.displayPos=new egret.Point(1070*t.GameConst.scaleFactor,530-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(i.stepY=-36),i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepX=0,this.outPutCards.stepY=-38,this.outPutCards.lineX=57,this.outPutCards.lineY=0,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point(860+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,t.ResUtil.changeYAxis(420)),this.outPutCards.numArr=[20,20,20]):(this.outPutCards.initPoint=new egret.Point(900*t.GameConst.scaleFactor,510-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.resetPoint=function(){this.defaultPoint=this.initPoint=new egret.Point(1070*t.GameConst.scaleFactor,510-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(this.stepY=-36)},i}(t.UserSideCard);t.UserSideCard1=e,__reflect(e.prototype,"game.UserSideCard1")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.defaultPoint=i.initPoint=new egret.Point(850*t.GameConst.scaleFactor,12),i.stepX=-44,i.stepY=0,i.takeCardStepX=-10,i.takeCardStepY=0,i.userSeat=2,i.displayPos=new egret.Point(850*t.GameConst.scaleFactor,17),1==t.RoomInfo.getInstance().video&&(i.stepX=-42),i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepY=0,this.outPutCards.lineX=0,this.outPutCards.stepX=-44,this.outPutCards.lineY=-52,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1280)/2+960,180),this.outPutCards.numArr=[18,18,18]):(this.outPutCards.initPoint=new egret.Point((uniLib.Global.screenWidth-1280)/2+824,180),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.resetPoint=function(){this.defaultPoint=this.initPoint=new egret.Point(850*t.GameConst.scaleFactor,12)},i}(t.UserSideCard);t.UserSideCard2=e,__reflect(e.prototype,"game.UserSideCard2")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.defaultPoint=i.initPoint=new egret.Point(190*t.GameConst.scaleFactor,100-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),i.stepX=0,i.stepY=32,i.takeCardStepX=0,i.takeCardStepY=10,i.userSeat=3,i.displayPos=new egret.Point(190*t.GameConst.scaleFactor,80-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(i.stepY=36,i.displayPos.y=i.initPoint.y=40),i.initOutPutCards(),i}return __extends(i,e),i.prototype.initOutPutCards=function(){this.displayCardsMc.x=this.displayPos.x,this.displayCardsMc.y=this.displayPos.y,this.outPutCards.stepX=0,this.outPutCards.stepY=38,this.outPutCards.lineX=-58,this.outPutCards.lineY=0,2==t.RoomInfo.getInstance().playerNumber?(this.outPutCards.initPoint=new egret.Point(340+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,155),this.outPutCards.numArr=[20,20,20]):(this.outPutCards.initPoint=new egret.Point(340*t.GameConst.scaleFactor,155-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),this.outPutCards.numArr=[10,10,10]),this.outPutCards.type=this.userSeat,this.outPutCards.initCards()},i.prototype.resetPoint=function(){this.defaultPoint=this.initPoint=new egret.Point(190*t.GameConst.scaleFactor,100-t.CardMJ.CardHeight*(t.GameConst.scaleFactor-1)),1==t.RoomInfo.getInstance().video&&(this.stepY=36,this.displayPos.y=this.initPoint.y=40)},i}(t.UserSideCard);t.UserSideCard3=e,__reflect(e.prototype,"game.UserSideCard3")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new DissPanel_2d5_new_Skin,t.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onAgreeHandler,t),t.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onRefuse,t),t}return __extends(i,e),i.prototype.stopTimer=function(){this._timer&&(this._timer.removeEventListener(egret.TimerEvent.TIMER,this.timerHandle,this),this._timer.stop(),this._timer=null)},i.prototype.timerHandle=function(e){var i=new Date,n=i.getTime(),s=this._totalTime-(n-this._startTime)/1e3;s>0?this._timeTxt.text=Math.floor(this._totalTime-(n-this._startTime)/1e3).toString():this.dispatchEventWith(t.UIEventConsts.CLOSE)},i.prototype.setData=function(e){if(this._dissGame=1,e.waitTime){this._dissGame=0,this._totalTime=e.waitTime,this.stopTimer();var i=new Date;this._startTime=i.getTime(),this._timer=new egret.Timer(200,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.timerHandle,this),this._timer.start(),this._timeTxt.text=this._totalTime.toString()}var n=t.RoomInfo.getInstance().getUserVoByUid(e.uid);n&&(e.waitTime?this.info.textFlow=[{text:"玩家",style:{textColor:8345395}},{text:"<"+n.nickName+">",style:{textColor:14638603}},{text:"申请解散房间是否同意？",style:{textColor:8345395}},{text:"\n(超过"+e.waitTime+"s未作出选择，则默认同意)",style:{textColor:8345395,size:20}}]:this.info.textFlow=[{text:"玩家",style:{textColor:8345395}},{text:"<"+n.nickName+">",style:{textColor:14638603}},{text:"申请将房间人数设置为"+t.RoomInfo.getInstance().userList.length,style:{textColor:8345395}}]),this.playerList=[];for(var s=t.RoomInfo.getInstance().userList,a=0;a<s.length;a++)if(s[a]){var o=new eui.ItemRenderer;o.skinName=new DissmissPanelListItem_2d5_new_Skin,o.nameLabel.text="<"+s[a].nickName+">",o.stateLabel.text="等待选择",e.uid==s[a].uid&&(o.stateLabel.text="已同意",o.stateLabel.textColor=3450744),e.waitTime&&this.playerListGroup.addChild(o);var r={};r.id=s[a].uid,r.item=o,this.playerList.push(r)}e.uid==uniLib.UserInfo.uid&&this.enableBtns()},i.prototype.enableBtns=function(){this.yesBtn.currentState="disabled",this.yesBtn.horizontalCenter="0",this.noBtn.visible=!1},i.prototype.updateStatus=function(t,e){for(var i=0,n=this.playerList;i<n.length;i++){var s=n[i];1==t&&s.id==e&&(s.item.stateLabel.text="已同意",s.item.stateLabel.textColor=3450744)}uniLib.UserInfo.uid==e&&this.enableBtns()},i.prototype.onAgreeHandler=function(e){0==this._dissGame?this.dispatchEventWith(t.UIEventConsts.DISMISS_BACK,!1,1):this.dispatchEventWith(t.UIEventConsts.AGREE_CHANGE_USERNUM,!1,1)},i.prototype.onRefuse=function(e){0==this._dissGame?this.dispatchEventWith(t.UIEventConsts.DISMISS_BACK,!1,0):this.dispatchEventWith(t.UIEventConsts.AGREE_CHANGE_USERNUM,!1,0)},i.prototype.destory=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeHandler,this),this.noBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefuse,this),this._timer&&(this._timer.removeEventListener(egret.TimerEvent.TIMER,this.timerHandle,this),this._timer.stop()),this._timer=null,this.info=null,this._timeTxt=null},i}(eui.Component);t.DismissPanel=e,__reflect(e.prototype,"game.DismissPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this.chatGroup=[],this.chatCoverGroup=[];for(var t=0;6>t;t++)this.creatChatItem(t)},i.prototype.creatChatItem=function(e){var i=t.ResUtil.createBitmapByName("chat_select");i.x=420,i.y=61+56*e,i.width=460,i.height=30,i.visible=!1,i.name="short_chatbg",this.addChild(i);var n=t.ResUtil.createTextFeild(1456961,egret.HorizontalAlign.LEFT,"",28,420,61+56*e,i.width);n.text=e+1+"."+t.GameData.getInstance().ShortTalkArr[e],this.addChild(n);var s=uniLib.DisplayUtils.createMask(0,i.width,i.height,0);s.name="short_"+e,s.x=420,s.y=56*(e+1),s.touchEnabled=!0,this.addChild(s),this.chatGroup.push(i),this.chatCoverGroup.push(s),s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickBegin,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),s.addEventListener(egret.TouchEvent.TOUCH_END,this.onClickEnd,this),s.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onClickEnd,this)},i.prototype.onClick=function(e){var i="2"+e.target.name.charAt(6);this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_CHAT,!1,i)},i.prototype.onClickBegin=function(t){var e=Number(t.target.name.charAt(6));this.chatGroup[e].visible=!0},i.prototype.onClickEnd=function(t){var e=Number(t.target.name.charAt(6));this.chatGroup[e].visible=!1},i.prototype.destory=function(){for(var t=0;t<this.chatCoverGroup.length;t++){var e=this.chatCoverGroup[t];e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickBegin,this),e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClickEnd,this),uniLib.DisplayUtils.removeAllChildren(e),uniLib.DisplayUtils.removeFromParent(e)}uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this.chatGroup=[],this.chatCoverGroup=[]},i}(t.BaseVc);t.ChatItem=e,__reflect(e.prototype,"game.ChatItem")}(game||(game={}));var GameViewType;!function(t){t[t.viewType_2d=0]="viewType_2d",t[t.viewType_2d5=1]="viewType_2d5"}(GameViewType||(GameViewType={}));var game;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"scaleFactor",{get:function(){return uniLib.Global.screenWidth/1280},enumerable:!0,configurable:!0}),t
}();e.viewType=GameViewType.viewType_2d5,e.revengeStr="pu",e.commonChatStr="",e.viewChange=!1,e.MaJiongChange=!1,e.selfResName="self_res",e.openDialect=!1,t.GameConst=e,__reflect(e.prototype,"game.GameConst")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new Chat_2d5_new_Skin,t.initUI(),t}return __extends(i,e),i.prototype.initUI=function(){for(var e=1;31>=e;e++){var i=new eui.RadioButton;i.skinName=new FaceButton_2d5_new_Skin,i.iconDisplay.texture=RES.getRes("face"+e),i.groupName="face",i.value=e,this.faceGroup.addChild(i)}for(var e=0;12>e;e++){var n=new eui.RadioButton;n.skinName=new ChatRadioButton_2d5_new_Skin,n.groupName="chat",n.value=e,n.label=e+1+"."+t.GameData.getInstance().ShortTalkArr[e],n.y=56*e,this.chatGroup.addChild(n)}this.touchEnabled=!1,this.chatScroller.visible=!0,this.btnGroup=[],this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.faceGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceGroupTap,this),this.chatGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatGroupTap,this),this.textField.name="short_input",this.textField.size=28,this.textField.type=egret.TextFieldType.INPUT,this.textField.text="请输入聊天内容",this.touchEnabled=!0,this.textField.addEventListener(egret.FocusEvent.FOCUS_IN,this.onTextFieldFocusIn,this),this.textField.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onTextFieldFocusOut,this),this.sendBtn.name="short_send",this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendClickHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},i.prototype.onChatGroupTap=function(e){var i=e.target;if(i instanceof eui.RadioButton){var n="2"+i.value;this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_CHAT,!1,n)}},i.prototype.onFaceGroupTap=function(e){var i=e.target;if(i instanceof eui.RadioButton){var n="1"+i.value;this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_CHAT,!1,n)}},i.prototype.onTouchTap=function(t){t.target==this.textField&&t.target.setFocus()},i.prototype.sendClickHandler=function(e){var i=this.textField.text;return-1!=i.indexOf("请输入聊天内容")?void(this.textField.text=""):(this.dispatchEventWith(t.UIEventConsts.SEND_COMMON_TALK,!1,i),void(this.textField.text=""))},i.prototype.onTextFieldFocusIn=function(t){t.target.setFocus(),-1!=this.textField.text.indexOf("请输入聊天内容")&&(this.textField.text="")},i.prototype.onTextFieldFocusOut=function(t){""==this.textField.text&&(this.textField.text="请输入聊天内容")},i.prototype.btnClickHandler=function(t){var e=t.currentTarget.name;switch(e){case"short_chat":this.initBarStatus(),this.btnGroup[0].select=!0,this._yetOpen&&(this._yetOpen.visible=!1);break;case"short_record":this.initBarStatus(),this.btnGroup[1].select=!0,this.createRecordYetOpen()}},i.prototype.createRecordYetOpen=function(){this._yetOpen||(this._yetOpen=t.ResUtil.createTextFeild(1456961,egret.HorizontalAlign.CENTER,"此功能暂未开放",30),this.addChild(this._yetOpen),this._yetOpen.x=540,this._yetOpen.y=280),this._yetOpen.visible=!0},i.prototype.createBarBtn=function(e,i,n,s,a,o){var r=new t.ToggleButton(e,i,"",n);r.select=s,r.x=a,r.y=o,this.addChild(r),this.btnGroup.push(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this)},i.prototype.initBarStatus=function(){for(var t=0;t<this.btnGroup.length;t++){var e=this.btnGroup[t];e.select=!1}},i.prototype.destory=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this);for(var t=0;t<this.btnGroup.length;t++){var e=this.btnGroup[t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClickHandler,this)}this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.faceGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceGroupTap,this),this.chatGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatGroupTap,this),this.textField.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onTextFieldFocusIn,this),this.textField.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onTextFieldFocusOut,this),this.sendBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.sendClickHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.sendBtn=null,uniLib.DisplayUtils.removeAllChildren(this._content),uniLib.DisplayUtils.removeFromParent(this._content),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.setRecordData=function(t){},i.prototype.onClose=function(e){this.visible=!1,t.PopupManager.removePopUp(this)},i}(eui.Component);t.RoomFacePanel=e,__reflect(e.prototype,"game.RoomFacePanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new GameHelp_HZ_Skin,t.initUI(),t}return __extends(i,e),Object.defineProperty(i,"Instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.initUI=function(){this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this);var e="",i=t.RoomInfo.getInstance().getPlayTypeByList();if(i.length<=0)return void(this.ruleTxt.text="房主什么都没选择,你们随意");for(var n=0;n<i.length;n++)e=e+i[n]+"  ";this.ruleTxt.text=e},i.prototype.destory=function(){this.closeButton&&this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.closeHandle=function(e){console.error("@@@@@@"),this.dispatchEventWith(t.UIEventConsts.CLOSE)},i.prototype.addUserGpsIcon=function(t){for(var e=[[1,2,3],[0,2,3],[0,1,3],[0,1,2]],i=e[t],n=0;n<i.length;n++)this.addUserBySeatId(t,i[n])},i.prototype.addUserBySeatId=function(e,i){var n="";n=i>e?e+""+i:i+""+e;var s=-1,a=t.RoomInfo.getInstance().getUserIdBySeatNo(e),o=t.RoomInfo.getInstance().getUserIdBySeatNo(i);if(0!=a){var r=t.RoomInfo.getInstance().getUserVoByUid(a);if(r.headUrl){var h=this["headImage_"+e],d=this["headBg_"+e],l=this["playerName_"+e],c=this["address_"+e];h.visible=!0,h.source=r.headUrl,l.text=r.nickName,c.text=r.address?r.address:"未获取到具体位置信息",d.visible=!0}}if(0!=o){var u=t.RoomInfo.getInstance().getUserVoByUid(o);u.address&&(this["address_"+i].text=u.address)}if(0!==a&&0!==o){var _=t.RoomInfo.getInstance().getUserVoByUid(o);if(r.lat&&r.lng&&_.lat&&_.lng&&(s=Math.floor(uniLib.Utils.getDistance(r.lat,r.lng,_.lat,_.lng))),s){var g="";g=s>1e3?Math.floor(s/1e3)+"km":s.toString()+"m"}var p=this["distance_"+n],C=this["line_"+n],m=this["lineBg_"+n];p.visible=!0,C.visible=!0,m.visible=!0,p.text=g,0>=s&&(p.text="?")}},i.prototype.reset=function(){for(var t=0;4>t;t++)this.removePlayer(t)},i.prototype.removePlayer=function(t){if(!isNaN(t))for(var e=[[1,2,3],[0,2,3],[0,1,3],[0,1,2]],i=e[t],n=0;n<i.length;n++)this.removeLine(t,i[n])},i.prototype.removeLine=function(t,e){var i="";i=e>t?t+""+e:e+""+t;var n=this["distance_"+i],s=this["line_"+i],a=this["lineBg_"+i],o=this["headImage_"+t],r=this["headBg_"+t],h=this["playerName_"+t],d=this["address_"+t];n.visible=!1,s.visible=!1,a.visible=!1,n.text="",o.visible=!1,r.visible=!1,h.text="",d.text=""},i}(eui.Component);t.gameHelpPanel=e,__reflect(e.prototype,"game.gameHelpPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._noticeArr=[],t}return __extends(i,e),i.prototype.initUI=function(){this._buffer=30;var e=t.ResUtil.createBitmapByName("mjl_lobby_systembg");e.scale9Grid=new egret.Rectangle(100,41,14,23),e.width=924,this._txtWidth=828,this.addChild(e),this._msgTxt=t.ResUtil.createTextFeild(16777215,egret.HorizontalAlign.LEFT,"系统公告",32,55,33),this._msgTxt.multiline=!1,uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_GM,this.onNoticeCome,this),uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_HORN,this.onNoticeCome,this),uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_SYSTEM,this.onNoticeCome,this),uniLib.Global.addEventListener(uniLib.ZqEvent.CHAT_IMPORTANT,this.onNoticeCome,this),this._txtMc=new egret.DisplayObjectContainer,this._txtMc.addChild(this._msgTxt),this._txtMc.x=75,this.addChild(this._txtMc),this._txtMc.scrollRect=new egret.Rectangle(0,0,this._txtWidth,e.height),this.visible=!1},i.prototype.startScroll=function(){this.visible=!0,egret.Tween.removeTweens(this._msgTxt),this._msgTxt.x=this._txtWidth+this._buffer;var t=this._msgTxt.textWidth<this._txtWidth?this._txtWidth:this._msgTxt.textWidth;egret.Tween.get(this._msgTxt).to({x:-(this._msgTxt.textWidth+this._buffer)},20*(t+this._buffer)).call(this.scrollEnd,this)},i.prototype.scrollEnd=function(){egret.Tween.removeTweens(this._msgTxt),this.visible=!1},i.prototype.onNoticeCome=function(t){var e=t.param;null==this._noticeArr&&(this._noticeArr=[]),this._noticeArr.push(e.info),this._msgTxt.text=this._noticeArr.shift(),this.startScroll()},i.prototype.destory=function(){e.prototype.destory.call(this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_GM,this.onNoticeCome,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_HORN,this.onNoticeCome,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_SYSTEM,this.onNoticeCome,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.CHAT_IMPORTANT,this.onNoticeCome,this),this.scrollEnd(),this._txtMc&&(uniLib.DisplayUtils.removeAllChildren(this._txtMc),uniLib.DisplayUtils.removeFromParent(this._txtMc)),this._txtMc=null,this._msgTxt=null,this._noticeArr=null},i}(t.BaseVc);t.GameSysMsg=e,__reflect(e.prototype,"game.GameSysMsg")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new GpsPanel_2d5_new_Skin,t.initUI(),t}return __extends(i,e),Object.defineProperty(i,"Instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.initUI=function(){this.updateGpsAdd(),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),this.gameContinueBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),this.gameDissBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dissRoom,this);var e="",i=t.RoomInfo.getInstance().getPlayTypeByList();if(i.length<=0)return void(this.ruleTxt.text="房主什么都没选择,你们随意");for(var n=0;n<i.length;n++)e=e+i[n]+"  ";this.ruleTxt.text=e},i.prototype.updataGroupVisible=function(t){this.ruleGroup.visible=t,this.buttonGroup.visible=!t},i.prototype.updateGpsAdd=function(){var e=t.RoomInfo.getInstance().playerNumber;this.gpsGroup.y=3==e?90:158,this.gpsTips.visible=2==e?!0:!1},i.prototype.destory=function(){this.closeButton&&this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),this.gameContinueBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandle,this),this.gameDissBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.dissRoom,this),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i.prototype.closeHandle=function(e){this.dispatchEventWith(t.UIEventConsts.CLOSE)},i.prototype.dissRoom=function(){this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME,!1,1)},i.prototype.addUserGpsIcon=function(t){var e=[[2,3],[1,3],[1,2]];if(0!=t)for(var i=e[t-1],n=0;n<i.length;n++)this.addUserBySeatId(t,i[n])},i.prototype.addUserBySeatId=function(e,i){var n=2!=t.RoomInfo.getInstance().playerNumber?!0:!1,s="";s=i>e?e+""+i:i+""+e;var a=-1,o=t.RoomInfo.getInstance().getUserIdBySeatNo(e),r=t.RoomInfo.getInstance().getUserIdBySeatNo(i);if(0!=o){var h=t.RoomInfo.getInstance().getUserVoByUid(o);if(h.headUrl){var d=this["head_"+e],l=d.headImage,c=this["playerName_"+e],u=this["address_"+e];d.visible=l.visible=n?!0:!1,l.source=h.headUrl,c.text=n?h.nickName:"",u.text=n&&h.address?h.address:""}}if(0!=r){var _=t.RoomInfo.getInstance().getUserVoByUid(r);_.address&&(this["address_"+i].text=_.address)}if(0!==o&&0!==r){var g=t.RoomInfo.getInstance().getUserVoByUid(r);if(h.lat&&h.lng&&g.lat&&g.lng&&(a=Math.floor(uniLib.Utils.getDistance(h.lat,h.lng,g.lat,g.lng))),a){var p="";p=a>1e3?Math.floor(a/1e3)+"km":a.toString()+"m"}var C=this["distance_"+s],m=this["line_"+s],v=this["lineBg_"+s];C.visible=m.visible=v.visible=n?!0:!1,C.text=p,0>=a&&(C.text="?")}},i.prototype.reset=function(){for(var t=0;4>t;t++)this.removePlayer(t)},i.prototype.removePlayer=function(t){if(!isNaN(t)){var e=[[2,3],[1,3],[1,2]];if(0!=t)for(var i=e[t-1],n=0;n<i.length;n++)this.removeLine(t,i[n])}},i.prototype.removeLine=function(t,e){var i="";i=e>t?t+""+e:e+""+t;var n=this["distance_"+i],s=this["line_"+i],a=this["lineBg_"+i],o=this["head_"+t],r=o.headImage,h=this["playerName_"+t],d=this["address_"+t];n.visible=!1,s.visible=!1,a.visible=!1,n.text="",r.visible=!1,o.visible=!1,h.text="",d.text=""},i}(eui.Component);t.GpsPanel=e,__reflect(e.prototype,"game.GpsPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._step=.1,"yellow_"==t.ColorConst.color?(i._lightPosArr=[new egret.Point(13,92),new egret.Point(95,13),new egret.Point(12,7),new egret.Point(8,12)],i._dirPosArr=[new egret.Point(65,106),new egret.Point(109,66),new egret.Point(65,20),new egret.Point(20,66)]):(i._lightPosArr=[new egret.Point(0,0),new egret.Point(0,0),new egret.Point(0,0),new egret.Point(0,0)],i._dirPosArr=[new egret.Point(54,86),new egret.Point(86,54),new egret.Point(54,22),new egret.Point(22,54)]),i}return __extends(i,e),i.prototype.initLight=function(e){this._seatId=e,this._highLight||(this._highLight=t.ResUtil.createBitmapByName("count_light"+(e+1)),this.addChild(this._highLight)),this._highLight.x=this._lightPosArr[e].x,this._highLight.y=this._lightPosArr[e].y,this._highLight.visible=!1},i.prototype.setDir=function(e){this._grayDirIcon?this._grayDirIcon.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_direction"+e+"1"):(this._grayDirIcon=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_direction"+e+"1"),this.addChild(this._grayDirIcon)),this._grayDirIcon.x=this._dirPosArr[this._seatId].x-Math.round(this._grayDirIcon.width/2),this._grayDirIcon.y=this._dirPosArr[this._seatId].y-Math.round(this._grayDirIcon.height/2),this._lightDirIcon?this._lightDirIcon.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_direction"+e+"1"):(this._lightDirIcon=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_direction"+e+"1"),this.addChild(this._lightDirIcon)),this._lightDirIcon.x=this._grayDirIcon.x,this._lightDirIcon.y=this._grayDirIcon.y,this._lightDirIcon.visible=!1},i.prototype.flash=function(t){void 0===t&&(t=0),this.stopTimer(),this._highLight.visible=!0,this._lightDirIcon.visible=!0,this._highLight.alpha=1,1==t},i.prototype.onTimer=function(t){this._highLight.alpha>=1?this._step=-Math.abs(this._step):this._highLight.alpha<=0&&(this._step=Math.abs(this._step)),this._highLight.alpha+=this._step},i.prototype.stopTimer=function(){this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer=null)},i.prototype.stop=function(){this._highLight.visible=!1,this._lightDirIcon.visible=!1,this.stopTimer()},i.prototype.destory=function(){this.stopTimer(),this._grayDirIcon=null,this._lightDirIcon=null,this._highLight=null},i}(t.BaseVc);t.HighLightItem=e,__reflect(e.prototype,"game.HighLightItem")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new ResultPanel_2d5_new_Skin,t.width=uniLib.Global.screenWidth,t.initUI(),t}return __extends(i,e),i.prototype.destory=function(){this._startBtn&&(this._startBtn.touchEnabled=!1,this._startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReady,this),this._startBtn=null),this._shuffleBtn&&(this._shuffleBtn=null),this._content&&(uniLib.DisplayUtils.removeAllChildren(this._content),uniLib.DisplayUtils.removeFromParent(this._content)),this._changeBtn&&(this._changeBtn.touchEnabled=!1,this._changeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this._changeBtn=null),this._leaveBtn&&(this._leaveBtn.touchEnabled=!1,this._leaveBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeave,this),this._leaveBtn=null),this._shareBtn&&(this._shareBtn.touchEnabled=!1,this._shareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this._shareBtn=null),this._content=null,t.ResUtil.removeAllChildren(this),t.ResUtil.removeFromParent(this),this._data=null},i.prototype.initUI=function(){this.touchEnabled=!0,this.touchChildren=!0,this.addChild(this.titleBg),this._startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReady,this),this._startBtn.name="startButton",this._shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this._shuffleBtn=new t.ShuffleButton,this._shuffleBtn.x=(uniLib.Global.screenWidth-this._shuffleBtn.width)/2+50+300,this._shuffleBtn.y=this._startBtn.y,this.addChild(this._shuffleBtn),this._shuffleBtn.visible=!1,t.RoomInfo.getInstance().playTypeList instanceof Array&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)&&(this._changeBtn.touchEnabled=!0,this._changeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this._leaveBtn||(this._leaveBtn=t.ResUtil.createBitmapByName("game_leaveRoom1",uniLib.Global.screenWidth-224,this._startBtn.y),this._leaveBtn.touchEnabled=!0,this._leaveBtn.x=uniLib.Global.screenWidth-this._leaveBtn.width-150,this._leaveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeave,this),this.addChild(this._leaveBtn),this._leaveBtn.visible=!1)),this._content=new egret.Sprite,this.addChild(this._content),this._content.x=18*t.GameConst.scaleFactor,this._content.y=15},i.prototype.setResultData=function(e){this._horseSet=[],this._winUID=0,this._horseWinNum=0,e.horseSet&&(this._horseSet=e.horseSet),e.winHorse&&(this._horseWinNum=e.winHorse),this.reset(),this._data=e;for(var i=e.rewardSet,n=!1,s=0;s<i.length;s++){var a=i[s];a.uid!=uniLib.NetMgr.UID||1!=a.winType&&2!=a.winType||(n=!0),0!=a.winType?((2==a.winType||1==a.winType)&&(this._winUID=a.uid),this._content.addChild(this.setHandler(0,124*s+110,a,this._data.thisId))):this._content.addChild(this.setHandler(0,124*s+110,a,0))}n?(uniLib.SoundMgr.instance.playSound(t.SoundConsts.WIN),this.titleBg.source="wintitle_2d5"):(uniLib.SoundMgr.instance.playSound(t.SoundConsts.LOSE),this.titleBg.source="losetitle_2d5"),t.RoomInfo.getInstance().host_mode&&egret.setTimeout(this.onReady,this,4e3);var o=t.RoomInfo.getInstance().playTypeList.first(function(t){return 88==t});o&&this.showShuffleBtn(e.shuffleUid,e.shuffleCost),this._content.x=(uniLib.Global.screenWidth-this._content.width)/2},i.prototype.showShuffleBtn=function(t,e){void 0===e&&(e=.1),t==uniLib.NetMgr.UID?(this._shuffleBtn.visible=!0,this._shuffleBtn.updateCost(e)):(this._shuffleBtn.visible=!1,this._startBtn.x=541)},i.prototype.setHandler=function(e,i,n,s){var a=new egret.Sprite;a.x=e,a.y=i;var o;o=n.winType>0?t.ResUtil.createBitmapByName("result_winBg"):t.ResUtil.createBitmapByName("result_loseBg"),o.scale9Grid=new egret.Rectangle(14,39,6,22),o.width=1230,o.height=122,o.x=0,a.addChild(o);var r=t.ResUtil.createTextFeild(4079177,egret.HorizontalAlign.LEFT,"力",20,115,10,810);r.text=n.nickname,r.x=(uniLib.Global.screenWidth-1280)/2+120;var h=new t.HeadMc(60,60),d=t.RoomInfo.getInstance().getUserVoByUid(n.uid);if(d&&(h.headUrl=d.headUrl,h.x=r.x,h.y=r.y+r.height+10),r.text=n.nickname+"     "+this.getRewardDeatail(n),a.addChild(r),a.addChild(h),n.uid==t.RoomInfo.getInstance().bankerId){var l=t.ResUtil.createBitmapByName("bank",150,2);l.scaleX=l.scaleY=.85,l.x=r.x-l.width/2,l.y=h.y-5,a.addChild(l)}if(n.winType>0){var c=new egret.Bitmap;1==n.winType?c=t.ResUtil.createBitmapByName("result_zimo",22,8):2==n.winType?c=t.ResUtil.createBitmapByName("result_win",22,37):3==n.winType&&(c=t.ResUtil.createBitmapByName("result_fangpao",23,30)),a.addChild(c)}var u=new egret.Sprite;u.x=(uniLib.Global.screenWidth-1280)/2+220,u.y=40,a.addChild(u),this.setCardOrder(n.userCard,s,u),this.setFlowerCard(n.userCard.flowerCardSet,u);var _;return n.totalReward>=0?(_=this.createAlignBitmapText("win_fnt","",(uniLib.Global.screenWidth-1280)/2+900,40,65,egret.HorizontalAlign.CENTER),_.text="+"+n.totalReward.toString()):(_=this.createAlignBitmapText("lose_fnt","",(uniLib.Global.screenWidth-1280)/2+900,40,65,egret.HorizontalAlign.CENTER),_.text=n.totalReward.toString()),a.addChild(_),a},i.prototype.onShare=function(t){var e=new uniLib.WXShareVo;e.shareWay=0;var i=new egret.Bitmap(uniLib.DisplayUtils.catchScreenToTex(this,new egret.Rectangle(0,0,this.width,this.height),.6));e.shareImageData=uniLib.DisplayUtils.catchScreen(i,new egret.Rectangle(0,0,this.width,this.height)),uniLib.ZQGameSdk.share(e,null,null)},i.prototype.setCardOrder=function(e,i,n){void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=null);var s,a=[],o=new t.OperatVo;if(e.eatSet&&e.eatSet.length>0)for(var r=0;r<e.eatSet.length;r++)o.setEatData(e.eatSet[r]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getChowCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);if(e.touchSet&&e.touchSet.length>0)for(var h=0;h<e.touchSet.length;h++)o.setPongData(e.touchSet[h]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getPongCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);if(e.barSet&&e.barSet.length>0)for(var d=0;d<e.barSet.length;d++)o.setKongData(e.barSet[d]),o.uid=e.uid,o.seatId=0,s=t.GroupCardsFactory.getInstance().getGangCard(o,!0),0!=n.width&&(s.x=n.width+2),n.addChild(s);e.handCardSet||(e.handCardSet=[]);for(var l=e.handCardSet,c=0;c<l.length;c++){var u=l[c];a.push(u)}if(0!=i){var _=a.indexOf(i);-1!=_&&a.splice(_,1),a.push(i)}for(var g,p=n.width+4,c=0;c<a.length;c++)g=new t.OutPutCard,g.setCard(0,a[c],1,!0),g.x=p+46*c,c==a.length-1&&0!=i&&(g.x+=8),n.addChild(g);if(this._winUID&&this._horseSet&&this._winUID==e.uid){for(var C=670,m=-31,v=0;v<this._horseSet.length;v++){var f=this.crearteHorseCard(this._horseSet[v].thisId,this._horseSet[v].bWin);v%2==0?f.y=m:f.y=f.height+m-10,f.x=C+Math.floor(v/2)*f.width,n.addChild(f)}if(this._horseSet&&this._horseSet.length>0){var y=new egret.Bitmap;y=0==this._horseWinNum?uniLib.DisplayUtils.createBitmapByName("game_bird_notHit"):uniLib.DisplayUtils.createBitmapByName("game_bird_hit"),y.scaleX=.9,y.scaleY=.9,y.x=783,y.y=-28,n.addChild(y)}}},i.prototype.crearteHorseCard=function(e,i){void 0===i&&(i=0);var n=new t.OutPutCard;if(n.setCard(0,e,.9,!0),0==i){var s=new egret.Sprite;s.graphics.beginFill(0,.3),s.graphics.drawRect(0,0,n.width,n.height),s.graphics.endFill(),n.addChild(s)}return n},i.prototype.setFlowerCard=function(e,i){void 0===i&&(i=null);var n,s=0;if(e){s=10;for(var a=0;a<e.length;a++)n=new t.OutPutCard,n.setCard(0,e[a],1,!0),n.x=700+37*a,n.y=s,i.addChild(n)}},i.prototype.onReady=function(){this.dispatchEventWith(t.UIEventConsts.READY)},i.prototype.onChange=function(){this.dispatchEventWith(t.UIEventConsts.EXCHANGE_DESK)},i.prototype.onLeave=function(){this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME,!1,0)},i.prototype.reset=function(){this._data=null,uniLib.DisplayUtils.removeAllChildren(this._content)},i.prototype.createAlignBitmapText=function(t,e,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=-1),void 0===a&&(a="left");var o=new ui.AlignBitmapText;return-1!=s&&(o.width=s),o.font=RES.getRes(t),o.text=e,o.x=i,o.y=n,o.hAlign=a,o},i.prototype.getRewardDeatail=function(t){var e=t.multiDetailSet;if(!e||e.length<=0)return"";for(var i="",n=0;n<e.length;n++){var s=e[n];i=i+" "+this.getRewardTxt(s.multiType,0)+this.getReward(s.reward)}return i},i.prototype.getReward=function(t){var e="";return e=t>=0?"+"+t:t+""},i.prototype.getRewardTxt=function(t,e){void 0===e&&(e=0);var i="";switch(t){case Cmd.MultiType.MahjongMulti_BrightBar:i="明杠";break;case Cmd.MultiType.MahjongMulti_DarkBar:i="暗杠";break;case Cmd.MultiType.MahjongMulti_Horse:i="抓鸟";break;case Cmd.MultiType.MahjongMulti_selfWin:i="自摸";break;case Cmd.MultiType.MahjongMulti_flowerBarWin:i="杠上开花";break;case Cmd.MultiType.MahjongMulti_grabBarWin:i="抢杠和";break;case Cmd.MultiType.MahjongMulti_NoGoldCard:i="无鬼";break;case 8:i="放炮";break;default:i=""}return i},i}(t.BaseComponent);t.ResultPanel=e,__reflect(e.prototype,"game.ResultPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.row=10,t.btnGroup=[],t.initWidth=230,t.initHeight=50,t.createScene(),t}return __extends(i,e),i.prototype.createScene=function(){this.name="chat",this.content=uniLib.DisplayUtils.createMask(.5,1280,350,0),this.content.name="chat_bg",this.content.touchEnabled=!0,this.content.touchChildren=!0,this.addChild(this.content),this.btnPanel=uniLib.DisplayUtils.createMask(.3,1280,200,0),this.btnPanel.y=350,this.addChild(this.btnPanel),this.cardsGroup=[],this.content.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)},i.prototype.removeListener=function(){this.content.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)},i.prototype.touchHandler=function(e){var i=e.target.name;if(this.selectCard&&this.selectCard.name==i)this.setSelectMode(this.selectCard,!1),this.selectCard=null;else if(this.selectCard&&this.selectCard.name!=i)this.setSelectMode(this.selectCard,!1),this.selectCard=this.content.getChildByName(i),this.setSelectMode(this.selectCard,!0);else{if(this.selectCard=this.content.getChildByName(i),null==this.selectCard)return;this.setSelectMode(this.selectCard,!0);var n=t.MahJongFourFacede.getInstance().retrieveMediator(t.HNHZGameMJMediator.NAME),s=n.getViewComponent();s.dispatchEventWith(t.UIEventConsts.GM_SELECT_HEAPCARD,!1,this.getSelectCard())}},i.prototype.setTypeButton=function(t){this.clearTypeButton();for(var e=0,i=Math.ceil(t.length/this.row),n=0;i>n;n++)for(var s=0;s<this.row;s++){var a=t[e];if(a){var o=this.creatBtn(a);o.x=80+120*s,o.y=20+30*n}e++}},i.prototype.creatBtn=function(t){var e=uniLib.DisplayUtils.createMask(1,100,25,16418329);e.name=t.id.toString(),e.touchEnabled=!0,this.btnPanel.addChild(e);var i=uniLib.DisplayUtils.createTextLabel(16777215,egret.HorizontalAlign.CENTER,t.value,16,100,25);return i.y=3,e.addChild(i),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnTypeHandler,this),this.btnGroup.push(e),e},i.prototype.btnTypeHandler=function(e){var i=e.target.name,n=t.MahJongFourFacede.getInstance().retrieveMediator(t.HNHZGameMJMediator.NAME),s=n.getViewComponent();s.dispatchEventWith(t.UIEventConsts.GM_SELECT_CARDS,!1,Number(i))},i.prototype.clearTypeButton=function(){for(var t=0;t<this.btnGroup.length;t++){var e=this.btnGroup[t];e&&(e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnTypeHandler,this),uniLib.DisplayUtils.removeAllChildren(e),uniLib.DisplayUtils.removeFromParent(e))}uniLib.DisplayUtils.removeAllChildren(this.btnPanel),this.btnGroup=[]},i.prototype.setHeapCard=function(e){if(this.clearHeapCard(),e||!(e.length<=0)){e.sort(function(t,e){return t>e?1:t==e?0:-1});for(var i=0;i<e.length;i++){var n=table.TableCard.selectByThisId(e[i]),s=table.TableCard.resPutOut(n.cardId,0),a=t.ResUtil.createBitmapByName(s);a.name=n.thisId+"",a.touchEnabled=!0,20>i?(a.x=this.initWidth+40*i,a.y=this.initHeight):i>=20&&40>i?(a.x=this.initWidth+40*(i-20),a.y=this.initHeight+70):i>=40&&60>i?(a.x=this.initWidth+40*(i-40),a.y=this.initHeight+140):i>=60&&80>i?(a.x=this.initWidth+40*(i-60),a.y=this.initHeight+210):i>=80&&100>i?(a.x=this.initWidth+40*(i-80),a.y=this.initHeight+280):i>=100&&120>i?(a.x=this.initWidth+40*(i-100),a.y=this.initHeight+350):i>=120&&140>i?(a.x=this.initWidth+40*(i-120),a.y=this.initHeight+420):i>=140&&(a.x=this.initWidth+40*(i-140),a.y=this.initHeight+490),this.cardsGroup.push(a),this.content.addChild(a)}}},i.prototype.clearHeapCard=function(){for(var t=0;t<this.cardsGroup.length;t++){var e=this.cardsGroup[t];uniLib.DisplayUtils.removeFromParent(e)}this.selectMode&&uniLib.DisplayUtils.removeFromParent(this.selectMode),this.selectMode=null,uniLib.DisplayUtils.removeAllChildren(this.content),this.cardsGroup=[],this.selectCard=null},i.prototype.setSelectMode=function(e,i){i?(this.selectMode=t.ResUtil.createBitmapByName("GoldIcon2"),this.selectMode.x=e.x,this.selectMode.y=e.y,this.content.addChild(this.selectMode)):(this.selectMode&&uniLib.DisplayUtils.removeFromParent(this.selectMode),this.selectMode=null)},i.prototype.getSelectCard=function(){return this.selectCard?this.selectCard.name:""},i.prototype.onKeyDown=function(t){},i.prototype.onBtnClick=function(t){},i.prototype.createBitmapByName=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=new egret.Bitmap,s=RES.getRes(t);return n.texture=s,n.smoothing=!0,n.x=e,n.y=i,n},i.prototype.destory=function(){this.removeListener(),this.clearHeapCard(),this.clearTypeButton(),this.content&&(uniLib.DisplayUtils.removeAllChildren(this.content),uniLib.DisplayUtils.removeFromParent(this.content)),this.content=null,this.btnPanel&&(uniLib.DisplayUtils.removeAllChildren(this.btnPanel),uniLib.DisplayUtils.removeFromParent(this.btnPanel)),this.btnPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.RoomGmTool=e,__reflect(e.prototype,"game.RoomGmTool");var i=function(t){function e(){var e=t.call(this)||this;return e.inputs=[],e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this;document.onkeydown=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];t.handlekeydown(n),t.inputs.length>0&&t.dispatchEventWith(e.onkeydown,!0,t.inputs,!0)},document.onkeyup=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];t.handlekeyup(n),t.inputs.length>0&&t.dispatchEventWith(e.onkeyup,!0,t.inputs,!0)},document.onmousedown=function(e){t.inputs=[]}},e.prototype.handlekeydown=function(t){t.key==e.CnterEnter&&this.checkInput(e.CnterEnter)},e.prototype.handlekeyup=function(t){t.key==e.CnterEnter&&this.removeByKey(e.CnterEnter)},e.prototype.checkInput=function(t){for(var e=!1,i=0;i<this.inputs.length;i++)this.inputs[i]==t&&(e=!0);e||this.inputs.push(t)},e.prototype.removeByKey=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e]==t&&this.inputs.splice(e,1)},e.prototype.isContain=function(t,e){for(var i=!1,n=0;n<t.length;n++)t[n]==e&&(i=!0);return i},e}(egret.EventDispatcher);i.onkeydown="KeyBoardonkeydown",i.onkeyup="KeyBoardonkeyup",i.CnterEnter="Enter",t.KeyBoard=i,__reflect(i.prototype,"game.KeyBoard")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.animatable=!0,t._numRecord=0,t.skinName=new ScoreRecordPanel_Skin,t._profiles=[],t._totalScores=[],t._uids=[],t}return __extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._profiles.push(this._profile0),this._profiles.push(this._profile1),this._profiles.push(this._profile2),this._profiles.push(this._profile3),this._totalScores.push(this._totalScore0),this._totalScores.push(this._totalScore1),this._totalScores.push(this._totalScore2),this._totalScores.push(this._totalScore3)},Object.defineProperty(i.prototype,"displayed",{get:function(){return this._displayed=null!=this.parent,this._displayed},set:function(t){this._displayed=t},enumerable:!0,configurable:!0}),i.prototype.updateRecordData=function(e){var i=t.RoomInfo.getInstance().playerNumber;if(this._uids.length<i&&this.updatePlayerProfile(),e&&e.length>0){var n=e[0],s=0;n&&(s=n.score.length),s>0&&this._lblNoData&&(this._lblNoData.parent.removeChild(this._lblNoData),this._lblNoData=null);var a=this.parseTotalScores(e);this.updateTotalScore(a);for(var o=this._numRecord;s>o;o++){var r=this.parseOneRecord(e,o);this.addOneRecord(o+1,r)}this._numRecord=s}},i.prototype.setRightArrowPosition=function(t,e){null!=t&&(this._arrowR.x=t),null!=e&&(this._arrowR.y=e)},i.prototype.parseOneRecord=function(t,e){for(var i=[],n=0,s=t;n<s.length;n++){var a=s[n],o=this._uids.indexOf(a.uid);i[o]=a.score[e]}return i},i.prototype.parseTotalScores=function(t){for(var e=[],i=function(t){var i=n._uids.indexOf(t.uid),s=0;t.score.forEach(function(t){s+=t}),e[i]=s},n=this,s=0,a=t;s<a.length;s++){var o=a[s];
i(o)}return e},i.prototype.updatePlayerProfile=function(){for(var e=t.RoomInfo.getInstance().userList,i=0,n=e.length;n>i;i++)this._uids[i]=e[i].uid,this._profiles[i].source=e[i].headUrl},i.prototype.updateTotalScore=function(t){for(var e=0,i=t.length;i>e;e++)this._totalScores[e].text=""+t[e]},i.prototype.addOneRecord=function(t,e){var i=54*(t-1);if(t%2===0){var n=new eui.Image;n.source="scoreRecord_json.record_bg_unit",n.width=this._detailScroller.width,n.y=i,this._detailScroller.addChild(n)}var s=this.createLabel("第"+t+"局",8,i+17.5);this._detailScroller.addChild(s);for(var a=112,o=0,r=e;o<r.length;o++){var h=r[o],d=this.createLabel(""+h,a,i+17.5);this._detailScroller.addChild(d),a+=90}},i.prototype.createLabel=function(t,e,i,n,s,a,o){void 0===n&&(n=18),void 0===s&&(s=9330238),void 0===a&&(a=80),void 0===o&&(o="center");var r=new eui.Label;return r.text=t,r.x=e,r.y=i,r.size=n,r.textColor=s,r.width=a,r.textAlign=o,r},i}(eui.Component);t.ScoreRecordPanel=e,__reflect(e.prototype,"game.ScoreRecordPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new SeatPlay_2d_Skin,t.initUI(),t}return __extends(i,e),i.prototype.destory=function(){t.ResUtil.removeAllChildren(this),t.ResUtil.removeFromParent(this),this._userVo=null,this._startSp=null},i.prototype.initUI=function(){this._pointNum=0,this.updateStatus(),this.dingqueWan=t.ResUtil.createBitmapByName("dingque_wan_icon"),this.dingqueWan.x=60,this.dingqueWan.y=-5,this.addChild(this.dingqueWan),this.dingqueTiao=t.ResUtil.createBitmapByName("dingque_tiao_icon"),this.dingqueTiao.x=60,this.dingqueTiao.y=-5,this.addChild(this.dingqueTiao),this.dingqueTong=t.ResUtil.createBitmapByName("dingque_tong_icon"),this.dingqueTong.x=60,this.dingqueTong.y=-5,this.addChild(this.dingqueTong),this.dingqueWan.visible=!1,this.dingqueTiao.visible=!1,this.dingqueTong.visible=!1,this._startSp=new egret.Sprite,this._startSp.y=30,this._startSp.x=-5,this.addChild(this._startSp)},i.prototype.updateData=function(t){this._userVo=t,null!=t&&(this._pointNum=t.remainder,this.headImage.source=this._userVo.headUrl,this.headImage.mask=this.headMask,this.nameTxt.text=t.nickName.slice(0,4),this.chipTxt.text=t.remainder.toString())},i.prototype.updataChips=function(t){this._pointNum=t,this.chipTxt.text=t.toString()},i.prototype.playerPause=function(t){this._playerPause.visible=t},i.prototype.changeLeftTime=function(t,e){t?this.leftTime.text="自动解散("+e+")":this.leftTime.text=""},i.prototype.pauseOutTimeSec=function(t){this.pauseLeftTimeSec&&(this.pauseLeftTimeSec.text=t+"s")},i.prototype.showListenIcon=function(t){this._listenIcon.visible=t},i.prototype.floatClear=function(t){var e=new egret.Sprite;e.x=0,e.y=75,e.alpha=0;var i;if(t>=0)i=this.createAlignBitmapText("winFloat_fnt","",0,0,120,egret.HorizontalAlign.CENTER),i.text="+"+t;else{i=this.createAlignBitmapText("loseFloat_fnt","",0,0,120,egret.HorizontalAlign.CENTER);var n=t+"";i.text="-"+Number(n.substring(1))}e.addChild(i),this.addChild(e);egret.Tween.get(e).wait(2500).to({alpha:1},100).to({y:25},500).wait(1500).to({y:5},200).call(this.moveComplete,this,[e,t])},i.prototype.moveComplete=function(t,e){this.updataChips(e),t&&(egret.Tween.removeTweens(t),uniLib.DisplayUtils.removeAllChildren(t),uniLib.DisplayUtils.removeAllChildren(t))},i.prototype.addMark=function(t){for(var e=0;e<t.length;e++){var i=void 0;i=26==t[e]?new egret.Bitmap(RES.getRes("game_startHu_2")):new egret.Bitmap(RES.getRes("game_startHu_"+t[e])),i.y=this._startSp.numChildren*i.height,this._startSp.addChild(i)}},i.prototype.updateStatus=function(t){switch(void 0===t&&(t=Cmd.OnlineState.OnlineState_Online),t){case Cmd.OnlineState.OnlineState_Online:this.grayBg.visible=!1,this.status.visible=!1,this.signal.visible=!1,this.host.visible=!1;break;case Cmd.OnlineState.OnlineState_Offline:this.status.source="offline",this.grayBg.visible=!0,this.status.visible=!0,this.signal.visible=!1,this.host.visible=!1;break;case Cmd.OnlineState.OnlineState_Leave:this.status.source="leave",this.grayBg.visible=!0,this.status.visible=!0,this.signal.visible=!1,this.host.visible=!1;break;case Cmd.OnlineState.OnlineState_Slow:this.grayBg.visible=!1,this.status.visible=!1,this.signal.visible=!0,this.host.visible=!1;break;case Cmd.OnlineState.OnlineState_Calling:this.grayBg.visible=!1,this.status.visible=!1,this.signal.visible=!1,this.host.visible=!1;break;case Cmd.OnlineState.OnlineState_Hosting:}},i.prototype.reset=function(){this._listenIcon.visible=!1,this._startSp.removeChildren()},Object.defineProperty(i.prototype,"seatId",{get:function(){return this._seatId},set:function(t){this._seatId=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._userVo},enumerable:!0,configurable:!0}),i.prototype.createAlignBitmapText=function(t,e,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=-1),void 0===a&&(a="left");var o=new ui.AlignBitmapText;return-1!=s&&(o.width=s),o.font=RES.getRes(t),o.text=e,o.x=i,o.y=n,o.hAlign=a,o},i.prototype.updateDingQue=function(t){this._dingqueValue=t,this.refreshDingQue()},i.prototype.refreshDingQue=function(){if(this._dingqueValue){for(var e=!0,i=0,n=t.RoomInfo.getInstance().userList;i<n.length;i++){var s=n[i];s.dingQueStare||(e=!1)}if(e)switch(this._dingqueValue){case 1:this.dingqueWan.visible=!0,this.dingqueTiao.visible=!1,this.dingqueTong.visible=!1;break;case 2:this.dingqueWan.visible=!1,this.dingqueTiao.visible=!0,this.dingqueTong.visible=!1;break;case 3:this.dingqueWan.visible=!1,this.dingqueTiao.visible=!1,this.dingqueTong.visible=!0}}},i.prototype.resetDingque=function(){var e=t.RoomInfo.getInstance().getUserVoByUid(this._userVo.uid);e.dingQueStare=!1,this.dingqueWan.visible=!1,this.dingqueTiao.visible=!1,this.dingqueTong.visible=!1},i}(eui.Component);t.SeatPlayer=e,__reflect(e.prototype,"game.SeatPlayer")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new SettingPanel_2d5_dalian_Skin,t.addListener(),t.init(),t}return __extends(i,e),i.prototype.init=function(){this.updateViewtype(),this.updateMajiangtype(),uniLib.SoundMgr.instance.soundOpen?(this.soundButton.currentState="up",uniLib.SoundMgr.instance.soundVolume=.7):(this.soundButton.currentState="down",uniLib.SoundMgr.instance.soundVolume=0),uniLib.SoundMgr.instance.musicOpen?(this.musicButton.currentState="up",uniLib.SoundMgr.instance.musicVolume=.7):(this.musicButton.currentState="down",uniLib.SoundMgr.instance.musicVolume=0),"pu"==t.RoomInfo.getInstance().languageMode?this.dialectBtn.currentState="down":this.dialectBtn.currentState="up",this.updateTableCheck();var e=this.selectionGroup;if(!t.GameConst.MaJiongChange){var i=this.majiangGroup;e.removeChild(i)}if(!t.GameConst.viewChange){var n=this.viewGroup;e.removeChild(n)}if(!t.GameConst.openDialect){var s=this.dialectGroup;e.removeChild(s)}},i.prototype.addListener=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTap,this)},i.prototype.removeListener=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTap,this)},i.prototype.destory=function(){this.removeListener()},i.prototype.updateViewtype=function(){1==uniLib.Utils.getLocalStorage("viewType_"+t.RoomInfo.getInstance().gameId)?this.View_3d.selected=!0:this.View_2d.selected=!0},i.prototype.updateMajiangtype=function(){1==uniLib.Utils.getLocalStorage("majiangType_"+t.RoomInfo.getInstance().gameId)?this.majiang_1.selected=!0:this.majiang_2.selected=!0},i.prototype.onCheckTable=function(e){RES.hasRes("buttonClick_mp3")&&uniLib.SoundMgr.instance.playSound("buttonClick_mp3"),e.target==this.bg_1?t.RoomInfo.getInstance().tableclothMode="green":t.RoomInfo.getInstance().tableclothMode="blue",this.updateTableCheck(),uniLib.Utils.setLocalStorage("tabelMode",t.RoomInfo.getInstance().tableclothMode),this.dispatchEventWith(t.UIEventConsts.CHANGE_TABLECLOTH)},i.prototype.changeView=function(e){var i=0;e.target==this.View_3d&&(i=1),uniLib.Utils.setLocalStorage("viewType_"+t.RoomInfo.getInstance().gameId,i),uniLib.ZQGameSdk.restart("请重新进入游戏后切换视角!","确定","取消")},i.prototype.changeMajiang=function(e){var i=0;e.target==this.majiang_2&&(i=1),t.PublicMethod.Instance.showConfirmPanel("下一局将会为您切换麻将样式！",["确定"],[],null,this),uniLib.Utils.setLocalStorage("viewType_"+t.RoomInfo.getInstance().gameId,i),this.dispatchEventWith(t.UIEventConsts.CLOSE)},i.prototype.updateTableCheck=function(){"green"==t.RoomInfo.getInstance().tableclothMode?this.bg_1.selected=!0:"blue"==t.RoomInfo.getInstance().tableclothMode&&(this.bg_2.selected=!0)},i.prototype.onClickTap=function(e){switch(e.target instanceof eui.Button&&RES.hasRes("buttonClick_mp3")&&uniLib.SoundMgr.instance.playSound("buttonClick_mp3"),e.target){case this.dismissButton:this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME,!1,1);break;case this.bg_1:case this.bg_2:this.onCheckTable(e);break;case this.replaceButton:uniLib.ZQGameSdk.restart("修复过程会重启游戏！","确定","取消");break;case this.dialectBtn:this.updataLanguage();break;case this.View_2d:case this.View_3d:this.changeView(e);break;case this.majiang_1:case this.majiang_2:this.changeMajiang(e);break;case this.soundButton:uniLib.SoundMgr.instance.soundOpen?(uniLib.SoundMgr.instance.soundVolume=0,uniLib.SoundMgr.instance.soundOpen=!1,this.soundButton.currentState="down"):(uniLib.SoundMgr.instance.soundVolume=.7,uniLib.SoundMgr.instance.soundOpen=!0,this.soundButton.currentState="up"),uniLib.Utils.setLocalStorage("sound_toggle",Number(uniLib.SoundMgr.instance.soundOpen)),uniLib.Utils.setLocalStorage("soundVolume",uniLib.SoundMgr.instance.soundVolume);break;case this.musicButton:uniLib.SoundMgr.instance.musicOpen?(uniLib.SoundMgr.instance.musicVolume=0,uniLib.SoundMgr.instance.musicOpen=!1,this.musicButton.currentState="down"):(uniLib.SoundMgr.instance.musicVolume=.7,uniLib.SoundMgr.instance.musicOpen=!0,this.musicButton.currentState="up"),uniLib.Utils.setLocalStorage("music_toggle",Number(uniLib.SoundMgr.instance.musicOpen)),uniLib.Utils.setLocalStorage("musicVolume",uniLib.SoundMgr.instance.musicVolume);break;case this.closeRect:this.dispatchEventWith(t.UIEventConsts.CLOSE)}},i.prototype.refrenshHandel=function(){uniLib.ZQGameSdk.restart("修复过程会重启游戏！","确定","取消")},i.prototype.updataLanguage=function(){"up"==this.dialectBtn.currentState?(this.dialectBtn.currentState="down",t.RoomInfo.getInstance().languageMode="pu"):(this.dialectBtn.currentState="up",t.RoomInfo.getInstance().languageMode=t.GameConst.revengeStr),uniLib.Utils.setLocalStorage("languageMode",t.RoomInfo.getInstance().languageMode)},i}(eui.Component);t.SettingPanel=e,__reflect(e.prototype,"game.SettingPanel")}(game||(game={}));var game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=new HZ_ShuffleButtonSkin,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addListener,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeListener,e),e}return __extends(e,t),e.prototype.addListener=function(){this.shuffleButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},e.prototype.removeListener=function(){this.shuffleButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.shuffleButton.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addListener,this),this.shuffleButton.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListener,this)},e.prototype.onTouchTap=function(t){switch(t.target){case this.shuffleButton:var e=new Cmd.ReadyStartMahjongCmd_C;e.shuffle=1,uniLib.NetMgr.tcpSend(e)}},e.prototype.updateCost=function(t){this.shuffleButton.label=t+""},e}(eui.Component);t.ShuffleButton=e,__reflect(e.prototype,"game.ShuffleButton")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.redPack=0,t.skinName=new TotalRecordItem_2d5_new_Skin,t}return __extends(i,e),i.prototype.dataChanged=function(){var e=this.data;this.nameLabel.text=e.nickname,this.idLabel.text=e.uid+"",this.headMc.source=e.headurl,this.hostImage.visible=null==e.isOwner?!1:e.isOwner,this.winIcon.visible=e.isWinner?!0:!1,e.totalScore>=0?(this.winBitMapLabel.font="win_jiesuan_fnt",this.winBitMapLabel.text="+"+e.totalScore==null?null:e.totalScore.toString()):(this.winBitMapLabel.font="lose_jiesuan_fnt",this.winBitMapLabel.text=null==e.totalScore?null:e.totalScore.toString()),this.group.removeChildren(),this.labelList=[];var i=(t.DataCache.langObj.uiTxt.TotalRecordPanel,new eui.VerticalLayout);i.horizontalAlign="center",i.verticalAlign="middle";var n=3;i.gap=(256-28*n)/(n+1)>0?(256-28*n)/(n+1):0,this.group.layout=i;for(var s=0;n>s;s++){var a=new eui.Label;a.size=28,a.name="label"+s,a.textColor=12680246,this.group.addChild(a),this.labelList.push(a)}this.labelList[0].text="胡牌分数    "+(e.win?e.win:0),this.labelList[1].text="开杠分数    "+(e.bar?e.bar:0),this.labelList[2].text="抓鸟分数    "+(e.horse?e.horse:0),void 0!==e.redpack&&e.redpack>0&&(this.redPack=e.redpack,dragonBones.addMovieGroup(RES.getRes("hongbao_effect_ske_dbmv"),RES.getRes("hongbao_effect_tex_png"),"hongbao_effect"),this._hongbaoEffect=dragonBones.buildMovie("MovieClip","hongbao_effect"),this._hongbaoEffect.x=145,this._hongbaoEffect.y=240,this._hongbaoEffect.addEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,this.loop,this),this.addChild(this._hongbaoEffect),this._hongbaoEffect.play("newAnimation",1))},i.prototype.loop=function(){var t=this.redPack;this._hongbaoPanel=new egret.Sprite,this._hongbaoPanel.x=0,this._hongbaoPanel.y=75,this._hongbaoPanel.alpha=0;var e;t>=0&&(e=new eui.Label,e.x=48,e.y=180,e.text="+"+t+"元"),this._hongbaoPanel.addChild(e),this.addChild(this._hongbaoPanel);egret.Tween.get(this._hongbaoPanel).wait(250).to({alpha:1},100).to({y:35},1e3).call(this.moveComplete,this,[this._hongbaoPanel])},i.prototype.moveComplete=function(t){t&&(egret.Tween.removeTweens(t),dragonBones.WorldClock.clock.remove(this._hongbaoEffect))},i}(eui.ItemRenderer);t.TotalRecordItem=e,__reflect(e.prototype,"game.TotalRecordItem")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName=new TotalRecord_2d5_new_Skin,t.initUI(),t}return __extends(i,e),i.prototype.initUI=function(){var e=new eui.HorizontalLayout;e.horizontalAlign="center",e.gap=0,this.list.layout=e,this.list.itemRenderer=t.TotalRecordItem,this.shareButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.againButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgain,this),this.againButton.visible=!0,0!=uniLib.Global.is_sandbox&&(this.shareButton.visible=!1),t.DataCache.platParam?t.RoomInfo.getInstance().matchId?this.roomIdLabel.text="房号:"+t.DataCache.platParam.roomId+"  包厢号:"+t.RoomInfo.getInstance().matchId:this.roomIdLabel.text="房号: "+t.DataCache.platParam.roomId:this.roomIdLabel.text="房号: 13058091314   16局",this.roomTitleLabel.text=""+t.RoomInfo.getInstance().getPlayType()+"  "+t.RoomInfo.getInstance().totalNumber+"局",1==uniLib.Global.is_sandbox&&(this.roomTitleLabel.text=""),t.GameData.getInstance().resultReason?(this.reason.text=t.GameData.getInstance().resultReason,this.reason.alpha=.65,this.reason.visible=!0):(this.reason.text=null,this.reason.visible=!1);var i=new Date,n=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();this.roomTimeLabel.text=n+"  "+this.setTimeFormat(i.getHours())+":"+this.setTimeFormat(i.getMinutes())+":"+this.setTimeFormat(i.getSeconds())},i.prototype.setTimeFormat=function(t){var e="";return e=10>t?"0"+t:t+""},i.prototype.onBack=function(e){this.dispatchEventWith(t.UIEventConsts.EXIT_GAME)},i.prototype.onAgain=function(e){this.dispatchEventWith(t.UIEventConsts.EXIT_GAME),uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"game_request_continue")},i.prototype.setData=function(e){if(e){for(var i=e.length,n=[],s=0;i>s;s++)if(e[s].uid==uniLib.UserInfo.uid){n.push(e[s]);break}for(var s=0;i>s;s++)e[s].uid!=uniLib.UserInfo.uid&&n.push(e[s]);this.list.dataProvider=new eui.ArrayCollection(n);var a;if(t.DataCache.platParam.roomId<1e6)for(var s=0;i>s;s++)e[s].isOwner&&e[s].uid==uniLib.UserInfo.uid&&(this.againButton.visible=!0);t.DataCache.platParam.shareInfo&&t.DataCache.platParam.shareInfo.codeUrl?a&&(a.headUrl=t.DataCache.platParam.shareInfo.codeUrl,this.addChild(a)):a&&uniLib.DisplayUtils.removeFromParent(a)}},i.prototype.onShare=function(t){var e=new uniLib.WXShareVo;e.shareWay=0;var i=1;uniLib.Utils.isIOS()&&(i=.6);var n=new egret.Bitmap(uniLib.DisplayUtils.catchScreenToTex(this,new egret.Rectangle(0,0,this.width,this.height),i));e.shareImageData=uniLib.DisplayUtils.catchScreen(n,new egret.Rectangle(0,0,this.width,this.height)),uniLib.ZQGameSdk.share(e,null,null)},i.prototype.destory=function(){this.shareButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.againButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(eui.Component);t.TotalRecordPanel=e,__reflect(e.prototype,"game.TotalRecordPanel")}(game||(game={}));var game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=new UserInfoPanel_2d5_new_Skin,t.giftList.itemRenderer=i,t.addListener(),t}return __extends(n,e),n.prototype.addListener=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseHandle,this),this.giftList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this)},n.prototype.removeListener=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseHandle,this),this.giftList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this)},n.prototype.onCloseHandle=function(e){this.dispatchEventWith(t.UIEventConsts.CLOSE)},n.prototype.gitData=function(){var t=table.TableGift.instance();return t.clone().splice(0,6)},n.prototype.onListItemTap=function(e){if(RES.hasRes("buttonClick_mp3")&&uniLib.SoundMgr.instance.playSound("buttonClick_mp3"),this._data.uid==uniLib.UserInfo.uid)return void t.GameInfo.manage.showMildWarnShow("不能给自己送礼物");var i=e.item,n=1;if(null!=this._data){if(this._data.uid==uniLib.UserInfo.uid&&(n=t.RoomInfo.getInstance().userList.length-1),0>=n)return t.GameInfo.manage.showMildWarnShow(t.DataCache.langObj.msgTxt.noOtherPlayer),void this.dispatchEventWith(t.UIEventConsts.CLOSE);if(this._data.uid==uniLib.UserInfo.uid){var s=new Cmd.GiftsInfo;s.giftsId=i.giftId,s.toUid=0,s.fromUid=this._data.uid,s.giftsNum=1,this.dispatchEventWith(t.UIEventConsts.GIFT_SEND,!1,s)}else{var s=new Cmd.GiftsInfo;s.giftsId=i.giftId,s.toUid=this._data.uid,s.fromUid=uniLib.UserInfo.uid,s.giftsNum=1,this.dispatchEventWith(t.UIEventConsts.GIFT_SEND,!1,s)}}},n.prototype.reset=function(){this._data=null,this._nickTxt.text="",this._idTxt.text="",this._ipTxt.text="",this._diamondTxt.text="",this._scoreTxt.text="",this.distanceLabel.text="",this.addressLabel.text=""},n.prototype.setData=function(e){this._data=e,this._nickTxt.text=e.nickname.slice(0,6),this._idTxt.text=e.uid.toString(),this._ipTxt.text=e.ip?e.ip:"",this._diamondTxt.text=e.diamond.toString(),this._scoreTxt.text=e.points.toString(),this._genderIcon.source="男"==e.gender?"userinfo_sex0_2d5":"userinfo_sex1_2d5",this._headMc.headImage.source=e.headurl;var i=t.RoomInfo.getInstance().getUserVoByUid(uniLib.NetMgr.UID);if(e.lat&&e.lng&&i.lat&&i.lng){var n=uniLib.Utils.getDistance(e.lat,e.lng,i.lat,i.lng);if(n){var s="";s=n>1e3?"距离此玩家："+Math.floor(n/1e3)+"km":"距离此玩家："+n.toString()+"m",this.distanceLabel.text=s}}else this.distanceLabel.text="距离此玩家：距离未知";e.address?this.addressLabel.text="位置："+e.address:this.addressLabel.text="位置：未获取到位置",this.giftList.dataProvider=new eui.ArrayCollection(this.gitData())},n.prototype.diamondChange=function(t){"diamondChange"==t.param&&Number(this._idTxt.text)==uniLib.UserInfo.uid&&(this._diamondTxt.text=uniLib.UserInfo.chips.toString())},n.prototype.destory=function(){this.removeListener()},n}(eui.Component);t.UserInfoPanel=e,__reflect(e.prototype,"game.UserInfoPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName=new GiftItem_2d5_new_skin,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.iconImage.source="gift_2d5_"+t.giftId},e}(eui.ItemRenderer);t.GiftItem=i,__reflect(i.prototype,"game.GiftItem")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initUI=function(){this._mask=new egret.Sprite,this._mask.graphics.beginFill(0,.01),this._mask.graphics.drawRect(0,0,t.DataCache.defaultWidth,t.DataCache.defaultHeight),this._mask.graphics.endFill(),this._mask.touchEnabled=!0,this.addChild(this._mask);var e=uniLib.DisplayUtils.createBitmapByName("video_bg");this.addChild(e),e.y=uniLib.Global.screenHeight/2+t.CountVc.HEIGHT/2,e.x=uniLib.Global.screenWidth/2-e.width/2,this._backBtn=new t.GameButton(["video_back1","video_back2"]),this.addChild(this._backBtn),this._backBtn.name="back",this._stopBtn=new t.GameButton(["video_stop1","video_stop2"]),this.addChild(this._stopBtn),this._stopBtn.name="stop",this._advanceBtn=new t.GameButton(["video_advance1","video_advance2"]),this.addChild(this._advanceBtn),this._advanceBtn.name="advance",this._closeBtn=new t.GameButton(["video_close1","video_close2"]),this.addChild(this._closeBtn),this._closeBtn.name="close",this._backBtn.x=e.x+2,this._stopBtn.x=this._backBtn.x+this._backBtn.width+5,this._advanceBtn.x=this._stopBtn.x+this._stopBtn.width+5,this._closeBtn.x=this._advanceBtn.x+this._advanceBtn.width+3,this._backBtn.y=this._stopBtn.y=this._advanceBtn.y=this._closeBtn.y=e.y+5,this._backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._stopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._advanceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this)},i.prototype.btnClick=function(e){var i=e.currentTarget.name;switch(i){case"back":this.dispatchEventWith(t.UIEventConsts.VIDEO_BACK);break;case"stop":this.dispatchEventWith(t.UIEventConsts.VIDEO_STOP);break;case"advance":this.dispatchEventWith(t.UIEventConsts.VIDEO_ADVANCE);break;case"close":this.dispatchEventWith(t.UIEventConsts.VIDEO_CLOSE)}},i.prototype.destory=function(){this._backBtn&&(this._backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._backBtn=null),this._stopBtn&&(this._stopBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._stopBtn=null),this._advanceBtn&&(this._advanceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._advanceBtn=null),this._closeBtn&&(this._closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnClick,this),this._closeBtn=null),uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);t.VideoPanel=e,__reflect(e.prototype,"game.VideoPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s.initGame(),s._cardVc=n,s._cardVc.addEventListener(t.UIEventConsts.ACTION_HOST,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.USER_DODISCARD,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.ACTION_DISCARD,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.REMOVE_READYHAND,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.ACTION_READYHAND,s.onOperate,s),s._cardVc.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,s.onOperate,s),s}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),egret.MainContext.instance.stage.removeEventListener(egret.Event.DEACTIVATE,this.onDeactivateHandler,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_ACTIVE_SOCKET_CACHE_OK,this.onActivateHandler,this),this._cardVc&&(this._cardVc.removeEventListener(t.UIEventConsts.ACTION_HOST,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.USER_DODISCARD,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.ACTION_DISCARD,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.ACTION_READYHAND,this.onOperate,this),this._cardVc.removeEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onOperate,this),this._cardVc.destory(),this._cardVc=null)},i.prototype.onOperate=function(e){var i,n=e.type;switch(n){case t.UIEventConsts.ACTION_DISCARD:i=new Cmd.OutCardMahjongCmd_C,i.thisId=e.data;var s=(new Date).getTime();if(this.thisId==i.thisId&&s-this.timeStamp<200)return;this.thisId=i.thisId,this.timeStamp=s;break;case t.UIEventConsts.ACTION_READYHAND:this._cardVc.showListenPanel(e.data);break;case t.UIEventConsts.ACTION_CANCEL:i=new Cmd.CancelOpMahjongCmd_C;break;case t.UIEventConsts.REMOVE_READYHAND:this._cardVc.removeListenPanel();break;case t.UIEventConsts.ACTION_HOST:i=new Cmd.HostMahjongCmd_C,i.hostType=0;break;case t.UIEventConsts.USER_DODISCARD:this._cardVc.doDiscard(uniLib.UserInfo.uid,t.GameData.getInstance().waitCard);break;case t.UIEventConsts.USER_DODISCARD_FAIL:this._cardVc.removeOutPutCard(0,e.data)}i&&(this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA),uniLib.NetMgr.setMsgTimeout(8,"OutCardMahjongCmd_C"))},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.DRAW_NOTICE,t.MahjongFourFacadeConst.SEND_CARDS,t.MahjongFourFacadeConst.CHOW_NOTICE,t.MahjongFourFacadeConst.KONG_NOTICE,t.MahjongFourFacadeConst.PONG_NOTICE,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.GM_CHANGE_CARD,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.OUT_CARD_REFRESH,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.GAME_SET_BANKER,t.MahjongFourFacadeConst.NOTIFY_COMMON_CHAT,t.MahjongFourFacadeConst.NOTICE_CARD_ENABLE,t.MahjongFourFacadeConst.SUPPLY_FLOWER_NOTICE,t.MahjongFourFacadeConst.SELF_HANDCARD_CHANGE,t.MahjongFourFacadeConst.NOTIFY_SELECT_GOLDOUT,t.MahjongFourFacadeConst.DRAW,t.MahjongFourFacadeConst.NOTIFY_HOST,t.MahjongFourFacadeConst.REFRESH_LISTEN_SCENE,t.MahjongFourFacadeConst.SELF_OUTCARD_REFRESH,t.MahjongFourFacadeConst.VIDEO_REFRESH_HANDCARD]},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.RESET_TABLE:this._cardVc.resetTable(),this._cardVc.removeListenPanel();break;case t.MahjongFourFacadeConst.GAME_START:this._cardVc.startGame(),this._cardVc.removeListenPanel();break;case t.MahjongFourFacadeConst.GAME_SET_BANKER:this._cardVc.setBanker(e.getBody());break;case t.MahjongFourFacadeConst.USER_ENTER_ROOM:this._cardVc.creatUserCardSide(),0!=t.RoomInfo.getInstance().isHostMode&&this._cardVc.setHostMask(1);break;case t.MahjongFourFacadeConst.SELF_HANDCARD_CHANGE:var i=e.getBody();if(t.RoomInfo.getInstance().isTween)return;i?this._cardVc.draw(i):this._cardVc.refreshHandCards(),this._cardVc.removeListenPanel();break;case t.MahjongFourFacadeConst.SEND_CARDS:this._cardVc.setUserCards(),this._cardVc.startSendCards();break;case t.MahjongFourFacadeConst.DRAW_NOTICE:this._cardVc.drawNotice(e.getBody());break;case t.MahjongFourFacadeConst.KONG_NOTICE:var n=e.getBody();this._cardVc.doKong(n);break;case t.MahjongFourFacadeConst.PONG_NOTICE:var s=e.getBody();this._cardVc.doPong(s);break;case t.MahjongFourFacadeConst.CHOW_NOTICE:var a=e.getBody();this._cardVc.doChow(a);break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:this._cardVc.doDiscard(t.RoomInfo.getInstance().outerId,t.RoomInfo.getInstance().OutCard.thisId),t.RoomInfo.getInstance().OutCard.isFollow;break;case t.MahjongFourFacadeConst.RELOGIN:this._cardVc.creatUserCardSide(),this._cardVc.refreshBanker(),this._cardVc.setRelogindata(e.getBody()),0!=t.RoomInfo.getInstance().isHostMode&&this._cardVc.setHostMask(1);break;case t.MahjongFourFacadeConst.SUPPLY_FLOWER_NOTICE:this._cardVc.fillFlower(e.getBody());break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._cardVc.doWin(e.getBody()),this._cardVc.hideCardListenIcon(),this._cardVc.removeListenPanel(),this._cardVc.setEnable(!1);break;case t.MahjongFourFacadeConst.NOTIFY_COMMON_CHAT:var o=e.getBody();o.voiceId?this._cardVc.showCommonChat(o.uid,String(o.voiceId)):o.words&&this._cardVc.showCommonTalk(o.uid,o.words);break;case t.MahjongFourFacadeConst.NOTIFY_SELECT_GOLDOUT:this._cardVc.selectGoldOut();break;case t.MahjongFourFacadeConst.OUT_CARD_REFRESH:this._cardVc.removeOutPutCard(0,e.getBody()),this._cardVc.refreshHandCards(1,e.getBody());break;case t.MahjongFourFacadeConst.GM_CHANGE_CARD:this._cardVc.refreshHandCards();break;case t.MahjongFourFacadeConst.NOTICE_CARD_ENABLE:var r=e.getBody();this._cardVc.setEnable(r);break;case t.MahjongFourFacadeConst.DRAW:t.CardInfo.getInstance().drawData.listenSet&&0!=t.CardInfo.getInstance().drawData.listenSet.length&&this._cardVc.setListenCard();break;case t.MahjongFourFacadeConst.REFRESH_LISTEN_SCENE:this._cardVc.showListenPanel1(e.getBody());break;case t.MahjongFourFacadeConst.NOTIFY_HOST:var h=e.getBody();h.uid==uniLib.UserInfo.uid&&this._cardVc.setHostMask(h.hostType);break;case t.MahjongFourFacadeConst.VIDEO_REFRESH_HANDCARD:this._cardVc.videoRefresh(e.getBody());break;case t.MahjongFourFacadeConst.SELF_OUTCARD_REFRESH:this._cardVc.refreshOutCards()}},i.prototype.initGame=function(){egret.MainContext.instance.stage.addEventListener(egret.Event.DEACTIVATE,this.onDeactivateHandler,this),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_ACTIVE_SOCKET_CACHE_OK,this.onActivateHandler,this)},i.prototype.onActivateHandler=function(t){this._cardVc.refreshBanker(),this._cardVc.refreshTempCard()},i.prototype.onDeactivateHandler=function(){this._cardVc.hidePointMc()},i}(puremvc.Mediator);e.NAME="CardMJMediator",t.CardMJMediator=e,__reflect(e.prototype,"game.CardMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(t){var n=e.call(this,i.NAME,t)||this;return n._countVc=t,n}return __extends(i,e),i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.SEND_CARDS,t.MahjongFourFacadeConst.PONG_NOTICE,t.MahjongFourFacadeConst.KONG_NOTICE,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.DRAW_NOTICE,t.MahjongFourFacadeConst.CHOW_NOTICE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.GAME_SET_BANKER,t.MahjongFourFacadeConst.NOTIFY_EAST_LOCATION]},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.SEND_CARDS:this._countVc.setCount(t.RoomInfo.getInstance().bankerSeatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.USER_ENTER_ROOM:break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:if(t.RoomInfo.getInstance().opCount){var i=t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().outerId);2==t.RoomInfo.getInstance().playerNumber?(1==t.RoomInfo.getInstance().OutCard.isOp,this._countVc.setCount((i+2)%4,t.RoomInfo.getInstance().opCount,t.RoomInfo.getInstance().OutCard.isOp)):3==t.RoomInfo.getInstance().playerNumber?1==i?this._countVc.setCount((i+2)%4,t.RoomInfo.getInstance().opCount):this._countVc.setCount((i+1)%4,t.RoomInfo.getInstance().opCount):this._countVc.setCount((i+1)%4,t.RoomInfo.getInstance().opCount,t.RoomInfo.getInstance().OutCard.isOp)}break;case t.MahjongFourFacadeConst.DRAW_NOTICE:t.RoomInfo.getInstance().outCount&&this._countVc.setCount(t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().outerId),t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.KONG_NOTICE:var n=e.getBody();
this._countVc.setCount(n.seatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.PONG_NOTICE:var s=e.getBody();this._countVc.setCount(s.seatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.CHOW_NOTICE:var a=e.getBody();this._countVc.setCount(a.seatId,t.RoomInfo.getInstance().outCount);break;case t.MahjongFourFacadeConst.RELOGIN:if(t.RoomInfo.getInstance().eastUid){var o=t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().eastUid);this._countVc.setEast(o)}break;case t.MahjongFourFacadeConst.RESET_TABLE:this._countVc.reset();break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._countVc.reset();break;case t.MahjongFourFacadeConst.NOTIFY_EAST_LOCATION:var r=t.RoomInfo.getInstance().getSeatNoByUserId(t.RoomInfo.getInstance().eastUid);this._countVc.setEast(r);break;case t.MahjongFourFacadeConst.GAME_SET_BANKER:this._countVc.setCount(t.RoomInfo.getInstance().bankerSeatId,t.RoomInfo.getInstance().outCount)}},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this._countVc&&(this._countVc.destory(),this._countVc=null)},i}(puremvc.Mediator);e.NAME="CountMJMediator",t.CountMJMediator=e,__reflect(e.prototype,"game.CountMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s._mySelect="",s._gmSelect="",s._stopVideo=!1,s._isClick=!0,s._gameVc=s.viewComponent=new t.GameVc,t.GameInfo.uiLayer.addChild(s._gameVc),s.initGame(),s._gameVc.addEventListener(t.UIEventConsts.EXCHANGE_DESK,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.READY,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.DESTORY,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_HELP,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.EXIT_GAME,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.DISMISS_GAME,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHARE_GAME,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_GM_Tool,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_SETTING,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_GPS,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.ACTION_HOST,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_STOP_SERVICE,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.SHOW_SHORT_CHAT,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GET_SCORE_DATA,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GM_SELECT_CARDS,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GM_SELECT_HANDCARD,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.GM_SELECT_HEAPCARD,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.REQUEST_CHANGE_USERNUM,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_BACK,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_ADVANCE,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_CLOSE,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.VIDEO_STOP,s.uiHandle,s),s._gameVc.addEventListener(t.UIEventConsts.START_READY,s.uiHandle,s),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_L2G,s.onMoon,s),s}return __extends(i,e),i.prototype.uiHandle=function(e){switch(e.type){case t.UIEventConsts.EXCHANGE_DESK:this.changeDeak();break;case t.UIEventConsts.GET_SCORE_DATA:this.getScoreList();break;case t.UIEventConsts.DESTORY:this.sendNotification(t.MahjongFourFacadeConst.DESTORY);break;case t.UIEventConsts.START_READY:this.startReady();break;case t.UIEventConsts.READY:if(t.GameData.getInstance().recordInfo)this.showTotal(t.GameData.getInstance().recordInfo);else{var i=new Cmd.ReadyStartMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA)}break;case t.UIEventConsts.SHOW_SETTING:this.showSetting();break;case t.UIEventConsts.SHOW_GPS:var n=new Cmd.RequestIpGPSCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,n,t.DataRequestCommand.GAME_DATA),this.showGps();break;case t.UIEventConsts.SHOW_GM_Tool:this.showGmTool();break;case t.UIEventConsts.EXIT_GAME:this.exitGame();break;case t.UIEventConsts.SHARE_GAME:this.showShare();break;case t.UIEventConsts.DISMISS_GAME:1==e.data?this.showDismissConfirm():this.showLeaveRoom();break;case t.UIEventConsts.SHOW_SHORT_CHAT:this._shortChat&&this._shortChat.visible?this.hideShortChat():this.showShortChat();break;case t.UIEventConsts.GM_SELECT_HANDCARD:var s=e.data;this._mySelect=s,this.requestChange();break;case t.UIEventConsts.GM_SELECT_HEAPCARD:var a=e.data;this._gmSelect=a,this.requestChange();break;case t.UIEventConsts.GM_SELECT_CARDS:this.requestChanges(e.data);break;case t.UIEventConsts.SHOW_STOP_SERVICE:this.showStopServiceNotice();break;case t.UIEventConsts.ACTION_HOST:var o=new Cmd.HostMahjongCmd_C;1==t.RoomInfo.getInstance().isHostMode?o.hostType=0:o.hostType=1,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,o,t.DataRequestCommand.GAME_DATA);break;case t.UIEventConsts.SHOW_HELP:this.showHelp();break;case t.UIEventConsts.REQUEST_CHANGE_USERNUM:var r=new Cmd.RequestChangeUserNbrRoom_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,r,t.DataRequestCommand.GAME_DATA);break;case t.UIEventConsts.VIDEO_BACK:uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_back");break;case t.UIEventConsts.VIDEO_ADVANCE:uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_advance");break;case t.UIEventConsts.VIDEO_CLOSE:this.showVideoFinish(1);break;case t.UIEventConsts.VIDEO_STOP:uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_stop")}},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.DESTORY,t.MahjongFourFacadeConst.GM_DELETE,t.MahjongFourFacadeConst.EXIT_GAME,t.MahjongFourFacadeConst.SEND_CARDS,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.DISS_NOTICE,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.GM_HEAP_CARD,t.MahjongFourFacadeConst.GM_CHANGE_CARD,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.NOTIFY_SAME_IP,t.MahjongFourFacadeConst.LASTCARD_CHANGE,t.MahjongFourFacadeConst.TURNGOLD_NOTICE,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.TOTAL_RECORD_DATA,t.MahjongFourFacadeConst.DISS_RESULT_NOTICE,t.MahjongFourFacadeConst.NOTIFY_CHAT_RECORD,t.MahjongFourFacadeConst.RESET_RESULT_PANEL,t.MahjongFourFacadeConst.SELF_DISCARD_NOTICE,t.MahjongFourFacadeConst.DISS_REQUEST_NOTICE,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.GAME_SET_BANKER,t.MahjongFourFacadeConst.STOP_SREVICE_NOTICE,t.MahjongFourFacadeConst.CHANGE_USERNUM_NOTICE,t.MahjongFourFacadeConst.CHANGE_USERNUM_BACK,t.MahjongFourFacadeConst.SHOW_CHANGE_BTN,t.MahjongFourFacadeConst.TIMEOUT_WAIT,t.MahjongFourFacadeConst.READY_NOTICE,t.MahjongFourFacadeConst.READY_SHOW,t.MahjongFourFacadeConst.SHOW_READY_BTN]},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.USER_ENTER_ROOM:this._gameVc.updateRoomId(),this._gameVc.updateEnterRoom(),this._gameVc.updateGhostData(),this._gameVc.showDissBtn(),this._gameVc.showChangeRoom();break;case t.MahjongFourFacadeConst.GAME_START:this._gameVc.reset(),this._gameVc.updateRound(),this._gameVc.disposeBtn(),this._gameVc.updateRoomId();break;case t.MahjongFourFacadeConst.SHOW_READY_BTN:break;case t.MahjongFourFacadeConst.SEND_CARDS:this._gameVc.disposeBtn(),this._gameVc.refreshCard();break;case t.MahjongFourFacadeConst.RESET_TABLE:this._gameVc.reset();break;case t.MahjongFourFacadeConst.RESULT_NOTICE:var i=e.getBody();this._gameVc.showResult(i),this._gameVc.clearListenPanel();break;case t.MahjongFourFacadeConst.LASTCARD_CHANGE:this._gameVc.refreshCard();break;case t.MahjongFourFacadeConst.RELOGIN:this._gameVc.updateRound(),this._gameVc.updateRoomId(),this._gameVc.updateEnterRoom(),this._gameVc.setGoldenMj();var n=e.getBody();n.userCard&&n.userCard.handCardSet&&n.userCard.handCardSet.length>0&&(this._gameVc.disposeBtn(),this._gameVc.refreshCard()),t.RoomInfo.getInstance().curNumber&&t.RoomInfo.getInstance().curNumber>=1&&this._gameVc.disposeBtn();break;case t.MahjongFourFacadeConst.TURNGOLD_NOTICE:this._gameVc.setGoldenMj();break;case t.MahjongFourFacadeConst.SELF_DISCARD_NOTICE:this._gameVc.showListenIcon(t.CardInfo.getInstance().winCardSet);break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:t.CardInfo.getInstance().freshListenData&&(t.CardInfo.getInstance().freshListenData=!1,this._gameVc.refreshListenPanel());break;case t.MahjongFourFacadeConst.TOTAL_RECORD_DATA:this.showTotal(e.getBody());break;case t.MahjongFourFacadeConst.DISS_RESULT_NOTICE:var s=e.getBody();this.dissData=s;var a,o="";s.bOk?(o=t.DataCache.langObj.uiTxt.DismissPanel.success,a=s.agreeUsers):(o=t.DataCache.langObj.uiTxt.DismissPanel.fail,a=s.disagreeUsers);var r=o.split("#");s.bOk?t.PublicMethod.Instance.showConfirmPanel(r[0]+a.toString()+r[1],["确定"],[this.dismissok],null,this,0,!1):t.PublicMethod.Instance.showConfirmPanel(r[0]+a.toString()+r[1],["确定"],[],null,this,0,!1),this.removeDissPanel();break;case t.MahjongFourFacadeConst.CHANGE_USERNUM_NOTICE:case t.MahjongFourFacadeConst.DISS_REQUEST_NOTICE:var h=t.RoomInfo.getInstance().getUserVoByUid(e.getBody().uid);h&&this.showDissPanel(e.getBody());break;case t.MahjongFourFacadeConst.CHANGE_USERNUM_BACK:case t.MahjongFourFacadeConst.DISS_NOTICE:if(this._dismissPanel){var d=e.getBody();this._dismissPanel.updateStatus(d.isAgree,d.uid)}break;case t.MahjongFourFacadeConst.NOTIFY_CHAT_RECORD:this._shortChat&&this._shortChat.setRecordData(e.getBody());break;case t.MahjongFourFacadeConst.EXIT_GAME:this.exitGame();break;case t.MahjongFourFacadeConst.RESET_RESULT_PANEL:this._gameVc.removeResultPanel();break;case t.MahjongFourFacadeConst.NOTIFY_SAME_IP:var l=e.getBody();l.sameSet&&l.sameSet.length>0&&this.ipWarnPanel(l.sameSet);break;case t.MahjongFourFacadeConst.GM_HEAP_CARD:this._gmTool&&(t.GameInfo.topLayer.addChild(this._gmTool),this._gmTool.setHeapCard(t.CardInfo.getInstance().heapCard),this._gmTool.setTypeButton(e.getBody()));break;case t.MahjongFourFacadeConst.GM_CHANGE_CARD:this._gmTool&&this._gmTool.setHeapCard(t.CardInfo.getInstance().heapCard);break;case t.MahjongFourFacadeConst.GM_DELETE:t.PublicManage.getInstance().showMildWarnShow("请等待发牌后，执行GM"),this._gmTool&&this._gmTool.destory(),this._gmTool=null;break;case t.MahjongFourFacadeConst.STOP_SREVICE_NOTICE:break;case t.MahjongFourFacadeConst.GAME_SET_BANKER:this._gameVc.updateNetWork(!0);break;case t.MahjongFourFacadeConst.SHOW_CHANGE_BTN:this._gameVc.ShowChangeIcon();break;case t.MahjongFourFacadeConst.TIMEOUT_WAIT:e.getBody();this._gameVc.updateTimeout();break;case t.MahjongFourFacadeConst.READY_SHOW:case t.MahjongFourFacadeConst.READY_NOTICE:e.getBody()===uniLib.UserInfo.uid&&this._gameVc.changeReay(),this._gameVc.updateReadyState()}},i.prototype.changeDeak=function(){var e=new Cmd.ChangeRoomMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.ipWarnPanel=function(e){for(var i="",n=0;n<e.length;n++)n==e.length-1?i+=e[n]:i=i+e[n]+",";t.PublicMethod.Instance.showConfirmPanel("玩家"+i+"IP相同,请注意",["确定"],[],null,this,0,!1)},i.prototype.initGame=function(){var e=new t.CountVc;e.x=(uniLib.Global.screenWidth-e.width)/2,e.y=uniLib.Global.screenHeight-e.height-t.CountVc.OFFSET_Y>>1,t.GameInfo.uiLayer.addChild(e),this.facade.registerMediator(new t.CountMJMediator(e));var i=new t.SeatPlayVc;t.GameInfo.uiLayer.addChild(i),this.facade.registerMediator(new t.SeatPlayerMJMediator(i));var n=new t.VoiceChat;t.GameInfo.uiLayer.addChild(n),n.updateBtnRes(["2d_voiceBtn","2d_voiceBtn"]),n.voiceButtonX=uniLib.Global.screenWidth-n.width-30,n.voiceButtonY=500,this.facade.registerMediator(new t.VoiceChatMediator(n));var s=new t.CardsVc;t.GameInfo.uiLayer.addChild(s),this.facade.registerMediator(new t.CardMJMediator(s));var a=new t.OperateVc;t.GameInfo.topLayer.addChild(a),this.facade.registerMediator(new t.OperateMJMediator(a)),this.facade.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,null,t.DataRequestCommand.CONNECT_GAME_SERVER),uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_SERVER_DEBUG_LEVEL,this.setDebugState,this)},i.prototype.setDebugState=function(t){this._gameVc.showDebugButton()},i.prototype.onTouchHandler=function(t){var e=t.target.name;e.indexOf("short")>=0||this._shortChat&&this._shortChat.visible&&this.hideShortChat()},i.prototype.getScoreList=function(){var e=new Cmd.GetRankingListRoomCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.facade.removeMediator(t.CountMJMediator.NAME),this.facade.removeMediator(t.SeatPlayerMJMediator.NAME),this.facade.removeMediator(t.CardMJMediator.NAME),this.facade.removeMediator(t.OperateMJMediator.NAME),this.facade.removeMediator(t.VoiceChatMediator.NAME),this._gameVc&&(this._gameVc.removeEventListener(t.UIEventConsts.EXCHANGE_DESK,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.READY,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.DESTORY,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_HELP,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.EXIT_GAME,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.DISMISS_GAME,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHARE_GAME,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.ACTION_HOST,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_GM_Tool,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_SETTING,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_GPS,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_STOP_SERVICE,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.SHOW_SHORT_CHAT,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GET_SCORE_DATA,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GM_SELECT_CARDS,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GM_SELECT_HANDCARD,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.GM_SELECT_HEAPCARD,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.REQUEST_CHANGE_USERNUM,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_BACK,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_ADVANCE,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_CLOSE,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.VIDEO_STOP,this.uiHandle,this),this._gameVc.removeEventListener(t.UIEventConsts.START_READY,this.uiHandle,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_L2G,this.onMoon,this),this._gameVc.destory(),this._gameVc=null),this.removeShortChat(),this.removeDissPanel(),this.removeTotalPanel(),this.removeHelp(),this.removeSetting(),uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_SERVER_DEBUG_LEVEL,this.setDebugState,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),t.MahJongFourFacede.getInstance().removeMediator(i.NAME),uniLib.delDefinitionByName(i.NAME),t.GameViewConfig.mainMediatorName=null,t.GameViewConfig.mainMediator=null},i.prototype.showTotal=function(t){egret.Tween.removeTweens(this),this.showResultPanel(t)},i.prototype.showResultPanel=function(e){egret.Tween.removeTweens(this),this._gameVc.removeResultPanel(),this._recordPanel||(this._recordPanel=new t.TotalRecordPanel,this._recordPanel.setData(e),this._recordPanel.addEventListener(t.UIEventConsts.EXIT_GAME,this.exitGame,this),t.PopupManager.addPopUp(this._recordPanel,!0,!1,!1,930,480))},i.prototype.removeTotalPanel=function(){this._recordPanel&&(t.PopupManager.removePopUp(this._recordPanel),this._recordPanel.destory(),this._recordPanel=null)},i.prototype.showHelp=function(){t.gameHelpPanel.Instance&&t.gameHelpPanel.Instance.addEventListener(t.UIEventConsts.CLOSE,this.removeHelp,this),t.PopupManager.addPopUp(t.gameHelpPanel.Instance,!0);var e=t.RoomInfo.getInstance().userList;if(e&&e.length>0)for(var i=0,n=e;i<n.length;i++){var s=n[i],a=t.RoomInfo.getInstance().getSeatNoByUserId(s.uid);t.gameHelpPanel.Instance.addUserGpsIcon(a)}},i.prototype.removeHelp=function(){t.gameHelpPanel.Instance&&(t.gameHelpPanel.Instance.removeEventListener(t.UIEventConsts.CLOSE,this.removeSetting,this),t.PopupManager.removePopUp(t.gameHelpPanel.Instance))},i.prototype.showGps=function(){t.GpsPanel.Instance&&t.GpsPanel.Instance.addEventListener(t.UIEventConsts.CLOSE,this.removeGps,this),t.PopupManager.addPopUp(t.GpsPanel.Instance,!0);var e=t.RoomInfo.getInstance().userList;if(e&&e.length>0)for(var i=0,n=e;i<n.length;i++){var s=n[i],a=t.RoomInfo.getInstance().getSeatNoByUserId(s.uid);t.GpsPanel.Instance.addUserGpsIcon(a)}},i.prototype.removeGps=function(){t.GpsPanel.Instance&&(t.GpsPanel.Instance.removeEventListener(t.UIEventConsts.CLOSE,this.removeGps,this),t.PopupManager.removePopUp(t.GpsPanel.Instance))},i.prototype.showSetting=function(){this._settingPanel||(this._settingPanel=new t.SettingPanel,this._settingPanel.addEventListener(t.UIEventConsts.CLOSE,this.hideSetting,this),this._settingPanel.addEventListener(t.UIEventConsts.CHANGE_TABLECLOTH,this.tableclothChange,this),this._settingPanel.addEventListener(t.UIEventConsts.DISMISS_GAME,this.showDismissConfirm,this)),this._settingPanel.settinggroup.x=uniLib.Global.screenWidth,this._settingPanel.closeRect.visible=!0,t.PopupManager.addPopUp(this._settingPanel,!1,!1),egret.Tween.get(this._settingPanel.settinggroup).to({x:uniLib.Global.screenWidth-this._settingPanel.settinggroup.width},300,egret.Ease.sineOut)},i.prototype.hideSetting=function(){this._settingPanel&&(this._settingPanel.closeRect.visible=!1,egret.Tween.get(this._settingPanel.settinggroup).to({x:uniLib.Global.screenWidth},300,egret.Ease.sineOut).call(this.removeSetting))},i.prototype.removeSetting=function(){this._settingPanel&&(this._settingPanel.removeEventListener(t.UIEventConsts.CLOSE,this.hideSetting,this),this._settingPanel.removeEventListener(t.UIEventConsts.DISMISS_BACK,this.showDismissConfirm,this),this._settingPanel.removeEventListener(t.UIEventConsts.AGREE_CHANGE_USERNUM,this.showDismissConfirm,this),t.PopupManager.removePopUp(this._settingPanel),this._settingPanel.destory(),this._settingPanel=null)},i.prototype.tableclothChange=function(){this._gameVc.changeTablecloth()},i.prototype.showShortChat=function(){this._shortChat?(this._shortChat.visible=!0,t.PopupManager.addPopUp(this._shortChat,!0)):(this._shortChat=new t.RoomFacePanel,this._shortChat.x=uniLib.Global.screenWidth/2-this._shortChat.width/2,this._shortChat.addEventListener(t.UIEventConsts.SEND_CHAT_RECORD,this.requestRecord,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.addEventListener(t.UIEventConsts.SEND_COMMON_TALK,this.commonTalkHandler,this),t.PopupManager.addPopUp(this._shortChat,!0))},i.prototype.requestRecord=function(){var e=new Cmd.VoiceChatRecord_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.commonTalkHandler=function(e){var i=this;if(!this._isClick)return void t.PublicManage.getInstance().showMildWarnShow("您的操作太频繁了！请休息一下吧");var n=e.data,s=new Cmd.CommonChat_C;s.words=n,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,s,t.DataRequestCommand.GAME_DATA),uniLib.NetMgr.setMsgTimeout(8,"CommonChat_C"),this._isClick=!1,setTimeout(function(){i._isClick=!0},3e3),this.hideShortChat()},i.prototype.commonChatHandler=function(e){var i=this;if(!this._isClick)return void t.PublicManage.getInstance().showMildWarnShow("您的操作太频繁了！请休息一下吧");var n=e.data,s=new Cmd.CommonChat_C;s.voiceId=Number(n),this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,s,t.DataRequestCommand.GAME_DATA),this._isClick=!1,setTimeout(function(){i._isClick=!0},3e3),this.hideShortChat()},i.prototype.hideShortChat=function(){this._shortChat&&(this._shortChat.visible=!1,t.PopupManager.removePopUp(this._shortChat))},i.prototype.removeShortChat=function(){this._shortChat&&(this._shortChat.removeEventListener(t.UIEventConsts.SEND_CHAT_RECORD,this.requestRecord,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_TALK,this.commonTalkHandler,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.removeEventListener(t.UIEventConsts.SEND_COMMON_CHAT,this.commonChatHandler,this),this._shortChat.destory()),this._shortChat=null},i.prototype.showGmTool=function(){this._gmTool?(t.RoomInfo.getInstance().isShowGMTool=!1,this._gmTool.destory(),this._gmTool=null):(this._gmTool=new t.RoomGmTool,t.RoomInfo.getInstance().isShowGMTool=!0,this.requestGm())},i.prototype.requestGm=function(){var e=new Cmd.HeapCardGmMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.showShare=function(){var e=new uniLib.WXShareVo;e.shareWay=0,t.DataCache.platParam&&(e.title=t.DataCache.platParam.shareInfo.title,e.description=t.DataCache.platParam.shareInfo.content+t.RoomInfo.getInstance().getAllNames(),e.webpageUrl=t.DataCache.platParam.shareInfo.webPageUrl),uniLib.ZQGameSdk.share(e,null,this)},i.prototype.showDismissConfirm=function(){var e=e=t.DataCache.langObj.alertTxt.dismissTip;this.hideSetting(),t.PublicMethod.Instance.showConfirmPanel(e,["确定","取消"],[this.onDismissYesHandler],null,this)},i.prototype.showLeaveRoom=function(){t.PublicMethod.Instance.showConfirmPanel("确定要退出房间",["确定","取消"],[this.onLeaveRoom],null,this)},i.prototype.onLeaveRoom=function(){var e=new Cmd.LeaveMahjongCmd_C;e.state=0,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.startReady=function(){var e=new Cmd.ReadyStartMahjongCmd_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)},i.prototype.onDismissYesHandler=function(e){var i=new Cmd.RequestDissolveRoom_C;this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA)},i.prototype.dismissok=function(e){this._dismissPanel&&this.removeDissPanel();var i=t.GameData.getInstance().recordInfo;i?this.showResultPanel(i):this.exitGame()},i.prototype.showDissPanel=function(e){null!=e&&(this._dismissPanel&&this.removeDissPanel(),this._dismissPanel||(this._dismissPanel=new t.DismissPanel,this._dismissPanel.x=uniLib.Global.screenWidth-this._dismissPanel.width>>1,this._dismissPanel.y=uniLib.Global.screenHeight-this._dismissPanel.height>>1,this._dismissPanel.setData(e),this._dismissPanel.addEventListener(t.UIEventConsts.CLOSE,this.dissHandle,this),this._dismissPanel.addEventListener(t.UIEventConsts.DISMISS_BACK,this.dissHandle,this),this._dismissPanel.addEventListener(t.UIEventConsts.AGREE_CHANGE_USERNUM,this.dissHandle,this)),t.PopupManager.addPopUp(this._dismissPanel,!0,!1))},i.prototype.removeDissPanel=function(){this._dismissPanel&&(this._dismissPanel.removeEventListener(t.UIEventConsts.CLOSE,this.dissHandle,this),this._dismissPanel.removeEventListener(t.UIEventConsts.DISMISS_BACK,this.dissHandle,this),this._dismissPanel.removeEventListener(t.UIEventConsts.AGREE_CHANGE_USERNUM,this.dissHandle,this),t.PopupManager.removePopUp(this._dismissPanel),this._dismissPanel.destory()),this._dismissPanel=null},i.prototype.dissHandle=function(e){switch(e.type){case t.UIEventConsts.DISMISS_BACK:var i=new Cmd.ReplyDissolveRoom_C;i.isAgree=e.data,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA);break;case t.UIEventConsts.CLOSE:this.removeDissPanel();break;case t.UIEventConsts.AGREE_CHANGE_USERNUM:var n=new Cmd.ReturnChangeUserNbrRoom_C;n.isAgree=e.data,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,n,t.DataRequestCommand.GAME_DATA),this.removeDissPanel()}},i.prototype.exitGame=function(){if(0==t.RoomInfo.getInstance().video){var e=new Cmd.LeaveMahjongCmd_C;e.state=0,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA)}if(t.DataCache.gameInfo&&t.DataCache.gameInfo.defaultOrientation!=egret.OrientationMode.LANDSCAPE&&(uniLib.ScreenUtils.landscape=!1),uniLib.GameModuleUtils.ExitGame(!1),uniLib.Global.lobbyMode){var i=RES.destroyRes("HNZZRes",!0);uniLib.ResUtils.clearResConfigByGroupName(["HNZZRes"]),console.error("destroyRes"+i)}},i.prototype.requestChange=function(){if(""!=this._mySelect&&""!=this._gmSelect){var e=new Cmd.ChangeCardGmMahjongCmd_C;e.newCardId=Number(this._gmSelect),e.oldCardId=Number(this._mySelect),this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,e,t.DataRequestCommand.GAME_DATA),this._gmSelect="",this._mySelect=""}},i.prototype.requestChanges=function(e){var i=new Cmd.ChangeCardGmMahjongCmd_C;i.cardButtonId=e,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA)},i.prototype.showStopServiceNotice=function(){this._stopServicePanel||(this._stopServicePanel=new t.StopServicePanel),t.PopupManager.addPopUp(this._stopServicePanel,!0,!0),this._stopServicePanel.addEventListener(t.UIEventConsts.CLOSE,this.removeStopNotice,this)},i.prototype.removeStopNotice=function(){this._stopServicePanel&&(this._stopServicePanel.removeEventListener(t.UIEventConsts.CLOSE,this.removeStopNotice,this),t.PopupManager.removePopUp(this._stopServicePanel),this._stopServicePanel.destory(),this._stopServicePanel=null)},i.prototype.onMoon=function(t){switch(t.param){case"video_play_finish":this.showVideoFinish(0)}},i.prototype.showVideoFinish=function(e){var i=new t.MsgBoxPanel;i.x=uniLib.Global.screenWidth-i.width>>1,i.y=uniLib.Global.screenHeight-i.height>>1,t.GameInfo.main.addChild(i),0==e?i.setData("","录像播放完毕",["确定"],[this.videoExit],this):i.setData("","确定退出录像？",["确定"],[this.videoExit],this)},i.prototype.videoExit=function(){uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_close"),this.exitGame(),t.RoomInfo.getInstance().GM_Mode=!1},i.prototype.videoReplay=function(){uniLib.Global.dispatchEvent(uniLib.ZqEvent.EVENT_G2L,"video_replay")},i}(puremvc.Mediator);e.NAME="HNHZGameMJMediator",t.HNHZGameMJMediator=e,__reflect(e.prototype,"game.HNHZGameMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s._menuVc=n,s._menuVc.addEventListener(t.UIEventConsts.ACTION_CANCEL,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_CHOW,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_PONG,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_KONG,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.STOP_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ARROW_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.STOP_ARROW_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_WIN,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_TRUSTEESHIP,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_RECORD,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.START_READYHAND,s.onOperate,s),s._menuVc.addEventListener(t.UIEventConsts.ACTION_OPERATE,s.onOperate,s),s}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this._menuVc&&(this._menuVc.removeEventListener(t.UIEventConsts.ACTION_CANCEL,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_CHOW,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_PONG,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_KONG,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.STOP_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ARROW_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.STOP_ARROW_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_WIN,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_TRUSTEESHIP,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_RECORD,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.START_READYHAND,this.onOperate,this),this._menuVc.removeEventListener(t.UIEventConsts.ACTION_OPERATE,this.onOperate,this),this._menuVc.destory(),this._menuVc=null)},i.prototype.onOperate=function(e){var i,n=e.type;switch(n){case t.UIEventConsts.ACTION_CANCEL:i=new Cmd.CancelOpMahjongCmd_C;break;case t.UIEventConsts.ACTION_PONG:i=new Cmd.TouchCardMahjongCmd_C,i.thisId=e.data;break;case t.UIEventConsts.ACTION_KONG:i=new Cmd.BarCardMahjongCmd_C,i.thisId=e.data;break;case t.UIEventConsts.ACTION_WIN:i=new Cmd.WinMahjongCmd_C;break;case t.UIEventConsts.ACTION_TRUSTEESHIP:i=new Cmd.HostMahjongCmd_C,i.bHost=e.data;break;case t.UIEventConsts.ACTION_RECORD:break;case t.UIEventConsts.ACTION_OPERATE:this.sendNotification(t.MahjongFourFacadeConst.NOTIFY_SELECT_GOLDOUT);break;case t.UIEventConsts.ACTION_CHOW:i=new Cmd.EatCardMahjongCmd_C,i.one=t.CardInfo.getInstance().eatObj.one,i.two=t.CardInfo.getInstance().eatObj.two}i&&(this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA),t.MahJongFourFacede.getInstance().sendNotification(t.MahjongFourFacadeConst.REMOVE_ACTION),uniLib.NetMgr.setMsgTimeout(8,"OutCardMahjongCmd_C"))},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.DRAW,t.MahjongFourFacadeConst.PONG,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.DRAW_NOTICE,t.MahjongFourFacadeConst.SHOW_ACTION,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.KONG_NOTICE,t.MahjongFourFacadeConst.PONG_NOTICE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.REMOVE_ACTION,t.MahjongFourFacadeConst.DISCARD_NOTICE,t.MahjongFourFacadeConst.START_WIN_NOTICE,t.MahjongFourFacadeConst.CHOW_NOTICE]},i.prototype.handleNotification=function(e){var i=0;switch(e.getName()){case t.MahjongFourFacadeConst.RESET_TABLE:this._menuVc.startGame();break;case t.MahjongFourFacadeConst.GAME_START:this._menuVc.startGame();break;case t.MahjongFourFacadeConst.DISCARD_NOTICE:t.RoomInfo.getInstance().outerId==uniLib.UserInfo.uid&&this._menuVc.removeAction(),t.RoomInfo.getInstance().OutCard.opType&&t.RoomInfo.getInstance().OutCard.opType[0]&&this._menuVc.showAction(t.RoomInfo.getInstance().OutCard.thisId,t.RoomInfo.getInstance().OutCard.opType);break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._menuVc.removeAction();var n=e.getBody();0==n.thisId&&this._menuVc.startOver();break;case t.MahjongFourFacadeConst.REMOVE_ACTION:this._menuVc.removeAction();break;case t.MahjongFourFacadeConst.SHOW_ACTION:this._menuVc.showAction(null,e.getBody().opType);break;case t.MahjongFourFacadeConst.PONG:break;case t.MahjongFourFacadeConst.CHOW_NOTICE:case t.MahjongFourFacadeConst.KONG_NOTICE:case t.MahjongFourFacadeConst.PONG_NOTICE:this._menuVc.removeAction();break;case t.MahjongFourFacadeConst.DRAW:this._menuVc.removeAction();var s=e.getBody();i=s.barSet&&0!=s.barSet.length?s.barSet[0]:s.thisId,this._menuVc.showAction(i,s.opType);break;case t.MahjongFourFacadeConst.DRAW_NOTICE:var a=e.getBody();a.uid!=uniLib.UserInfo.uid&&this._menuVc.removeAction();break;case t.MahjongFourFacadeConst.START_WIN_NOTICE:}},i}(puremvc.Mediator);e.NAME="OperateMJMediator",t.OperateMJMediator=e,__reflect(e.prototype,"game.OperateMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(n){var s=e.call(this,i.NAME,n)||this;return s._requestUid=0,s._isClick=!0,s._seatVc=n,s._seatVc.addEventListener(t.UIEventConsts.SHOW_USER_INFO,s.uiEventHandle,s),s
}return __extends(i,e),i.prototype.uiEventHandle=function(e){var i=e.type;switch(i){case t.UIEventConsts.SHOW_USER_INFO:this._requestUid!=e.data&&(this.getUserData(e.data),this._requestUid=e.data),this.showUserInfoPanel()}},i.prototype.onRegister=function(){e.prototype.onRegister.call(this)},i.prototype.listNotificationInterests=function(){return[t.MahjongFourFacadeConst.RELOGIN,t.MahjongFourFacadeConst.NOTIFY_HOST,t.MahjongFourFacadeConst.GAME_START,t.MahjongFourFacadeConst.PLAYER_LEFT,t.MahjongFourFacadeConst.RESET_TABLE,t.MahjongFourFacadeConst.READY_NOTICE,t.MahjongFourFacadeConst.RESULT_NOTICE,t.MahjongFourFacadeConst.USERINFO_DATA,t.MahjongFourFacadeConst.PLAYER_CONNECT,t.MahjongFourFacadeConst.USER_ENTER_ROOM,t.MahjongFourFacadeConst.PLAYER_ENTER_ROOM,t.MahjongFourFacadeConst.PLAYER_DISCONNECT,t.MahjongFourFacadeConst.SEND_GIFTS_NOTICE,t.MahjongFourFacadeConst.NOTIFY_POINT_CHANGE,t.MahjongFourFacadeConst.NOTIFY_ONLINE_STATE,t.MahjongFourFacadeConst.UPDATA_USER_POINT,t.MahjongFourFacadeConst.GAME_SET_BANKER,t.MahjongFourFacadeConst.PLAYER_LEFT_SEAT,t.MahjongFourFacadeConst.TIMEOUT_WAIT,t.MahjongFourFacadeConst.CHANGE_REMAINDER_COUNT,t.MahjongFourFacadeConst.UPDATA_USER_CHIP]},i.prototype.handleNotification=function(e){switch(e.getName()){case t.MahjongFourFacadeConst.UPDATA_USER_CHIP:this._seatVc.updateGoldChips(e.getBody());break;case t.MahjongFourFacadeConst.USER_ENTER_ROOM:this._seatVc.initSeat();break;case t.MahjongFourFacadeConst.PLAYER_ENTER_ROOM:var i=e.getBody();i.uid!=uniLib.UserInfo.uid&&(this._seatVc.addSeatPlayer(i),this._seatVc.updateStatus(i.uid,Cmd.OnlineState.OnlineState_Online));break;case t.MahjongFourFacadeConst.PLAYER_LEFT:this._seatVc.removePlayer(e.getBody());break;case t.MahjongFourFacadeConst.TIMEOUT_WAIT:var n=e.getBody();this._seatVc.Timeout(n);break;case t.MahjongFourFacadeConst.CHANGE_REMAINDER_COUNT:this._seatVc.cancelTimeout();break;case t.MahjongFourFacadeConst.RELOGIN:this._seatVc.initSeat();var s=e.getBody();s.userCard.handCardSet&&s.userCard.handCardSet.length>0&&this._seatVc.resetReady();break;case t.MahjongFourFacadeConst.READY_NOTICE:this._seatVc.refreshPlayerReady(t.RoomInfo.getInstance().readyUsers);break;case t.MahjongFourFacadeConst.RESULT_NOTICE:this._seatVc.updatePlayers(t.RoomInfo.getInstance().chipsSets);break;case t.MahjongFourFacadeConst.USERINFO_DATA:this._userInfoPanel&&this._userInfoPanel.setData(e.getBody());break;case t.MahjongFourFacadeConst.SEND_GIFTS_NOTICE:this._seatVc.showGift(e.getBody());break;case t.MahjongFourFacadeConst.GAME_START:this._seatVc.reset(),this._seatVc.resetReady();break;case t.MahjongFourFacadeConst.RESET_TABLE:break;case t.MahjongFourFacadeConst.PLAYER_CONNECT:var a=e.getBody();if(this._seatVc.updateStatus(a.uid,Cmd.OnlineState.OnlineState_Online),a.uid!=uniLib.UserInfo.uid){var o=t.RoomInfo.getInstance().getUserVoByUid(a.uid).nickName;t.PublicManage.getInstance().showMildWarnShow("玩家"+o+"已回来")}break;case t.MahjongFourFacadeConst.PLAYER_DISCONNECT:var r=e.getBody();this._seatVc.updateStatus(r.uid,r.state);var o=t.RoomInfo.getInstance().getUserVoByUid(r.uid).nickName;if(r.state==Cmd.OnlineState.OnlineState_Leave&&r.uid!=uniLib.UserInfo.uid)return;if(r.state==Cmd.OnlineState.OnlineState_Online)return;t.PublicManage.getInstance().showMildWarnShow("玩家"+o+"已断线，请等待");break;case t.MahjongFourFacadeConst.NOTIFY_ONLINE_STATE:var h=e.getBody();this._seatVc.updateStatus(h.uid,h.state);break;case t.MahjongFourFacadeConst.NOTIFY_POINT_CHANGE:break;case t.MahjongFourFacadeConst.UPDATA_USER_POINT:if(!t.RoomInfo.getInstance().pointSet)return;for(var d=0;d<t.RoomInfo.getInstance().pointSet.length;d++)this._seatVc.floatPoint(t.RoomInfo.getInstance().pointSet[d]);break;case t.MahjongFourFacadeConst.NOTIFY_HOST:var l=e.getBody();1==l.hostType?this._seatVc.updateStatus(l.uid,5):this._seatVc.updateStatus(l.uid,1)}},i.prototype.showUserInfoPanel=function(){this._userInfoPanel?this._userInfoPanel.reset():(this._userInfoPanel=new t.UserInfoPanel,this._userInfoPanel.x=uniLib.Global.screenWidth-this._userInfoPanel.width>>1,this._userInfoPanel.y=uniLib.Global.screenHeight-this._userInfoPanel.height>>1,this._userInfoPanel.addEventListener(t.UIEventConsts.GIFT_SEND,this.onUserPanelHandle,this),this._userInfoPanel.addEventListener(t.UIEventConsts.CLOSE,this.onUserPanelHandle,this),this._userInfoPanel.addListener()),t.PopupManager.addPopUp(this._userInfoPanel,!0,!1)},i.prototype.onUserPanelHandle=function(e){var i=this,n=e.type;switch(n){case t.UIEventConsts.GIFT_SEND:if(this._isClick){var s=new Cmd.SendGiftMahjongCmd_C;s.gift=e.data,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,s,t.DataRequestCommand.GAME_DATA),t.PopupManager.removePopUp(this._userInfoPanel),this.hideUserInfo(),this._isClick=!1,setTimeout(function(){i._isClick=!0},2600)}else t.PublicManage.getInstance().showMildWarnShow("您的操作太频繁了！请休息一下吧");break;case t.UIEventConsts.CLOSE:t.PopupManager.removePopUp(this._userInfoPanel),this.hideUserInfo()}},i.prototype.hideUserInfo=function(){this._isClick=!0,this._requestUid=0},i.prototype.removeUserInfo=function(){this._isClick=!0,this._userInfoPanel&&(this._userInfoPanel.removeEventListener(t.UIEventConsts.GIFT_SEND,this.onUserPanelHandle,this),this._userInfoPanel.removeEventListener(t.UIEventConsts.CLOSE,this.onUserPanelHandle,this),this._userInfoPanel.destory(),this._userInfoPanel=null),this._requestUid=0},i.prototype.getUserData=function(e){var i=new Cmd.GetPersonalPanel_C;i.uid=e,this.sendNotification(t.MahjongFourFacadeConst.SEND_DATA,i,t.DataRequestCommand.GAME_DATA),uniLib.NetMgr.setMsgTimeout(8,"GetPersonalPanel_C")},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.removeUserInfo(),this._seatVc&&(this._seatVc.removeEventListener(t.UIEventConsts.SHOW_USER_INFO,this.uiEventHandle,this),this._seatVc.destory(),this._seatVc=null)},i}(puremvc.Mediator);e.NAME="SeatPlayerMJMediator",t.SeatPlayerMJMediator=e,__reflect(e.prototype,"game.SeatPlayerMJMediator")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._sendCardNArr=[12,12,12,12,1,1,1,1,1],t}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),egret.Tween.removeAllTweens(),this._lieTu&&uniLib.DisplayUtils.removeFromParent(this._lieTu),this._lieTu=null,this._listenCardPanel&&this._listenCardPanel.destory(),this._listenCardPanel=null,this._actionEffect&&this._actionEffect.destory(),this._actionEffect=null,this._diceMc&&this._diceMc.destory(),this._diceMc=null,this._pointMc&&(this._pointMc.stop(),t.ResUtil.removeFromParent(this._pointMc)),this._pointMc=null,this._startMc&&this._startMc.destory(),this._startMc=null,this._bankMc&&this._bankMc.destory(),this._bankMc=null,this._bankPanel&&(uniLib.DisplayUtils.removeAllChildren(this._bankPanel),uniLib.DisplayUtils.removeFromParent(this._bankPanel)),this._bankPanel=null;var i;if(this._cardSideArr)for(i=0;4>i;i++)0==i&&(this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),this._cardSideArr[i]&&this._cardSideArr[i].removeEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this)),this._cardSideArr[i]&&this._cardSideArr[i].destory();if(this._cardSideArr=null,this._moveCardArr)for(i=0;i<this._moveCardArr.length;i++)this._moveCardArr[i].destory();if(this._moveCardArr=null,this._moveStackArr)for(i=0;i<this._moveStackArr.length;i++)this._moveStackArr[i].destory();this._moveStackArr=null,this._sendCardNArr=null},i.prototype.initUI=function(){this._moveStackArr=[],this._moveCardArr=[],this._cardSideArr=[],this._actionEffect=new t.ActionEffectMc,this._bankPanel=new egret.Sprite,this.addChild(this._bankPanel)},i.prototype.creatUserCardSide=function(){if(this._cardSideArr){for(var e=0;e<this._cardSideArr.length;e++)0==e&&(this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),this._cardSideArr[e]&&this._cardSideArr[e].removeEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this)),this._cardSideArr[e]&&this._cardSideArr[e].destory();this._cardSideArr.length=0}var i=t.RoomInfo.getInstance().playerNumber;if(!(this._cardSideArr.length>0)){if(2==i){var n=new t.UserSideCard0;n.addEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this),this._cardSideArr[0]=n;var s=new t.UserSideCard2;this.addChild(s),this._cardSideArr[2]=s,this.addChild(n)}else if(3==i){var n=new t.UserSideCard0;n.addEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this),this._cardSideArr[0]=n;var s=new t.UserSideCard1;this.addChild(s),this._cardSideArr[1]=s;var a=new t.UserSideCard3;this.addChild(a),this._cardSideArr[3]=a,this.addChild(n)}else{var n=new t.UserSideCard0;n.addEventListener(t.UIEventConsts.ACTION_HOST,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_DISCARD,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.REMOVE_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.ACTION_READYHAND,this.onUserSideHandle,this),n.addEventListener(t.UIEventConsts.USER_DODISCARD_FAIL,this.onUserSideHandle,this),this._cardSideArr.push(n);var o=new t.UserSideCard1;this.addChild(o),this._cardSideArr.push(o);var s=new t.UserSideCard2;this.addChild(s),this._cardSideArr.push(s);var a=new t.UserSideCard3;this.addChild(a),this._cardSideArr.push(a),this.addChild(n)}this._actionEffect&&this.addChild(this._actionEffect)}},i.prototype.onUserSideHandle=function(t){this.dispatchEvent(t)},i.prototype.resetTable=function(){this.resetCards(),this._actionEffect.clearEffect(),this._bankMc&&this._bankMc.destory(),this._bankMc=null,uniLib.DisplayUtils.removeFromParent(this._lieTu),this._lieTu=null,uniLib.DisplayUtils.removeAllChildren(this._bankPanel)},i.prototype.startGame=function(){this.resetTable(),this.showStartEffect(),uniLib.SoundMgr.instance.playSound(t.SoundConsts.START)},i.prototype.setBanker=function(e){var i=this;this._startMc&&this._startMc.destory(),this._startMc=null,this.showBanker(),0!=t.RoomInfo.getInstance().diceTime&&(e.one||(e.one=1,e.two=1),egret.setTimeout(function(){i.showDice(e)},this,1e3),egret.setTimeout(function(){i.clearDice()},this,3e3))},i.prototype.startSendCards=function(){for(var e=0;4>e;e++)this._cardSideArr[e]&&this._cardSideArr[e].resetCard();if(t.RoomInfo.getInstance().shuffleUid&&1!=t.RoomInfo.getInstance().video){this.addShuffleMc();var i=this;uniLib.SetUniEventTimeout(this,function(){i.removeShuffleMc(),i.sendCards()},2e3,1,this,null)}else this.sendCards()},i.prototype.showStartEffect=function(){this._startMc||(this._startMc=new t.StartEffectMc,this.addChild(this._startMc)),this._startMc.play()},i.prototype.showDice=function(e){this._diceMc||(this._diceMc=new t.DiceMc,this.addChild(this._diceMc)),this._diceMc.showDice(e)},i.prototype.showBanker=function(e){void 0===e&&(e=!0),uniLib.DisplayUtils.removeAllChildren(this._bankPanel),this._bankMc||(this._bankMc=new t.BankerEffectMc,this._bankPanel.addChild(this._bankMc)),this._bankMc.show(e)},i.prototype.refreshBanker=function(){if(null!=this._bankPanel){uniLib.DisplayUtils.removeAllChildren(this._bankPanel);var e=t.ResUtil.createBitmapByName("game_bank"),i=t.SeatPlayVc.seatPosArr[t.RoomInfo.getInstance().bankerSeatId];if(!i){var n=this;return void setTimeout(function(){n.refreshBanker()},1e3)}e.x=i.x-5,e.y=i.y-5,this._bankPanel.addChild(e)}},i.prototype.addShuffleMc=function(){this._fingerClickMc=uniLib.DisplayUtils.createMovieClicp("fingerClick_mc"),this.addChild(this._fingerClickMc),this._fingerClickMc.x=uniLib.Global.screenWidth/2-35,this._fingerClickMc.y=uniLib.Global.screenHeight/2-60,this._fingerClickMc.play(1),uniLib.SetUniEventTimeout(this,function(){uniLib.SoundMgr.instance.playSound("shuffleCard_mp3")},1e3,1,this,null);var e=t.RoomInfo.getInstance().getUserVoByUid(t.RoomInfo.getInstance().shuffleUid);e&&(this._shuffleBg=new eui.Image("shuffle_bg"),this._shuffleBg.x=(uniLib.Global.screenWidth-this._shuffleBg.width)/2-220,this._shuffleBg.y=uniLib.Global.screenHeight/2+140,this.addChild(this._shuffleBg),this._shuffleLabel=new eui.Label,this._shuffleLabel.text=e.nickName+"开始洗牌...",this._shuffleLabel.textColor=16767334,this._shuffleLabel.x=(uniLib.Global.screenWidth-this._shuffleLabel.width)/2,this._shuffleLabel.y=uniLib.Global.screenHeight/2+150,this.addChild(this._shuffleLabel))},i.prototype.removeShuffleMc=function(){uniLib.SoundMgr.instance.stopSound("shuffleCard_mp3"),this._fingerClickMc&&this._fingerClickMc.parent&&(this._fingerClickMc.stop(),this.removeChild(this._fingerClickMc),this._fingerClickMc=null),this._shuffleLabel&&this._shuffleLabel.parent&&(this.removeChild(this._shuffleLabel),this._shuffleLabel=null),this._shuffleBg&&this._shuffleBg.parent&&(this.removeChild(this._shuffleBg),this._shuffleBg=null)},i.prototype.sendCards=function(){for(var e,i,n,s,a,o=new egret.Point(560,280),r=0;r<this._sendCardNArr.length;r++)4==this._sendCardNArr[r]?(e=n=new t.CardStack,n.x=o.x,n.y=o.y,n.setType(r%4+1),this.addChild(n)):(e=s=new t.BlurBackCard,s.x=o.x,s.y=o.y,s.setType(r%4+1),this.addChild(s)),e.visible=!1,a=this._cardSideArr[r%4],a&&(i=a.getSendPos(4*Math.ceil(r/4)),r==this._sendCardNArr.length-1?egret.Tween.get(e).wait(1).call(this.startMovie,this,[e,i,a,this._sendCardNArr[r],!0]):egret.Tween.get(e).wait(1).call(this.startMovie,this,[e,i,a,this._sendCardNArr[r],!1]))},i.prototype.startMovie=function(e,i,n,s,a){void 0===a&&(a=!1),null!=e&&(egret.Tween.removeTweens(e),e.visible=!0,t.RoomInfo.getInstance().shuffleUid&&1!=t.RoomInfo.getInstance().video&&(e.visible=!1),egret.Tween.get(e).to({x:i.x,y:i.y},100,egret.Ease.circOut).call(this.movieEnd,this,[e,n,s,a]))},i.prototype.movieEnd=function(e,i,n,s){if(void 0===i&&(i=null),void 0===n&&(n=1),void 0===s&&(s=!1),null!=e&&(egret.Tween.removeTweens(e),e&&e.parent&&(1==n?this._moveCardArr.push(e):this._moveStackArr.push(e),e.parent.removeChild(e)),i&&i.sendCards(n),s)){if(t.RoomInfo.getInstance().isTween=!1,null==this._cardSideArr)return;t.CardInfo.getInstance().bankerThisId&&(t.CardInfo.getInstance().addMyCard(t.CardInfo.getInstance().bankerThisId),t.CardInfo.getInstance().bankerThisId=null),t.GameData.getInstance().isMyTime&&this.setEnable(!0);for(var a=0;4>a;a++)if(this._cardSideArr[a]){t.CardInfo.getInstance().getHandCardBySeat(a);this._cardSideArr[a].refreshOperate(a),this._cardSideArr[a].sortCard(),t.RoomInfo.getInstance().shuffleUid&&1!=t.RoomInfo.getInstance().video&&this._cardSideArr[a].groupingSendCards()}}},i.prototype.reloginFlower=function(e){e.userCard.flowerCardSet&&this._cardSideArr[0]&&this._cardSideArr[0].reloginFlower(e.userCard.flowerCardSet);var i=e.otherCard;if(!(null==i||i.length<=0))for(var n=0;n<i.length;n++){var s=t.RoomInfo.getInstance().getSeatNoByUserId(i[n].uid);this._cardSideArr[s]&&this._cardSideArr[s].reloginFlower(i[n].flowerCardSet)}},i.prototype.fillFlower=function(e){this.showOperateEffect(0,e.uid);var i=t.RoomInfo.getInstance().getSeatNoByUserId(e.uid);this._cardSideArr[i]&&this._cardSideArr[i].fillFlower(i,e.flowerSet)},i.prototype.setUserCards=function(){for(var e,i=t.RoomInfo.getInstance().userList,n=0;n<i.length;n++)e=t.RoomInfo.getInstance().getSeatNoByUserId(i[n].uid),this._cardSideArr[e]&&(this._cardSideArr[e].uid=i[n].uid,this._cardSideArr[e].handCardsArr=t.CardInfo.getInstance().getHandCardBySeat(e))},i.prototype.setEnable=function(e){e?(t.GameData.getInstance().waitCard=0,this._cardSideArr[0].setEnable(!0)):this._cardSideArr[0].setEnable(!1)},i.prototype.clearWaitCard=function(){for(var t=0;4>t;t++)this._cardSideArr[t]&&this._cardSideArr[t].movieEnd(null)},i.prototype.drawNotice=function(e){var i;if(this.clearWaitCard(),i=1==t.RoomInfo.getInstance().video?t.RoomInfo.getInstance().getSeatNoByUserId(e.ownerid):t.RoomInfo.getInstance().getSeatNoByUserId(e.uid),0!=i){e.uid!=uniLib.UserInfo.uid&&this._cardSideArr[i]&&this._cardSideArr[i].doDraw(e.thisId);var n=new egret.Point(560,280),s=new egret.Point;this._cardSideArr[i]&&(s=this._cardSideArr[i].getSendPos(13));var a;this._moveCardArr.length>0?(a=this._moveCardArr[0],a.name="BlurCard",this._moveCardArr.splice(0,1)):(a=new t.BlurBackCard,a.name="BlurCard"),a.setType(i%2+1),a.x=n.x,a.y=n.y,this.addChild(a),egret.Tween.get(a).to({x:s.x,y:s.y,alpha:.5},100,egret.Ease.circOut).call(this.movieEnd,this,[a])}},i.prototype.draw=function(t){this.doDraw(t)},i.prototype.doDraw=function(t){this._cardSideArr[0].cacheAsBitmap=!0,egret.Tween.removeTweens(this),this._cardSideArr[0].doDraw(t),this.setEnable(!0)},i.prototype.doDiscard=function(e,i){var n=(t.RoomInfo.getInstance().getUserVoByUid(e),t.RoomInfo.getInstance().getSeatNoByUserId(e)),s=new egret.Point;this._cardSideArr[n]&&(s=this._cardSideArr[n].doDiscard(i,n),0==n?this._lastOutCardPoint=this._cardSideArr[n].outPutCards.getCurOutPutPos():this._lastOutCardPoint=s),0!=n&&this._cardSideArr[n].refreshOperate(n),egret.Tween.removeTweens(this._cardSideArr[n]),this.showPointMc(this._lastOutCardPoint,this._cardSideArr[n])},i.prototype.showPointMc=function(t,e){e&&egret.Tween.removeTweens(e),this._pointMc||(this._pointMc=uniLib.DisplayUtils.createMovieClicp("baoshi"),this.addChild(this._pointMc)),null!=t&&(this._pointMc.x=t.x,this._pointMc.y=t.y-20,this._pointMc.visible=!0,this._pointMc.play(-1))},i.prototype.hidePointMc=function(){this._pointMc&&(this._pointMc.stop(),this._pointMc&&t.ResUtil.removeFromParent(this._pointMc)),this._pointMc=null},i.prototype.showOperateEffect=function(e,i){this._actionEffect.showEffect(e,i),t.GameInfo.topLayer.addChild(this._actionEffect)},i.prototype.showWinEffect=function(e,i){this._actionEffect.showWinEffect(e,i),t.GameInfo.topLayer.addChild(this._actionEffect),this.clearWaitCard()},i.prototype.doKong=function(t){this._cardSideArr[t.seatId]&&this._cardSideArr[t.seatId].refreshOperate(t.seatId),t.type==Cmd.MahjongOpCardType.MahjongOpCardType_BarOther&&this.removeOutPutCard(t.fromSeatId,t.thisId),this.showOperateEffect(Cmd.MahjongOpCardType.MahjongOpCardType_Bar,t.uid),this.clearWaitCard()},i.prototype.doPong=function(t){this._cardSideArr[t.seatId]&&this._cardSideArr[t.seatId].refreshOperate(t.seatId),this.removeOutPutCard(t.fromSeatId,t.thisId),this.showOperateEffect(Cmd.MahjongOpCardType.MahjongOpCardType_Touch,t.uid),this.clearWaitCard()},i.prototype.doChow=function(t){this._cardSideArr[t.seatId]&&this._cardSideArr[t.seatId].refreshOperate(t.seatId),this.removeOutPutCard(t.fromSeatId,t.thisId),this.showOperateEffect(Cmd.MahjongOpCardType.MahjongOpCardType_Eat,t.uid),this.clearWaitCard()},i.prototype.setRelogindata=function(t){this.resetCards();for(var e=0;4>e;e++)0==e?(this._cardSideArr[0].setReloginData(),this._cardSideArr[0].refreshHandCards()):this._cardSideArr[e]&&this._cardSideArr[e].setReloginData();this.reloginFlower(t)},i.prototype.resetCards=function(){this.hidePointMc();for(var t=0;4>t;t++)this._cardSideArr[t]&&this._cardSideArr[t].resetCard()},i.prototype.doWin=function(t){var e=t.rewardSet;this.showWinEff(e,t.thisId)},i.prototype.showWinEff=function(t,e){var i=this;egret.setTimeout(function(){i.showOtherHandCard(t,e)},null,1e3);for(var n=0;n<t.length;n++){var s=t[n];0!=s.animation&&this.showWinEffect(s,s.uid)}},i.prototype.showOtherHandCard=function(e,i){if(null!=this._cardSideArr)for(var n=0;n<e.length;n++){var s=t.RoomInfo.getInstance().getSeatNoByUserId(e[n].uid);1==e[n].winType&&e[n].userCard.handCardSet.remove(i)&&e[n].userCard.handCardSet.push(i),(1==e[n].winType||2==e[n].winType)&&this._cardSideArr[s].showUserHandCard(s,e[n].userCard.handCardSet,!0)}},i.prototype.showLightEff=function(e){var i=t.RoomInfo.getInstance().getSeatNoByUserId(1),n=t.CardInfo.getInstance().getOutCardBySeat(i).indexOf(e.thisId);-1!=n&&this._lastOutCardPoint&&(this._lightMc=uniLib.DisplayUtils.createMovieClicp("win_light"),this._lightMc.x=this._lastOutCardPoint.x,this._lightMc.y=this._lastOutCardPoint.y,this._lightMc.addEventListener(egret.Event.COMPLETE,this.onMcPlayerComplete,this),this.addChild(this._lightMc),this._lightMc.gotoAndPlay(1,1),0==i?(this._lieTu=uniLib.DisplayUtils.createBitmapByName("lietu"),this._lieTu.width=43,this._lieTu.height=60,this._lieTu.x=this._lastOutCardPoint.x-25):2==i?(this._lieTu=uniLib.DisplayUtils.createBitmapByName("lietu03"),this._lieTu.width=44,this._lieTu.height=60,this._lieTu.x=this._lastOutCardPoint.x-24):(this._lieTu=uniLib.DisplayUtils.createBitmapByName("lietu02"),this._lieTu.width=60,this._lieTu.height=46,this._lieTu.x=this._lastOutCardPoint.x-30),this._lieTu.y=this._lastOutCardPoint.y,uniLib.SoundMgr.instance.playSound(t.SoundConsts.LIGHT),setTimeout(function(){this._lieTu&&this.addChild(this._lieTu)},500))},i.prototype.onMcPlayerComplete=function(t){var e=t.target;e&&(e.stop(),e.removeEventListener(egret.Event.COMPLETE,this.onMcPlayerComplete,this),uniLib.DisplayUtils.removeFromParent(e),e=null)},i.prototype.showCommonChat=function(t,e){this._actionEffect.showCommonChat(t,e)},i.prototype.showCommonTalk=function(t,e){this._actionEffect.showCommonTalk(t,e)},i.prototype.selectGoldOut=function(){this._cardSideArr[0].selectGoldOut()},i.prototype.clearDice=function(){this._diceMc&&this._diceMc.destory(),this._diceMc=null},i.prototype.refreshTempCard=function(){for(var t=0;4>t;t++)this._cardSideArr[t]&&this._cardSideArr[t].refreshTempCard()},i.prototype.refreshHandCards=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null),this._cardSideArr[0].refreshHandCards(t,e)},i.prototype.setListenCard=function(){this._cardSideArr[0].showListenIcon()},i.prototype.hideCardListenIcon=function(){this._cardSideArr[0].hideListenIcon()},i.prototype.setHostMask=function(t){1==t?this._cardSideArr[0].addHostMask():this._cardSideArr[0].removeHostMask()},i.prototype.showListenPanel=function(e){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.listenSet&&t.CardInfo.getInstance().drawData.listenObjSet){var i=t.CardInfo.getInstance().drawData.listenSet.indexOf(e);-1!=i?(this._listenCardPanel||(this._listenCardPanel=new t.ListenCardPanel),this._listenCardPanel.setListenScene(t.CardInfo.getInstance().drawData.listenObjSet[i].listenCardSet),this.addChild(this._listenCardPanel)):this.removeListenPanel(),this._cardSideArr[0].showListenIcon(e)}},i.prototype.showListenPanel1=function(e){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.listenSet&&this._cardSideArr[0].getSelectCardThisId()===e.thisId&&t.CardInfo.getInstance().drawData.listenSet.length>=1){for(var i=-1,n=0,s=this._cardSideArr[0].getHandsCardByThisIDToBaseId(e.thisId).length;s>n;n++)if(ArrayUtil.isInArray(this._cardSideArr[0].getHandsCardByThisIDToBaseId(e.thisId)[n].data,t.CardInfo.getInstance().drawData.listenSet)){i=0;break}-1!=i?(this._listenCardPanel||(this._listenCardPanel=new t.ListenCardPanel),this._listenCardPanel.setListenScene(e.los.listenCardSet),this.addChild(this._listenCardPanel)):this.removeListenPanel(),this._cardSideArr[0].showListenIcon(e.thisId)}},i.prototype.removeListenPanel=function(){this._listenCardPanel&&(this._listenCardPanel.destory(),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),uniLib.DisplayUtils.removeFromParent(this._listenCardPanel)),this._listenCardPanel=null},i.prototype.removeOutPutCard=function(t,e){this._cardSideArr[t]&&this._cardSideArr[t].removeOutPutCard(e),this.hidePointMc()},i.prototype.videoRefresh=function(t){this._cardSideArr[t]&&(this._cardSideArr[t].refreshOperate(t),this._cardSideArr[t].refreshOutCards())},i.prototype.refreshOutCards=function(){this._cardSideArr[0]&&this._cardSideArr[0].refreshOutCards()},i}(t.BaseVc);t.CardsVc=e,__reflect(e.prototype,"game.CardsVc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.dirArr=[[1,2,3,4],[2,3,4,1],[3,4,1,2],[4,1,2,3]],t._step=.1,t}return __extends(i,e),i.prototype.initUI=function(){var e=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_bg");this.addChild(e),this._dirArr=[];for(var i,n=0;4>n;n++)i=new t.HighLightItem,i.initLight(n),this.addChild(i),this._dirArr.push(i),i.setDir(n+1);"yellow_"==t.ColorConst.color?(this._countNum1=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",39,42),this._countNum2=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",52,42)):(this._countNum1=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",39,42),this._countNum2=t.ResUtil.createBitmapByName(t.ColorConst.color+"count_num0",52,42)),this.addChild(this._countNum1),this.addChild(this._countNum2)},i.prototype.setEast=function(t){for(var e=this.dirArr[t],i=0;4>i;i++){var n=e[i];this._dirArr[n-1].setDir(i+1)}},i.prototype.setCount=function(t,e,i){void 0===i&&(i=0),t||(t=0),this._countSecond=e,this._dirArr[this._countSeatId]&&this._dirArr[this._countSeatId].stop(),this._dirArr[t].flash(i),this._countSeatId=t,this.stopTimer(),this.startCount()},i.prototype.startCount=function(){this._countIndex=0,this._timer=new egret.Timer(1e3),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.start()},i.prototype.onTimer=function(e){this._countIndex++;var i=this._countSecond-Math.floor(this._countIndex);i>=99?(this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"green_num9"),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"green_num9"),this._countNum1.alpha>=1?this._step=-Math.abs(this._step):this._countNum1.alpha<=0&&(this._step=Math.abs(this._step)),this._countNum1.alpha+=this._step,this._countNum2.alpha+=this._step):i>0?(this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num"+Math.floor(i/10)),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num"+i%10),this._countNum1.alpha=1,this._countNum2.alpha=1,i%5==2&&uniLib.NetMgr.checkMsgTimeout(8e3)&&uniLib.NetMgr.setMsgTimeout(8,"ClientEchoMahjongCmd_SC")&&uniLib.NetMgr.tcpSend(new Cmd.ClientEchoMahjongCmd_SC)):0>=i&&(uniLib.NetMgr.checkMsgTimeout(5e3)&&uniLib.NetMgr.setMsgTimeout(5,"ClientEchoMahjongCmd_SC")&&uniLib.NetMgr.tcpSend(new Cmd.ClientEchoMahjongCmd_SC),this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0"),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0"),this._countNum1.alpha=1,this._countNum2.alpha=1,this.stopTimer())},i.prototype.stopTimer=function(){this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer=null)},i.prototype.reset=function(){this.stopTimer();for(var e=0;4>e;e++)this._dirArr[e].stop();this._countNum1.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0"),this._countNum2.texture=t.ResUtil.createTexture(t.ColorConst.color+"count_num0")},i.prototype.destory=function(){this.stopTimer();for(var t=0;t<this._dirArr.length;t++){var e=this._dirArr[t];e.destory()}this._dirArr=null,this._countNum1=null,this._countNum2=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this)},i}(t.BaseVc);e.HEIGHT=134,e.OFFSET_Y=70,t.CountVc=e,__reflect(e.prototype,"game.CountVc")}(game||(game={}));var game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t._defaultPoint=new egret.Point((uniLib.Global.screenWidth-1136)/2+866,uniLib.Global.screenHeight-230),t.isShuff=!1,t.skinName=new GameVc_2d_bigSkin,t.width=uniLib.Global.screenWidth,t.initUI(),t.addListener(),t}return __extends(n,e),n.prototype.addListener=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),t.GameInfo.topLayer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),uniLib.Global.addEventListener(uniLib.ZqEvent.NATIVE_TO_EGERET,this.onNativeMessage,this)},n.prototype.removeListener=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),t.GameInfo.topLayer.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),uniLib.Global.removeEventListener(uniLib.ZqEvent.NATIVE_TO_EGERET,this.onNativeMessage,this)},n.prototype.onClick=function(e){var i=this;switch(this.menuEffect.visible&&e.target.parent!=this.menuBtnGroup&&e.target!=this.menuBtn&&this.onMenuClose(),e.target){case this.settingBtn:this.dispatchEventWith(t.UIEventConsts.SHOW_SETTING),this.onMenuClose();break;case this.dissBtn:case this.dismissBtn:this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME,!1,1),this.onMenuClose();break;case this.hostBtn:this.dispatchEventWith(t.UIEventConsts.ACTION_HOST,!1,1),this.onMenuClose();break;case this.menuBtn:"up"==this.menuBtn.currentState?(this.menuBtn.currentState="down",t.GameInfo.topLayer.addChild(this.menuEffect),t.GameInfo.topLayer.addChild(this.menuBtn),this.menuEffect.visible=!0,this.menuEffect.scrollEnabled=!0,this.menuBtnGroup.y=-384,egret.Tween.removeTweens(this.menuBtnGroup),egret.Tween.removeTweens(this.menuBtn.menuBtnArrow),egret.Tween.get(this.menuBtnGroup).to({y:0},200,egret.Ease.sineOut).call(function(){i.menuEffect.scrollEnabled=!1}),egret.Tween.get(this.menuBtn.menuBtnArrow).to({rotation:180},200,egret.Ease.sineOut)):"down"==this.menuBtn.currentState&&this.onMenuClose();break;case this.chatBtn:this.buttonTween(e.target),this.dispatchEventWith(t.UIEventConsts.SHOW_SHORT_CHAT);break;case this.gpsBtn:this.dispatchEventWith(t.UIEventConsts.SHOW_GPS),this.onMenuClose();break;case this._recordBtn:this.onRecordBtnClick();break;case this.gmIcon:this.dispatchEventWith(t.UIEventConsts.SHOW_GM_Tool);break;case this.hostIcon:this.onHostTouchHandler();break;case this.shareBtn:this.dispatchEventWith(t.UIEventConsts.SHARE_GAME);break;case this.backBtn:this.dispatchEventWith(t.UIEventConsts.EXIT_GAME);break;case this.changeIcon:this.showChangeUserNumConfirm();break;case this.readyBtn:this.dispatchEventWith(t.UIEventConsts.START_READY);break;case this.cancelreadyBtn:this.dispatchEventWith(t.UIEventConsts.START_READY,!1,1);break;case this.changeRoom:var n="是否换桌？";t.PublicMethod.Instance.showConfirmPanel(n,["确定","取消"],[this.onChangeRoomHandler],null,this);break;case this.leaveBtn:this.dispatchEventWith(t.UIEventConsts.DISMISS_GAME,!1,0);break;default:this.btnListenInterface()}},n.prototype.btnListenInterface=function(){},n.prototype.destory=function(){this._sysMsgVc&&(this._sysMsgVc.destory(),this._sysMsgVc=null),this._timer_1000&&this._timer_1000.stop(),this._timer_1000=null,this._listenTimer&&(this._listenTimer.stop(),this._listenTimer.removeEventListener(egret.TimerEvent.TIMER,this.listenTimerEvt,this)),this._listenTimer=null,this._listenPanel&&(uniLib.DisplayUtils.removeAllChildren(this._listenPanel),uniLib.DisplayUtils.removeFromParent(this._listenPanel)),this._listenPanel=null,this._huanBao&&uniLib.DisplayUtils.removeFromParent(this._huanBao),this._huanBao=null,this._kanBao&&uniLib.DisplayUtils.removeFromParent(this._kanBao),this._kanBao=null,this._tingCard=null,this._tingCard1&&uniLib.DisplayUtils.removeFromParent(this._tingCard1),this._tingCard1=null,this._tingCard2&&uniLib.DisplayUtils.removeFromParent(this._tingCard2),this._tingCard2=null,this._tingCard3&&uniLib.DisplayUtils.removeFromParent(this._tingCard3),this._tingCard3=null,this._listenCardPanel&&(uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),uniLib.DisplayUtils.removeFromParent(this._listenCardPanel)),this._listenCardPanel=null,this._listenBtnIcon&&this._listenBtnIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._resultPanel&&this._resultPanel.destory(),this._buyHorsePanel&&(this._buyHorsePanel.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.showResultPanel,this),uniLib.DisplayUtils.removeAllChildren(this._buyHorsePanel),uniLib.DisplayUtils.removeFromParent(this._buyHorsePanel)),this.tmpImage&&(this.tmpImage.parent&&uniLib.DisplayUtils.removeFromParent(this.tmpImage),this.tmpImage=null),this._buyHorsePanel=null,this._resultPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this.gameState&&egret.Tween.removeTweens(this.gameState),this._goldenMjGroup=null,this.enterTips&&egret.Tween.removeTweens(this.enterTips),this._listenBtnIcon=null,this._listenBtnBg=null
},n.prototype.buttonTween=function(t){egret.Tween.get(t).to({scaleX:1.2,scaleY:1.3},70).to({scaleX:1.4,scaleY:1.4},60,egret.Ease.quintIn).to({scaleX:1,scaleY:1},120,egret.Ease.sineIn).to({scaleX:1.1,scaleY:1.1},80).to({scaleX:1,scaleY:1},60)},n.prototype.onMenuClose=function(){var t=this;this.menuBtn.currentState="up",this.addChild(this.menuEffect),this.addChild(this.menuBtn),this.menuEffect.scrollEnabled=!0,egret.Tween.removeTweens(this.menuBtnGroup),egret.Tween.removeTweens(this.menuBtn.menuBtnArrow),egret.Tween.get(this.menuBtnGroup).to({y:-384},200,egret.Ease.sineOut).call(function(){t.menuEffect.visible=!1}),egret.Tween.get(this.menuBtn.menuBtnArrow).to({rotation:0},200,egret.Ease.sineOut)},n.prototype.initUI=function(){this.loadingDingque(),"green"!=uniLib.Utils.getLocalStorage("tableclothMode")&&uniLib.Utils.getLocalStorage("tableclothMode")?this.tableCloth.source="2d_tableBg2_big":this.tableCloth.source="2d_tableBg1_big",this.numText.x=(uniLib.Global.screenWidth-this.numText.width)/2-150,this.roomNumber.x=(uniLib.Global.screenWidth-this.roomNumber.width)/2+150,this._recordBtn.visible=t.RoomInfo.getInstance().curNumber&&t.RoomInfo.getInstance().curNumber>1?!0:!1,this.recordRect=new eui.Rect,this.recordRect.width=uniLib.Global.screenWidth,this.recordRect.height=uniLib.Global.screenHeight,this.recordRect.fillAlpha=.2,this.recordRect.visible=!1,this.recordRect.touchEnabled=!0,t.GameInfo.topLayer.addChild(this.recordRect),this.recordRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecordBtnClick,this),this._goldenMjGroup=[],this._listenPanel=new egret.Sprite,this._listenPanel.x=(uniLib.Global.screenWidth-1136)/2+170,this._listenPanel.y=uniLib.Global.screenHeight-199,t.GameInfo.mainUILayer.addChild(this._listenPanel),this._listenPanel.visible=!1,this._listenBtnBg=uniLib.DisplayUtils.createBitmapByName("listenBtn_bg"),this._listenBtnBg.scale9Grid=new egret.Rectangle(94,22,19,79),this._listenBtnBg.x=3,this._listenBtnBg.y=-19,this._listenBtnBg.height=95,this._listenPanel.addChild(this._listenBtnBg),this._listenBtnBg.visible=!1,this._listenBtnIcon=new t.GameButton(["listen_btn1","listen_btn2"]),this._listenBtnIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._listenPanel.addChild(this._listenBtnIcon),this._listenBtnIcon.visible=!1,this._listenCardPanel=new egret.Sprite,this._listenPanel.addChild(this._listenCardPanel),this._listenCardPanel.visible=!1,this._listenTimer=new egret.Timer(4e3,1),this._listenTimer.addEventListener(egret.TimerEvent.TIMER,this.listenTimerEvt,this),t.DataCache.platParam?this.roomIdText.textFlow=[{text:"房号",style:{textColor:7186632}},{text:t.DataCache.platParam.roomId,style:{textColor:14936289}}]:this.roomIdText.text="房号",this.backBtn.visible=!1,this.shareBtn.visible=!1,this.readyBtn.visible=!1,this.cancelreadyBtn.visible=!0,this.dissBtn.visible=!1,this.changeRoom.visible=!1,this.leaveBtn.visible=!1,this.signalTxt.visible=!1;var e=new Date;e.getMonth()+1+"-"+this.setTimeFormat(e.getDate());this.timeTxt.text=this.setTimeFormat(e.getHours())+":"+this.setTimeFormat(e.getMinutes()),this._timer_1000=new uniLib.TimerBase(1e4,this.countSecond,this),this._timer_1000.start(1),uniLib.SoundMgr.instance.playBgMusic([t.SoundConsts.BG_MUSIC]),this.updateJoinRoom(),this.vision.text=uniLib.Global.version.toString(),this._sysMsgVc=new t.GameSysMsg,this._sysMsgVc.x=320,this._sysMsgVc.y=13,t.GameInfo.topLayer.addChild(this._sysMsgVc),this.showDebugButton(),this.showEnterButtons(),this.showVideoPanel(),this.selfInitUi()},n.prototype.selfInitUi=function(){},n.prototype.loadingDingque=function(){this._dingque.visible=!1,this._nextdingque.visible=!1,this._lastdingque.visible=!1,this._mydingque.visible=!1,this._dingque.text="已定缺",this._nextdingque.text="已定缺",this._lastdingque.text="已定缺",this._mydingque.text="已定缺"},n.prototype.showPointPanel=function(){1!=t.RoomInfo.getInstance().video&&(this.selecePointPanel||(this.selecePointPanel=new i,this.selecePointPanel.x=(uniLib.Global.screenWidth-this.selecePointPanel.width)/2,this.selecePointPanel.y=470,this.selecePointPanel.addEventListener(egret.Event.CLOSE,this.closePointPanel,this),this.selecePointPanel.addEventListener(t.UIEventConsts.ADD_BASE_POINT,this.selectPoint,this),this.addChild(this.selecePointPanel)))},n.prototype.closePointPanel=function(){this.selecePointPanel&&(this.selecePointPanel.removeEventListener(t.UIEventConsts.ADD_BASE_POINT,this.selectPoint,this),this.selecePointPanel.removeEventListener(egret.Event.CLOSE,this.closePointPanel,this),uniLib.DisplayUtils.removeFromParent(this.selecePointPanel),this.selecePointPanel.destory(),this.selecePointPanel=null)},n.prototype.selectPoint=function(e){this.dispatchEventWith(t.UIEventConsts.ADD_BASE_POINT,!1,e.data)},n.prototype.onGpsBtnTouch=function(e){function i(t){if(0==t.code){n.lng=t.data.longitude,n.lat=t.data.latitude;var e=new Cmd.GetGPSLocationCmd_C;e.lat=n.lat,e.lng=n.lng,uniLib.NetMgr.tcpSend(e)}}var n;n=uniLib.ZQGameSdk.getLocation(i,this),this.dispatchEventWith(t.UIEventConsts.SHOW_GPS)},n.prototype.showDebugButton=function(){uniLib.Global.debugLevel>=1?(this.gmIcon.visible=!0,this.hostIcon.visible=!0):(this.gmIcon.visible=!1,this.hostIcon.visible=!1)},n.prototype.onNativeMessage=function(t){t.param.cmd==uniLib.ZQGameSdk.NETSTATE&&0==t.param.code?(uniLib.ZQGameSdk.lastNetState&&uniLib.ZQGameSdk.lastNetState.data[uniLib.ZQGameSdk.NETSTATE]!=t.param.data[uniLib.ZQGameSdk.NETSTATE]&&(uniLib.NetMgr.tcpSend(new Cmd.ClientEchoMahjongCmd_SC),uniLib.NetMgr.setMsgTimeout(5,"ClientEchoMahjongCmd_SC")),t.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.NO_SIGNAL?(this.signalTxt.visible=!0,this.signal.visible=!1):t.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.WIFI?(this.signalTxt.visible=!1,this.signal.visible=!0,this.signal.source="table_wifi_icon"):t.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.DATA_FLOWS?(this.signalTxt.visible=!1,this.signal.visible=!0,this.signal.source="table_data_icon"):t.param.data[uniLib.ZQGameSdk.NETSTATE]==uniLib.NetState.WIFI_AND_DATA&&(this.signalTxt.visible=!1,this.signal.visible=!0,this.signal.source="table_wifi_icon")):t.param.cmd==uniLib.ZQGameSdk.BATTERY&&0==t.param.code&&(this.betteryPercent.width=t.param.data[uniLib.ZQGameSdk.BATTERY]/100*23)},n.prototype.countSecond=function(){var t=new Date;t.getMonth()+1+"-"+this.setTimeFormat(t.getDate());this.timeTxt.text=this.setTimeFormat(t.getHours())+":"+this.setTimeFormat(t.getMinutes()),uniLib.ZQGameSdk.getNetStateType(),uniLib.ZQGameSdk.getBatteryPer()},n.prototype.setTimeFormat=function(t){var e="";return e=10>t?"0"+t:t+""},n.prototype.showEnterButtons=function(){if(this.backBtn&&this.shareBtn&&this.dissBtn){if(t.DataCache.platParam){Number(t.DataCache.platParam.roomId)}1!=uniLib.Global.is_sandbox&&(this.shareBtn.visible=!0),this.backBtn.visible=!0,this.readyBtn.visible=!0,this.cancelreadyBtn.visible=!1,this.dissBtn.visible=!0,this.changeIcon.visible=!1,this.changeRoom.visible=!1}},n.prototype.showChangeRoom=function(){6!==(t.DataCache.platParam.roomId+"").length&&t.RoomInfo.getInstance().playTypeList instanceof Array&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)&&(this.readyBtn.visible=!0,this.changeRoom.visible=!0,this.leaveBtn.visible=!0,this.cancelreadyBtn.visible=!1)},n.prototype.changeReay=function(){this.cancelreadyBtn.visible=this.readyBtn.visible,this.readyBtn.visible=!this.readyBtn.visible,t.RoomInfo.getInstance().isStart||(this.readyBtn.visible=!1,this.cancelreadyBtn.visible=!0)},n.prototype.cancelReady=function(){this.readyBtn.visible=!0,this.cancelreadyBtn.visible=!1},n.prototype.ShowChangeIcon=function(){this.changeIcon.visible=!0},n.prototype.showDissBtn=function(){uniLib.UserInfo.uid!=t.RoomInfo.getInstance().houseOwnerUID&&1==this.dissBtn.visible&&(console.info("显示解散房间和退出房间按钮"),this.dissBtn.visible=!1,this.leaveBtn.visible=!0)},n.prototype.showListenIcon=function(e){this._listenPanel.visible=!0,e.length>0?(this._listenBtnBg||(this._listenBtnBg=uniLib.DisplayUtils.createBitmapByName("listenBtn_bg"),this._listenBtnBg.x=3,this._listenBtnBg.y=-19,this._listenBtnBg.height=95,this._listenBtnBg.scale9Grid=new egret.Rectangle(94,22,19,79),this._listenPanel.addChild(this._listenBtnBg),this._listenBtnBg.visible=!1),this._listenBtnIcon||(this._listenBtnIcon=new t.GameButton(["listen_btn1","listen_btn2"]),this._listenBtnIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._listenPanel.addChild(this._listenBtnIcon)),this._listenCardPanel||(this._listenCardPanel=new egret.Sprite,this._listenPanel.addChild(this._listenCardPanel),this._listenCardPanel.visible=!1),this._listenBtnBg.visible&&this.refreshListenPanel(),this._listenBtnIcon.visible=!0,this._huzidongBtn&&(this._huzidongBtn.visible=!0),this.showHu_zidong()):(this._listenBtnIcon&&(this._listenBtnIcon.visible=!1),this._listenBtnBg&&(this._listenBtnBg.visible=!1),this._huzidongBtn&&(this._huzidongBtn.visible=!1),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel))},n.prototype.showHu_zidong=function(){t.CardInfo.getInstance().winCardSet instanceof Array&&t.CardInfo.getInstance().winCardSet.length>0&&(this._huzidongBtn||(this._huzidongBtn=t.ResUtil.createBitmapByName("com_hu_zidong1",1120*t.GameConst.scaleFactor,500),this._huzidongBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHuClick,this),this._huzidongBtn.touchEnabled=!0,this._huzidongBtn.scaleX=.6,this._huzidongBtn.scaleY=.6,this.addChild(this._huzidongBtn)),this.chageHuBtn(t.RoomInfo.getInstance().isHostMode))},n.prototype.onHuClick=function(){this.dispatchEventWith(t.UIEventConsts.ACTION_HOST,!1,2)},n.prototype.chageHuBtn=function(t){this._huzidongBtn&&(2==t||1==t?this._huzidongBtn.texture=RES.getRes("com_hu_zidong2"):this._huzidongBtn.texture=RES.getRes("com_hu_zidong1"))},n.prototype.removeHu_zidong=function(){this._huzidongBtn&&this._huzidongBtn.parent&&(this._huzidongBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHuClick,this),this._huzidongBtn.parent.removeChild(this._huzidongBtn),this._huzidongBtn=null)},n.prototype.setListenCard=function(){var e=t.CardInfo.getInstance().winCardSet;if(this._listenBtnBg.visible?(this._listenBtnBg.visible=!1,this._listenTimer.stop()):(this._listenBtnBg.visible=!0,this._listenTimer.start()),this._listenBtnBg.width=155+47*(e.length-1),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),this._listenCardPanel.visible)this._listenCardPanel.visible=!1;else{if(34==e.length||27==e.length){this._listenBtnBg.width=155;var i=new t.OutPutCard;i.showListenCard(e[0],1,!0),i.x=100,this._listenCardPanel.addChild(i)}else for(var n=0;n<e.length;n++){var s=new t.OutPutCard;s.showListenCard(e[n],1),s.x=n*(s.width+5)+100,this._listenCardPanel.addChild(s)}this._listenCardPanel.visible=!0}},n.prototype.shouListenButton=function(){null==this.listenButton&&(this.listenButton=new t.GameButton(["operate_listen1","operate_listen1"]),this.listenButton.x=this._defaultPoint.x-160,this.listenButton.y=this._defaultPoint.y+3,this.listenButton.touchEnabled=!0,this.listenButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showOperate,this)),null==this.passButton&&(this.passButton=new t.GameButton(["operate_cancel1","operate_cancel1"]),this.passButton.x=this._defaultPoint.x,this.passButton.y=this._defaultPoint.y+3,this.passButton.touchEnabled=!0,this.passButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeButton,this)),t.PopupManager.addPopUp(this.listenButton,!1,!1),t.PopupManager.addPopUp(this.passButton,!1,!1),t.CardsVc.defaultTouchEnabled=!1},n.prototype.showOperate=function(t){this.closeButton()},n.prototype.closeButton=function(){t.CardsVc.defaultTouchEnabled=!0,this.passButton&&this.passButton.parent&&(this.passButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeButton,this),t.PopupManager.removePopUp(this.passButton),this.passButton.destory(),this.passButton=null),this.listenButton&&this.listenButton.parent&&(this.listenButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showOperate,this),t.PopupManager.removePopUp(this.listenButton),this.listenButton.destory(),this.listenButton=null)},n.prototype.refreshListenPanel=function(){if(this._listenCardPanel&&0!=t.CardInfo.getInstance().winCardSet.length&&0!=this._listenCardPanel.numChildren&&this._listenCardPanel.visible){var e=t.CardInfo.getInstance().winCardSet;if(this._listenBtnBg.width=155+47*(e.length-1),uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),34==e.length||27==e.length){this._listenBtnBg.width=155;var i=new t.OutPutCard;i.showListenCard(e[0],1,!0),i.x=100,this._listenCardPanel.addChild(i)}else for(var n=0;n<e.length;n++){var s=new t.OutPutCard;s.showListenCard(e[n],1),s.x=n*(s.width+5)+100,this._listenCardPanel.addChild(s)}}},n.prototype.listenTimerEvt=function(t){this._listenBtnBg&&(this._listenBtnBg.visible=!1),this._listenCardPanel&&(this._listenCardPanel.visible=!1,uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel)),this._listenTimer.stop()},n.prototype.clearListenPanel=function(){uniLib.DisplayUtils.removeAllChildren(this._listenPanel),this._listenBtnBg=null,this._listenBtnIcon&&this._listenBtnIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setListenCard,this),this._listenBtnIcon=null,this._listenCardPanel&&uniLib.DisplayUtils.removeAllChildren(this._listenCardPanel),this._listenCardPanel=null,n.isTing=null},n.prototype.gmTool=function(){this.dispatchEventWith(t.UIEventConsts.SHOW_GM_Tool)},n.prototype.onHostTouchHandler=function(){t.RoomInfo.getInstance().host_mode?(t.RoomInfo.getInstance().host_mode=0,t.GameInfo.manage.showMildWarnShow("取消托管")):(t.RoomInfo.getInstance().host_mode=1,t.GameInfo.manage.showMildWarnShow("托管"))},n.prototype.onChangeTouchHandler=function(e){this.dispatchEventWith(t.UIEventConsts.REQUEST_CHANGE_USERNUM)},n.prototype.onChangeRoomHandler=function(e){this.dispatchEventWith(t.UIEventConsts.EXCHANGE_DESK)},n.prototype.showChangeUserNumConfirm=function(){if(t.RoomInfo.getInstance().userList){if(1==t.RoomInfo.getInstance().userList.length)return void t.PublicManage.getInstance().showMildWarnShow("当前房间只有您自己，不可提前开局");var e="是否将房间改为"+t.RoomInfo.getInstance().userList.length+"人模式，提前开局？";t.PublicMethod.Instance.showConfirmPanel(e,["确定","取消"],[this.onChangeTouchHandler],null,this)}},n.prototype.onTingADDED_TO_STAGE=function(t){t.target.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onTingADDED_TO_STAGE,this),t.target.play(-1)},n.prototype.removeTingMc=function(e){e.stop(),e.parent&&t.ResUtil.removeFromParent(e),e=null},n.prototype.setGoldenMj=function(e){if(void 0===e&&(e=0),0==t.RoomInfo.getInstance().playType)return void(this.goldenIcon&&(this.goldenIcon.visible=!1));var i=t.RoomInfo.getInstance().displayCard;uniLib.Console.info("setGoldenMj",t.RoomInfo.getInstance().playType);for(var n=0;n<i.length;n++){var s=table.TableCard.resNormal(i[n]);this._goldenMjGroup[n].bitmapData=RES.getRes(s),this._goldenMjGroup[n].visible=!0}1==t.RoomInfo.getInstance().playType?(this.goldenIcon.bitmapData=RES.getRes("treasure_null"),this.goldenIcon.x=20):(this.goldenIcon.bitmapData=RES.getRes("treasure_null"),this.goldenIcon.x=20),this.goldenIcon.visible=!1},n.prototype.showResult=function(e){n.isResult=!0,this._dingBao&&(this._dingBao.visible=!1,uniLib.DisplayUtils.removeFromParent(this._dingBao)),this._dingBao=null,this._huanBao&&(this._huanBao.visible=!1,uniLib.DisplayUtils.removeFromParent(this._huanBao)),this._huanBao=null,this._kanBao&&(this._kanBao.visible=!1,uniLib.DisplayUtils.removeFromParent(this._kanBao)),this._kanBao=null,t.RoomInfo.getInstance().winRes=e,egret.Tween.removeTweens(this),e.horseSet instanceof Array?egret.Tween.get(this).wait(3e3).call(this.showBuyHorsePanel,this,[e]):egret.Tween.get(this).wait(3e3).call(this.showResultPanel,this,[e])},n.prototype.showBuyHorsePanel=function(e){this._buyHorsePanel||(this._buyHorsePanel=new t.BuyHorsePanel),this._buyHorsePanel.createPanel(e),t.PopupManager.addPopUp(this._buyHorsePanel,!0,!1),egret.Tween.get(this).wait(3e3).call(this.showResultPanel,this)},n.prototype.showResultPanel=function(e){e=t.RoomInfo.getInstance().winRes,this._buyHorsePanel&&(t.PopupManager.removePopUp(this._buyHorsePanel),this._buyHorsePanel.destory(),this._buyHorsePanel=null),this._resultPanel||(this._resultPanel=new t.ResultPanel,this._resultPanel.name="result",this._resultPanel.x=(uniLib.Global.screenWidth-this._resultPanel.width)/2,this._resultPanel.y=(uniLib.Global.screenHeight-this._resultPanel.height)/2),this._resultPanel.setResultData(e),this._resultPanel.addEventListener(t.UIEventConsts.READY,this.onResultHandle,this),this._resultPanel.addEventListener(t.UIEventConsts.EXCHANGE_DESK,this.onResultHandle,this),t.GameInfo.topLayer.addChild(this._resultPanel)},n.prototype.onResultHandle=function(t){this.dispatchEvent(t)},n.prototype.removeResultPanel=function(){this._resultPanel&&(this._resultPanel.hasEventListener(t.UIEventConsts.READY)&&this._resultPanel.removeEventListener(t.UIEventConsts.READY,this.onResultHandle,this),this._resultPanel.hasEventListener(t.UIEventConsts.EXCHANGE_DESK)&&this._resultPanel.removeEventListener(t.UIEventConsts.EXCHANGE_DESK,this.onResultHandle,this),this._resultPanel.reset(),uniLib.DisplayUtils.removeFromParent(this._resultPanel)),n.isResult=null},n.prototype.reset=function(){for(var t=0;t<this._goldenMjGroup.length;t++)this._goldenMjGroup[t].visible=!1;this._listenPanel.visible=!1,this.tmpImage&&(this.tmpImage=null),this.removeResultPanel(),this.clearListenPanel()},n.prototype.updateGhostData=function(){var e=t.RoomInfo.getInstance().playType;console.info("刷新鬼牌数据",e);for(var i=0;e>i;i++){var n=new egret.Bitmap;n.x=15+85*i,n.y=115,n.width=85,n.height=126,this._goldenMjGroup.push(n),this.addChild(n)}switch(this.addChild(this.goldenIcon),e){case 0:this.goldenIcon.visible=!1;break;case 1:this.goldenIcon.source="treasure",this.goldenIcon.visible=!1;break;case 2:this.goldenIcon.source="treasure2",this.goldenIcon.visible=!0}},n.prototype.changeTablecloth=function(){"green"==t.RoomInfo.getInstance().tableclothMode?this.tableCloth.source="2d_tableBg1_big":this.tableCloth.source="2d_tableBg2_big"},n.prototype.updateEnterRoom=function(){egret.Tween.removeTweens(this.enterTips),this.enterTips.text="",this.roomName.text=t.RoomInfo.getInstance().getPlayType(),this.roomPlayerNum.text=t.RoomInfo.getInstance().playerNumber+"人",this.roomPlayerNum.x=this.roomName.x+this.roomName.width+10,"green"!=uniLib.Utils.getLocalStorage("tabelMode")&&uniLib.Utils.getLocalStorage("tabelMode")?t.RoomInfo.getInstance().tableclothMode="blue":t.RoomInfo.getInstance().tableclothMode="green",this.changeTablecloth()},n.prototype.updateRound=function(){this.roomNumber.text=t.RoomInfo.getInstance().curNumber+"/"+t.RoomInfo.getInstance().totalNumber+"局",this._recordBtn.visible=t.RoomInfo.getInstance().curNumber&&t.RoomInfo.getInstance().curNumber>1?!0:!1},n.prototype.updateRoomId=function(){this.roomIdText.textFlow=[{text:"房号",style:{textColor:12501202}},{text:t.DataCache.platParam.roomId,style:{textColor:2471020}}]},n.prototype.updateJoinRoom=function(){egret.Tween.get(this.enterTips,{loop:!0}).to({text:this.enterTips.text+"."},500).to({text:this.enterTips.text+".."},500).wait(500)},n.prototype.updateNetWork=function(t){this.gameState&&(egret.Tween.removeTweens(this.gameState),t?(this.gameState.text="发牌中，请稍等.",egret.Tween.get(this.gameState,{loop:!0}).to({text:this.gameState.text+"."},500).to({text:this.gameState.text+".."},500).wait(500)):(egret.Tween.removeTweens(this.gameState),this.gameState.text=""))},n.prototype.updateReadyState=function(e){void 0===e&&(e="准备中."),this.gameState&&t.RoomInfo.getInstance().firstReady&&(egret.Tween.removeTweens(this.gameState),t.RoomInfo.getInstance().firstReady=!1,this.gameState.text="准备中.",egret.Tween.get(this.gameState,{loop:!0}).to({text:this.gameState.text+"."},500).to({text:this.gameState.text+".."},500).wait(500))},n.prototype.refreshCard=function(){if(egret.Tween.removeTweens(this.gameState),this.gameState.text="",this.numText.text="剩"+t.RoomInfo.getInstance().getRemainCardNum()+"张",t.RoomInfo.getInstance().getRemainCardNum()<18&&t.RoomInfo.getInstance().getRemainCardNum()>1){var e=t.RoomInfo.getInstance().getUserVoByUid(uniLib.UserInfo.uid).getGender(),i="action_pu_fenzhang_"+e.toString()+"_mp3";RES.hasRes(i)||(i=""),""!=i&&uniLib.SoundMgr.instance.playSound(i)}},n.prototype.remove=function(){egret.Tween.removeTweens(this.tmpImage),null!=this.tmpImage&&this.tmpImage.parent&&uniLib.DisplayUtils.removeFromParent(this.tmpImage)},n.prototype.updateTimeout=function(){egret.Tween.removeTweens(this.gameState),this.gameState.text=""},n.prototype.disposeBtn=function(){this.shareBtn.visible=!1,this.backBtn.visible=!1,this.dissBtn.visible=!1,this.readyBtn.visible=!1,this.changeRoom.visible=!1,this.leaveBtn.visible=!1,this.cancelreadyBtn.visible=!1,this.changeIcon.visible=!1},n.prototype.formatSeconds=function(t){if(!(0>t)){var e=t,i=0,n=0;e>60&&(i=Math.floor(e/60),e=Math.floor(e%60),i>60&&(n=Math.floor(i/60),i=Math.floor(i%60)));var s=" "+this.getzf(e.toString());return i>=0&&(s=""+this.getzf(i.toString())+s),n>=0&&(s=this.getzf(n.toString())+s),s}},n.prototype.getzf=function(t){return parseInt(t)<10&&parseInt(t)>0?t="0"+t:0==parseInt(t)&&(t="00"),t},n.prototype.showVideoPanel=function(){0!=t.RoomInfo.getInstance().video&&(this.showGameVc(!1),t.RoomInfo.getInstance().GM_Mode=!0,this._videoPanel=new t.VideoPanel,t.GameInfo.main.addChild(this._videoPanel),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_BACK,this.videoDisEvent,this),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_STOP,this.videoDisEvent,this),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_ADVANCE,this.videoDisEvent,this),this._videoPanel.addEventListener(t.UIEventConsts.VIDEO_CLOSE,this.videoDisEvent,this))},n.prototype.videoDisEvent=function(t){this.dispatchEventWith(t.type)},n.prototype.showGameVc=function(t){this.chatBtn.visible=t,this.hostBtn.visible=t,this.settingBtn.visible=t,this.gpsBtn.visible=t},n.prototype.onRecordBtnClick=function(){this.RefreshRecordScore()},n.prototype.RefreshRecordScore=function(e){var i=this;if(void 0===e&&(e=!1),!(e||this._scoreRecordPanel&&this._scoreRecordPanel.displayed))return void uniLib.NetMgr.tcpSend(new Cmd.ShowRoundScore_C);if(!this._scoreRecordPanel){this._scoreRecordPanel=new t.ScoreRecordPanel,this._scoreRecordPanel.name="战绩面板",this._scoreRecordPanel.anchorOffsetX=this._scoreRecordPanel.width/2,this._scoreRecordPanel.anchorOffsetY=this._scoreRecordPanel.height/2,this._scoreRecordPanel.y=uniLib.Global.designHeight/2;var n=this._recordBtn.y+this._recordBtn.height/2-(this._scoreRecordPanel.y-this._scoreRecordPanel.height/2);this._scoreRecordPanel.setRightArrowPosition(null,n)}var s=this._scoreRecordPanel.animatable;if(this._scoreRecordPanel.displayed&&!e){this.recordRect.visible=!1;var a=function(){i._scoreRecordPanel.parent&&i._scoreRecordPanel.parent.removeChild(i._scoreRecordPanel),i._scoreRecordPanel.animatable=!0};this.recordPanelOut(s,a),this._scoreRecordPanel.displayed=!1}else{this.recordRect.visible=!0,t.GameInfo.topLayer.addChild(this._scoreRecordPanel);var o=t.RoomInfo.getInstance().roundScore;this._scoreRecordPanel.updateRecordData(o);var a=function(){i._scoreRecordPanel.animatable=!0};this.recordPanelIn(s,a),this._scoreRecordPanel.displayed=!0}this._scoreRecordPanel.animatable=!1},n.prototype.recordPanelIn=function(t,e){void 0===t&&(t=!0),e||(e=function(){});var i=uniLib.Global.designWidth-(this._scoreRecordPanel.width/2+85),n=uniLib.Global.designHeight/2;t?(this._scoreRecordPanel.x=this._recordBtn.x+this._recordBtn.width/2+1080,this._scoreRecordPanel.y=this._recordBtn.y+this._recordBtn.height/2,this._scoreRecordPanel.scaleX=0,this._scoreRecordPanel.scaleY=0,this._scoreRecordPanel.alpha=0,egret.Tween.get(this._scoreRecordPanel).to({x:i,y:n,scaleX:1,scaleY:1,alpha:1},300,egret.Ease.quartOut).call(e)):e()},n.prototype.recordPanelOut=function(t,e){void 0===t&&(t=!0),e||(e=function(){});var i=this._recordBtn.x+this._recordBtn.width/2+1080,n=this._recordBtn.y+this._recordBtn.height/2;t?(this._scoreRecordPanel.x=uniLib.Global.designWidth-(this._scoreRecordPanel.width/2+85),this._scoreRecordPanel.y=uniLib.Global.designHeight/2,egret.Tween.get(this._scoreRecordPanel).to({x:i,y:n,scaleX:0,scaleY:0,alpha:0},300,egret.Ease.quartOut).call(e)):e()},n.prototype.reconUpdateDingque=function(){var e=t.RoomInfo.getInstance().lackInfos;if(null!=e&&e instanceof Array)for(var i=0;i<e.length;i++){var n=e[i];if(null!=n){n.uid==uniLib.UserInfo.uid&&(t.RoomInfo.getInstance().dqCardType=n.cardType,t.RoomInfo.getInstance().isMask=!0);var s=t.RoomInfo.getInstance().getSeatNoByUserId(n.uid),a=t.RoomInfo.getInstance().getUserVoByUid(n.uid);null!=a&&(n.cardType?(a.dingQueStare=!0,this.changeDingqueState(!1,s)):(a.dingQueStare=!1,this.changeDingqueState(!0,s)))}}},n.prototype.changeDingqueState=function(t,e){if(t)switch(e){case 0:this._mydingque.visible=!1,this._mydingque.text="定缺中";break;case 1:this._nextdingque.visible=!0,this._nextdingque.text="定缺中";break;case 2:this._dingque.visible=!0,this._dingque.text="定缺中";break;case 3:this._lastdingque.visible=!0,this._lastdingque.text="定缺中"}else switch(e){case 0:this._mydingque.visible=!0,this._mydingque.text="已定缺";break;case 1:this._nextdingque.visible=!0,this._nextdingque.text="已定缺";break;case 2:this._dingque.visible=!0,this._dingque.text="已定缺";break;case 3:this._lastdingque.visible=!0,this._lastdingque.text="已定缺"}"已定缺"==this._dingque.text&&"已定缺"==this._lastdingque.text&&"已定缺"==this._nextdingque.text&&"已定缺"==this._mydingque.text&&(this._dingque.visible=!1,this._lastdingque.visible=!1,this._nextdingque.visible=!1,this._mydingque.visible=!1)},n.prototype.onPiaoBtnTouch=function(e){var i=e.target.name;this.dispatchEventWith(t.UIEventConsts.START_READY,!1,{name:i,isShuff:this.isShuff}),this.disposePiaoBtns()},n.prototype.disposePiaoBtns=function(){this._pao0Btn.visible=!1,this._pao1Btn.visible=!1,this._pao2Btn.visible=!1,this._pao3Btn.visible=!1,this._pao4Btn.visible=!1,this.isShuff=!1},n.prototype.createPiaoBtns=function(t){void 0===t&&(t=!1),this.isShuff=t,this._pao0Btn.visible=!0,this._pao1Btn.visible=!0,this._pao2Btn.visible=!0,this._pao3Btn.visible=!0,this._pao4Btn.visible=!0},n}(eui.Component);e.isResult=null,e.isTing=null,e.isRecon=!1,t.GameVc=e,__reflect(e.prototype,"game.GameVc");var i=function(e){function i(){var t=e.call(this)||this;return t.skinName="SelectPointSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClick,t),t}return __extends(i,e),i.prototype.onClick=function(e){this.dispatchEventWith(t.UIEventConsts.ADD_BASE_POINT,!1,e.target.name)},i.prototype.destory=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},i}(eui.Component);t.SelectPointPanel=i,__reflect(i.prototype,"game.SelectPointPanel")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._second=0,t}return __extends(i,e),i.prototype.destory=function(){if(e.prototype.destory.call(this),this.timer_100&&this.timer_100.stop(),this.timer_100=null,this.actionCard&&this.actionCard.destory(),this.actionCard=null,this._actMcArr){for(var i,n,s=0;s<this._actMcArr.length;s++)i=this._actMcArr[s],n=i.actionMc,n.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onActionHandle,this),n.touchEnabled=!1,n.destory();i=0,this._actMcArr=null}this._overPanel&&(uniLib.DisplayUtils.removeAllChildren(this._overPanel),uniLib.DisplayUtils.removeFromParent(this._overPanel)),this._overPanel=null,this._actionMc&&(t.ResUtil.removeAllChildren(this._actionMc),t.ResUtil.removeFromParent(this._actionMc)),this._actionMc=null,this._chowPanel&&(this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_KONG)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_KONG,this.onUserOpera,this),uniLib.DisplayUtils.removeAllChildren(this._chowPanel),uniLib.DisplayUtils.removeFromParent(this._chowPanel)),this._chowPanel=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeFromParent(this),this._second=0,this._initPoint=null,this._actionMcStrArr=null,this._operateCard=null},i.prototype.initUI=function(){this._stepX=-160,this._actMcArr=[];var e,i;this._initPoint=new egret.Point((uniLib.Global.screenWidth-1136)/2+866,uniLib.Global.screenHeight-195),this._actionMcStrArr=["game_operate_win","operate_rob","game_operate_kong","game_operate_pong","game_operate_eat","operate_thirdDown","game_operate_check","game_operate_cancel","operate_singleTour","operate_duoTour","operate_thirdTour","operate_fourDown","operate_fiveDown","operate_sixDown"];for(var n=0;n<this._actionMcStrArr.length;n++)i=new t.GameButton([this._actionMcStrArr[n]+"1",this._actionMcStrArr[n]+"2"],null,!1),e={},e.index=n,e.actionMc=i,i.name="action"+n,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onActionHandle,this),this._actMcArr.push(e);this._actionMc=new egret.DisplayObjectContainer,this.addChild(this._actionMc),this._overPanel=new egret.Sprite,this.addChild(this._overPanel),this.timer_100=new uniLib.TimerBase(100,this.countSecond,this),this.timer_100.stop()},i.prototype.startGame=function(){this.removeAction(),this._second=0,uniLib.DisplayUtils.removeAllChildren(this._overPanel)},i.prototype.showAction=function(e,i){if(1!=t.RoomInfo.getInstance().video&&i&&i[0]&&0!=i.length&&(1!=i.length||10!=i[0])){uniLib.SoundMgr.instance.playSound(t.SoundConsts.DRAW_OTHER_TURN),this._operateCard=e;for(var n,s=[],a=0;a<i.length;a++)n=this.addAction(i[a]),n&&-1==s.indexOf(n)&&s.push(n);s.push(this._actMcArr[6]),s.sort(function(t,e){return t.index>e.index?1:t.index==e.index?0:-1});for(var o,r=s.length-1;r>=0;r--)if(o=s[r].actionMc,r==s.length-2?o.x=this._initPoint.x+-150*(s.length-r-1):o.x=this._initPoint.x+(s.length-r-1)*Math.round(this._stepX),o.y=this._initPoint.y-o.height/2,this._actionMc.addChild(o),2==s[r].index||3==s[r].index||4==s[r].index&&null!=e){if(t.CardInfo.getInstance().drawData&&t.CardInfo.getInstance().drawData.barSet&&t.CardInfo.getInstance().drawData.barSet.length>1)continue;if(t.RoomInfo.getInstance().OutCard&&t.RoomInfo.getInstance().OutCard.eatSet&&t.RoomInfo.getInstance().OutCard.eatSet.length>1)continue;this.actionCard=new t.MySelfCard,this.actionCard.setCard(e,.4),this.actionCard.x=o.x+o.width-11,this.actionCard.y=o.y+40,this._actionMc.addChild(this.actionCard)}if(t.RoomInfo.getInstance().host_mode){var h=new egret.TouchEvent(egret.TouchEvent.TOUCH_TAP,!1);h.$currentTarget=s[0].actionMc,this.onActionHandle(h)}}},i.prototype.addAction=function(t){switch(t){case Cmd.MahjongOpCardType.MahjongOpCardType_Win:return this._actMcArr[0];case Cmd.MahjongOpCardType.MahjongOpCardType_BarOther:case Cmd.MahjongOpCardType.MahjongOpCardType_Bar:case Cmd.MahjongOpCardType.MahjongOpCardType_BarSelf:case Cmd.MahjongOpCardType.MahjongOpCardType_BarTouch:return this._actMcArr[2].type=t,this._actMcArr[2];case Cmd.MahjongOpCardType.MahjongOpCardType_Touch:return this._actMcArr[3];case Cmd.MahjongOpCardType.MahjongOpCardType_Eat:return this._actMcArr[4];case Cmd.MahjongOpCardType.MahjongOpCardType_ThreeGold:return this._actMcArr[5];case Cmd.MahjongOpCardType.MahjongOpCardType_SkyWin:return this._actMcArr[0];case Cmd.MahjongOpCardType.MahjongOpCardType_GrabGold:return this._actMcArr[1];case Cmd.MahjongOpCardType.MahjongOpCardType_GoldSwim:return this._actMcArr[8];case Cmd.MahjongOpCardType.MahjongOpCardType_DoubleSwim:return this._actMcArr[9];case Cmd.MahjongOpCardType.MahjongOpCardType_ThreeSwim:return this._actMcArr[10];case Cmd.MahjongOpCardType.MahjongOpCardType_FourGold:return this._actMcArr[11];case Cmd.MahjongOpCardType.MahjongOpCardType_FiveGold:return this._actMcArr[12];case Cmd.MahjongOpCardType.MahjongOpCardType_SixGold:return this._actMcArr[13];case Cmd.MahjongOpCardType.MahjongOpCardType_Listen:return null}return null},i.prototype.removeAction=function(){this.actionCard&&this.actionCard.destory(),this.actionCard=null,this.removeChowPanel(),this._actionMc&&uniLib.DisplayUtils.removeAllChildren(this._actionMc)
},i.prototype.setActionVisible=function(t){this._actionMc&&(this._actionMc.visible=t)},i.prototype.dispatch=function(t,e){void 0===e&&(e=null),this.dispatchEventWith(t,!1,e)},i.prototype.onActionHandle=function(e){var i=e.currentTarget;this._curIndex=Number(i.name.slice(6));var n=new t.CardVo;switch(this._curIndex){case 0:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 1:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 3:this.dispatch(t.UIEventConsts.ACTION_PONG,this._operateCard);break;case 2:t.CardInfo.getInstance().drawData?t.RoomInfo.getInstance().host_mode||1==t.CardInfo.getInstance().drawData.barSet.length?this.dispatch(t.UIEventConsts.ACTION_KONG,this._operateCard):this.createKongScene():this.dispatch(t.UIEventConsts.ACTION_KONG,this._operateCard);break;case 4:t.RoomInfo.getInstance().host_mode||1==t.RoomInfo.getInstance().OutCard.eatSet.length?(t.CardInfo.getInstance().eatObj=t.RoomInfo.getInstance().OutCard.eatSet[0],this.dispatch(t.UIEventConsts.ACTION_CHOW)):this.createChowScene();break;case 5:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 6:this.dispatch(t.UIEventConsts.ACTION_CANCEL),this.removeAction();break;case 8:this.dispatchEventWith(t.UIEventConsts.ACTION_OPERATE,!1,n);break;case 9:this.dispatchEventWith(t.UIEventConsts.ACTION_OPERATE,!1,n);break;case 10:this.dispatchEventWith(t.UIEventConsts.ACTION_OPERATE,!1,n);break;case 11:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 12:this.dispatch(t.UIEventConsts.ACTION_WIN);break;case 13:this.dispatch(t.UIEventConsts.ACTION_WIN)}},i.prototype.startOver=function(){var e=t.ResUtil.createBitmapByName("heBg_png",350,0);this._overPanel.addChild(e),egret.Tween.get(e).to({y:180},800).call(this.bgDown,this,[e]);var i=t.ResUtil.createBitmapByName("liu",100,230);this._overPanel.addChild(i),egret.Tween.get(i).wait(300).to({x:490},800).call(this.bgDown,this,[i]);var n=t.ResUtil.createBitmapByName("ju",1e3,230);this._overPanel.addChild(n),egret.Tween.get(n).wait(300).to({x:690},800).call(this.bgDown,this,[n]),this.timer_100.start()},i.prototype.bgDown=function(t){egret.Tween.removeTweens(t)},i.prototype.countSecond=function(){this._second++,this._second>=20&&(uniLib.DisplayUtils.removeAllChildren(this._overPanel),this.timer_100.stop(),this._second=0)},i.prototype.createChowScene=function(){this.setActionVisible(!1),this._chowPanel||(this._chowPanel=new t.ChowCardsPanel),this._chowPanel.createChowPanel(),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW,this.onUserOpera,this),t.PopupManager.addPopUp(this._chowPanel,!1,!1)},i.prototype.createKongScene=function(){this.setActionVisible(!1),this._chowPanel||(this._chowPanel=new t.ChowCardsPanel),this._chowPanel.createKongPanel(t.CardInfo.getInstance().drawData.barSet),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.addEventListener(t.UIEventConsts.ACTION_BEGIN_KONG,this.onUserOpera,this),t.PopupManager.addPopUp(this._chowPanel,!1,!1)},i.prototype.onUserOpera=function(e){switch(e.type){case t.UIEventConsts.ACTION_STOP_CHOW:this.setActionVisible(!0);break;case t.UIEventConsts.ACTION_BEGIN_CHOW:this.dispatch(t.UIEventConsts.ACTION_CHOW);break;case t.UIEventConsts.ACTION_BEGIN_KONG:this.dispatch(t.UIEventConsts.ACTION_KONG,t.CardInfo.getInstance().kongThisId)}},i.prototype.removeChowPanel=function(){this._chowPanel&&(this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_STOP_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_CHOW,this.onUserOpera,this),this._chowPanel.hasEventListener(t.UIEventConsts.ACTION_BEGIN_KONG)&&this._chowPanel.removeEventListener(t.UIEventConsts.ACTION_BEGIN_KONG,this.onUserOpera,this),t.PopupManager.removePopUp(this._chowPanel),this._chowPanel.destory(),uniLib.DisplayUtils.removeAllChildren(this._chowPanel),uniLib.DisplayUtils.removeFromParent(this._chowPanel)),this._chowPanel=null,this.setActionVisible(!0)},i}(t.BaseVc);t.OperateVc=e,__reflect(e.prototype,"game.OperateVc")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._index=0,t}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this.removeGiftItems(),this._giftArr=null;var i;if(this._seatArr&&this._seatArr.length>0)for(var n=0;n<this._seatArr.length;n++)i=this._seatArr[n],i.destory();if(this._readyIconArr)for(var s=0;4>s;s++)t.ResUtil.removeFromParent(this._readyIconArr[s]);this.removeSeat(),this._seatMc=null,this._readyIconArr=null,this._seatArr=null,uniLib.Global.removeEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this)},i.prototype.initUI=function(){uniLib.Global.addEventListener(uniLib.ZqEvent.EVENT_L2G,this.diamondChange,this),this._seatMc=new egret.DisplayObjectContainer,this.addChild(this._seatMc),this._seatArr=[],this._readyIconArr=[];for(var e,i=[new egret.Point((uniLib.Global.screenWidth-1280)/2+590,t.ResUtil.changeYAxis(455)),new egret.Point((uniLib.Global.screenWidth-1280)/2+1050,255),new egret.Point((uniLib.Global.screenWidth-1280)/2+590,53),new egret.Point((uniLib.Global.screenWidth-1136)/2+128,275)],n=0;4>n;n++)e=t.ResUtil.createBitmapByName("readyIcon"),e.x=i[n].x,e.y=i[n].y,this.addChild(e),e.visible=!1,this._readyIconArr.push(e)},i.prototype.initSeat=function(){this.removeSeat();for(var e=t.RoomInfo.getInstance().userList,i=0;i<e.length;i++)this.addOnePlay(e[i])},i.prototype.refreshPlayerReady=function(t){if(t&&!(t.length<=0))for(var e=0;e<t.length;e++)this.showReady(t[e])},i.prototype.removeSeat=function(){for(var t,e=this._seatMc.numChildren,i=0;e>i;i++)t=this._seatMc.removeChildAt(0),t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showUseInfo,this),this._seatArr.push(t);this.resetReady()},i.prototype.removePlayer=function(t){var e;e=this._seatMc.getChildByName("seat"+t),e&&(this._readyIconArr[e.seatId].visible=!1,e&&e.parent&&(this._seatMc.removeChild(e),e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showUseInfo,this),this._seatArr.push(e)))},i.prototype.addOnePlay=function(e){this.removePlayer(e.uid);var i=t.RoomInfo.getInstance().getSeatNo(e.seatId);if(!isNaN(i)){var n;this._seatArr.length>0?(n=this._seatArr[0],this._seatArr.splice(0,1)):n=new t.SeatPlayer,n.name="seat"+e.uid,n.updateData(e),n.updateStatus(e.onlineState),n.seatId=i;var s=t.SeatPlayVc.seatPosArr[i];n.x=s.x,n.y=s.y,this._seatMc.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showUseInfo,this),e.bReady&&this.showReady(e.uid)}},Object.defineProperty(i,"seatPosArr",{get:function(){return[new egret.Point(20,410),new egret.Point(uniLib.Global.screenWidth-117,230),new egret.Point(954*t.GameConst.scaleFactor,11),new egret.Point(20,250)]},enumerable:!0,configurable:!0}),i.prototype.showUseInfo=function(e){var i=e.currentTarget;this.dispatchEventWith(t.UIEventConsts.SHOW_USER_INFO,!1,i.data.uid)},i.prototype.getPlayByUserId=function(t){var e=this._seatMc.getChildByName("seat"+t);return e},i.prototype.Timeout=function(e){this.pauseUid=e.uid;var i=this.getPlayByUserId(e.uid),n=t.RoomInfo.getInstance().getSeatNoByUserId(e.uid);0!=n&&i.playerPause(!0),this.stopTotalTime=e.sec?e.sec:0,this.stopTimeDiss||(this.stopTimeDiss=new uniLib.UniTimer(this,this.pauseTimerHandle,1e3,!0,this,i)),e.leftsec?(this.leftsec=e.leftsec,this._timeDiss||(this._timeDiss=new uniLib.UniTimer(this,this.timerHandle,1e3,!0,this,i)),i.changeLeftTime(!0,e.leftsec)):i.changeLeftTime(!1)},i.prototype.pauseTimerHandle=function(t){var e=++this.stopTotalTime;t.pauseOutTimeSec(Math.floor(e))},i.prototype.timerHandle=function(t){var e=--this.leftsec;e>0?t.changeLeftTime(!0,Math.floor(e)):(this.stopTimer(),t.changeLeftTime(!1))},i.prototype.stopTimer=function(){this._timeDiss&&(this._timeDiss.stop(),this._timeDiss=null),this.stopTimeDiss&&(this.stopTimeDiss.stop(),this.stopTimeDiss=null)},i.prototype.cancelTimeout=function(){if(this.pauseUid){var t=this._seatMc.getChildByName("seat"+this.pauseUid);t.playerPause(!1),this.stopTimer()}},i.prototype.addSeatPlayer=function(t){this.addOnePlay(t)},i.prototype.reset=function(){for(var t,e=this._seatMc.numChildren,i=0;e>i;i++)t=this._seatMc.getChildAt(i),t.reset()},i.prototype.updatePlayers=function(t){for(var e,i=0;i<t.length;i++)e=this.getPlayByUserId(t[i].uid),e.updataChips(t[i].points)},i.prototype.showGift=function(e){var i=this;this._giftArr=[];var n=t.RoomInfo.getInstance().getSeatNoByUserId(e.gift.fromUid),s=this.getPlayByUserId(e.gift.fromUid);if(s){var a=[];if(a=0==e.gift.toUid?t.RoomInfo.getInstance().getUidNotSendID(e.gift.fromUid):[e.gift.toUid],!(a.length<=0)){this._index=egret.setTimeout(function(){i.countTime()},null,2500);for(var o=0;o<a.length;o++)this.sendGift(e.gift.giftsId,a[o],n)}}},i.prototype.sendGift=function(e,i,n){var s,a,o;s=new t.GiftAnItem,s.giftId=e,o=t.RoomInfo.getInstance().getSeatNoByUserId(i),a=t.SeatPlayVc.seatPosArr[o],s.x=t.SeatPlayVc.seatPosArr[n].x+48,s.y=(t.SeatPlayVc.seatPosArr[n].y+46)*uniLib.ScreenUtils.scaleFactor,this._giftArr.push(s),t.GameInfo.topLayer.addChild(s),egret.Tween.get(s).to({x:a.x+48,y:(a.y+46)*uniLib.ScreenUtils.scaleFactor},400,egret.Ease.circOut).call(this.giftMoveEnd,this,[s])},i.prototype.countTime=function(){egret.clearTimeout(this._index),this.removeGiftItems(),this._index=0},i.prototype.removeGiftItems=function(){if(this._giftArr){for(var t=0;t<this._giftArr.length;t++){var e=this._giftArr[t];e&&(uniLib.DisplayUtils.removeFromParent(e),egret.Tween.removeTweens(e),e.destory())}this._giftArr=[]}},i.prototype.giftMoveEnd=function(t){egret.Tween.removeTweens(t),t.play()},i.prototype.showReady=function(e){var i=t.RoomInfo.getInstance().getSeatNoByUserId(e);isNaN(i)||t.RoomInfo.getInstance().isStart||(this._readyIconArr[i].visible=!0)},i.prototype.resetReady=function(){for(var t=0;4>t;t++)this._readyIconArr[t].visible=!1},i.prototype.updateStatus=function(t,e){var i=this.getPlayByUserId(t);i&&i.updateStatus(e)},i.prototype.floatPoint=function(t){var e=this.getPlayByUserId(t.uid);e&&e.floatClear(t.points)},i.prototype.diamondChange=function(e){if("diamondChange"==e.param&&t.RoomInfo.getInstance().getRoomType()>0){var i=void 0;i=this.getPlayByUserId(uniLib.UserInfo.uid),t.RoomInfo.getInstance().getUserVoByUid(uniLib.UserInfo.uid).setdiamond(uniLib.UserInfo.chips),t.RoomInfo.getInstance().playTypeList&&-1!=t.RoomInfo.getInstance().playTypeList.indexOf(95)&&i.updataChips(uniLib.UserInfo.goldChips)}},i.prototype.updateGoldChips=function(t){for(var e=t.chipsSet,i=0;i<e.length;i++){var n=this.getPlayByUserId(e[i].uid);n&&n.updataChips(e[i].remainder)}},i}(t.BaseVc);t.SeatPlayVc=e,__reflect(e.prototype,"game.SeatPlayVc")}(game||(game={}));var HNHZMahjiongMain=function(t){function e(e){var i=t.call(this,e)||this;return game.GameViewConfig.mainMediatorName=uniLib.getQualifiedClassName(game.HNHZGameMJMediator),i._gameInfo&&(game.DataCache.gameInfo=i._gameInfo),e&&e.destroyResOnExit&&(game.DataCache.destroyResOnExit=e.destroyResOnExit),i._gameInfo&&i._gameInfo.extData&&(game.DataCache.platParam=i._gameInfo.extData),i._gameInfo&&i._gameInfo.extData&&i._gameInfo.extData.video?(game.RoomInfo.getInstance().video=i._gameInfo.extData.video,game.RoomInfo.getInstance().videoUid=i._gameInfo.extData.videoUid):(game.RoomInfo.getInstance().video=0,game.RoomInfo.getInstance().videoUid=0),i}return __extends(e,t),e.prototype.start=function(t){void 0===t&&(t=null);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter);var i={};i.designWidth=1280,i.designHeight=720,i.debug=!0,i.scaleMode=egret.StageScaleMode.FIXED_HEIGHT,i.logLevel=0,uniLib.init(i),RES.setMaxLoadingThread(6),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/HNHZmahjong.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(t){this.preLoadEnd()},e.prototype.onResourceLoadComplete=function(t){},e.prototype.preLoadEnd=function(){if(uniLib.UIMgr.instance.showProcessBar(null,2,100,"正在加载游戏资源..."),uniLib.Global.lobbyMode)uniLib.ResLoadMgr.instance.load("HNZZRes",this.createGameScene,null,this,null);else{var t=[];t=["HNZZRes","gameCommon"],RES.createGroup("HNZZLoadAll",t),uniLib.ResLoadMgr.instance.load("HNZZLoadAll",this.createGameScene,null,this,null)}},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.createGameScene=function(){this._gameInfo&&(game.DataCache.gameInfo=this._gameInfo),this._gameInfo&&this._gameInfo.extData&&(game.DataCache.platParam=this._gameInfo.extData),game.DataCache.langObj=JSON.parse(RES.getRes("GameTxt_cn_txt")),game.GameInfo.manage=game.PublicManage.getInstance(),game.DataCache.stageWidth=uniLib.Global.screenWidth,game.DataCache.stageHight=uniLib.Global.screenHeight,uniLib.UIMgr.instance.hideLoading(),uniLib.SceneMgr.instance.changeScene(game.MJGameScene),game.PositionData.seatPosArr=[new egret.Point(40,400),new egret.Point(uniLib.Global.screenWidth-117,230),new egret.Point(954+(uniLib.Global.screenWidth-uniLib.Global.designWidth)/2,11),new egret.Point(40,250)]},e.prototype.resize=function(){this.scaleY=uniLib.Global.screenHeight/game.DataCache.defaultHeight,this.y=(uniLib.Global.screenHeight-game.DataCache.defaultHeight)/2},e}(uniLib.GameDoc);__reflect(HNHZMahjiongMain.prototype,"HNHZMahjiongMain");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);